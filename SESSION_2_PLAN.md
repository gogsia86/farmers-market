# Session 2: Code Cleanup Plan
**Farmers Market Platform - Continuation of Code Cleanup**

**Created**: 2025-01-XX
**Status**: PLANNING
**Previous**: Session 1 (commit 983fbbbf) - Removed dead code, consolidated validation/testing

---

## üìã Session 2 Objectives

### Primary Goals
1. **Clean up documentation chaos** - Remove/archive 30+ obsolete session docs
2. **Organize new test files** - Consolidate recent test additions
3. **Fix type issues in testing framework** - Remove `src/lib/testing/` from tsconfig excludes
4. **Standardize mock structure** - Organize `__mocks__/@/lib/` properly
5. **Update configurations** - Clean up modified configs (jest, package.json, schema)

---

## üóÇÔ∏è Tasks Breakdown

### Task 2.1: Documentation Cleanup ‚ö†Ô∏è HIGH PRIORITY
**Status**: PENDING
**Estimated Time**: 15 minutes

#### Files to DELETE (30 obsolete session docs):
```
ACCESSIBILITY_FIXES_SUMMARY.txt
API_SMOKE_TEST_RESULTS.md
BUILD_FIX_SUMMARY.txt
COMPLETION_STATUS.md
CONTINUE_NOW.md
CONTINUE_PHASE_2.md
CONTINUE_TASK_2.1.md
COVERAGE_BASELINE.md
CRITICAL_ACTIONS_REQUIRED.txt
DATABASE_CONNECTION_TEST_RESULTS.md
ENV_VARIABLE_AUDIT_RESULTS.md
EXECUTE_NOW.md
FINISH_THIS.md
IMMEDIATE_ACTIONS.md
INSPECTION_BOT_VISUAL_SUMMARY.txt
LETS_GO.md
MIGRATION_SUCCESS.txt
PHASE_1_COMPLETE.md
PHASE_1_TRACKER.md
PROJECT_REVIEW_SUMMARY.md
QUICK_REFERENCE.md
QUICK_REFERENCE.txt
README_PHASE_2.md
REDIS_CONNECTION_TEST_RESULTS.md
SEO_FIXES_SUMMARY.txt
SESSION_SUMMARY.md
START_TODAY.md
TASK_2.1_PROGRESS.md
TEST_RESULTS.md
analyze errors and give comprehensive fixes for github copilot cloude sonnete 4.5 for zed editor.txt
coverage-run.txt
site-status-report-1768221776412.json
test-results-with-redis.txt
```

#### Files to KEEP/ORGANIZE:
```
DOCUMENTATION_INDEX.md ‚Üí Move to docs/
PROJECT_STATUS_BANNER.txt ‚Üí Keep at root
START_HERE_NEXT_SESSION.md ‚Üí Keep at root
docs/SESSION-11-INTEGRATION-TEST-BREAKTHROUGH.md ‚Üí Keep
docs/SESSION-12-CONTINUED-PROGRESS.md ‚Üí Keep
docs/INTEGRATION-TESTING-QUICKSTART.md ‚Üí Keep
docs/TEST_DATABASE_SETUP.md ‚Üí Keep
docs/testing/ ‚Üí Keep entire directory
docs/test-progress/ ‚Üí Keep entire directory
```

#### Actions:
- [ ] Delete 33 obsolete session doc files
- [ ] Move `DOCUMENTATION_INDEX.md` to `docs/`
- [ ] Keep 2 root-level "start here" files
- [ ] Verify all `docs/` subdirectories are preserved
- [ ] Stage deletions and moves

---

### Task 2.2: Test File Organization
**Status**: PENDING
**Estimated Time**: 20 minutes

#### New Test Files to Review:
```
src/__tests__/helpers/test-helpers.debug.test.ts
src/__tests__/integration/__debug__.test.ts
src/__tests__/integration/__helpers-test__.test.ts
src/__tests__/integration/__simple-db-test__.test.ts
src/__tests__/integration/api/cart.api.integration.test.ts
src/__tests__/integration/api/orders.api.integration.test.ts
src/__tests__/integration/api/products.api.integration.test.ts
src/__tests__/unit/repositories/farm.repository.advanced.test.ts
src/__tests__/unit/repositories/product.repository.advanced.test.ts
src/__tests__/unit/services/cart.service.test.ts
src/__tests__/unit/services/order.service.advanced.test.ts
src/__tests__/unit/services/order.service.test.ts
src/__tests__/unit/services/product.service.advanced.test.ts
src/__tests__/unit/services/product.service.test.ts
src/__tests__/unit/utils/ (new directory)
```

#### Analysis Needed:
- [ ] Identify debug/temporary test files (prefix: `__debug__`, `__helpers-test__`)
- [ ] Check for duplicate test coverage
- [ ] Verify naming consistency (`*.test.ts` vs `*.advanced.test.ts`)
- [ ] Ensure proper placement (unit vs integration)
- [ ] Remove debug tests or move to examples

#### Decision Matrix:
| File Pattern | Action | Reason |
|--------------|--------|--------|
| `__debug__*.test.ts` | DELETE | Temporary debugging files |
| `__helpers-test__*.test.ts` | DELETE | Test scaffolding |
| `__simple-db-test__*.test.ts` | DELETE | Basic sanity check |
| `*.advanced.test.ts` | REVIEW | May be duplicates or extensions |
| `test-helpers.debug.test.ts` | DELETE | Debug helper test |
| `src/__tests__/unit/utils/` | KEEP | New utils tests |

---

### Task 2.3: Mock Structure Cleanup
**Status**: PENDING
**Estimated Time**: 15 minutes

#### New Mock Directories:
```
__mocks__/@/lib/database/
__mocks__/@/lib/services/
```

#### Actions:
- [ ] Review mock structure vs existing `src/__mocks__/`
- [ ] Determine if root-level `__mocks__/@/` is appropriate (Jest convention)
- [ ] Check for duplicate mocks
- [ ] Ensure mocks follow project patterns
- [ ] Verify mock usage in tests
- [ ] Document mock strategy if needed

#### Questions to Answer:
1. Are these auto-generated by Jest or manually created?
2. Do they conflict with existing mocks in `src/__mocks__/`?
3. Should they be in `src/__mocks__/@/lib/` instead?

---

### Task 2.4: Configuration File Review
**Status**: PENDING
**Estimated Time**: 20 minutes

#### Modified Configurations:
```
jest.config.cjs (modified)
jest.env.cjs (modified)
jest.integration.config.cjs (new)
jest.integration.setup.cjs (new)
next-env.d.ts (modified)
package-lock.json (modified)
package.json (modified)
prisma/schema.prisma (modified)
```

#### Review Checklist:
- [ ] `jest.config.cjs` - Review changes, ensure consistent with Session 1 ESLint fix
- [ ] `jest.env.cjs` - Verify environment setup
- [ ] `jest.integration.config.cjs` - New file, ensure proper structure
- [ ] `jest.integration.setup.cjs` - Already fixed in Session 1, verify clean
- [ ] `next-env.d.ts` - Check for unnecessary changes
- [ ] `package.json` - Review dependency changes
- [ ] `prisma/schema.prisma` - Review schema changes

#### Actions:
- [ ] Run `npm run type-check` to verify configs
- [ ] Run `npm run test` to verify Jest configs
- [ ] Stage and commit clean configs
- [ ] Document significant changes

---

### Task 2.5: Testing Framework Type Safety
**Status**: PENDING
**Estimated Time**: 30 minutes

#### Current Issue:
- `src/lib/testing/` is excluded in `tsconfig.json`
- This was noted in Session 1 as a follow-up task

#### Actions:
- [ ] Review type errors in `src/lib/testing/` directory
- [ ] Fix type errors (likely simple fixes)
- [ ] Remove `src/lib/testing/` from `tsconfig.json` exclude array
- [ ] Run `npm run type-check` to verify
- [ ] Ensure no new type errors introduced

#### Files in `src/lib/testing/`:
```
src/lib/testing/
‚îú‚îÄ‚îÄ react-test-utils.tsx (moved from test-utils.tsx in Session 1)
‚îî‚îÄ‚îÄ (other testing utilities)
```

---

### Task 2.6: Helper Files Consolidation
**Status**: PENDING
**Estimated Time**: 15 minutes

#### New Helper Files:
```
tests/helpers/integration-helpers.ts (new)
tests/helpers/api-test-helpers.ts (modified)
```

#### Actions:
- [ ] Review new `integration-helpers.ts`
- [ ] Check for duplication with existing helpers
- [ ] Verify proper exports and usage
- [ ] Ensure consistent naming and structure
- [ ] Document helper usage patterns

---

## üéØ Success Criteria

### Session 2 Complete When:
- [ ] All 33 obsolete session docs deleted
- [ ] Documentation organized in `docs/` structure
- [ ] Debug/temporary test files removed
- [ ] Test file naming and structure consistent
- [ ] Mock structure clarified and documented
- [ ] All configuration files reviewed and clean
- [ ] `src/lib/testing/` type-checked (not excluded)
- [ ] Helper files consolidated and documented
- [ ] `npm run lint` passes (0 errors)
- [ ] `npm run type-check` passes
- [ ] `npm run build` succeeds
- [ ] All changes staged and committed

---

## ‚ö†Ô∏è Safety Checks

### Before Deleting Files:
1. Search for references in codebase: `git grep "filename"`
2. Check git history: `git log --all -- path/to/file`
3. Verify not imported/required anywhere

### Before Moving Files:
1. Update all import paths
2. Run `npm run type-check`
3. Search for string references

### Before Committing:
1. Review `git diff --cached`
2. Run full test suite
3. Verify build succeeds

---

## üìù Commit Strategy

### Commit 1: Documentation Cleanup
```
chore: Session 2.1 - Remove obsolete session documentation

- Delete 33 outdated session tracking files
- Move DOCUMENTATION_INDEX.md to docs/
- Preserve recent session docs (11, 12)
- Keep start-here guides at root
```

### Commit 2: Test Organization
```
chore: Session 2.2 - Organize and clean test files

- Remove debug/temporary test files
- Consolidate duplicate tests
- Ensure consistent naming patterns
- Document test structure
```

### Commit 3: Mock and Config Cleanup
```
chore: Session 2.3 - Clean up mocks and configurations

- Organize mock structure
- Review and validate Jest configs
- Update package.json/schema changes
- Ensure type safety
```

### Commit 4: Type Safety Improvements
```
chore: Session 2.4 - Enable type checking for testing framework

- Fix type errors in src/lib/testing/
- Remove testing directory from tsconfig excludes
- Consolidate helper files
- All checks passing
```

---

## üîÑ Rollback Plan

If Session 2 introduces issues:

1. **Individual file recovery**:
   ```bash
   git checkout HEAD~1 -- path/to/file
   ```

2. **Full session revert**:
   ```bash
   git revert <commit-hash>
   ```

3. **Reset to Session 1 complete**:
   ```bash
   git reset --hard 983fbbbf
   ```

---

## üìä Estimated Timeline

| Task | Time | Priority |
|------|------|----------|
| 2.1 Documentation Cleanup | 15 min | HIGH |
| 2.2 Test Organization | 20 min | MEDIUM |
| 2.3 Mock & Config Cleanup | 15 min | MEDIUM |
| 2.4 Type Safety | 30 min | HIGH |
| 2.5 Helper Consolidation | 15 min | LOW |
| **Total** | **~95 min** | |

---

## ‚úÖ Next Steps

1. Review and approve this plan
2. Execute Task 2.1 (Documentation Cleanup)
3. Execute remaining tasks sequentially
4. Create Session 2 summary document
5. Push commits to remote

---

**Ready to proceed?** Start with Task 2.1: Documentation Cleanup