generator client {
  provider      = "prisma-client-js"
  binaryTargets = ["native"]
}

datasource db {
  provider     = "postgresql"
  url          = env("DATABASE_URL")
  relationMode = "foreignKeys"
}

model User {
  id                        String                     @id @default(cuid())
  email                     String                     @unique @db.VarChar(255)
  password                  String?                    @db.VarChar(255)
  firstName                 String?                    @db.VarChar(100)
  lastName                  String?                    @db.VarChar(100)
  name                      String?                    @db.VarChar(255)
  phone                     String?                    @db.VarChar(20)
  avatar                    String?                    @db.VarChar(500)
  role                      UserRole                   @default(CONSUMER)
  status                    UserStatus                 @default(ACTIVE)
  approvedBy                String?
  approvedAt                DateTime?
  suspendedBy               String?
  suspendedAt               DateTime?
  suspensionReason          String?
  emailVerified             Boolean                    @default(false)
  emailVerifiedAt           DateTime?
  phoneVerified             Boolean                    @default(false)
  phoneVerifiedAt           DateTime?
  verificationToken         String?                    @unique @db.VarChar(255)
  verificationExpiry        DateTime?
  resetToken                String?                    @unique @db.VarChar(255)
  resetTokenExpiry          DateTime?
  dietaryPreferences        Json?
  notificationPreferences   Json?
  privacySettings           Json?
  lastLoginAt               DateTime?
  lastLoginIP               String?                    @db.VarChar(45)
  loginCount                Int                        @default(0)
  createdAt                 DateTime                   @default(now())
  updatedAt                 DateTime                   @updatedAt
  accounts                  Account[]
  Address                   Address[]
  adminActions              AdminAction[]              @relation("AdminActions")
  aiUsageLogs               AIUsageLog[]
  aiUsageQuota              AIUsageQuota?
  auditLogs                 AuditLog[]
  cartItems                 CartItem[]
  chatThreads               ChatThread[]
  deviceTokens              DeviceToken[]
  downloadLogs              DownloadLog[]
  emailLogs                 EmailLog[]
  emailPreferences          EmailPreferences?
  teamMemberships           FarmTeamMember[]
  farms                     Farm[]
  favorites                 Favorite[]
  messages                  Message[]                  @relation("MessageSender")
  notificationSettings      NotificationPreferences?
  notificationPreferencesV2 NotificationPreferencesV2?
  notifications             Notification[]
  orders                    Order[]
  pushNotificationLogs      PushNotificationLog[]
  qualityIssues             QualityIssue[]
  reviews                   Review[]
  savedSearchFolders        SavedSearchFolder[]
  savedSearches             SavedSearch[]
  sessions                  Session[]
  smsLogs                   SMSLog[]
  supportTickets            SupportTicket[]
  addresses                 UserAddress[]
  userPreference            UserPreference?
  userSettings              UserSettings?

  @@index([email])
  @@index([role, status])
  @@index([createdAt])
  @@map("users")
}

model Session {
  id           String   @id @default(cuid())
  userId       String
  sessionToken String   @unique @db.VarChar(255)
  accessToken  String?
  refreshToken String?
  expiresAt    DateTime
  createdAt    DateTime @default(now())
  updatedAt    DateTime @updatedAt
  user         User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId])
  @@map("sessions")
}

model AIUsageLog {
  id               String   @id @default(cuid())
  userId           String
  endpoint         String   @db.VarChar(100)
  model            String   @db.VarChar(50)
  tokensUsed       Int
  costUSD          Decimal  @db.Decimal(10, 6)
  requestId        String   @unique @db.VarChar(100)
  requestData      Json?
  responseData     Json?
  confidence       Decimal? @db.Decimal(3, 2)
  processingTimeMs Int
  success          Boolean  @default(true)
  errorCode        String?  @db.VarChar(50)
  errorMessage     String?
  createdAt        DateTime @default(now())
  user             User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId, createdAt])
  @@index([endpoint, createdAt])
  @@index([success, createdAt])
  @@index([requestId])
  @@map("ai_usage_logs")
}

model AIUsageQuota {
  id                       String   @id @default(cuid())
  userId                   String   @unique
  monthlyTokenLimit        Int      @default(100000)
  monthlyTokenUsed         Int      @default(0)
  monthlyCostLimit         Decimal  @default(50.00) @db.Decimal(10, 2)
  monthlyCostUsed          Decimal  @default(0.00) @db.Decimal(10, 2)
  productDescriptionHourly Int      @default(50)
  pricingHourly            Int      @default(100)
  advisorHourly            Int      @default(30)
  pestIdentifyHourly       Int      @default(20)
  periodStart              DateTime @default(now())
  periodEnd                DateTime
  createdAt                DateTime @default(now())
  updatedAt                DateTime @updatedAt
  user                     User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId])
  @@index([periodEnd])
  @@map("ai_usage_quotas")
}

model Account {
  id                String    @id @default(cuid())
  userId            String
  provider          String    @db.VarChar(50)
  providerAccountId String    @db.VarChar(255)
  refreshToken      String?
  accessToken       String?
  expiresAt         DateTime?
  tokenType         String?   @db.VarChar(50)
  scope             String?   @db.VarChar(255)
  idToken           String?
  sessionState      String?   @db.VarChar(255)
  createdAt         DateTime  @default(now())
  updatedAt         DateTime  @updatedAt
  user              User      @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([provider, providerAccountId])
  @@index([userId])
  @@map("accounts")
}

model UserAddress {
  id        String      @id @default(cuid())
  userId    String
  type      AddressType @default(HOME)
  label     String?     @db.VarChar(100)
  street    String      @db.VarChar(255)
  street2   String?     @db.VarChar(255)
  city      String      @db.VarChar(100)
  state     String      @db.VarChar(50)
  zipCode   String      @db.VarChar(20)
  country   String      @default("US") @db.VarChar(2)
  latitude  Decimal?    @db.Decimal(10, 8)
  longitude Decimal?    @db.Decimal(11, 8)
  isDefault Boolean     @default(false)
  createdAt DateTime    @default(now())
  updatedAt DateTime    @updatedAt
  orders    Order[]     @relation("DeliveryAddress")
  user      User        @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId])
  @@index([zipCode])
  @@map("user_addresses")
}

model AdminAction {
  id          String          @id @default(cuid())
  type        AdminActionType
  adminId     String
  targetId    String?
  targetType  String?         @db.VarChar(50)
  description String
  metadata    Json?
  ipAddress   String?         @db.VarChar(45)
  userAgent   String?         @db.VarChar(500)
  createdAt   DateTime        @default(now())
  admin       User            @relation("AdminActions", fields: [adminId], references: [id])

  @@index([adminId])
  @@index([type])
  @@index([createdAt])
  @@index([targetId, targetType])
  @@map("admin_actions")
}

model Farm {
  id                         String                 @id @default(cuid())
  name                       String                 @db.VarChar(255)
  slug                       String                 @unique @db.VarChar(255)
  description                String?
  story                      String?
  status                     FarmStatus             @default(PENDING)
  verificationStatus         FarmVerificationStatus @default(PENDING)
  verifiedBy                 String?
  verifiedAt                 DateTime?
  rejectionReason            String?
  ownerId                    String
  email                      String                 @db.VarChar(255)
  phone                      String                 @db.VarChar(20)
  website                    String?                @db.VarChar(500)
  address                    String                 @db.VarChar(255)
  city                       String                 @db.VarChar(100)
  state                      String                 @db.VarChar(50)
  zipCode                    String                 @db.VarChar(20)
  country                    String                 @default("US") @db.VarChar(2)
  latitude                   Decimal                @db.Decimal(10, 8)
  longitude                  Decimal                @db.Decimal(11, 8)
  location                   Json?
  images                     String[]
  logoUrl                    String?                @db.VarChar(500)
  bannerUrl                  String?                @db.VarChar(500)
  businessName               String?                @db.VarChar(255)
  taxId                      String?                @db.VarChar(50)
  businessType               String?                @db.VarChar(50)
  yearEstablished            Int?
  farmSize                   Decimal?               @db.Decimal(10, 2)
  hardinessZone              Int?
  soilType                   String?
  waterAvailability          String?
  sunExposure                String?
  equipmentAvailable         String[]
  laborCapacityHours         Int?
  budgetPerAcre              Decimal?               @db.Decimal(10, 2)
  isOrganic                  Boolean                @default(false)
  isBiodynamic               Boolean                @default(false)
  followsLunarCalendar       Boolean                @default(false)
  usesBiodynamicPreparations Boolean                @default(false)
  practicesCropRotation      Boolean                @default(false)
  maintainsBiodiversity      Boolean                @default(false)
  compostsOnSite             Boolean                @default(false)
  avoidsSyntheticChemicals   Boolean                @default(false)
  integratesLivestock        Boolean                @default(false)
  previousCrops              Json?
  certificationsArray        String[]
  stripeAccountId            String?                @unique @db.VarChar(255)
  stripeOnboarded            Boolean                @default(false)
  stripeOnboardedAt          DateTime?
  payoutsEnabled             Boolean                @default(false)
  stripeDetailsSubmitted     Boolean                @default(false)
  payoutSchedule             Json?
  productCategories          Json?
  farmingPractices           Json?
  deliveryRadius             Int?                   @default(25)
  profileViewsCount          Int                    @default(0)
  totalOrdersCount           Int                    @default(0)
  totalRevenueUSD            Decimal                @default(0) @db.Decimal(12, 2)
  averageRating              Decimal?               @db.Decimal(3, 2)
  reviewCount                Int                    @default(0)
  createdAt                  DateTime               @default(now())
  updatedAt                  DateTime               @updatedAt
  biodynamicCalendar         BiodynamicCalendar[]
  chatThreads                ChatThread[]
  cropRotations              CropRotation[]
  DeliverySlot               DeliverySlot[]
  DeliveryZone               DeliveryZone[]
  certifications             FarmCertification[]
  photos                     FarmPhoto[]
  FarmRating                 FarmRating?
  farmSettings               FarmSettings?
  teamMembers                FarmTeamMember[]
  owner                      User                   @relation(fields: [ownerId], references: [id])
  favorites                  Favorite[]
  harvestRecords             HarvestRecord[]
  harvestSchedules           HarvestSchedule[]
  Inventory                  Inventory[]
  marketLocations            MarketLocation[]
  messages                   Message[]
  notifications              Notification[]
  orders                     Order[]
  payouts                    Payout[]
  PickupLocation             PickupLocation[]
  products                   Product[]
  qualityIssues              QualityIssue[]
  reviews                    Review[]
  soilAnalyses               SoilAnalysis[]
  weatherData                WeatherData[]
  yieldPredictions           YieldPrediction[]

  @@index([ownerId])
  @@index([slug])
  @@index([status])
  @@index([latitude, longitude])
  @@index([createdAt])
  @@index([status, verificationStatus])
  @@index([verificationStatus])
  @@index([stripeOnboarded])
  @@index([averageRating])
  @@index([totalRevenueUSD])
  @@index([hardinessZone])
  @@index([isOrganic])
  @@index([isBiodynamic])
  @@index([soilType])
  @@map("farms")
}

model Crop {
  id                     String            @id @default(cuid())
  name                   String            @db.VarChar(100)
  scientificName         String?           @db.VarChar(200)
  commonNames            String[]
  category               ProductCategory
  cropType               String            @db.VarChar(50)
  cropFamily             CropFamily
  hardinessZones         Int[]
  soilPreferences        String[]
  waterRequirements      String            @db.VarChar(20)
  sunRequirements        String            @db.VarChar(20)
  phRange                Json?
  daysToMaturity         Json
  plantingDepth          Decimal?          @db.Decimal(5, 2)
  spacing                Json?
  growingSeasons         Season[]
  averageYieldPerAcre    Decimal           @db.Decimal(10, 2)
  yieldUnit              String            @db.VarChar(20)
  marketPricePerLb       Decimal?          @db.Decimal(10, 2)
  organicPremium         Decimal?          @default(1.3) @db.Decimal(3, 2)
  inputCostPerAcre       Decimal           @db.Decimal(10, 2)
  laborHoursPerAcre      Decimal           @db.Decimal(8, 2)
  storageLife            Int?
  priceVolatility        Decimal?          @default(0.2) @db.Decimal(3, 2)
  peakSeason             String?           @db.VarChar(50)
  companionPlants        String[]
  antagonistPlants       String[]
  commonPests            String[]
  commonDiseases         String[]
  nutritionalInfo        Json?
  lunarPlantingPhases    String[]
  biodynamicPreparations String[]
  imageUrl               String?           @db.VarChar(500)
  thumbnailUrl           String?           @db.VarChar(500)
  description            String?
  growingTips            String?
  harvestingTips         String?
  storageTips            String?
  isActive               Boolean           @default(true)
  isFeatured             Boolean           @default(false)
  createdAt              DateTime          @default(now())
  updatedAt              DateTime          @updatedAt
  marketData             CropMarketData[]
  cropRotations          CropRotation[]
  harvestRecords         HarvestRecord[]
  harvestSchedules       HarvestSchedule[]
  yieldPredictions       YieldPrediction[]

  @@index([category])
  @@index([cropFamily])
  @@index([isActive])
  @@index([isFeatured])
  @@index([name])
  @@map("crops")
}

model CropMarketData {
  id                  String   @id @default(cuid())
  cropId              String
  region              String   @db.VarChar(100)
  averagePrice        Decimal  @db.Decimal(10, 2)
  priceUnit           String   @db.VarChar(20)
  demandIndex         Decimal  @db.Decimal(5, 2)
  supplyIndex         Decimal  @db.Decimal(5, 2)
  competitionLevel    String   @db.VarChar(20)
  trendDirection      String   @db.VarChar(20)
  seasonalPriceFactor Decimal  @default(1.0) @db.Decimal(3, 2)
  source              String?  @db.VarChar(100)
  dataDate            DateTime @default(now())
  createdAt           DateTime @default(now())
  updatedAt           DateTime @updatedAt
  crop                Crop     @relation(fields: [cropId], references: [id], onDelete: Cascade)

  @@index([cropId])
  @@index([region])
  @@index([dataDate])
  @@map("crop_market_data")
}

model YieldPrediction {
  id                   String          @id @default(cuid())
  cropId               String
  farmId               String
  plantingDate         DateTime
  predictedHarvestDate DateTime
  predictedYield       Decimal         @db.Decimal(10, 2)
  yieldUnit            String          @db.VarChar(20)
  confidence           Decimal         @db.Decimal(3, 2)
  weatherScore         Decimal?        @db.Decimal(3, 2)
  soilScore            Decimal?        @db.Decimal(3, 2)
  biodynamicScore      Decimal?        @db.Decimal(3, 2)
  historicalScore      Decimal?        @db.Decimal(3, 2)
  actualHarvestDate    DateTime?
  actualYield          Decimal?        @db.Decimal(10, 2)
  harvestQuality       HarvestQuality?
  notes                String?
  createdAt            DateTime        @default(now())
  updatedAt            DateTime        @updatedAt
  harvestRecords       HarvestRecord[]
  crop                 Crop            @relation(fields: [cropId], references: [id], onDelete: Cascade)
  farm                 Farm            @relation(fields: [farmId], references: [id], onDelete: Cascade)

  @@index([cropId])
  @@index([farmId])
  @@index([plantingDate])
  @@map("yield_predictions")
}

model HarvestRecord {
  id               String           @id @default(cuid())
  farmId           String
  cropId           String
  scheduleId       String?
  predictionId     String?
  harvestDate      DateTime
  fieldName        String           @db.VarChar(255)
  fieldSize        Decimal?         @db.Decimal(10, 2)
  fieldSizeUnit    String?          @db.VarChar(20)
  totalYield       Decimal          @db.Decimal(10, 2)
  yieldUnit        String           @db.VarChar(20)
  yieldPerArea     Decimal?         @db.Decimal(10, 2)
  quality          HarvestQuality
  gradeSplit       Json?
  laborHours       Decimal?         @db.Decimal(6, 2)
  laborCost        Decimal?         @db.Decimal(10, 2)
  equipmentUsed    String[]
  totalCost        Decimal?         @db.Decimal(10, 2)
  marketValue      Decimal?         @db.Decimal(10, 2)
  temperature      Decimal?         @db.Decimal(4, 1)
  humidity         Decimal?         @db.Decimal(3, 0)
  rainfall7Days    Decimal?         @db.Decimal(5, 2)
  lunarPhase       LunarPhase?
  season           Season
  diseasePresent   Boolean          @default(false)
  diseaseName      String?          @db.VarChar(255)
  pestDamage       Boolean          @default(false)
  pestName         String?          @db.VarChar(255)
  plantHealthScore Int?
  soilMoisture     Decimal?         @db.Decimal(3, 0)
  soilPH           Decimal?         @db.Decimal(3, 1)
  soilNitrogen     Decimal?         @db.Decimal(5, 2)
  soilPhosphorus   Decimal?         @db.Decimal(5, 2)
  soilPotassium    Decimal?         @db.Decimal(5, 2)
  notes            String?
  challenges       String[]
  successes        String[]
  lessonsLearned   String?
  photos           String[]
  documents        String[]
  recordedBy       String?
  verifiedBy       String?
  verifiedAt       DateTime?
  createdAt        DateTime         @default(now())
  updatedAt        DateTime         @updatedAt
  crop             Crop             @relation(fields: [cropId], references: [id], onDelete: Cascade)
  farm             Farm             @relation(fields: [farmId], references: [id], onDelete: Cascade)
  prediction       YieldPrediction? @relation(fields: [predictionId], references: [id])
  schedule         HarvestSchedule? @relation(fields: [scheduleId], references: [id])

  @@index([farmId])
  @@index([cropId])
  @@index([harvestDate])
  @@index([quality])
  @@index([season])
  @@map("harvest_records")
}

model MLTrainingData {
  id                  String   @id @default(cuid())
  harvestRecordId     String   @unique
  avgTemperature      Decimal  @db.Decimal(5, 4)
  totalRainfall       Decimal  @db.Decimal(5, 4)
  avgHumidity         Decimal  @db.Decimal(5, 4)
  growingDegreeDays   Decimal  @db.Decimal(5, 4)
  frostDays           Int      @default(0)
  soilQualityScore    Decimal  @db.Decimal(5, 4)
  soilNitrogenLevel   Decimal  @db.Decimal(5, 4)
  soilPhosphorusLevel Decimal  @db.Decimal(5, 4)
  soilPotassiumLevel  Decimal  @db.Decimal(5, 4)
  soilPHLevel         Decimal  @db.Decimal(5, 4)
  soilMoistureAvg     Decimal  @db.Decimal(5, 4)
  lunarPhaseScore     Decimal  @db.Decimal(5, 4)
  seasonalAlignment   Decimal  @db.Decimal(5, 4)
  plantingTiming      Decimal  @db.Decimal(5, 4)
  cropType            String   @db.VarChar(100)
  cropFamily          String   @db.VarChar(100)
  daysToMaturity      Int
  companionPlants     Int      @default(0)
  farmSize            Decimal  @db.Decimal(5, 4)
  farmerExperience    Int
  organicCertified    Boolean
  irrigationMethod    String   @db.VarChar(50)
  yieldPerArea        Decimal  @db.Decimal(10, 4)
  qualityScore        Decimal  @db.Decimal(5, 4)
  trainingSetVersion  String   @db.VarChar(20)
  usedInTraining      Boolean  @default(false)
  validationSet       Boolean  @default(false)
  outlier             Boolean  @default(false)
  createdAt           DateTime @default(now())
  updatedAt           DateTime @updatedAt

  @@index([trainingSetVersion])
  @@index([usedInTraining])
  @@map("ml_training_data")
}

model MLModel {
  id                  String         @id @default(cuid())
  modelName           String         @db.VarChar(100)
  version             String         @db.VarChar(20)
  algorithm           String         @db.VarChar(50)
  trainingDataSize    Int
  validationDataSize  Int
  trainingAccuracy    Decimal        @db.Decimal(5, 4)
  validationAccuracy  Decimal        @db.Decimal(5, 4)
  meanAbsoluteError   Decimal        @db.Decimal(10, 4)
  rootMeanSquareError Decimal        @db.Decimal(10, 4)
  r2Score             Decimal        @db.Decimal(5, 4)
  hyperparameters     Json
  featureImportance   Json
  modelPath           String?        @db.VarChar(500)
  modelSize           Int?
  status              MLModelStatus  @default(TRAINING)
  deployedAt          DateTime?
  deprecatedAt        DateTime?
  trainedBy           String?
  notes               String?
  createdAt           DateTime       @default(now())
  updatedAt           DateTime       @updatedAt
  predictions         MLPrediction[]

  @@unique([modelName, version])
  @@index([status])
  @@map("ml_models")
}

model MLPrediction {
  id                 String          @id @default(cuid())
  modelId            String
  farmId             String
  cropId             String
  inputFeatures      Json
  predictedYield     Decimal         @db.Decimal(10, 2)
  predictedQuality   HarvestQuality
  confidence         Decimal         @db.Decimal(3, 2)
  confidenceInterval Json
  actualYield        Decimal?        @db.Decimal(10, 2)
  actualQuality      HarvestQuality?
  predictionError    Decimal?        @db.Decimal(10, 2)
  predictionDate     DateTime        @default(now())
  harvestDate        DateTime?
  validated          Boolean         @default(false)
  validatedAt        DateTime?
  createdAt          DateTime        @default(now())
  updatedAt          DateTime        @updatedAt
  model              MLModel         @relation(fields: [modelId], references: [id])

  @@index([modelId])
  @@index([farmId])
  @@index([predictionDate])
  @@map("ml_predictions")
}

model FarmTeamMember {
  id        String           @id @default(cuid())
  farmId    String
  email     String           @db.VarChar(255)
  userId    String?
  role      TeamMemberRole   @default(STAFF)
  status    TeamMemberStatus @default(INVITED)
  invitedAt DateTime         @default(now())
  invitedBy String
  joinedAt  DateTime?
  removedAt DateTime?
  removedBy String?
  farm      Farm             @relation(fields: [farmId], references: [id], onDelete: Cascade)
  user      User?            @relation(fields: [userId], references: [id])

  @@unique([farmId, email])
  @@index([farmId])
  @@index([userId])
  @@map("farm_team_members")
}

model FarmPhoto {
  id           String   @id @default(cuid())
  farmId       String
  photoUrl     String   @db.VarChar(500)
  thumbnailUrl String   @db.VarChar(500)
  caption      String?  @db.VarChar(255)
  altText      String?  @db.VarChar(255)
  sortOrder    Int      @default(0)
  isPrimary    Boolean  @default(false)
  width        Int?
  height       Int?
  fileSize     Int?
  createdAt    DateTime @default(now())
  farm         Farm     @relation(fields: [farmId], references: [id], onDelete: Cascade)

  @@index([farmId])
  @@index([isPrimary])
  @@map("farm_photos")
}

model FarmCertification {
  id                  String              @id @default(cuid())
  farmId              String
  type                CertificationType
  certifierName       String              @db.VarChar(255)
  certificationNumber String?             @db.VarChar(100)
  documentUrl         String?             @db.VarChar(500)
  issueDate           DateTime
  expirationDate      DateTime?
  status              CertificationStatus @default(PENDING)
  notes               String?
  verifiedBy          String?
  verifiedAt          DateTime?
  createdAt           DateTime            @default(now())
  updatedAt           DateTime            @updatedAt
  farm                Farm                @relation(fields: [farmId], references: [id], onDelete: Cascade)

  @@index([farmId])
  @@index([type])
  @@index([status])
  @@index([expirationDate])
  @@map("farm_certifications")
}

model MarketLocation {
  id          String   @id @default(cuid())
  farmId      String
  marketName  String   @db.VarChar(255)
  boothNumber String?  @db.VarChar(50)
  address     String   @db.VarChar(255)
  city        String   @db.VarChar(100)
  state       String   @db.VarChar(50)
  zipCode     String   @db.VarChar(20)
  latitude    Decimal  @db.Decimal(10, 8)
  longitude   Decimal  @db.Decimal(11, 8)
  schedule    Json
  isActive    Boolean  @default(true)
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
  farm        Farm     @relation(fields: [farmId], references: [id], onDelete: Cascade)

  @@index([farmId])
  @@map("market_locations")
}

model BiodynamicCalendar {
  id                        String     @id @default(cuid())
  farmId                    String
  lunarPhase                LunarPhase
  lunarDay                  Int
  moonRiseTime              DateTime?
  moonSetTime               DateTime?
  season                    Season
  astronomicalDate          DateTime
  plantingFavorability      Int        @default(0)
  harvestFavorability       Int        @default(0)
  soilWorkFavorability      Int        @default(0)
  planetaryAlignment        Json?
  recommendedActivities     String[]
  avoidActivities           String[]
  agriculturalConsciousness Decimal    @default(0.0) @db.Decimal(3, 2)
  createdAt                 DateTime   @default(now())
  updatedAt                 DateTime   @updatedAt
  farm                      Farm       @relation(fields: [farmId], references: [id], onDelete: Cascade)

  @@unique([farmId, astronomicalDate])
  @@index([farmId])
  @@index([season])
  @@index([lunarPhase])
  @@map("biodynamic_calendar")
}

model SoilAnalysis {
  id                String          @id @default(cuid())
  farmId            String
  fieldName         String          @db.VarChar(255)
  latitude          Decimal         @db.Decimal(10, 8)
  longitude         Decimal         @db.Decimal(11, 8)
  pH                Decimal         @db.Decimal(4, 2)
  nitrogen          Decimal         @db.Decimal(5, 2)
  phosphorus        Decimal         @db.Decimal(5, 2)
  potassium         Decimal         @db.Decimal(5, 2)
  organicMatter     Decimal         @db.Decimal(5, 2)
  soilType          SoilType
  drainage          DrainageLevel
  compaction        CompactionLevel
  microbialActivity Decimal         @default(0.0) @db.Decimal(3, 2)
  earthwormCount    Int?
  fungalPresence    Decimal?        @db.Decimal(3, 2)
  previousCrops     Json?
  soilHistory       Json?
  amendments        String[]
  recommendedCrops  String[]
  analyzedBy        String?         @db.VarChar(255)
  analysisDate      DateTime        @default(now())
  nextAnalysisDate  DateTime?
  createdAt         DateTime        @default(now())
  updatedAt         DateTime        @updatedAt
  farm              Farm            @relation(fields: [farmId], references: [id], onDelete: Cascade)

  @@index([farmId])
  @@index([fieldName])
  @@index([analysisDate])
  @@map("soil_analyses")
}

model WeatherData {
  id                 String           @id @default(cuid())
  farmId             String
  recordedAt         DateTime         @default(now())
  latitude           Decimal          @db.Decimal(10, 8)
  longitude          Decimal          @db.Decimal(11, 8)
  temperature        Decimal          @db.Decimal(5, 2)
  feelsLike          Decimal?         @db.Decimal(5, 2)
  tempMin            Decimal?         @db.Decimal(5, 2)
  tempMax            Decimal?         @db.Decimal(5, 2)
  humidity           Int
  precipitation      Decimal?         @db.Decimal(6, 2)
  precipitationProb  Int?
  windSpeed          Decimal?         @db.Decimal(5, 2)
  windDirection      Int?
  condition          WeatherCondition
  cloudCover         Int?
  uvIndex            Int?
  visibility         Decimal?         @db.Decimal(5, 2)
  growingDegreeDay   Decimal?         @db.Decimal(5, 2)
  evapotranspiration Decimal?         @db.Decimal(5, 2)
  soilMoisture       Decimal?         @db.Decimal(3, 2)
  frostRisk          Boolean          @default(false)
  heatStressRisk     Boolean          @default(false)
  source             String           @default("API") @db.VarChar(50)
  createdAt          DateTime         @default(now())
  farm               Farm             @relation(fields: [farmId], references: [id], onDelete: Cascade)

  @@index([farmId])
  @@index([recordedAt])
  @@map("weather_data")
}

model CropRotation {
  id                  String     @id @default(cuid())
  farmId              String
  cropId              String?
  fieldName           String     @db.VarChar(255)
  rotationCycle       Int
  currentYear         Int
  currentCrop         String     @db.VarChar(100)
  currentCropFamily   CropFamily
  plantedAt           DateTime
  expectedHarvest     DateTime?
  cropHistory         Json
  plannedRotations    Json
  coverCropPlanned    Boolean    @default(false)
  coverCropType       String?    @db.VarChar(100)
  restPeriod          Boolean    @default(false)
  followsBiodynamic   Boolean    @default(false)
  biodynamicScore     Decimal    @default(0.0) @db.Decimal(3, 2)
  nextRecommendedCrop String?    @db.VarChar(100)
  soilBenefits        String[]
  createdAt           DateTime   @default(now())
  updatedAt           DateTime   @updatedAt
  crop                Crop?      @relation(fields: [cropId], references: [id])
  farm                Farm       @relation(fields: [farmId], references: [id], onDelete: Cascade)

  @@unique([farmId, fieldName])
  @@index([farmId])
  @@index([cropId])
  @@index([currentCropFamily])
  @@map("crop_rotations")
}

model HarvestSchedule {
  id                   String          @id @default(cuid())
  farmId               String
  productId            String?
  cropId               String?
  cropName             String          @db.VarChar(255)
  cropVariety          String?         @db.VarChar(255)
  fieldName            String          @db.VarChar(255)
  plantedAt            DateTime
  plantedQuantity      Decimal?        @db.Decimal(10, 2)
  plantedUnit          String?         @db.VarChar(50)
  expectedHarvestStart DateTime
  expectedHarvestEnd   DateTime?
  actualHarvestStart   DateTime?
  actualHarvestEnd     DateTime?
  harvestConfidence    Decimal         @default(0.5) @db.Decimal(3, 2)
  predictedYield       Decimal?        @db.Decimal(10, 2)
  predictedYieldUnit   String?         @db.VarChar(50)
  actualYield          Decimal?        @db.Decimal(10, 2)
  actualYieldUnit      String?         @db.VarChar(50)
  harvestQuality       HarvestQuality?
  optimalLunarPhase    LunarPhase?
  seasonalAlignment    Season
  biodynamicTiming     Boolean         @default(false)
  estimatedLaborHours  Decimal?        @db.Decimal(6, 2)
  actualLaborHours     Decimal?        @db.Decimal(6, 2)
  laborersNeeded       Int?
  status               HarvestStatus   @default(PLANNED)
  notes                String?
  challenges           String[]
  successes            String[]
  createdAt            DateTime        @default(now())
  updatedAt            DateTime        @updatedAt
  harvestRecords       HarvestRecord[]
  crop                 Crop?           @relation(fields: [cropId], references: [id])
  farm                 Farm            @relation(fields: [farmId], references: [id], onDelete: Cascade)
  product              Product?        @relation(fields: [productId], references: [id])

  @@index([farmId])
  @@index([productId])
  @@index([cropId])
  @@index([status])
  @@index([expectedHarvestStart])
  @@index([seasonalAlignment])
  @@map("harvest_schedules")
}

model Product {
  id                   String            @id @default(cuid())
  farmId               String
  name                 String            @db.VarChar(255)
  slug                 String            @db.VarChar(255)
  description          String?           @db.VarChar(500)
  category             ProductCategory
  status               ProductStatus     @default(DRAFT)
  price                Decimal           @db.Decimal(10, 2)
  compareAtPrice       Decimal?          @db.Decimal(10, 2)
  unit                 String            @db.VarChar(50)
  trackInventory       Boolean           @default(true)
  quantityAvailable    Decimal?          @db.Decimal(10, 2)
  lowStockThreshold    Decimal?          @db.Decimal(10, 2)
  allowBackorder       Boolean           @default(false)
  inStock              Boolean           @default(true)
  organic              Boolean           @default(false)
  seasonal             Boolean           @default(false)
  seasonality          Season[]
  certifications       String[]
  featured             Boolean           @default(false)
  seasonalStart        DateTime?
  seasonalEnd          DateTime?
  harvestDate          DateTime?
  storageInstructions  String?
  primaryPhotoUrl      String?           @db.VarChar(500)
  photoUrls            Json?
  images               String[]
  hasVariants          Boolean           @default(false)
  variants             Json?
  tags                 Json?
  pricing              Json?
  inventory            Json?
  attributes           Json?
  scheduledPublishAt   DateTime?
  scheduledUnpublishAt DateTime?
  publishedAt          DateTime?
  viewsCount           Int               @default(0)
  cartAddsCount        Int               @default(0)
  purchaseCount        Int               @default(0)
  wishlistCount        Int               @default(0)
  averageRating        Decimal?          @db.Decimal(3, 2)
  reviewCount          Int               @default(0)
  createdAt            DateTime          @default(now())
  updatedAt            DateTime          @updatedAt
  cartItems            CartItem[]
  favorites            Favorite[]
  harvestSchedules     HarvestSchedule[]
  Inventory            Inventory[]
  inventoryLogs        InventoryLog[]
  orderItems           OrderItem[]
  farm                 Farm              @relation(fields: [farmId], references: [id], onDelete: Cascade)
  reviews              Review[]
  SeasonalCycle        SeasonalCycle[]

  @@unique([farmId, slug])
  @@index([farmId])
  @@index([category])
  @@index([status])
  @@index([organic])
  @@index([createdAt])
  @@index([farmId, inStock])
  @@index([status, category])
  @@index([farmId, status])
  @@index([featured, status])
  @@index([seasonal, status])
  @@index([price])
  @@index([averageRating])
  @@index([farmId, category, inStock])
  @@index([quantityAvailable])
  @@map("products")
}

model ProductTemplate {
  id           String          @id @default(cuid())
  farmId       String?
  name         String          @db.VarChar(255)
  category     ProductCategory
  templateData Json
  useCount     Int             @default(0)
  isPublic     Boolean         @default(false)
  createdAt    DateTime        @default(now())
  updatedAt    DateTime        @updatedAt

  @@index([farmId])
  @@index([category])
  @@map("product_templates")
}

model InventoryLog {
  id               String   @id @default(cuid())
  productId        String
  previousQuantity Decimal  @db.Decimal(10, 2)
  newQuantity      Decimal  @db.Decimal(10, 2)
  changeAmount     Decimal  @db.Decimal(10, 2)
  changeReason     String   @db.VarChar(100)
  notes            String?
  changedBy        String
  createdAt        DateTime @default(now())
  product          Product  @relation(fields: [productId], references: [id], onDelete: Cascade)

  @@index([productId])
  @@index([createdAt])
  @@map("inventory_logs")
}

model CartItem {
  id                String            @id @default(cuid())
  userId            String
  productId         String
  farmId            String
  quantity          Decimal           @db.Decimal(10, 2)
  unit              String            @db.VarChar(50)
  priceAtAdd        Decimal           @db.Decimal(10, 2)
  fulfillmentMethod FulfillmentMethod @default(DELIVERY)
  reservedUntil     DateTime?
  createdAt         DateTime          @default(now())
  updatedAt         DateTime          @updatedAt
  product           Product           @relation(fields: [productId], references: [id], onDelete: Cascade)
  user              User              @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId])
  @@index([productId])
  @@index([farmId])
  @@index([reservedUntil])
  @@map("cart_items")
}

model Order {
  id                    String            @id @default(cuid())
  orderNumber           String            @unique @db.VarChar(50)
  customerId            String
  farmId                String
  status                OrderStatus       @default(PENDING)
  paymentStatus         PaymentStatus     @default(PENDING)
  subtotal              Decimal           @db.Decimal(10, 2)
  deliveryFee           Decimal           @default(0) @db.Decimal(10, 2)
  platformFee           Decimal           @db.Decimal(10, 2)
  tax                   Decimal           @default(0) @db.Decimal(10, 2)
  discount              Decimal           @default(0) @db.Decimal(10, 2)
  total                 Decimal           @db.Decimal(10, 2)
  farmerAmount          Decimal           @db.Decimal(10, 2)
  fulfillmentMethod     FulfillmentMethod
  deliveryAddressId     String?
  scheduledDate         DateTime?
  scheduledTimeSlot     String?           @db.VarChar(50)
  fulfillmentNotes      String?
  stripePaymentIntentId String?           @unique @db.VarChar(255)
  stripeChargeId        String?           @db.VarChar(255)
  stripeTransferId      String?           @db.VarChar(255)
  paymentIntentId       String?           @db.VarChar(255)
  paidAt                DateTime?
  trackingNumber        String?           @db.VarChar(255)
  shippingService       String?           @db.VarChar(100)
  shippingAddress       Json?
  deliverySlotId        String?
  specialInstructions   String?
  createdAt             DateTime          @default(now())
  updatedAt             DateTime          @updatedAt
  confirmedAt           DateTime?
  fulfilledAt           DateTime?
  completedAt           DateTime?
  cancelledAt           DateTime?
  cancelledBy           String?
  cancelReason          String?
  fulfillment           Fulfillment?
  messages              Message[]
  items                 OrderItem[]
  customer              User              @relation(fields: [customerId], references: [id])
  deliveryAddress       UserAddress?      @relation("DeliveryAddress", fields: [deliveryAddressId], references: [id])
  farm                  Farm              @relation(fields: [farmId], references: [id])
  Payment               Payment?
  qualityIssues         QualityIssue[]
  refunds               Refund[]
  reviews               Review[]

  @@index([customerId])
  @@index([farmId])
  @@index([status])
  @@index([paymentStatus])
  @@index([createdAt])
  @@index([orderNumber])
  @@index([farmId, createdAt])
  @@index([customerId, createdAt])
  @@index([status, createdAt])
  @@index([status, farmId])
  @@index([status, customerId])
  @@index([paymentStatus, status])
  @@index([scheduledDate])
  @@map("orders")
}

model OrderItem {
  id              String  @id @default(cuid())
  orderId         String
  productId       String
  productName     String  @db.VarChar(255)
  quantity        Decimal @db.Decimal(10, 2)
  unit            String  @db.VarChar(50)
  unitPrice       Decimal @db.Decimal(10, 2)
  subtotal        Decimal @db.Decimal(10, 2)
  productSnapshot Json?
  order           Order   @relation(fields: [orderId], references: [id], onDelete: Cascade)
  product         Product @relation(fields: [productId], references: [id])

  @@index([orderId])
  @@index([productId])
  @@map("order_items")
}

model Fulfillment {
  id                String            @id @default(cuid())
  orderId           String            @unique
  status            FulfillmentStatus @default(PENDING)
  trackingNumber    String?           @db.VarChar(100)
  carrierName       String?           @db.VarChar(100)
  estimatedDate     DateTime?
  actualDate        DateTime?
  proofPhotoUrl     String?           @db.VarChar(500)
  signature         String?
  recipientName     String?           @db.VarChar(255)
  deliveryNotes     String?
  gpsLatitude       Decimal?          @db.Decimal(10, 8)
  gpsLongitude      Decimal?          @db.Decimal(11, 8)
  deliveryTimestamp DateTime?
  createdAt         DateTime          @default(now())
  updatedAt         DateTime          @updatedAt
  order             Order             @relation(fields: [orderId], references: [id], onDelete: Cascade)

  @@index([orderId])
  @@index([status])
  @@map("fulfillments")
}

model Payment {
  id                    String        @id @default(cuid())
  orderId               String        @unique
  amount                Decimal       @db.Decimal(10, 2)
  currency              String        @default("usd") @db.VarChar(3)
  status                PaymentStatus @default(PENDING)
  paymentMethod         String        @db.VarChar(50)
  stripePaymentIntentId String?       @unique @db.VarChar(255)
  paypalOrderId         String?       @unique @db.VarChar(255)
  paidAt                DateTime?
  failureReason         String?
  receiptUrl            String?       @db.VarChar(500)
  createdAt             DateTime      @default(now())
  updatedAt             DateTime      @updatedAt
  order                 Order         @relation(fields: [orderId], references: [id], onDelete: Cascade)

  @@index([orderId])
  @@index([status])
  @@index([stripePaymentIntentId])
  @@index([paypalOrderId])
  @@map("payments")
}

model WebhookEvent {
  id            String    @id @default(cuid())
  eventId       String?   @unique @db.VarChar(255)
  provider      String    @db.VarChar(50)
  eventType     String    @db.VarChar(100)
  payload       Json
  processed     Boolean   @default(false)
  processedAt   DateTime?
  attempts      Int       @default(0)
  lastAttemptAt DateTime  @default(now())
  error         String?
  createdAt     DateTime  @default(now())
  updatedAt     DateTime  @updatedAt

  @@index([eventId])
  @@index([provider])
  @@index([processed])
  @@index([attempts])
  @@index([createdAt])
  @@map("webhook_events")
}

model Payout {
  id             String    @id @default(cuid())
  farmId         String
  amount         Decimal   @db.Decimal(10, 2)
  currency       String    @default("USD") @db.VarChar(3)
  status         String    @db.VarChar(50)
  stripePayoutId String?   @unique @db.VarChar(255)
  periodStart    DateTime
  periodEnd      DateTime
  orderCount     Int
  scheduledDate  DateTime
  paidDate       DateTime?
  failureReason  String?
  createdAt      DateTime  @default(now())
  farm           Farm      @relation(fields: [farmId], references: [id])

  @@index([farmId])
  @@index([status])
  @@index([scheduledDate])
  @@map("payouts")
}

model Refund {
  id             String    @id @default(cuid())
  orderId        String
  amount         Decimal   @db.Decimal(10, 2)
  reason         String    @db.VarChar(255)
  notes          String?
  stripeRefundId String?   @unique @db.VarChar(255)
  status         String    @db.VarChar(50)
  processedAt    DateTime?
  createdAt      DateTime  @default(now())
  order          Order     @relation(fields: [orderId], references: [id])

  @@index([orderId])
  @@map("refunds")
}

model QualityIssue {
  id                   String             @id @default(cuid())
  orderId              String
  customerId           String
  farmId               String
  type                 QualityIssueType
  description          String             @db.VarChar(500)
  photoUrl             String?            @db.VarChar(500)
  status               QualityIssueStatus @default(OPEN)
  resolutionPreference ResolutionType
  resolution           ResolutionType?
  resolutionNotes      String?
  refundAmount         Decimal?           @db.Decimal(10, 2)
  createdAt            DateTime           @default(now())
  resolvedAt           DateTime?
  resolvedBy           String?
  customer             User               @relation(fields: [customerId], references: [id])
  farm                 Farm               @relation(fields: [farmId], references: [id])
  order                Order              @relation(fields: [orderId], references: [id])

  @@index([orderId])
  @@index([customerId])
  @@index([farmId])
  @@index([status])
  @@map("quality_issues")
}

model Review {
  id                 String       @id @default(cuid())
  farmId             String
  productId          String?
  customerId         String
  orderId            String?
  rating             Int
  reviewText         String?      @db.VarChar(500)
  photoUrl           String?      @db.VarChar(500)
  isVerifiedPurchase Boolean      @default(false)
  status             ReviewStatus @default(PENDING)
  helpfulCount       Int          @default(0)
  unhelpfulCount     Int          @default(0)
  farmerResponse     String?      @db.VarChar(500)
  farmerRespondedAt  DateTime?
  flaggedReason      String?      @db.VarChar(255)
  flaggedAt          DateTime?
  moderatedBy        String?
  moderatedAt        DateTime?
  createdAt          DateTime     @default(now())
  updatedAt          DateTime     @updatedAt
  customer           User         @relation(fields: [customerId], references: [id])
  farm               Farm         @relation(fields: [farmId], references: [id])
  order              Order?       @relation(fields: [orderId], references: [id])
  product            Product?     @relation(fields: [productId], references: [id])

  @@index([farmId])
  @@index([productId])
  @@index([customerId])
  @@index([orderId])
  @@index([status])
  @@index([createdAt])
  @@index([productId, createdAt])
  @@index([rating])
  @@index([farmId, rating])
  @@map("reviews")
}

model Favorite {
  id        String   @id @default(cuid())
  userId    String
  farmId    String?
  productId String?
  createdAt DateTime @default(now())
  farm      Farm?    @relation(fields: [farmId], references: [id], onDelete: Cascade)
  product   Product? @relation(fields: [productId], references: [id], onDelete: Cascade)
  user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([userId, farmId])
  @@unique([userId, productId])
  @@index([userId])
  @@index([farmId])
  @@index([productId])
  @@map("favorites")
}

model FarmRating {
  id             String   @id @default(cuid())
  farmId         String   @unique
  averageRating  Float    @default(0)
  totalReviews   Int      @default(0)
  productQuality Float    @default(0)
  communication  Float    @default(0)
  delivery       Float    @default(0)
  packaging      Float    @default(0)
  fiveStarCount  Int      @default(0)
  fourStarCount  Int      @default(0)
  threeStarCount Int      @default(0)
  twoStarCount   Int      @default(0)
  oneStarCount   Int      @default(0)
  updatedAt      DateTime @updatedAt
  farm           Farm     @relation(fields: [farmId], references: [id], onDelete: Cascade)

  @@index([averageRating])
  @@map("farm_ratings")
}

model Message {
  id          String    @id @default(cuid())
  senderId    String
  recipientId String?
  farmId      String?
  orderId     String?
  subject     String?   @db.VarChar(255)
  body        String
  isRead      Boolean   @default(false)
  readAt      DateTime?
  createdAt   DateTime  @default(now())
  farm        Farm?     @relation(fields: [farmId], references: [id])
  order       Order?    @relation(fields: [orderId], references: [id])
  sender      User      @relation("MessageSender", fields: [senderId], references: [id])

  @@index([senderId])
  @@index([recipientId])
  @@index([farmId])
  @@index([orderId])
  @@index([isRead])
  @@map("messages")
}

model Notification {
  id        String              @id @default(cuid())
  userId    String?
  farmId    String?
  type      NotificationType
  channel   NotificationChannel
  title     String              @db.VarChar(255)
  body      String
  data      Json?
  isRead    Boolean             @default(false)
  readAt    DateTime?
  sentAt    DateTime?
  createdAt DateTime            @default(now())
  farm      Farm?               @relation(fields: [farmId], references: [id])
  user      User?               @relation(fields: [userId], references: [id])

  @@index([userId])
  @@index([farmId])
  @@index([type])
  @@index([isRead])
  @@index([createdAt])
  @@map("notifications")
}

model AnalyticsEvent {
  id         String   @id @default(cuid())
  eventType  String   @db.VarChar(100)
  userId     String?
  farmId     String?
  productId  String?
  orderId    String?
  sessionId  String?  @db.VarChar(255)
  properties Json?
  userAgent  String?
  ipAddress  String?  @db.VarChar(45)
  referrer   String?  @db.VarChar(500)
  createdAt  DateTime @default(now())

  @@index([eventType])
  @@index([userId])
  @@index([farmId])
  @@index([productId])
  @@index([createdAt])
  @@map("analytics_events")
}

model DeliveryZone {
  id              String   @id @default(cuid())
  farmId          String
  name            String   @db.VarChar(255)
  description     String?
  zipCodes        String[]
  cities          String[]
  baseFee         Decimal  @db.Decimal(10, 2)
  perMileFee      Decimal  @default(0) @db.Decimal(10, 2)
  minimumOrder    Decimal  @default(0) @db.Decimal(10, 2)
  freeDeliveryMin Decimal  @default(0) @db.Decimal(10, 2)
  availableDays   String[]
  cutoffHours     Int      @default(24)
  isActive        Boolean  @default(true)
  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt
  farm            Farm     @relation(fields: [farmId], references: [id], onDelete: Cascade)

  @@index([farmId])
  @@index([isActive])
  @@map("delivery_zones")
}

model DeliverySlot {
  id            String   @id @default(cuid())
  farmId        String
  date          DateTime @db.Date
  startTime     String   @db.VarChar(10)
  endTime       String   @db.VarChar(10)
  maxOrders     Int      @default(10)
  currentOrders Int      @default(0)
  isActive      Boolean  @default(true)
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt
  farm          Farm     @relation(fields: [farmId], references: [id], onDelete: Cascade)

  @@index([farmId])
  @@index([date])
  @@index([isActive])
  @@map("delivery_slots")
}

model PickupLocation {
  id             String   @id @default(cuid())
  farmId         String
  name           String   @db.VarChar(255)
  address        String   @db.VarChar(500)
  city           String   @db.VarChar(100)
  state          String   @db.VarChar(50)
  zipCode        String   @db.VarChar(20)
  instructions   String?
  latitude       Decimal? @db.Decimal(10, 8)
  longitude      Decimal? @db.Decimal(11, 8)
  availableDays  String[]
  availableHours String?  @db.VarChar(255)
  isActive       Boolean  @default(true)
  createdAt      DateTime @default(now())
  updatedAt      DateTime @updatedAt
  farm           Farm     @relation(fields: [farmId], references: [id], onDelete: Cascade)

  @@index([farmId])
  @@index([isActive])
  @@map("pickup_locations")
}

model Address {
  id        String      @id @default(cuid())
  userId    String?
  fullName  String      @db.VarChar(255)
  street    String      @db.VarChar(500)
  city      String      @db.VarChar(100)
  state     String      @db.VarChar(50)
  zipCode   String      @db.VarChar(20)
  country   String      @default("USA") @db.VarChar(50)
  phone     String?     @db.VarChar(20)
  latitude  Decimal?    @db.Decimal(10, 8)
  longitude Decimal?    @db.Decimal(11, 8)
  type      AddressType @default(HOME)
  isDefault Boolean     @default(false)
  createdAt DateTime    @default(now())
  updatedAt DateTime    @updatedAt
  user      User?       @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId])
  @@map("addresses")
}

model SeasonalCycle {
  id             String      @id @default(cuid())
  productId      String
  season         Season
  phase          GrowthPhase
  startDate      DateTime
  endDate        DateTime?
  lunarPhase     String?     @db.VarChar(50)
  soilConditions Json?
  energyLevel    Int?
  notes          String?
  createdAt      DateTime    @default(now())
  updatedAt      DateTime    @updatedAt
  product        Product     @relation(fields: [productId], references: [id], onDelete: Cascade)

  @@index([productId])
  @@index([season])
  @@index([phase])
  @@index([startDate, endDate])
  @@map("seasonal_cycles")
}

model Inventory {
  id           String           @id @default(cuid())
  farmId       String
  productId    String
  sku          String           @unique @db.VarChar(100)
  quantity     Int              @default(0)
  reservedQty  Int              @default(0)
  availableQty Int              @default(0)
  reorderPoint Int              @default(10)
  reorderQty   Int              @default(50)
  costPrice    Decimal          @db.Decimal(10, 2)
  sellingPrice Decimal          @db.Decimal(10, 2)
  pricePerUnit Decimal          @db.Decimal(10, 2)
  location     String?          @db.VarChar(100)
  zone         String?          @db.VarChar(50)
  status       InventoryStatus  @default(IN_STOCK)
  createdAt    DateTime         @default(now())
  updatedAt    DateTime         @updatedAt
  farm         Farm             @relation(fields: [farmId], references: [id], onDelete: Cascade)
  product      Product          @relation(fields: [productId], references: [id], onDelete: Cascade)
  alerts       InventoryAlert[]
  batches      ProductBatch[]
  movements    StockMovement[]

  @@index([farmId])
  @@index([productId])
  @@index([status])
  @@index([quantity])
  @@map("inventory")
}

model ProductBatch {
  id              String    @id @default(cuid())
  inventoryId     String
  batchNumber     String    @unique @db.VarChar(100)
  quantity        Int
  receivedQty     Int
  damagedQty      Int       @default(0)
  receivedDate    DateTime  @default(now())
  expiryDate      DateTime?
  manufactureDate DateTime?
  supplier        String?   @db.VarChar(255)
  cost            Decimal?  @db.Decimal(10, 2)
  qualityGrade    String?   @db.VarChar(20)
  notes           String?
  createdAt       DateTime  @default(now())
  updatedAt       DateTime  @updatedAt
  inventory       Inventory @relation(fields: [inventoryId], references: [id], onDelete: Cascade)

  @@index([inventoryId])
  @@index([expiryDate])
  @@map("product_batches")
}

model StockMovement {
  id          String            @id @default(cuid())
  inventoryId String
  type        StockMovementType
  quantity    Int
  reference   String?           @db.VarChar(255)
  previousQty Int
  newQty      Int
  reason      String?
  performedBy String            @db.VarChar(255)
  createdAt   DateTime          @default(now())
  inventory   Inventory         @relation(fields: [inventoryId], references: [id], onDelete: Cascade)

  @@index([inventoryId])
  @@index([type])
  @@index([createdAt])
  @@map("stock_movements")
}

model InventoryAlert {
  id          String        @id @default(cuid())
  inventoryId String
  type        AlertType
  severity    AlertSeverity
  message     String
  isRead      Boolean       @default(false)
  isResolved  Boolean       @default(false)
  resolvedAt  DateTime?
  resolvedBy  String?       @db.VarChar(255)
  createdAt   DateTime      @default(now())
  updatedAt   DateTime      @updatedAt
  inventory   Inventory     @relation(fields: [inventoryId], references: [id], onDelete: Cascade)

  @@index([inventoryId])
  @@index([type])
  @@index([severity])
  @@index([isResolved])
  @@map("inventory_alerts")
}

model SupportTicket {
  id             String                 @id @default(cuid())
  userId         String
  subject        String                 @db.VarChar(255)
  description    String
  category       SupportTicketCategory  @default(GENERAL)
  priority       SupportTicketPriority  @default(MEDIUM)
  status         SupportTicketStatus    @default(OPEN)
  assignedTo     String?
  assignedAt     DateTime?
  tags           String[]               @default([])
  relatedOrderId String?
  relatedFarmId  String?
  resolvedAt     DateTime?
  resolvedBy     String?
  resolutionNote String?
  createdAt      DateTime               @default(now())
  updatedAt      DateTime               @updatedAt
  files          SupportTicketFile[]
  messages       SupportTicketMessage[]
  user           User                   @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId])
  @@index([status])
  @@index([priority])
  @@index([category])
  @@index([assignedTo])
  @@index([createdAt])
  @@map("support_tickets")
}

model SupportTicketMessage {
  id         String        @id @default(cuid())
  ticketId   String
  content    String
  isStaff    Boolean       @default(false)
  authorId   String
  isInternal Boolean       @default(false)
  isRead     Boolean       @default(false)
  createdAt  DateTime      @default(now())
  updatedAt  DateTime      @updatedAt
  ticket     SupportTicket @relation(fields: [ticketId], references: [id], onDelete: Cascade)

  @@index([ticketId])
  @@index([authorId])
  @@index([createdAt])
  @@map("support_ticket_messages")
}

model SupportTicketFile {
  id          String        @id @default(cuid())
  ticketId    String
  filename    String        @db.VarChar(255)
  url         String        @db.VarChar(500)
  mimeType    String        @db.VarChar(100)
  size        Int
  description String?
  uploadedBy  String
  createdAt   DateTime      @default(now())
  ticket      SupportTicket @relation(fields: [ticketId], references: [id], onDelete: Cascade)

  @@index([ticketId])
  @@index([uploadedBy])
  @@map("support_ticket_files")
}

model NotificationPreferences {
  id              String   @id @default(cuid())
  userId          String   @unique
  emailOrders     Boolean  @default(true)
  emailReviews    Boolean  @default(true)
  emailPromotions Boolean  @default(false)
  emailNewsletter Boolean  @default(false)
  inAppOrders     Boolean  @default(true)
  inAppReviews    Boolean  @default(true)
  inAppMessages   Boolean  @default(true)
  pushOrders      Boolean  @default(true)
  pushReviews     Boolean  @default(true)
  pushPromotions  Boolean  @default(false)
  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt
  user            User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId])
  @@map("notification_preferences")
}

model DownloadLog {
  id         String   @id @default(cuid())
  userId     String?
  resourceId String   @db.VarChar(255)
  ipAddress  String?  @db.VarChar(45)
  userAgent  String?
  createdAt  DateTime @default(now())
  user       User?    @relation(fields: [userId], references: [id])

  @@index([userId])
  @@index([resourceId])
  @@index([createdAt])
  @@map("download_logs")
}

model AuditLog {
  id         String      @id @default(cuid())
  userId     String?
  action     AuditAction
  entityType String      @db.VarChar(100)
  entityId   String      @db.VarChar(255)
  changes    Json?
  ipAddress  String?     @db.VarChar(45)
  userAgent  String?
  createdAt  DateTime    @default(now())
  user       User?       @relation(fields: [userId], references: [id])

  @@index([userId])
  @@index([entityType, entityId])
  @@index([action])
  @@index([createdAt])
  @@map("audit_logs")
}

/// Monitoring report for workflow executions
model MonitoringReport {
  id                 String              @id @default(cuid())
  reportId           String              @unique @map("report_id") @db.VarChar(255)
  startTime          DateTime            @map("start_time")
  endTime            DateTime            @map("end_time")
  totalRuns          Int                 @default(0) @map("total_runs")
  successfulRuns     Int                 @default(0) @map("successful_runs")
  failedRuns         Int                 @default(0) @map("failed_runs")
  totalDurationMs    Int                 @default(0) @map("total_duration_ms")
  avgDurationMs      Float               @default(0) @map("avg_duration_ms")
  successRate        Float               @default(0) @map("success_rate")
  status             String              @default("COMPLETED")
  reportType         String              @default("PERIODIC") @map("report_type")
  generatedAt        DateTime            @default(now()) @map("generated_at")
  notified           Boolean             @default(false)
  notifiedAt         DateTime?           @map("notified_at")
  metadata           Json?
  createdAt          DateTime            @default(now()) @map("created_at")
  updatedAt          DateTime            @updatedAt @map("updated_at")
  notificationLogs   NotificationLog[]
  workflowExecutions WorkflowExecution[]

  @@index([reportId])
  @@index([status])
  @@index([generatedAt])
  @@index([startTime])
  @@map("monitoring_reports")
}

/// Individual workflow execution record
model WorkflowExecution {
  id                 String              @id @default(cuid())
  runId              String              @unique @map("run_id") @db.VarChar(255)
  workflowName       String              @map("workflow_name")
  status             String
  startedAt          DateTime            @map("started_at")
  completedAt        DateTime?           @map("completed_at")
  durationMs         Int?                @map("duration_ms")
  testsPassed        Int                 @default(0) @map("tests_passed")
  testsFailed        Int                 @default(0) @map("tests_failed")
  testsTotal         Int                 @default(0) @map("tests_total")
  errorMessage       String?             @map("error_message")
  errorStack         String?             @map("error_stack")
  triggeredBy        String              @default("SCHEDULED") @map("triggered_by")
  environment        String              @default("production")
  metadata           Json?
  reportId           String?             @map("report_id")
  createdAt          DateTime            @default(now()) @map("created_at")
  updatedAt          DateTime            @updatedAt @map("updated_at")
  notificationLogs   NotificationLog[]
  systemHealthChecks SystemHealthCheck[]
  report             MonitoringReport?   @relation(fields: [reportId], references: [reportId])
  workflowMetrics    WorkflowMetrics[]

  @@index([runId])
  @@index([workflowName])
  @@index([status])
  @@index([startedAt])
  @@index([reportId])
  @@map("workflow_executions")
}

/// Workflow metrics and performance data
model WorkflowMetrics {
  id                String             @id @default(cuid())
  workflowId        String             @map("workflow_id") @db.VarChar(255)
  metricName        String             @map("metric_name")
  metricValue       Float              @map("metric_value")
  metricUnit        String?            @map("metric_unit")
  thresholdValue    Float?             @map("threshold_value")
  isWithinThreshold Boolean            @default(true) @map("is_within_threshold")
  recordedAt        DateTime           @default(now()) @map("recorded_at")
  tags              Json?
  metadata          Json?
  executionId       String?            @map("execution_id")
  createdAt         DateTime           @default(now()) @map("created_at")
  execution         WorkflowExecution? @relation(fields: [executionId], references: [runId], onDelete: Cascade)

  @@index([workflowId])
  @@index([metricName])
  @@index([recordedAt])
  @@index([executionId])
  @@index([isWithinThreshold])
  @@map("workflow_metrics")
}

/// System health checks
model SystemHealthCheck {
  id             String             @id @default(cuid())
  checkId        String             @unique @map("check_id")
  checkName      String             @map("check_name")
  status         String
  responseTimeMs Int                @map("response_time_ms")
  details        Json?
  checkedAt      DateTime           @default(now()) @map("checked_at")
  endpoint       String?
  expectedStatus Int?               @map("expected_status")
  actualStatus   Int?               @map("actual_status")
  errorMessage   String?            @map("error_message")
  metadata       Json?
  executionId    String?            @map("execution_id")
  createdAt      DateTime           @default(now()) @map("created_at")
  execution      WorkflowExecution? @relation(fields: [executionId], references: [runId], onDelete: Cascade)

  @@index([checkId])
  @@index([checkName])
  @@index([status])
  @@index([checkedAt])
  @@index([executionId])
  @@map("system_health_checks")
}

/// Notification log
model NotificationLog {
  id               String             @id @default(cuid())
  logId            String             @unique @map("log_id") @db.VarChar(255)
  channel          String
  notificationType String             @map("notification_type")
  status           String
  recipient        String?
  subject          String?
  message          String
  sentAt           DateTime           @default(now()) @map("sent_at")
  deliveryStatus   String?            @map("delivery_status")
  errorMessage     String?            @map("error_message")
  retryCount       Int                @default(0) @map("retry_count")
  metadata         Json?
  executionId      String?            @map("execution_id")
  reportId         String?            @map("report_id")
  createdAt        DateTime           @default(now()) @map("created_at")
  execution        WorkflowExecution? @relation(fields: [executionId], references: [runId])
  report           MonitoringReport?  @relation(fields: [reportId], references: [reportId])

  @@index([logId])
  @@index([channel])
  @@index([status])
  @@index([sentAt])
  @@index([executionId])
  @@index([reportId])
  @@map("notification_logs")
}

/// Workflow scheduler configuration
model WorkflowSchedule {
  id             String    @id @default(cuid())
  scheduleId     String    @unique @map("schedule_id") @db.VarChar(255)
  workflowName   String    @map("workflow_name")
  cronExpression String    @map("cron_expression")
  enabled        Boolean   @default(true)
  lastRunAt      DateTime? @map("last_run_at")
  nextRunAt      DateTime? @map("next_run_at")
  runCount       Int       @default(0) @map("run_count")
  failureCount   Int       @default(0) @map("failure_count")
  successCount   Int       @default(0) @map("success_count")
  description    String?
  tags           Json?
  metadata       Json?
  createdAt      DateTime  @default(now()) @map("created_at")
  updatedAt      DateTime  @updatedAt @map("updated_at")

  @@index([scheduleId])
  @@index([workflowName])
  @@index([enabled])
  @@index([nextRunAt])
  @@map("workflow_schedules")
}

model SavedSearch {
  id                    String                @id @default(cuid())
  userId                String
  name                  String                @db.VarChar(255)
  description           String?
  query                 String?               @db.VarChar(500)
  filters               Json                  @default("{}")
  sortBy                String?               @db.VarChar(50)
  location              Json?
  isPublic              Boolean               @default(false)
  shareToken            String?               @unique @db.VarChar(100)
  folderId              String?
  tags                  String[]
  notificationsEnabled  Boolean               @default(true)
  notificationFrequency NotificationFrequency @default(DAILY)
  lastNotificationSent  DateTime?
  executionCount        Int                   @default(0)
  lastExecutedAt        DateTime?
  resultsCount          Int?
  seasonalPreference    Season?
  preferredFarms        String[]
  biodynamicOnly        Boolean               @default(false)
  createdAt             DateTime              @default(now())
  updatedAt             DateTime              @updatedAt
  sharedWith            SavedSearchShare[]
  folder                SavedSearchFolder?    @relation(fields: [folderId], references: [id])
  user                  User                  @relation(fields: [userId], references: [id], onDelete: Cascade)
  alerts                SearchAlert[]

  @@index([userId])
  @@index([shareToken])
  @@index([createdAt])
  @@index([lastExecutedAt])
  @@map("saved_searches")
}

model SavedSearchFolder {
  id          String        @id @default(cuid())
  userId      String
  name        String        @db.VarChar(100)
  description String?
  icon        String?       @db.VarChar(50)
  sortOrder   Int           @default(0)
  color       String?       @db.VarChar(20)
  createdAt   DateTime      @default(now())
  updatedAt   DateTime      @updatedAt
  user        User          @relation(fields: [userId], references: [id], onDelete: Cascade)
  searches    SavedSearch[]

  @@index([userId])
  @@map("saved_search_folders")
}

model SavedSearchShare {
  id              String          @id @default(cuid())
  savedSearchId   String
  sharedWithEmail String          @db.VarChar(255)
  sharedWithId    String?
  permission      SharePermission @default(VIEW)
  expiresAt       DateTime?
  createdAt       DateTime        @default(now())
  savedSearch     SavedSearch     @relation(fields: [savedSearchId], references: [id], onDelete: Cascade)

  @@unique([savedSearchId, sharedWithEmail])
  @@index([savedSearchId])
  @@map("saved_search_shares")
}

model SearchAlert {
  id            String          @id @default(cuid())
  savedSearchId String
  userId        String
  type          SearchAlertType @default(NEW_PRODUCTS)
  conditions    Json
  isActive      Boolean         @default(true)
  lastTriggered DateTime?
  triggerCount  Int             @default(0)
  channels      Json
  createdAt     DateTime        @default(now())
  updatedAt     DateTime        @updatedAt
  savedSearch   SavedSearch     @relation(fields: [savedSearchId], references: [id], onDelete: Cascade)

  @@index([savedSearchId])
  @@index([userId])
  @@index([isActive])
  @@map("search_alerts")
}

model SearchEvent {
  id                  String    @id @default(cuid())
  userId              String?
  sessionId           String    @db.VarChar(100)
  query               String?   @db.VarChar(500)
  filters             Json?
  sortBy              String?   @db.VarChar(50)
  categoryId          String?
  farmId              String?
  location            Json?
  priceRange          Json?
  seasonalFilter      Season?
  resultsCount        Int
  resultsShown        Int?
  clickedResults      String[]
  clickedResultIds    Json?
  hasResults          Boolean?
  responseTime        Int?
  responseTimeMs      Int?
  cacheHit            Boolean   @default(false)
  databaseTimeMs      Int?
  renderTimeMs        Int?
  source              String?   @db.VarChar(50)
  userAgent           String?   @db.VarChar(500)
  ipAddress           String?   @db.VarChar(45)
  referrer            String?   @db.VarChar(500)
  deviceId            String?   @db.VarChar(100)
  currentSeason       Season?
  lunarPhase          String?   @db.VarChar(50)
  agriculturalContext Json?
  biodynamicFactors   Json?
  seasonalRelevance   Decimal?  @db.Decimal(5, 2)
  savedSearch         Boolean   @default(false)
  refinedSearch       Boolean   @default(false)
  exitedAt            DateTime?
  sessionDepth        Int       @default(1)
  abTestVariant       String?   @db.VarChar(50)
  timestamp           DateTime  @default(now())
  createdAt           DateTime  @default(now())

  @@index([userId])
  @@index([sessionId])
  @@index([timestamp])
  @@index([query])
  @@index([userId, sessionId, query, createdAt])
  @@map("search_events")
}

model UserInteraction {
  id                  String          @id @default(cuid())
  userId              String?
  sessionId           String          @db.VarChar(100)
  type                InteractionType
  entityType          String          @db.VarChar(50)
  entityId            String
  searchEventId       String?
  recommendationId    String?
  abTestId            String?
  abTestVariant       String?         @db.VarChar(50)
  source              String?         @db.VarChar(50)
  metadata            Json?
  durationMs          Int?
  scrollDepth         Decimal?        @db.Decimal(5, 2)
  clickPosition       Int?
  timeInSession       Int?
  sessionDepth        Int             @default(1)
  agriculturalContext Json?
  userAgent           String?         @db.VarChar(500)
  deviceId            String?         @db.VarChar(100)
  value               Decimal?        @db.Decimal(10, 2)
  timestamp           DateTime        @default(now())
  createdAt           DateTime        @default(now())

  @@index([userId])
  @@index([sessionId])
  @@index([entityType, entityId])
  @@index([type])
  @@index([timestamp])
  @@index([userId, sessionId, type, entityType, entityId])
  @@map("user_interactions")
}

model SearchAnalytics {
  id                   String      @id @default(cuid())
  query                String?     @db.VarChar(500)
  categoryId           String?
  farmId               String?
  season               Season?
  periodType           PeriodType
  period               PeriodType?
  periodKey            String?     @db.VarChar(50)
  periodStart          DateTime
  periodEnd            DateTime
  totalSearches        Int         @default(0)
  uniqueUsers          Int         @default(0)
  uniqueSessions       Int         @default(0)
  uniqueQueries        Int         @default(0)
  averageResultsCount  Decimal     @db.Decimal(10, 2)
  noResultsCount       Int         @default(0)
  refinementRate       Decimal     @db.Decimal(5, 4)
  saveRate             Decimal     @db.Decimal(5, 4)
  bounceRate           Decimal     @db.Decimal(5, 4)
  avgResponseTime      Int
  averageResponseTime  Decimal     @db.Decimal(10, 2)
  cacheHitRate         Decimal     @db.Decimal(5, 4)
  p95ResponseTime      Int
  p99ResponseTime      Decimal     @db.Decimal(10, 2)
  avgResultsCount      Decimal     @db.Decimal(10, 2)
  avgClickThrough      Decimal     @db.Decimal(5, 4)
  clickThroughRate     Decimal     @db.Decimal(5, 4)
  conversionRate       Decimal     @db.Decimal(5, 4)
  seasonalRelevanceAvg Decimal?    @db.Decimal(5, 2)
  biodynamicEngagement Decimal?    @db.Decimal(5, 4)
  seasonalTrends       Json?
  farmPopularity       Json?
  topQueries           Json?
  topFilters           Json?
  topCategories        Json?
  topClickedResults    Json?
  topConvertedItems    Json?
  createdAt            DateTime    @default(now())
  calculatedAt         DateTime    @default(now())
  updatedAt            DateTime?

  @@unique([periodType, periodStart])
  @@unique([query, categoryId, farmId, season, period, periodKey])
  @@index([periodType, periodStart])
  @@index([query])
  @@index([categoryId])
  @@index([farmId])
  @@map("search_analytics")
}

model UserPreference {
  id                    String   @id @default(cuid())
  userId                String   @unique
  dietaryRestrictions   String[]
  allergens             String[]
  certifications        String[]
  preferOrganic         Boolean  @default(false)
  preferLocal           Boolean  @default(false)
  priceRangeMin         Decimal? @db.Decimal(10, 2)
  priceRangeMax         Decimal? @db.Decimal(10, 2)
  favoriteFarms         String[]
  favoriteCategories    String[]
  budgetRange           Json?
  defaultLocation       Json?
  preferredLocations    Json[]
  maxDistance           Int?
  preferredPickupDays   String[]
  preferredDeliveryTime String?
  springPreferences     Json?
  summerPreferences     Json?
  fallPreferences       Json?
  winterPreferences     Json?
  lunarPhaseAware       Boolean  @default(false)
  biodynamicOnly        Boolean  @default(false)
  allowPersonalization  Boolean  @default(true)
  shareDataForAnalytics Boolean  @default(true)
  autoApplyFilters      Boolean  @default(true)
  autoApplySort         Boolean  @default(true)
  createdAt             DateTime @default(now())
  updatedAt             DateTime @updatedAt
  user                  User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId])
  @@map("user_preferences")
}

model PersonalizationScore {
  id              String   @id @default(cuid())
  userId          String
  entityType      String   @db.VarChar(50)
  entityId        String
  relevanceScore  Int
  affinityScore   Int
  seasonalScore   Int
  proximityScore  Int
  popularityScore Int
  totalScore      Int
  season          Season
  calculatedAt    DateTime @default(now())
  expiresAt       DateTime

  @@unique([userId, entityType, entityId, season])
  @@index([userId])
  @@index([entityType, entityId])
  @@index([totalScore])
  @@index([expiresAt])
  @@map("personalization_scores")
}

model Recommendation {
  id          String             @id @default(cuid())
  userId      String
  type        RecommendationType
  entityType  String             @db.VarChar(50)
  entityId    String
  score       Decimal            @db.Decimal(5, 2)
  confidence  Decimal            @db.Decimal(5, 4)
  reasons     Json
  season      Season?
  source      String?            @db.VarChar(50)
  shown       Boolean            @default(false)
  shownAt     DateTime?
  clicked     Boolean            @default(false)
  clickedAt   DateTime?
  converted   Boolean            @default(false)
  convertedAt DateTime?
  createdAt   DateTime           @default(now())
  expiresAt   DateTime

  @@index([userId])
  @@index([type])
  @@index([entityType, entityId])
  @@index([shown, clicked, converted])
  @@index([expiresAt])
  @@map("recommendations")
}

model ABTest {
  id             String             @id @default(cuid())
  name           String             @db.VarChar(255)
  description    String?
  variants       Json
  trafficSplit   Json
  targetAudience Json?
  status         ABTestStatus       @default(DRAFT)
  startedAt      DateTime?
  endedAt        DateTime?
  results        Json?
  winnerVariant  String?
  createdAt      DateTime           @default(now())
  updatedAt      DateTime           @updatedAt
  assignments    ABTestAssignment[]

  @@index([status])
  @@index([startedAt, endedAt])
  @@map("ab_tests")
}

model ABTestAssignment {
  id         String   @id @default(cuid())
  testId     String
  userId     String?
  sessionId  String   @db.VarChar(100)
  variantId  String   @db.VarChar(50)
  assignedAt DateTime @default(now())
  test       ABTest   @relation(fields: [testId], references: [id], onDelete: Cascade)

  @@unique([testId, userId])
  @@unique([testId, sessionId])
  @@index([testId])
  @@index([userId])
  @@map("ab_test_assignments")
}

model ABTestEvent {
  id        String   @id @default(cuid())
  testId    String
  userId    String
  variantId String   @db.VarChar(50)
  event     String   @db.VarChar(100)
  value     Decimal  @default(0) @db.Decimal(10, 2)
  metadata  Json?
  timestamp DateTime @default(now())

  @@index([testId])
  @@index([userId])
  @@index([variantId])
  @@index([event])
  @@index([timestamp])
  @@map("ab_test_events")
}

model UserSearchProfile {
  id                    String    @id @default(cuid())
  userId                String    @unique
  totalSearches         Int
  uniqueQueriesCount    Int
  averageSessionDepth   Decimal   @db.Decimal(5, 2)
  averageSearchesPerDay Decimal   @db.Decimal(10, 2)
  preferredSortBy       String?   @db.VarChar(50)
  topCategories         Json
  favoriteFarms         Json
  seasonalPreferences   Json
  dietaryPatterns       Json?
  priceRangeTendency    Json
  clickThroughRate      Decimal   @db.Decimal(5, 4)
  conversionRate        Decimal   @db.Decimal(5, 4)
  averageOrderValue     Decimal?  @db.Decimal(10, 2)
  repeatPurchaseRate    Decimal?  @db.Decimal(5, 4)
  peakSearchHours       Json
  peakSearchDays        Json
  lastSearchAt          DateTime?
  firstSearchAt         DateTime?
  savedSearchesCount    Int       @default(0)
  activeAlertsCount     Int       @default(0)
  sharedSearchesCount   Int       @default(0)
  reviewsCount          Int       @default(0)
  biodynamicEngagement  Decimal   @db.Decimal(5, 4)
  seasonalAwareness     Decimal   @db.Decimal(5, 4)
  localFarmSupport      Decimal   @db.Decimal(5, 4)
  calculatedAt          DateTime  @default(now())
  updatedAt             DateTime  @updatedAt

  @@index([userId])
  @@index([calculatedAt])
  @@map("user_search_profiles")
}

model PerformanceMetric {
  id           String     @id @default(cuid())
  metricName   String     @db.VarChar(100)
  metricType   String     @db.VarChar(50)
  period       PeriodType
  periodKey    String     @db.VarChar(50)
  count        Int
  sum          Decimal    @db.Decimal(15, 2)
  average      Decimal    @db.Decimal(10, 2)
  min          Decimal    @db.Decimal(10, 2)
  max          Decimal    @db.Decimal(10, 2)
  median       Decimal    @db.Decimal(10, 2)
  p50          Decimal    @db.Decimal(10, 2)
  p75          Decimal    @db.Decimal(10, 2)
  p90          Decimal    @db.Decimal(10, 2)
  p95          Decimal    @db.Decimal(10, 2)
  p99          Decimal    @db.Decimal(10, 2)
  stdDev       Decimal    @db.Decimal(10, 4)
  context      Json?
  cpuUsage     Decimal?   @db.Decimal(5, 2)
  memoryUsage  Decimal?   @db.Decimal(5, 2)
  gpuUsage     Decimal?   @db.Decimal(5, 2)
  threadCount  Int?
  calculatedAt DateTime   @default(now())

  @@unique([metricName, metricType, period, periodKey])
  @@index([metricName, metricType])
  @@index([period, periodKey])
  @@index([calculatedAt])
  @@map("performance_metrics")
}

model SearchTrend {
  id                  String     @id @default(cuid())
  query               String?    @db.VarChar(500)
  categoryId          String?
  farmId              String?
  season              Season?
  trendType           String     @db.VarChar(50)
  currentVolume       Int
  previousVolume      Int
  growthRate          Decimal    @db.Decimal(10, 4)
  volatility          Decimal    @db.Decimal(5, 4)
  trendScore          Decimal    @db.Decimal(5, 2)
  period              PeriodType
  periodKey           String     @db.VarChar(50)
  comparisonPeriodKey String     @db.VarChar(50)
  forecast            Json?
  seasonality         Json?
  agriculturalFactors Json?
  biodynamicInfluence Decimal?   @db.Decimal(5, 2)
  rank                Int?
  previousRank        Int?
  calculatedAt        DateTime   @default(now())
  updatedAt           DateTime   @updatedAt
  expiresAt           DateTime

  @@unique([query, categoryId, farmId, season, period, periodKey])
  @@index([trendType])
  @@index([period, periodKey])
  @@index([rank])
  @@index([expiresAt])
  @@map("search_trends")
}

model AnalyticsDashboard {
  id               String     @id @default(cuid())
  dashboardType    String     @db.VarChar(50)
  entityId         String?
  period           PeriodType
  periodKey        String     @db.VarChar(50)
  metrics          Json
  kpis             Json
  timeSeriesData   Json?
  distributionData Json?
  comparisonData   Json?
  seasonalInsights Json?
  farmPerformance  Json?
  productTrends    Json?
  calculatedAt     DateTime   @default(now())
  expiresAt        DateTime

  @@unique([dashboardType, entityId, period, periodKey])
  @@index([dashboardType])
  @@index([period, periodKey])
  @@index([expiresAt])
  @@map("analytics_dashboards")
}

model EmailPreferences {
  id                     String    @id @default(cuid())
  userId                 String    @unique
  orderConfirmation      Boolean   @default(true)
  orderStatusUpdates     Boolean   @default(true)
  shippingNotifications  Boolean   @default(true)
  deliveryReminders      Boolean   @default(true)
  farmUpdates            Boolean   @default(true)
  newProducts            Boolean   @default(true)
  promotions             Boolean   @default(true)
  seasonalNews           Boolean   @default(true)
  newsletter             Boolean   @default(true)
  productRecommendations Boolean   @default(true)
  securityAlerts         Boolean   @default(true)
  accountUpdates         Boolean   @default(true)
  priceAlerts            Boolean   @default(true)
  inventoryAlerts        Boolean   @default(true)
  surveyRequests         Boolean   @default(true)
  unsubscribedAll        Boolean   @default(false)
  unsubscribedAt         DateTime?
  unsubscribeToken       String?   @unique @db.VarChar(64)
  unsubscribeReason      String?   @db.VarChar(500)
  unsubscribeFeedback    String?
  createdAt              DateTime  @default(now())
  updatedAt              DateTime  @updatedAt
  user                   User      @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId])
  @@index([unsubscribeToken])
  @@map("email_preferences")
}

model EmailLog {
  id             String      @id @default(cuid())
  userId         String?     @db.VarChar(255)
  recipient      String      @db.VarChar(255)
  emailType      EmailType   @default(OTHER)
  subject        String      @db.VarChar(500)
  status         EmailStatus @default(PENDING)
  sentAt         DateTime?
  deliveredAt    DateTime?
  failedAt       DateTime?
  errorMessage   String?
  attemptCount   Int         @default(0)
  lastAttemptAt  DateTime?
  openedAt       DateTime?
  clickedAt      DateTime?
  unsubscribedAt DateTime?
  jobId          String?     @unique @db.VarChar(255)
  queueName      String?     @db.VarChar(100)
  metadata       Json?
  createdAt      DateTime    @default(now())
  updatedAt      DateTime    @updatedAt
  user           User?       @relation(fields: [userId], references: [id])

  @@index([userId])
  @@index([recipient])
  @@index([emailType])
  @@index([status])
  @@index([sentAt])
  @@index([jobId])
  @@index([createdAt])
  @@map("email_logs")
}

model UserSettings {
  id                      String   @id @default(cuid())
  userId                  String   @unique
  notificationPreferences Json?
  theme                   String   @default("light") @db.VarChar(20)
  language                String   @default("en") @db.VarChar(10)
  timezone                String   @default("UTC") @db.VarChar(100)
  distanceUnit            String   @default("miles") @db.VarChar(20)
  currency                String   @default("USD") @db.VarChar(10)
  profileVisibility       String   @default("public") @db.VarChar(20)
  showEmail               Boolean  @default(false)
  showPhone               Boolean  @default(false)
  allowMessaging          Boolean  @default(true)
  dataSharing             Boolean  @default(false)
  contactMethod           String   @default("email") @db.VarChar(20)
  communicationFrequency  String   @default("normal") @db.VarChar(20)
  createdAt               DateTime @default(now())
  updatedAt               DateTime @updatedAt
  user                    User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId])
  @@map("user_settings")
}

model NotificationPreferencesV2 {
  id                   String   @id @default(cuid())
  userId               String   @unique
  emailEnabled         Boolean  @default(true)
  emailFrequency       String   @default("immediate") @db.VarChar(20)
  emailQuietHoursStart String?  @db.VarChar(5)
  emailQuietHoursEnd   String?  @db.VarChar(5)
  smsEnabled           Boolean  @default(false)
  smsFrequency         String   @default("immediate") @db.VarChar(20)
  smsQuietHoursStart   String?  @db.VarChar(5)
  smsQuietHoursEnd     String?  @db.VarChar(5)
  pushEnabled          Boolean  @default(true)
  pushFrequency        String   @default("immediate") @db.VarChar(20)
  pushQuietHoursStart  String?  @db.VarChar(5)
  pushQuietHoursEnd    String?  @db.VarChar(5)
  inAppEnabled         Boolean  @default(true)
  inAppSound           Boolean  @default(true)
  inAppBadge           Boolean  @default(true)
  createdAt            DateTime @default(now())
  updatedAt            DateTime @updatedAt
  user                 User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId])
  @@map("notification_preferences_v2")
}

model FarmSettings {
  id                     String          @id @default(cuid())
  farmId                 String          @unique
  deliveryAreas          Json?
  deliveryFee            Float?
  minOrderValue          Float?
  acceptedPaymentMethods String[]
  requireDepositOnOrders Boolean         @default(false)
  depositPercentage      Float?
  returnPolicy           String?
  cancellationPolicy     String?
  termsAndConditions     String?
  enablePreOrders        Boolean         @default(false)
  enableSubscriptions    Boolean         @default(false)
  enableGiftCards        Boolean         @default(false)
  createdAt              DateTime        @default(now())
  updatedAt              DateTime        @updatedAt
  businessHours          BusinessHours[]
  farm                   Farm            @relation(fields: [farmId], references: [id], onDelete: Cascade)

  @@index([farmId])
  @@map("farm_settings")
}

model BusinessHours {
  id             String       @id @default(cuid())
  farmSettingsId String
  dayOfWeek      Int          @db.SmallInt
  openTime       String       @db.VarChar(5)
  closeTime      String       @db.VarChar(5)
  timezone       String       @default("UTC") @db.VarChar(100)
  isClosed       Boolean      @default(false)
  effectiveFrom  DateTime?
  effectiveTo    DateTime?
  createdAt      DateTime     @default(now())
  updatedAt      DateTime     @updatedAt
  farmSettings   FarmSettings @relation(fields: [farmSettingsId], references: [id], onDelete: Cascade)

  @@unique([farmSettingsId, dayOfWeek])
  @@index([farmSettingsId])
  @@index([dayOfWeek])
  @@map("business_hours")
}

model SystemSettings {
  id          String   @id @default(cuid())
  key         String   @unique @db.VarChar(255)
  value       Json
  type        String   @db.VarChar(20)
  category    String   @db.VarChar(50)
  description String?
  isPublic    Boolean  @default(false)
  isEditable  Boolean  @default(true)
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  @@index([category])
  @@index([isPublic])
  @@index([key])
  @@map("system_settings")
}

model SMSLog {
  id           String    @id @default(cuid())
  userId       String
  phoneNumber  String    @db.VarChar(20)
  message      String
  status       String    @db.VarChar(20)
  messageId    String?   @db.VarChar(255)
  errorMessage String?
  metadata     Json      @default("{}")
  sentAt       DateTime?
  failedAt     DateTime?
  createdAt    DateTime  @default(now())
  updatedAt    DateTime  @updatedAt
  user         User      @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId])
  @@index([status])
  @@index([createdAt])
  @@index([phoneNumber])
  @@map("sms_logs")
}

model PushNotificationLog {
  id             String    @id @default(cuid())
  userId         String
  notificationId String?
  title          String    @db.VarChar(255)
  body           String
  data           Json      @default("{}")
  status         String    @db.VarChar(20)
  successCount   Int       @default(0)
  failureCount   Int       @default(0)
  errorMessage   String?
  sentAt         DateTime?
  failedAt       DateTime?
  createdAt      DateTime  @default(now())
  updatedAt      DateTime  @updatedAt
  user           User      @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId])
  @@index([notificationId])
  @@index([status])
  @@index([createdAt])
  @@map("push_notification_logs")
}

model DeviceToken {
  id         String   @id @default(cuid())
  userId     String
  token      String   @unique @db.VarChar(255)
  platform   String   @db.VarChar(20)
  isActive   Boolean  @default(true)
  lastUsedAt DateTime @default(now())
  createdAt  DateTime @default(now())
  updatedAt  DateTime @updatedAt
  user       User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId])
  @@index([platform])
  @@index([isActive])
  @@index([token])
  @@map("device_tokens")
}

model ChatThread {
  id             String        @id @default(cuid())
  userId         String?
  farmId         String?
  title          String?       @db.VarChar(255)
  provider       ChatProvider  @default(OLLAMA)
  model          String?       @db.VarChar(100)
  isActive       Boolean       @default(true)
  messageCount   Int           @default(0)
  lastActivityAt DateTime      @default(now())
  createdAt      DateTime      @default(now())
  updatedAt      DateTime      @updatedAt
  messages       ChatMessage[]
  summaries      ChatSummary[]
  farm           Farm?         @relation(fields: [farmId], references: [id])
  user           User?         @relation(fields: [userId], references: [id])

  @@index([userId])
  @@index([farmId])
  @@index([provider])
  @@index([isActive])
  @@index([lastActivityAt])
  @@index([createdAt])
  @@map("chat_threads")
}

model ChatMessage {
  id         String     @id @default(cuid())
  threadId   String
  role       ChatRole
  content    String
  tokens     Int?
  model      String?    @db.VarChar(100)
  confidence Float?
  citations  Json?
  createdAt  DateTime   @default(now())
  thread     ChatThread @relation(fields: [threadId], references: [id], onDelete: Cascade)

  @@index([threadId])
  @@index([role])
  @@index([createdAt])
  @@map("chat_messages")
}

model ChatSummary {
  id              String     @id @default(cuid())
  threadId        String
  summary         String
  keyTopics       Json?
  keyEntities     Json?
  userIntent      String?    @db.VarChar(500)
  messagesCovered Int        @default(0)
  tokensCondensed Int?
  summaryTokens   Int?
  confidence      Float?
  createdAt       DateTime   @default(now())
  expiresAt       DateTime?
  thread          ChatThread @relation(fields: [threadId], references: [id], onDelete: Cascade)

  @@index([threadId])
  @@index([createdAt])
  @@index([expiresAt])
  @@map("chat_summaries")
}

enum UserRole {
  CONSUMER
  FARMER
  ADMIN
  SUPER_ADMIN
  MODERATOR
}

enum UserStatus {
  ACTIVE
  SUSPENDED
  DELETED
}

enum FarmStatus {
  PENDING
  ACTIVE
  SUSPENDED
  INACTIVE
}

enum FarmVerificationStatus {
  PENDING
  VERIFIED
  REJECTED
}

enum TeamMemberRole {
  OWNER
  MANAGER
  STAFF
}

enum TeamMemberStatus {
  INVITED
  ACTIVE
  REMOVED
}

enum CertificationType {
  ORGANIC
  REGENERATIVE
  ANIMAL_WELFARE
  KOSHER
  HALAL
  FAIR_TRADE
  BIODYNAMIC
  OTHER
}

enum CertificationStatus {
  PENDING
  VERIFIED
  EXPIRED
  REJECTED
}

enum ProductCategory {
  VEGETABLES
  FRUITS
  DAIRY
  EGGS
  MEAT
  POULTRY
  SEAFOOD
  PANTRY
  BEVERAGES
  BAKED_GOODS
  PREPARED_FOODS
  FLOWERS
  HERBS
  OTHER
}

enum ProductStatus {
  DRAFT
  ACTIVE
  OUT_OF_STOCK
  ARCHIVED
}

enum OrderStatus {
  PENDING
  CONFIRMED
  PREPARING
  READY
  FULFILLED
  COMPLETED
  CANCELLED
}

enum PaymentStatus {
  PENDING
  PROCESSING
  PAID
  FAILED
  REFUNDED
  PARTIALLY_REFUNDED
}

enum PaymentMethod {
  STRIPE
  CARD
  PAYPAL
  CASH
  BANK_TRANSFER
}

enum FulfillmentMethod {
  DELIVERY
  FARM_PICKUP
  MARKET_PICKUP
}

enum FulfillmentStatus {
  PENDING
  SCHEDULED
  IN_TRANSIT
  READY_FOR_PICKUP
  DELIVERED
  FAILED
}

enum AddressType {
  HOME
  WORK
  OTHER
}

enum QualityIssueType {
  SPOILED
  MISSING_ITEMS
  WRONG_ITEMS
  POOR_QUALITY
  QUANTITY_MISMATCH
  DAMAGED
  OTHER
}

enum QualityIssueStatus {
  OPEN
  IN_REVIEW
  RESOLVED
  DISPUTED
}

enum ResolutionType {
  FULL_REFUND
  PARTIAL_REFUND
  REPLACEMENT
  CREDIT
  NO_ACTION
}

enum ReviewStatus {
  PENDING
  APPROVED
  FLAGGED
  REMOVED
}

enum NotificationType {
  ORDER_PLACED
  ORDER_CONFIRMED
  ORDER_READY
  ORDER_FULFILLED
  ORDER_CANCELLED
  PAYMENT_RECEIVED
  PAYOUT_PROCESSED
  NEW_MESSAGE
  REVIEW_RECEIVED
  QUALITY_ISSUE
  LOW_STOCK
  SYSTEM_ANNOUNCEMENT
}

enum NotificationChannel {
  EMAIL
  SMS
  PUSH
  IN_APP
}

enum AdminActionType {
  USER_APPROVED
  USER_SUSPENDED
  USER_DELETED
  USER_REACTIVATED
  USER_ACTIVATED
  USER_PROMOTED_ADMIN
  USER_DEMOTED_ADMIN
  USER_PASSWORD_RESET
  FARM_VERIFIED
  FARM_REJECTED
  FARM_SUSPENDED
  ORDER_REFUNDED
  PRODUCT_REMOVED
  SETTING_CHANGED
  ANNOUNCEMENT_CREATED
}

enum Season {
  SPRING
  SUMMER
  FALL
  WINTER
}

enum GrowthPhase {
  PREPARING
  SEEDING
  SPROUTING
  GROWING
  FLOWERING
  RIPENING
  HARVESTING
  RESTING
}

enum LunarPhase {
  NEW_MOON
  WAXING_CRESCENT
  FIRST_QUARTER
  WAXING_GIBBOUS
  FULL_MOON
  WANING_GIBBOUS
  LAST_QUARTER
  WANING_CRESCENT
}

enum SoilType {
  CLAY
  SANDY
  LOAM
  SILT
  PEATY
  CHALKY
  MIXED
}

enum DrainageLevel {
  EXCELLENT
  GOOD
  MODERATE
  POOR
  VERY_POOR
}

enum CompactionLevel {
  NONE
  LOW
  MODERATE
  HIGH
  SEVERE
}

enum WeatherCondition {
  CLEAR
  PARTLY_CLOUDY
  CLOUDY
  OVERCAST
  LIGHT_RAIN
  RAIN
  HEAVY_RAIN
  THUNDERSTORM
  SNOW
  SLEET
  FOG
  WINDY
}

enum CropFamily {
  ASTERACEAE
  AMARANTHACEAE
  BRASSICACEAE
  APIACEAE
  SOLANACEAE
  CUCURBITACEAE
  FABACEAE
  AMARYLLIDACEAE
  LAMIACEAE
  POACEAE
  OTHER
}

enum HarvestQuality {
  EXCELLENT
  GOOD
  FAIR
  POOR
  FAILED
}

enum HarvestStatus {
  PLANNED
  IN_PROGRESS
  COMPLETED
  DELAYED
  CANCELLED
}

enum MLModelStatus {
  TRAINING
  VALIDATING
  READY
  DEPLOYED
  DEPRECATED
  FAILED
}

enum InventoryStatus {
  IN_STOCK
  LOW_STOCK
  OUT_OF_STOCK
  DISCONTINUED
}

enum StockMovementType {
  PURCHASE
  SALE
  ADJUSTMENT
  TRANSFER
  RETURN
  WASTE
}

enum AlertType {
  LOW_STOCK
  EXPIRING_SOON
  EXPIRED
  OVERSTOCK
}

enum AlertSeverity {
  INFO
  WARNING
  CRITICAL
}

enum SupportTicketStatus {
  OPEN
  IN_PROGRESS
  WAITING_FOR_RESPONSE
  RESOLVED
  CLOSED
}

enum SupportTicketPriority {
  LOW
  MEDIUM
  HIGH
  URGENT
}

enum SupportTicketCategory {
  ACCOUNT
  ORDERS
  PAYMENTS
  PRODUCTS
  TECHNICAL
  FARM_MANAGEMENT
  GENERAL
  BUG_REPORT
  FEATURE_REQUEST
  OTHER
}

enum AuditAction {
  CREATE
  UPDATE
  DELETE
  LOGIN
  LOGOUT
  PERMISSION_CHANGE
  STATUS_CHANGE
  APPROVE
  REJECT
  SUSPEND
  RESTORE
}

enum NotificationFrequency {
  REALTIME
  HOURLY
  DAILY
  WEEKLY
  MONTHLY
}

enum SearchAlertType {
  NEW_PRODUCTS
  PRICE_CHANGE
  BACK_IN_STOCK
  SEASONAL_AVAILABLE
  FARM_UPDATE
  CUSTOM
}

enum SharePermission {
  VIEW
  EDIT
  ADMIN
}

enum InteractionType {
  SEARCH
  VIEW
  CLICK
  ADD_TO_CART
  PURCHASE
  FAVORITE
  REVIEW
  SHARE
}

enum PeriodType {
  HOUR
  DAY
  WEEK
  MONTH
  QUARTER
  YEAR
}

enum RecommendationType {
  SIMILAR_PRODUCT
  SIMILAR_PRODUCTS
  COMPLEMENTARY
  FREQUENTLY_BOUGHT_TOGETHER
  TRENDING
  SEASONAL
  POPULAR_IN_AREA
  FARM_DISCOVERY
  PERSONALIZED
  PERSONALIZED_PRODUCTS
  COLLABORATIVE
  BASED_ON_BROWSING
  NEW_ARRIVALS
}

enum ABTestStatus {
  DRAFT
  ACTIVE
  PAUSED
  COMPLETED
  ARCHIVED
}

enum AnalyticsGranularity {
  MINUTE
  HOUR
  DAY
  WEEK
  MONTH
  QUARTER
  YEAR
}

enum TrendDirection {
  RISING
  FALLING
  STABLE
  VOLATILE
  SEASONAL
}

enum MLModelType {
  RECOMMENDATION
  DEMAND_FORECASTING
  PRICE_OPTIMIZATION
  CHURN_PREDICTION
  SEASONALITY_DETECTION
  QUALITY_PREDICTION
  SENTIMENT_ANALYSIS
  YIELD_PREDICTION
}

enum MLTrainingStatus {
  PENDING
  RUNNING
  COMPLETED
  FAILED
  CANCELLED
}

enum EmailType {
  ORDER_CONFIRMATION
  ORDER_STATUS_UPDATE
  ORDER_SHIPPED
  ORDER_DELIVERED
  ORDER_CANCELLED
  PASSWORD_RESET
  VERIFICATION
  WELCOME
  FARM_APPROVED
  FARM_REJECTED
  FARM_UPDATE
  NEW_PRODUCT
  PROMOTION
  SEASONAL_NEWS
  SHIPPING_NOTIFICATION
  DELIVERY_REMINDER
  ACCOUNT_UPDATE
  SECURITY_ALERT
  PRICE_ALERT
  INVENTORY_ALERT
  SURVEY_REQUEST
  NEWSLETTER
  PRODUCT_RECOMMENDATION
  OTHER
}

enum EmailStatus {
  PENDING
  QUEUED
  SENDING
  SENT
  DELIVERED
  FAILED
  BOUNCED
  DROPPED
  DEFERRED
}

enum ChatProvider {
  OLLAMA
  PERPLEXITY
  OPENAI
  ANTHROPIC
}

enum ChatRole {
  SYSTEM
  USER
  ASSISTANT
  FUNCTION
}
