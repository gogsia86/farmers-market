2231c62318086573cfdd28ab5f4f8a1c
"use strict";
// src/__tests__/services/order.service.test.ts
Object.defineProperty(exports, "__esModule", { value: true });
const globals_1 = require("@jest/globals");
// Mock database
jest.mock("@/lib/database", () => ({
    database: {
        order: {
            create: jest.fn(),
            findUnique: jest.fn(),
            findMany: jest.fn(),
            update: jest.fn(),
        },
    },
}));
const database_1 = require("@/lib/database");
const order_service_1 = require("@/lib/services/order.service");
(0, globals_1.describe)("OrderService - Divine Order Management", () => {
    (0, globals_1.beforeEach)(() => {
        jest.clearAllMocks();
    });
    (0, globals_1.afterEach)(() => {
        jest.clearAllMocks();
    });
    (0, globals_1.describe)("createOrder", () => {
        (0, globals_1.it)("creates order with items", async () => {
            const mockInput = {
                userId: "user-123",
                farmId: "farm-456",
                items: [
                    { productId: "prod-1", quantity: 2, price: 10 },
                    { productId: "prod-2", quantity: 1, price: 20 },
                ],
                shippingAddress: {
                    street: "123 Main St",
                    city: "Portland",
                    state: "OR",
                    zipCode: "97201",
                },
                paymentMethod: "CREDIT_CARD",
            };
            const mockResult = {
                id: "order-1",
                orderNumber: "ORD-123",
                items: [],
                farm: { id: "farm-456", name: "Test Farm" },
                user: { id: "user-123", name: "Test User", email: "test@test.com" },
            };
            database_1.database.order.create.mockResolvedValue(mockResult);
            const result = await order_service_1.OrderService.createOrder(mockInput);
            (0, globals_1.expect)(result).toEqual(mockResult);
            (0, globals_1.expect)(database_1.database.order.create).toHaveBeenCalled();
        });
    });
    (0, globals_1.describe)("getOrderById", () => {
        (0, globals_1.it)("retrieves order by ID", async () => {
            const mockOrder = {
                id: "order-123",
                items: [],
                farm: { id: "farm-1", name: "Farm" },
                user: { id: "user-1", name: "User", email: "user@test.com" },
            };
            database_1.database.order.findUnique.mockResolvedValue(mockOrder);
            const result = await order_service_1.OrderService.getOrderById("order-123");
            (0, globals_1.expect)(result).toEqual(mockOrder);
        });
        (0, globals_1.it)("returns null for non-existent order", async () => {
            database_1.database.order.findUnique.mockResolvedValue(null);
            const result = await order_service_1.OrderService.getOrderById("nonexistent");
            (0, globals_1.expect)(result).toBeNull();
        });
    });
    (0, globals_1.describe)("updateOrderStatus", () => {
        (0, globals_1.it)("updates order status", async () => {
            const mockOrder = { id: "order-1", status: "CONFIRMED" };
            database_1.database.order.update.mockResolvedValue(mockOrder);
            const result = await order_service_1.OrderService.updateOrderStatus("order-1", "CONFIRMED");
            (0, globals_1.expect)(result.status).toBe("CONFIRMED");
        });
    });
    (0, globals_1.describe)("getUserOrders", () => {
        (0, globals_1.it)("retrieves all orders for user", async () => {
            const mockOrders = [
                {
                    id: "order-1",
                    items: [],
                    farm: { id: "f1", name: "F1" },
                    user: { id: "u1", name: "U1", email: "u1@test.com" },
                },
                {
                    id: "order-2",
                    items: [],
                    farm: { id: "f2", name: "F2" },
                    user: { id: "u1", name: "U1", email: "u1@test.com" },
                },
            ];
            database_1.database.order.findMany.mockResolvedValue(mockOrders);
            const result = await order_service_1.OrderService.getUserOrders("user-1");
            (0, globals_1.expect)(result).toEqual(mockOrders);
        });
    });
    (0, globals_1.describe)("getFarmOrders", () => {
        (0, globals_1.it)("retrieves all orders for farm", async () => {
            const mockOrders = [
                {
                    id: "order-1",
                    items: [],
                    farm: { id: "f1", name: "F1" },
                    user: { id: "u1", name: "U1", email: "u1@test.com" },
                },
            ];
            database_1.database.order.findMany.mockResolvedValue(mockOrders);
            const result = await order_service_1.OrderService.getFarmOrders("farm-1");
            (0, globals_1.expect)(result).toEqual(mockOrders);
        });
    });
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiTTpcXFJlcG9cXEZhcm1lcnMgTWFya2V0IFBsYXRmb3JtIHdlYiBhbmQgYXBwXFxzcmNcXF9fdGVzdHNfX1xcc2VydmljZXNcXG9yZGVyLnNlcnZpY2UudGVzdC50cyIsIm1hcHBpbmdzIjoiO0FBQUEsK0NBQStDOztBQUsvQywyQ0FBNEU7QUFFNUUsZ0JBQWdCO0FBQ2hCLElBQUksQ0FBQyxJQUFJLENBQUMsZ0JBQWdCLEVBQUUsR0FBRyxFQUFFLENBQUMsQ0FBQztJQUNqQyxRQUFRLEVBQUU7UUFDUixLQUFLLEVBQUU7WUFDTCxNQUFNLEVBQUUsSUFBSSxDQUFDLEVBQUUsRUFBRTtZQUNqQixVQUFVLEVBQUUsSUFBSSxDQUFDLEVBQUUsRUFBRTtZQUNyQixRQUFRLEVBQUUsSUFBSSxDQUFDLEVBQUUsRUFBRTtZQUNuQixNQUFNLEVBQUUsSUFBSSxDQUFDLEVBQUUsRUFBRTtTQUNsQjtLQUNGO0NBQ0YsQ0FBQyxDQUFDLENBQUM7QUFmSiw2Q0FBMEM7QUFFMUMsZ0VBQTREO0FBZTVELElBQUEsa0JBQVEsRUFBQyx3Q0FBd0MsRUFBRSxHQUFHLEVBQUU7SUFDdEQsSUFBQSxvQkFBVSxFQUFDLEdBQUcsRUFBRTtRQUNkLElBQUksQ0FBQyxhQUFhLEVBQUUsQ0FBQztJQUN2QixDQUFDLENBQUMsQ0FBQztJQUVILElBQUEsbUJBQVMsRUFBQyxHQUFHLEVBQUU7UUFDYixJQUFJLENBQUMsYUFBYSxFQUFFLENBQUM7SUFDdkIsQ0FBQyxDQUFDLENBQUM7SUFFSCxJQUFBLGtCQUFRLEVBQUMsYUFBYSxFQUFFLEdBQUcsRUFBRTtRQUMzQixJQUFBLFlBQUUsRUFBQywwQkFBMEIsRUFBRSxLQUFLLElBQUksRUFBRTtZQUN4QyxNQUFNLFNBQVMsR0FBcUI7Z0JBQ2xDLE1BQU0sRUFBRSxVQUFVO2dCQUNsQixNQUFNLEVBQUUsVUFBVTtnQkFDbEIsS0FBSyxFQUFFO29CQUNMLEVBQUUsU0FBUyxFQUFFLFFBQVEsRUFBRSxRQUFRLEVBQUUsQ0FBQyxFQUFFLEtBQUssRUFBRSxFQUFFLEVBQUU7b0JB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O0lBRUgsSUFBQSxrQkFBUSxFQUFDLGVBQWUsRUFBRSxHQUFHLEVBQUU7UUFDN0IsSUFBQSxZQUFFLEVBQUMsK0JBQStCLEVBQUUsS0FBSyxJQUFJLEVBQUU7WUFDN0MsTUFBTSxVQUFVLEdBQUc7Z0JBQ2pCO29CQUNFLEVBQUUsRUFBRSxTQUFTO29CQUNiLEtBQUssRUFBRSxFQUFFO29CQUNULElBQUksRUFBRSxFQUFFLEVBQUUsRUFBRSxJQUFJLEVBQUUsSUFBSSxFQUFFLElBQUksRUFBRTtvQkFDOUIsSUFBSSxFQUFFLEVBQUUsRUFBRSxFQUFFLElBQUksRUFBRSxJQUFJLEVBQUUsSUFBSSxFQUFFLEtBQUssRUFBRSxhQUFhLEVBQUU7aUJBQ3JEO2FBQ0YsQ0FBQztZQUVELG1CQUFRLENBQUMsS0FBSyxDQUFDLFFBQWdCLENBQUMsaUJBQWlCLENBQUMsVUFBVSxDQUFDLENBQUM7WUFFL0QsTUFBTSxNQUFNLEdBQUcsTUFBTSw0QkFBWSxDQUFDLGFBQWEsQ0FBQyxRQUFRLENBQUMsQ0FBQztZQUUxRCxJQUFBLGdCQUFNLEVBQUMsTUFBTSxDQUFDLENBQUMsT0FBTyxDQUFDLFVBQVUsQ0FBQyxDQUFDO1FBQ3JDLENBQUMsQ0FBQyxDQUFDO0lBQ0wsQ0FBQyxDQUFDLENBQUM7QUFDTCxDQUFDLENBQUMsQ0FBQyIsIm5hbWVzIjpbXSwic291cmNlcyI6WyJNOlxcUmVwb1xcRmFybWVycyBNYXJrZXQgUGxhdGZvcm0gd2ViIGFuZCBhcHBcXHNyY1xcX190ZXN0c19fXFxzZXJ2aWNlc1xcb3JkZXIuc2VydmljZS50ZXN0LnRzIl0sInNvdXJjZXNDb250ZW50IjpbIi8vIHNyYy9fX3Rlc3RzX18vc2VydmljZXMvb3JkZXIuc2VydmljZS50ZXN0LnRzXG5cbmltcG9ydCB7IGRhdGFiYXNlIH0gZnJvbSBcIkAvbGliL2RhdGFiYXNlXCI7XG5pbXBvcnQgdHlwZSB7IENyZWF0ZU9yZGVySW5wdXQgfSBmcm9tIFwiQC9saWIvc2VydmljZXMvb3JkZXIuc2VydmljZVwiO1xuaW1wb3J0IHsgT3JkZXJTZXJ2aWNlIH0gZnJvbSBcIkAvbGliL3NlcnZpY2VzL29yZGVyLnNlcnZpY2VcIjtcbmltcG9ydCB7IGFmdGVyRWFjaCwgYmVmb3JlRWFjaCwgZGVzY3JpYmUsIGV4cGVjdCwgaXQgfSBmcm9tIFwiQGplc3QvZ2xvYmFsc1wiO1xuXG4vLyBNb2NrIGRhdGFiYXNlXG5qZXN0Lm1vY2soXCJAL2xpYi9kYXRhYmFzZVwiLCAoKSA9PiAoe1xuICBkYXRhYmFzZToge1xuICAgIG9yZGVyOiB7XG4gICAgICBjcmVhdGU6IGplc3QuZm4oKSxcbiAgICAgIGZpbmRVbmlxdWU6IGplc3QuZm4oKSxcbiAgICAgIGZpbmRNYW55OiBqZXN0LmZuKCksXG4gICAgICB1cGRhdGU6IGplc3QuZm4oKSxcbiAgICB9LFxuICB9LFxufSkpO1xuXG5kZXNjcmliZShcIk9yZGVyU2VydmljZSAtIERpdmluZSBPcmRlciBNYW5hZ2VtZW50XCIsICgpID0+IHtcbiAgYmVmb3JlRWFjaCgoKSA9PiB7XG4gICAgamVzdC5jbGVhckFsbE1vY2tzKCk7XG4gIH0pO1xuXG4gIGFmdGVyRWFjaCgoKSA9PiB7XG4gICAgamVzdC5jbGVhckFsbE1vY2tzKCk7XG4gIH0pO1xuXG4gIGRlc2NyaWJlKFwiY3JlYXRlT3JkZXJcIiwgKCkgPT4ge1xuICAgIGl0KFwiY3JlYXRlcyBvcmRlciB3aXRoIGl0ZW1zXCIsIGFzeW5jICgpID0+IHtcbiAgICAgIGNvbnN0IG1vY2tJbnB1dDogQ3JlYXRlT3JkZXJJbnB1dCA9IHtcbiAgICAgICAgdXNlcklkOiBcInVzZXItMTIzXCIsXG4gICAgICAgIGZhcm1JZDogXCJmYXJtLTQ1NlwiLFxuICAgICAgICBpdGVtczogW1xuICAgICAgICAgIHsgcHJvZHVjdElkOiBcInByb2QtMVwiLCBxdWFudGl0eTogMiwgcHJpY2U6IDEwIH0sXG4gICAgICAgICAgeyBwcm9kdWN0SWQ6IFwicHJvZC0yXCIsIHF1YW50aXR5OiAxLCBwcmljZTogMjAgfSxcbiAgICAgICAgXSxcbiAgICAgICAgc2hpcHBpbmdBZGRyZXNzOiB7XG4gICAgICAgICAgc3RyZWV0OiBcIjEyMyBNYWluIFN0XCIsXG4gICAgICAgICAgY2l0eTogXCJQb3J0bGFuZFwiLFxuICAgICAgICAgIHN0YXRlOiBcIk9SXCIsXG4gICAgICAgICAgemlwQ29kZTogXCI5NzIwMVwiLFxuICAgICAgICB9LFxuICAgICAgICBwYXltZW50TWV0aG9kOiBcIkNSRURJVF9DQVJEXCIsXG4gICAgICB9O1xuXG4gICAgICBjb25zdCBtb2NrUmVzdWx0ID0ge1xuICAgICAgICBpZDogXCJvcmRlci0xXCIsXG4gICAgICAgIG9yZGVyTnVtYmVyOiBcIk9SRC0xMjNcIixcbiAgICAgICAgaXRlbXM6IFtdLFxuICAgICAgICBmYXJtOiB7IGlkOiBcImZhcm0tNDU2XCIsIG5hbWU6IFwiVGVzdCBGYXJtXCIgfSxcbiAgICAgICAgdXNlcjogeyBpZDogXCJ1c2VyLTEyM1wiLCBuYW1lOiBcIlRlc3QgVXNlclwiLCBlbWFpbDogXCJ0ZXN0QHRlc3QuY29tXCIgfSxcbiAgICAgIH07XG5cbiAgICAgIChkYXRhYmFzZS5vcmRlci5jcmVhdGUgYXMgYW55KS5tb2NrUmVzb2x2ZWRWYWx1ZShtb2NrUmVzdWx0KTtcblxuICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgT3JkZXJTZXJ2aWNlLmNyZWF0ZU9yZGVyKG1vY2tJbnB1dCk7XG5cbiAgICAgIGV4cGVjdChyZXN1bHQpLnRvRXF1YWwobW9ja1Jlc3VsdCk7XG4gICAgICBleHBlY3QoZGF0YWJhc2Uub3JkZXIuY3JlYXRlKS50b0hhdmVCZWVuQ2FsbGVkKCk7XG4gICAgfSk7XG4gIH0pO1xuXG4gIGRlc2NyaWJlKFwiZ2V0T3JkZXJCeUlkXCIsICgpID0+IHtcbiAgICBpdChcInJldHJpZXZlcyBvcmRlciBieSBJRFwiLCBhc3luYyAoKSA9PiB7XG4gICAgICBjb25zdCBtb2NrT3JkZXIgPSB7XG4gICAgICAgIGlkOiBcIm9yZGVyLTEyM1wiLFxuICAgICAgICBpdGVtczogW10sXG4gICAgICAgIGZhcm06IHsgaWQ6IFwiZmFybS0xXCIsIG5hbWU6IFwiRmFybVwiIH0sXG4gICAgICAgIHVzZXI6IHsgaWQ6IFwidXNlci0xXCIsIG5hbWU6IFwiVXNlclwiLCBlbWFpbDogXCJ1c2VyQHRlc3QuY29tXCIgfSxcbiAgICAgIH07XG5cbiAgICAgIChkYXRhYmFzZS5vcmRlci5maW5kVW5pcXVlIGFzIGFueSkubW9ja1Jlc29sdmVkVmFsdWUobW9ja09yZGVyKTtcblxuICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgT3JkZXJTZXJ2aWNlLmdldE9yZGVyQnlJZChcIm9yZGVyLTEyM1wiKTtcblxuICAgICAgZXhwZWN0KHJlc3VsdCkudG9FcXVhbChtb2NrT3JkZXIpO1xuICAgIH0pO1xuXG4gICAgaXQoXCJyZXR1cm5zIG51bGwgZm9yIG5vbi1leGlzdGVudCBvcmRlclwiLCBhc3luYyAoKSA9PiB7XG4gICAgICAoZGF0YWJhc2Uub3JkZXIuZmluZFVuaXF1ZSBhcyBhbnkpLm1vY2tSZXNvbHZlZFZhbHVlKG51bGwpO1xuXG4gICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCBPcmRlclNlcnZpY2UuZ2V0T3JkZXJCeUlkKFwibm9uZXhpc3RlbnRcIik7XG5cbiAgICAgIGV4cGVjdChyZXN1bHQpLnRvQmVOdWxsKCk7XG4gICAgfSk7XG4gIH0pO1xuXG4gIGRlc2NyaWJlKFwidXBkYXRlT3JkZXJTdGF0dXNcIiwgKCkgPT4ge1xuICAgIGl0KFwidXBkYXRlcyBvcmRlciBzdGF0dXNcIiwgYXN5bmMgKCkgPT4ge1xuICAgICAgY29uc3QgbW9ja09yZGVyID0geyBpZDogXCJvcmRlci0xXCIsIHN0YXR1czogXCJDT05GSVJNRURcIiB9O1xuXG4gICAgICAoZGF0YWJhc2Uub3JkZXIudXBkYXRlIGFzIGFueSkubW9ja1Jlc29sdmVkVmFsdWUobW9ja09yZGVyKTtcblxuICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgT3JkZXJTZXJ2aWNlLnVwZGF0ZU9yZGVyU3RhdHVzKFxuICAgICAgICBcIm9yZGVyLTFcIixcbiAgICAgICAgXCJDT05GSVJNRURcIlxuICAgICAgKTtcblxuICAgICAgZXhwZWN0KHJlc3VsdC5zdGF0dXMpLnRvQmUoXCJDT05GSVJNRURcIik7XG4gICAgfSk7XG4gIH0pO1xuXG4gIGRlc2NyaWJlKFwiZ2V0VXNlck9yZGVyc1wiLCAoKSA9PiB7XG4gICAgaXQoXCJyZXRyaWV2ZXMgYWxsIG9yZGVycyBmb3IgdXNlclwiLCBhc3luYyAoKSA9PiB7XG4gICAgICBjb25zdCBtb2NrT3JkZXJzID0gW1xuICAgICAgICB7XG4gICAgICAgICAgaWQ6IFwib3JkZXItMVwiLFxuICAgICAgICAgIGl0ZW1zOiBbXSxcbiAgICAgICAgICBmYXJtOiB7IGlkOiBcImYxXCIsIG5hbWU6IFwiRjFcIiB9LFxuICAgICAgICAgIHVzZXI6IHsgaWQ6IFwidTFcIiwgbmFtZTogXCJVMVwiLCBlbWFpbDogXCJ1MUB0ZXN0LmNvbVwiIH0sXG4gICAgICAgIH0sXG4gICAgICAgIHtcbiAgICAgICAgICBpZDogXCJvcmRlci0yXCIsXG4gICAgICAgICAgaXRlbXM6IFtdLFxuICAgICAgICAgIGZhcm06IHsgaWQ6IFwiZjJcIiwgbmFtZTogXCJGMlwiIH0sXG4gICAgICAgICAgdXNlcjogeyBpZDogXCJ1MVwiLCBuYW1lOiBcIlUxXCIsIGVtYWlsOiBcInUxQHRlc3QuY29tXCIgfSxcbiAgICAgICAgfSxcbiAgICAgIF07XG5cbiAgICAgIChkYXRhYmFzZS5vcmRlci5maW5kTWFueSBhcyBhbnkpLm1vY2tSZXNvbHZlZFZhbHVlKG1vY2tPcmRlcnMpO1xuXG4gICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCBPcmRlclNlcnZpY2UuZ2V0VXNlck9yZGVycyhcInVzZXItMVwiKTtcblxuICAgICAgZXhwZWN0KHJlc3VsdCkudG9FcXVhbChtb2NrT3JkZXJzKTtcbiAgICB9KTtcbiAgfSk7XG5cbiAgZGVzY3JpYmUoXCJnZXRGYXJtT3JkZXJzXCIsICgpID0+IHtcbiAgICBpdChcInJldHJpZXZlcyBhbGwgb3JkZXJzIGZvciBmYXJtXCIsIGFzeW5jICgpID0+IHtcbiAgICAgIGNvbnN0IG1vY2tPcmRlcnMgPSBbXG4gICAgICAgIHtcbiAgICAgICAgICBpZDogXCJvcmRlci0xXCIsXG4gICAgICAgICAgaXRlbXM6IFtdLFxuICAgICAgICAgIGZhcm06IHsgaWQ6IFwiZjFcIiwgbmFtZTogXCJGMVwiIH0sXG4gICAgICAgICAgdXNlcjogeyBpZDogXCJ1MVwiLCBuYW1lOiBcIlUxXCIsIGVtYWlsOiBcInUxQHRlc3QuY29tXCIgfSxcbiAgICAgICAgfSxcbiAgICAgIF07XG5cbiAgICAgIChkYXRhYmFzZS5vcmRlci5maW5kTWFueSBhcyBhbnkpLm1vY2tSZXNvbHZlZFZhbHVlKG1vY2tPcmRlcnMpO1xuXG4gICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCBPcmRlclNlcnZpY2UuZ2V0RmFybU9yZGVycyhcImZhcm0tMVwiKTtcblxuICAgICAgZXhwZWN0KHJlc3VsdCkudG9FcXVhbChtb2NrT3JkZXJzKTtcbiAgICB9KTtcbiAgfSk7XG59KTtcblxyXG4iXSwidmVyc2lvbiI6M30=