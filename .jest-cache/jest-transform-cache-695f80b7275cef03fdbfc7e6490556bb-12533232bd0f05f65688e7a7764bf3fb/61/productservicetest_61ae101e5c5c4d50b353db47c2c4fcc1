299e7b81c16104f0ee8b5a934c618fcf
"use strict";
/**
 * ðŸ›’ PRODUCT SERVICE TEST SUITE
 * Comprehensive tests for agricultural product management
 *
 * Coverage: 40+ tests for all product operations
 */
Object.defineProperty(exports, "__esModule", { value: true });
const globals_1 = require("@jest/globals");
// Mock the database
jest.mock("@/lib/database", () => ({
    database: {
        product: {
            findUnique: jest.fn(),
            findMany: jest.fn(),
            findFirst: jest.fn(),
            create: jest.fn(),
            update: jest.fn(),
            delete: jest.fn(),
            count: jest.fn(),
        },
        farm: {
            findUnique: jest.fn(),
        },
    },
}));
// Mock the slug utility
jest.mock("@/lib/utils/slug", () => ({
    generateSlug: jest.fn((name) => name.toLowerCase().replace(/\s+/g, "-")),
}));
const database_1 = require("@/lib/database");
const product_1 = require("@/types/product");
const product_service_1 = require("../product.service");
const mockDatabase = database_1.database;
(0, globals_1.describe)("ðŸ›’ Product Service - Divine Product Operations", () => {
    const mockUserId = "user-123";
    const mockFarmId = "farm-123";
    const mockProductId = "product-123";
    const mockFarm = {
        id: mockFarmId,
        ownerId: mockUserId,
        status: "ACTIVE",
        name: "Test Farm",
        slug: "test-farm",
    };
    const mockProduct = {
        id: mockProductId,
        name: "Organic Tomatoes",
        slug: "organic-tomatoes",
        farmId: mockFarmId,
        category: "VEGETABLES",
        description: "Fresh organic tomatoes",
        pricing: { basePrice: { amount: 500, currency: "USD" } },
        inventory: {
            quantity: 100,
            reservedQuantity: 10,
            availableQuantity: 90,
            lowStockThreshold: 20,
            isLowStock: false,
            inStock: true,
        },
        status: product_1.ProductStatus.AVAILABLE,
        isActive: true,
        images: [{ url: "https://example.com/tomato.jpg", isPrimary: true }],
        primaryPhotoUrl: "https://example.com/tomato.jpg",
        farm: mockFarm,
    };
    (0, globals_1.beforeEach)(() => {
        jest.clearAllMocks();
    });
    (0, globals_1.describe)("ðŸŽ¯ createProduct", () => {
        const validInput = {
            name: "Organic Tomatoes",
            farmId: mockFarmId,
            category: "VEGETABLES",
            description: "Fresh organic tomatoes",
            pricing: { basePrice: { amount: 500, currency: "USD" } },
            inventory: {
                quantity: 100,
                reservedQuantity: 0,
                lowStockThreshold: 20,
            },
            images: [{ url: "https://example.com/tomato.jpg", isPrimary: true }],
        };
        (0, globals_1.it)("should create product with valid data", async () => {
            jest.mocked(database_1.database.farm.findUnique).mockResolvedValue(mockFarm);
            jest.mocked(database_1.database.product.findFirst).mockResolvedValue(null);
            jest
                .mocked(database_1.database.product.create)
                .mockResolvedValue(mockProduct);
            const result = await product_service_1.ProductService.createProduct(validInput, mockUserId);
            (0, globals_1.expect)(result).toMatchObject({
                name: "Organic Tomatoes",
                slug: globals_1.expect.stringContaining("organic-tomatoes"),
            });
            (0, globals_1.expect)(database_1.database.farm.findUnique).toHaveBeenCalledWith({
                where: { id: mockFarmId },
                select: { id: true, ownerId: true, status: true },
            });
        });
        (0, globals_1.it)("should throw error if farm not found", async () => {
            jest.mocked(database_1.database.farm.findUnique).mockResolvedValue(null);
            await (0, globals_1.expect)(product_service_1.ProductService.createProduct(validInput, mockUserId)).rejects.toThrow("Farm not found");
        });
        (0, globals_1.it)("should throw error for unauthorized user", async () => {
            jest.mocked(database_1.database.farm.findUnique).mockResolvedValue({
                ...mockFarm,
                ownerId: "different-user",
            });
            await (0, globals_1.expect)(product_service_1.ProductService.createProduct(validInput, mockUserId)).rejects.toThrow("Unauthorized: You don't own this farm");
        });
        (0, globals_1.it)("should throw error for inactive farm", async () => {
            jest.mocked(database_1.database.farm.findUnique).mockResolvedValue({
                ...mockFarm,
                status: "INACTIVE",
            });
            await (0, globals_1.expect)(product_service_1.ProductService.createProduct(validInput, mockUserId)).rejects.toThrow("Cannot add products to inactive farm");
        });
        (0, globals_1.it)("should validate product name length (too short)", async () => {
            jest.mocked(database_1.database.farm.findUnique).mockResolvedValue(mockFarm);
            const shortNameInput = { ...validInput, name: "AB" };
            await (0, globals_1.expect)(product_service_1.ProductService.createProduct(shortNameInput, mockUserId)).rejects.toThrow("Product name must be at least 3 characters");
        });
        (0, globals_1.it)("should validate product name length (too long)", async () => {
            jest.mocked(database_1.database.farm.findUnique).mockResolvedValue(mockFarm);
            const longNameInput = { ...validInput, name: "A".repeat(101) };
            await (0, globals_1.expect)(product_service_1.ProductService.createProduct(longNameInput, mockUserId)).rejects.toThrow("Product name must not exceed 100 characters");
        });
        (0, globals_1.it)("should validate price is positive", async () => {
            jest.mocked(database_1.database.farm.findUnique).mockResolvedValue(mockFarm);
            const invalidPriceInput = {
                ...validInput,
                pricing: { basePrice: { amount: 0, currency: "USD" } },
            };
            await (0, globals_1.expect)(product_service_1.ProductService.createProduct(invalidPriceInput, mockUserId)).rejects.toThrow("Price must be greater than 0");
        });
        (0, globals_1.it)("should validate inventory quantity is non-negative", async () => {
            jest.mocked(database_1.database.farm.findUnique).mockResolvedValue(mockFarm);
            const negativeQuantityInput = {
                ...validInput,
                inventory: { ...validInput.inventory, quantity: -1 },
            };
            await (0, globals_1.expect)(product_service_1.ProductService.createProduct(negativeQuantityInput, mockUserId)).rejects.toThrow("Quantity cannot be negative");
        });
        (0, globals_1.it)("should validate reserved quantity does not exceed total", async () => {
            jest.mocked(database_1.database.farm.findUnique).mockResolvedValue(mockFarm);
            const invalidReservedInput = {
                ...validInput,
                inventory: {
                    ...validInput.inventory,
                    quantity: 50,
                    reservedQuantity: 60,
                },
            };
            await (0, globals_1.expect)(product_service_1.ProductService.createProduct(invalidReservedInput, mockUserId)).rejects.toThrow("Reserved quantity cannot exceed total quantity");
        });
        (0, globals_1.it)("should generate unique slug when duplicate exists", async () => {
            jest.mocked(database_1.database.farm.findUnique).mockResolvedValue(mockFarm);
            jest
                .mocked(database_1.database.product.findFirst)
                .mockResolvedValueOnce({ slug: "organic-tomatoes" })
                .mockResolvedValueOnce(null);
            jest.mocked(database_1.database.product.create).mockResolvedValue({
                ...mockProduct,
                slug: "organic-tomatoes-1",
            });
            const result = await product_service_1.ProductService.createProduct(validInput, mockUserId);
            (0, globals_1.expect)(result.slug).toBe("organic-tomatoes-1");
        });
        (0, globals_1.it)("should calculate available quantity correctly", async () => {
            jest.mocked(database_1.database.farm.findUnique).mockResolvedValue(mockFarm);
            jest.mocked(database_1.database.product.findFirst).mockResolvedValue(null);
            jest
                .mocked(database_1.database.product.create)
                .mockResolvedValue(mockProduct);
            await product_service_1.ProductService.createProduct(validInput, mockUserId);
            const createCall = jest.mocked(database_1.database.product.create).mock.calls[0][0];
            (0, globals_1.expect)(createCall.data.inventory.availableQuantity).toBe(100); // quantity - reserved
        });
        (0, globals_1.it)("should set isLowStock correctly", async () => {
            jest.mocked(database_1.database.farm.findUnique).mockResolvedValue(mockFarm);
            jest.mocked(database_1.database.product.findFirst).mockResolvedValue(null);
            jest
                .mocked(database_1.database.product.create)
                .mockResolvedValue(mockProduct);
            const lowStockInput = {
                ...validInput,
                inventory: { quantity: 15, reservedQuantity: 0, lowStockThreshold: 20 },
            };
            await product_service_1.ProductService.createProduct(lowStockInput, mockUserId);
            const createCall = jest.mocked(database_1.database.product.create).mock.calls[0][0];
            (0, globals_1.expect)(createCall.data.inventory.isLowStock).toBe(true);
        });
        (0, globals_1.it)("should extract primary photo URL", async () => {
            jest.mocked(database_1.database.farm.findUnique).mockResolvedValue(mockFarm);
            jest.mocked(database_1.database.product.findFirst).mockResolvedValue(null);
            jest
                .mocked(database_1.database.product.create)
                .mockResolvedValue(mockProduct);
            await product_service_1.ProductService.createProduct(validInput, mockUserId);
            const createCall = jest.mocked(database_1.database.product.create).mock.calls[0][0];
            (0, globals_1.expect)(createCall.data.primaryPhotoUrl).toBe("https://example.com/tomato.jpg");
        });
    });
    (0, globals_1.describe)("ðŸ“– getProductById", () => {
        (0, globals_1.it)("should get product by ID with farm", async () => {
            jest
                .mocked(database_1.database.product.findUnique)
                .mockResolvedValue(mockProduct);
            const result = await product_service_1.ProductService.getProductById(mockProductId);
            (0, globals_1.expect)(result).toMatchObject({ id: mockProductId });
            (0, globals_1.expect)(database_1.database.product.findUnique).toHaveBeenCalledWith({
                where: { id: mockProductId },
                include: {
                    farm: {
                        select: {
                            id: true,
                            name: true,
                            slug: true,
                            logoUrl: true,
                            verificationStatus: true,
                        },
                    },
                },
            });
        });
        (0, globals_1.it)("should get product by ID without farm", async () => {
            jest
                .mocked(database_1.database.product.findUnique)
                .mockResolvedValue(mockProduct);
            await product_service_1.ProductService.getProductById(mockProductId, false);
            (0, globals_1.expect)(database_1.database.product.findUnique).toHaveBeenCalledWith({
                where: { id: mockProductId },
                include: { farm: false },
            });
        });
        (0, globals_1.it)("should return null if product not found", async () => {
            jest.mocked(database_1.database.product.findUnique).mockResolvedValue(null);
            const result = await product_service_1.ProductService.getProductById("nonexistent");
            (0, globals_1.expect)(result).toBeNull();
        });
    });
    (0, globals_1.describe)("ðŸ”— getProductBySlug", () => {
        (0, globals_1.it)("should get product by farm and product slug", async () => {
            jest
                .mocked(database_1.database.product.findFirst)
                .mockResolvedValue(mockProduct);
            const result = await product_service_1.ProductService.getProductBySlug("test-farm", "organic-tomatoes");
            (0, globals_1.expect)(result).toMatchObject({ slug: "organic-tomatoes" });
            (0, globals_1.expect)(mockDatabase.product.findFirst).toHaveBeenCalledWith({
                where: {
                    slug: "organic-tomatoes",
                    farm: { slug: "test-farm" },
                },
                include: globals_1.expect.any(Object),
            });
        });
        (0, globals_1.it)("should return null if product not found by slug", async () => {
            jest.mocked(database_1.database.product.findFirst).mockResolvedValue(null);
            const result = await product_service_1.ProductService.getProductBySlug("test-farm", "nonexistent");
            (0, globals_1.expect)(result).toBeNull();
        });
    });
    (0, globals_1.describe)("ðŸ“‹ listProducts", () => {
        const mockProducts = [mockProduct, { ...mockProduct, id: "product-456" }];
        (0, globals_1.it)("should list products with default pagination", async () => {
            jest
                .mocked(database_1.database.product.findMany)
                .mockResolvedValue(mockProducts);
            jest.mocked(database_1.database.product.count).mockResolvedValue(2);
            const result = await product_service_1.ProductService.listProducts();
            (0, globals_1.expect)(result.products).toHaveLength(2);
            (0, globals_1.expect)(result.pagination).toMatchObject({
                page: 1,
                limit: 20,
                total: 2,
                totalPages: 1,
                hasMore: false,
            });
        });
        (0, globals_1.it)("should filter products by farm ID", async () => {
            jest
                .mocked(database_1.database.product.findMany)
                .mockResolvedValue(mockProducts);
            jest.mocked(database_1.database.product.count).mockResolvedValue(2);
            await product_service_1.ProductService.listProducts({ farmId: mockFarmId });
            const findCall = jest.mocked(database_1.database.product.findMany).mock.calls[0][0];
            (0, globals_1.expect)(findCall.where).toMatchObject({ farmId: mockFarmId });
        });
        (0, globals_1.it)("should filter products by category", async () => {
            jest
                .mocked(database_1.database.product.findMany)
                .mockResolvedValue(mockProducts);
            jest.mocked(database_1.database.product.count).mockResolvedValue(2);
            await product_service_1.ProductService.listProducts({ category: "VEGETABLES" });
            const findCall = jest.mocked(database_1.database.product.findMany).mock.calls[0][0];
            (0, globals_1.expect)(findCall.where).toMatchObject({ category: "VEGETABLES" });
        });
        (0, globals_1.it)("should filter products by status", async () => {
            jest
                .mocked(database_1.database.product.findMany)
                .mockResolvedValue(mockProducts);
            jest.mocked(database_1.database.product.count).mockResolvedValue(2);
            await product_service_1.ProductService.listProducts({ status: product_1.ProductStatus.AVAILABLE });
            const findCall = jest.mocked(database_1.database.product.findMany).mock.calls[0][0];
            (0, globals_1.expect)(findCall.where).toMatchObject({ status: product_1.ProductStatus.AVAILABLE });
        });
        (0, globals_1.it)("should filter products in stock", async () => {
            jest
                .mocked(database_1.database.product.findMany)
                .mockResolvedValue(mockProducts);
            jest.mocked(database_1.database.product.count).mockResolvedValue(2);
            await product_service_1.ProductService.listProducts({ inStock: true });
            const findCall = jest.mocked(database_1.database.product.findMany).mock.calls[0][0];
            (0, globals_1.expect)(findCall.where.inventory).toMatchObject({ inStock: true });
        });
        (0, globals_1.it)("should filter featured products", async () => {
            jest
                .mocked(database_1.database.product.findMany)
                .mockResolvedValue(mockProducts);
            jest.mocked(database_1.database.product.count).mockResolvedValue(2);
            await product_service_1.ProductService.listProducts({ isFeatured: true });
            const findCall = jest.mocked(database_1.database.product.findMany).mock.calls[0][0];
            (0, globals_1.expect)(findCall.where).toMatchObject({ isFeatured: true });
        });
        (0, globals_1.it)("should search products by name", async () => {
            jest
                .mocked(database_1.database.product.findMany)
                .mockResolvedValue(mockProducts);
            jest.mocked(database_1.database.product.count).mockResolvedValue(2);
            await product_service_1.ProductService.listProducts({ search: "tomato" });
            const findCall = jest.mocked(database_1.database.product.findMany).mock.calls[0][0];
            (0, globals_1.expect)(findCall.where.OR).toBeDefined();
        });
        (0, globals_1.it)("should handle pagination correctly", async () => {
            jest
                .mocked(database_1.database.product.findMany)
                .mockResolvedValue(mockProducts);
            jest.mocked(database_1.database.product.count).mockResolvedValue(50);
            const result = await product_service_1.ProductService.listProducts({}, { page: 2, limit: 10 });
            (0, globals_1.expect)(result.pagination).toMatchObject({
                page: 2,
                limit: 10,
                total: 50,
                totalPages: 5,
                hasMore: true,
            });
            const findCall = jest.mocked(database_1.database.product.findMany).mock.calls[0][0];
            (0, globals_1.expect)(findCall.skip).toBe(10);
            (0, globals_1.expect)(findCall.take).toBe(10);
        });
    });
    (0, globals_1.describe)("âœï¸ updateProduct", () => {
        const updateData = {
            name: "Updated Tomatoes",
            pricing: { basePrice: { amount: 600, currency: "USD" } },
        };
        (0, globals_1.it)("should update product successfully", async () => {
            jest
                .mocked(database_1.database.product.findUnique)
                .mockResolvedValue(mockProduct);
            jest.mocked(database_1.database.product.findFirst).mockResolvedValue(null);
            jest.mocked(database_1.database.product.update).mockResolvedValue({
                ...mockProduct,
                ...updateData,
            });
            const result = await product_service_1.ProductService.updateProduct(mockProductId, updateData, mockUserId);
            (0, globals_1.expect)(result.name).toBe("Updated Tomatoes");
        });
        (0, globals_1.it)("should throw error if product not found", async () => {
            jest.mocked(database_1.database.product.findUnique).mockResolvedValue(null);
            await (0, globals_1.expect)(product_service_1.ProductService.updateProduct(mockProductId, updateData, mockUserId)).rejects.toThrow("Product not found");
        });
        (0, globals_1.it)("should throw error for unauthorized user", async () => {
            jest.mocked(database_1.database.product.findUnique).mockResolvedValue({
                ...mockProduct,
                farm: { ...mockFarm, ownerId: "different-user" },
            });
            await (0, globals_1.expect)(product_service_1.ProductService.updateProduct(mockProductId, updateData, mockUserId)).rejects.toThrow("Unauthorized: You don't own this product");
        });
        (0, globals_1.it)("should regenerate slug if name changes", async () => {
            const originalProduct = {
                ...mockProduct,
                name: "Original Product Name",
                slug: "original-product-name",
                farm: {
                    ownerId: mockUserId,
                },
            };
            jest
                .mocked(database_1.database.product.findUnique)
                .mockResolvedValue(originalProduct);
            // Mock findFirst to return null (no duplicate slugs)
            jest.mocked(database_1.database.product.findFirst).mockResolvedValue(null);
            const updatedProduct = {
                ...originalProduct,
                name: "New Product Name",
                slug: "new-product-name",
                farm: {
                    id: mockFarmId,
                    name: "Test Farm",
                    slug: "test-farm",
                    logoUrl: null,
                    verificationStatus: "VERIFIED",
                },
            };
            jest
                .mocked(database_1.database.product.update)
                .mockResolvedValue(updatedProduct);
            const result = await product_service_1.ProductService.updateProduct(mockProductId, { name: "New Product Name" }, mockUserId);
            (0, globals_1.expect)(result.name).toBe("New Product Name");
            (0, globals_1.expect)(result.slug).toBe("new-product-name");
            // Verify slug generation was called (checks for duplicate slugs)
            (0, globals_1.expect)(database_1.database.product.findFirst).toHaveBeenCalled();
            // Verify update was called with the data
            const updateCall = jest.mocked(database_1.database.product.update).mock.calls[0][0];
            // The slug is passed as a separate field in the data object
            // Check that update was called with the new name
            (0, globals_1.expect)(updateCall.where.id).toBe(mockProductId);
            (0, globals_1.expect)(updateCall.data.name).toBe("New Product Name");
            // The service should have generated a new slug (verified by findFirst call)
            (0, globals_1.expect)(database_1.database.product.findFirst).toHaveBeenCalledWith(globals_1.expect.objectContaining({
                where: globals_1.expect.objectContaining({
                    farmId: mockFarmId,
                }),
            }));
        });
        (0, globals_1.it)("should recalculate inventory when updated", async () => {
            jest
                .mocked(database_1.database.product.findUnique)
                .mockResolvedValue(mockProduct);
            jest
                .mocked(database_1.database.product.update)
                .mockResolvedValue(mockProduct);
            await product_service_1.ProductService.updateProduct(mockProductId, { inventory: { quantity: 200, reservedQuantity: 20 } }, mockUserId);
            const updateCall = jest.mocked(database_1.database.product.update).mock.calls[0][0];
            (0, globals_1.expect)(updateCall.data.inventory.availableQuantity).toBe(180);
        });
        (0, globals_1.it)("should update primary photo URL if images change", async () => {
            jest
                .mocked(database_1.database.product.findUnique)
                .mockResolvedValue(mockProduct);
            jest
                .mocked(database_1.database.product.update)
                .mockResolvedValue(mockProduct);
            const newImages = [
                { url: "https://example.com/new.jpg", isPrimary: true },
            ];
            await product_service_1.ProductService.updateProduct(mockProductId, { images: newImages }, mockUserId);
            const updateCall = jest.mocked(database_1.database.product.update).mock.calls[0][0];
            (0, globals_1.expect)(updateCall.data.primaryPhotoUrl).toBe("https://example.com/new.jpg");
        });
    });
    (0, globals_1.describe)("ðŸ—‘ï¸ deleteProduct", () => {
        (0, globals_1.it)("should soft delete product successfully", async () => {
            jest
                .mocked(database_1.database.product.findUnique)
                .mockResolvedValue(mockProduct);
            jest
                .mocked(database_1.database.product.update)
                .mockResolvedValue(mockProduct);
            await product_service_1.ProductService.deleteProduct(mockProductId, mockUserId);
            (0, globals_1.expect)(mockDatabase.product.update).toHaveBeenCalledWith({
                where: { id: mockProductId },
                data: {
                    status: product_1.ProductStatus.DISCONTINUED,
                    updatedAt: globals_1.expect.any(Date),
                },
            });
        });
        (0, globals_1.it)("should throw error if product not found", async () => {
            jest.mocked(database_1.database.product.findUnique).mockResolvedValue(null);
            await (0, globals_1.expect)(product_service_1.ProductService.deleteProduct(mockProductId, mockUserId)).rejects.toThrow("Product not found");
        });
        (0, globals_1.it)("should throw error for unauthorized user", async () => {
            jest.mocked(database_1.database.product.findUnique).mockResolvedValue({
                ...mockProduct,
                farm: { ...mockFarm, ownerId: "different-user" },
            });
            await (0, globals_1.expect)(product_service_1.ProductService.deleteProduct(mockProductId, mockUserId)).rejects.toThrow("Unauthorized: You don't own this product");
        });
    });
    (0, globals_1.describe)("ðŸ“¦ updateInventory", () => {
        (0, globals_1.it)("should update inventory successfully", async () => {
            jest
                .mocked(database_1.database.product.findUnique)
                .mockResolvedValue(mockProduct);
            jest
                .mocked(database_1.database.product.update)
                .mockResolvedValue(mockProduct);
            const result = await product_service_1.ProductService.updateInventory(mockProductId, 150, mockUserId);
            (0, globals_1.expect)(database_1.database.product.update).toHaveBeenCalled();
            (0, globals_1.expect)(result).toBeDefined();
        });
        (0, globals_1.it)("should calculate available quantity", async () => {
            jest
                .mocked(database_1.database.product.findUnique)
                .mockResolvedValue(mockProduct);
            jest
                .mocked(database_1.database.product.update)
                .mockResolvedValue(mockProduct);
            await product_service_1.ProductService.updateInventory(mockProductId, 150, mockUserId);
            const updateCall = jest.mocked(database_1.database.product.update).mock.calls[0][0];
            (0, globals_1.expect)(updateCall.data.inventory.availableQuantity).toBe(140); // 150 - 10 reserved
        });
        (0, globals_1.it)("should set status to OUT_OF_STOCK when quantity is zero", async () => {
            jest
                .mocked(database_1.database.product.findUnique)
                .mockResolvedValue(mockProduct);
            jest
                .mocked(database_1.database.product.update)
                .mockResolvedValue(mockProduct);
            await product_service_1.ProductService.updateInventory(mockProductId, 10, mockUserId); // 10 - 10 reserved = 0
            const updateCall = jest.mocked(database_1.database.product.update).mock.calls[0][0];
            (0, globals_1.expect)(updateCall.data.status).toBe(product_1.ProductStatus.OUT_OF_STOCK);
        });
        (0, globals_1.it)("should set status to AVAILABLE when quantity is positive", async () => {
            jest
                .mocked(database_1.database.product.findUnique)
                .mockResolvedValue(mockProduct);
            jest
                .mocked(database_1.database.product.update)
                .mockResolvedValue(mockProduct);
            await product_service_1.ProductService.updateInventory(mockProductId, 50, mockUserId);
            const updateCall = jest.mocked(database_1.database.product.update).mock.calls[0][0];
            (0, globals_1.expect)(updateCall.data.status).toBe(product_1.ProductStatus.AVAILABLE);
        });
        (0, globals_1.it)("should update lastRestocked timestamp", async () => {
            jest
                .mocked(database_1.database.product.findUnique)
                .mockResolvedValue(mockProduct);
            jest
                .mocked(database_1.database.product.update)
                .mockResolvedValue(mockProduct);
            await product_service_1.ProductService.updateInventory(mockProductId, 150, mockUserId);
            const updateCall = jest.mocked(database_1.database.product.update).mock.calls[0][0];
            (0, globals_1.expect)(updateCall.data.inventory.lastRestocked).toBeInstanceOf(Date);
        });
    });
    (0, globals_1.describe)("ðŸ” searchProducts", () => {
        (0, globals_1.it)("should search products by name", async () => {
            jest
                .mocked(database_1.database.product.findMany)
                .mockResolvedValue([mockProduct]);
            const results = await product_service_1.ProductService.searchProducts("tomato");
            (0, globals_1.expect)(results).toHaveLength(1);
            const findCall = jest.mocked(database_1.database.product.findMany).mock.calls[0][0];
            (0, globals_1.expect)(findCall.where.OR).toBeDefined();
        });
        (0, globals_1.it)("should limit search results", async () => {
            jest
                .mocked(database_1.database.product.findMany)
                .mockResolvedValue([mockProduct]);
            await product_service_1.ProductService.searchProducts("tomato", 5);
            const findCall = jest.mocked(database_1.database.product.findMany).mock.calls[0][0];
            (0, globals_1.expect)(findCall.take).toBe(5);
        });
        (0, globals_1.it)("should only return available products", async () => {
            jest
                .mocked(database_1.database.product.findMany)
                .mockResolvedValue([mockProduct]);
            await product_service_1.ProductService.searchProducts("tomato");
            const findCall = jest.mocked(database_1.database.product.findMany).mock.calls[0][0];
            (0, globals_1.expect)(findCall.where.status).toBe(product_1.ProductStatus.AVAILABLE);
        });
    });
    (0, globals_1.describe)("ðŸ”„ batchUpdateProducts", () => {
        const productIds = ["product-1", "product-2", "product-3"];
        const batchUpdates = { status: product_1.ProductStatus.AVAILABLE };
        (0, globals_1.it)("should update multiple products successfully", async () => {
            jest
                .mocked(database_1.database.product.findUnique)
                .mockResolvedValue(mockProduct);
            jest
                .mocked(database_1.database.product.update)
                .mockResolvedValue(mockProduct);
            const result = await product_service_1.ProductService.batchUpdateProducts(productIds, batchUpdates, mockUserId);
            (0, globals_1.expect)(result.successCount).toBe(3);
            (0, globals_1.expect)(result.failureCount).toBe(0);
            (0, globals_1.expect)(result.successful).toHaveLength(3);
        });
        (0, globals_1.it)("should handle partial failures", async () => {
            jest
                .mocked(database_1.database.product.findUnique)
                .mockResolvedValueOnce(mockProduct)
                .mockResolvedValueOnce(null)
                .mockResolvedValueOnce(mockProduct);
            jest
                .mocked(database_1.database.product.update)
                .mockResolvedValue(mockProduct);
            const result = await product_service_1.ProductService.batchUpdateProducts(productIds, batchUpdates, mockUserId);
            (0, globals_1.expect)(result.successCount).toBe(2);
            (0, globals_1.expect)(result.failureCount).toBe(1);
            (0, globals_1.expect)(result.failed).toHaveLength(1);
            (0, globals_1.expect)(result.failed[0].error).toContain("Product not found");
        });
        (0, globals_1.it)("should return total count", async () => {
            jest
                .mocked(database_1.database.product.findUnique)
                .mockResolvedValue(mockProduct);
            jest
                .mocked(database_1.database.product.update)
                .mockResolvedValue(mockProduct);
            const result = await product_service_1.ProductService.batchUpdateProducts(productIds, batchUpdates, mockUserId);
            (0, globals_1.expect)(result.total).toBe(3);
        });
    });
    (0, globals_1.describe)("ðŸ“Š getProductStats", () => {
        (0, globals_1.it)("should return product statistics", async () => {
            const stats = await product_service_1.ProductService.getProductStats(mockProductId);
            (0, globals_1.expect)(stats).toMatchObject({
                productId: mockProductId,
                views: 0,
                orders: 0,
                revenue: 0,
                reviewCount: 0,
                inWishlistCount: 0,
            });
        });
    });
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiTTpcXFJlcG9cXEZhcm1lcnMgTWFya2V0IFBsYXRmb3JtIHdlYiBhbmQgYXBwXFxzcmNcXGxpYlxcc2VydmljZXNcXF9fdGVzdHNfX1xccHJvZHVjdC5zZXJ2aWNlLnRlc3QudHMiLCJtYXBwaW5ncyI6IjtBQUFBOzs7OztHQUtHOztBQUlILDJDQUFpRTtBQUdqRSxvQkFBb0I7QUFFcEIsSUFBSSxDQUFDLElBQUksQ0FBQyxnQkFBZ0IsRUFBRSxHQUFHLEVBQUUsQ0FBQyxDQUFDO0lBQ2pDLFFBQVEsRUFBRTtRQUNSLE9BQU8sRUFBRTtZQUNQLFVBQVUsRUFBRSxJQUFJLENBQUMsRUFBRSxFQUFFO1lBQ3JCLFFBQVEsRUFBRSxJQUFJLENBQUMsRUFBRSxFQUFFO1lBQ25CLFNBQVMsRUFBRSxJQUFJLENBQUMsRUFBRSxFQUFFO1lBQ3BCLE1BQU0sRUFBRSxJQUFJLENBQUMsRUFBRSxFQUFFO1lBQ2pCLE1BQU0sRUFBRSxJQUFJLENBQUMsRUFBRSxFQUFFO1lBQ2pCLE1BQU0sRUFBRSxJQUFJLENBQUMsRUFBRSxFQUFFO1lBQ2pCLEtBQUssRUFBRSxJQUFJLENBQUMsRUFBRSxFQUFFO1NBQ2pCO1FBQ0QsSUFBSSxFQUFFO1lBQ0osVUFBVSxFQUFFLElBQUksQ0FBQyxFQUFFLEVBQUU7U0FDdEI7S0FDRjtDQUNGLENBQUMsQ0FBQyxDQUFDO0FBSUosd0JBQXdCO0FBQ3hCLElBQUksQ0FBQyxJQUFJLENBQUMsa0JBQWtCLEVBQUUsR0FBRyxFQUFFLENBQUMsQ0FBQztJQUNuQyxZQUFZLEVBQUUsSUFBSSxDQUFDLEVBQUUsQ0FBQyxDQUFDLElBQVksRUFBRSxFQUFFLENBQ3JDLElBQUksQ0FBQyxXQUFXLEVBQUUsQ0FBQyxPQUFPLENBQUMsTUFBTSxFQUFFLEdBQUcsQ0FBQyxDQUN4QztDQUNGLENBQUMsQ0FBQyxDQUFDO0FBL0JKLDZDQUEwQztBQUMxQyw2Q0FBZ0Q7QUFFaEQsd0RBQW9EO0FBcUJwRCxNQUFNLFlBQVksR0FBRyxtQkFBd0MsQ0FBQztBQVM5RCxJQUFBLGtCQUFRLEVBQUMs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QUssRUFBRSxDQUFDO2dCQUNSLE1BQU0sRUFBRSxDQUFDO2dCQUNULE9BQU8sRUFBRSxDQUFDO2dCQUNWLFdBQVcsRUFBRSxDQUFDO2dCQUNkLGVBQWUsRUFBRSxDQUFDO2FBQ25CLENBQUMsQ0FBQztRQUNMLENBQUMsQ0FBQyxDQUFDO0lBQ0wsQ0FBQyxDQUFDLENBQUM7QUFDTCxDQUFDLENBQUMsQ0FBQyIsIm5hbWVzIjpbXSwic291cmNlcyI6WyJNOlxcUmVwb1xcRmFybWVycyBNYXJrZXQgUGxhdGZvcm0gd2ViIGFuZCBhcHBcXHNyY1xcbGliXFxzZXJ2aWNlc1xcX190ZXN0c19fXFxwcm9kdWN0LnNlcnZpY2UudGVzdC50cyJdLCJzb3VyY2VzQ29udGVudCI6WyIvKipcbiAqIPCfm5IgUFJPRFVDVCBTRVJWSUNFIFRFU1QgU1VJVEVcbiAqIENvbXByZWhlbnNpdmUgdGVzdHMgZm9yIGFncmljdWx0dXJhbCBwcm9kdWN0IG1hbmFnZW1lbnRcbiAqXG4gKiBDb3ZlcmFnZTogNDArIHRlc3RzIGZvciBhbGwgcHJvZHVjdCBvcGVyYXRpb25zXG4gKi9cblxuaW1wb3J0IHsgZGF0YWJhc2UgfSBmcm9tIFwiQC9saWIvZGF0YWJhc2VcIjtcbmltcG9ydCB7IFByb2R1Y3RTdGF0dXMgfSBmcm9tIFwiQC90eXBlcy9wcm9kdWN0XCI7XG5pbXBvcnQgeyBiZWZvcmVFYWNoLCBkZXNjcmliZSwgZXhwZWN0LCBpdCB9IGZyb20gXCJAamVzdC9nbG9iYWxzXCI7XG5pbXBvcnQgeyBQcm9kdWN0U2VydmljZSB9IGZyb20gXCIuLi9wcm9kdWN0LnNlcnZpY2VcIjtcblxuLy8gTW9jayB0aGUgZGF0YWJhc2VcblxuamVzdC5tb2NrKFwiQC9saWIvZGF0YWJhc2VcIiwgKCkgPT4gKHtcbiAgZGF0YWJhc2U6IHtcbiAgICBwcm9kdWN0OiB7XG4gICAgICBmaW5kVW5pcXVlOiBqZXN0LmZuKCksXG4gICAgICBmaW5kTWFueTogamVzdC5mbigpLFxuICAgICAgZmluZEZpcnN0OiBqZXN0LmZuKCksXG4gICAgICBjcmVhdGU6IGplc3QuZm4oKSxcbiAgICAgIHVwZGF0ZTogamVzdC5mbigpLFxuICAgICAgZGVsZXRlOiBqZXN0LmZuKCksXG4gICAgICBjb3VudDogamVzdC5mbigpLFxuICAgIH0sXG4gICAgZmFybToge1xuICAgICAgZmluZFVuaXF1ZTogamVzdC5mbigpLFxuICAgIH0sXG4gIH0sXG59KSk7XG5cbmNvbnN0IG1vY2tEYXRhYmFzZSA9IGRhdGFiYXNlIGFzIGplc3QuTW9ja2VkPHR5cGVvZiBkYXRhYmFzZT47XG5cbi8vIE1vY2sgdGhlIHNsdWcgdXRpbGl0eVxuamVzdC5tb2NrKFwiQC9saWIvdXRpbHMvc2x1Z1wiLCAoKSA9PiAoe1xuICBnZW5lcmF0ZVNsdWc6IGplc3QuZm4oKG5hbWU6IHN0cmluZykgPT5cbiAgICBuYW1lLnRvTG93ZXJDYXNlKCkucmVwbGFjZSgvXFxzKy9nLCBcIi1cIiksXG4gICksXG59KSk7XG5cbmRlc2NyaWJlKFwi8J+bkiBQcm9kdWN0IFNlcnZpY2UgLSBEaXZpbmUgUHJvZHVjdCBPcGVyYXRpb25zXCIsICgpID0+IHtcbiAgY29uc3QgbW9ja1VzZXJJZCA9IFwidXNlci0xMjNcIjtcbiAgY29uc3QgbW9ja0Zhcm1JZCA9IFwiZmFybS0xMjNcIjtcbiAgY29uc3QgbW9ja1Byb2R1Y3RJZCA9IFwicHJvZHVjdC0xMjNcIjtcblxuICBjb25zdCBtb2NrRmFybSA9IHtcbiAgICBpZDogbW9ja0Zhcm1JZCxcbiAgICBvd25lcklkOiBtb2NrVXNlcklkLFxuICAgIHN0YXR1czogXCJBQ1RJVkVcIixcbiAgICBuYW1lOiBcIlRlc3QgRmFybVwiLFxuICAgIHNsdWc6IFwidGVzdC1mYXJtXCIsXG4gIH07XG5cbiAgY29uc3QgbW9ja1Byb2R1Y3QgPSB7XG4gICAgaWQ6IG1vY2tQcm9kdWN0SWQsXG4gICAgbmFtZTogXCJPcmdhbmljIFRvbWF0b2VzXCIsXG4gICAgc2x1ZzogXCJvcmdhbmljLXRvbWF0b2VzXCIsXG4gICAgZmFybUlkOiBtb2NrRmFybUlkLFxuICAgIGNhdGVnb3J5OiBcIlZFR0VUQUJMRVNcIixcbiAgICBkZXNjcmlwdGlvbjogXCJGcmVzaCBvcmdhbmljIHRvbWF0b2VzXCIsXG4gICAgcHJpY2luZzogeyBiYXNlUHJpY2U6IHsgYW1vdW50OiA1MDAsIGN1cnJlbmN5OiBcIlVTRFwiIH0gfSxcbiAgICBpbnZlbnRvcnk6IHtcbiAgICAgIHF1YW50aXR5OiAxMDAsXG4gICAgICByZXNlcnZlZFF1YW50aXR5OiAxMCxcbiAgICAgIGF2YWlsYWJsZVF1YW50aXR5OiA5MCxcbiAgICAgIGxvd1N0b2NrVGhyZXNob2xkOiAyMCxcbiAgICAgIGlzTG93U3RvY2s6IGZhbHNlLFxuICAgICAgaW5TdG9jazogdHJ1ZSxcbiAgICB9LFxuICAgIHN0YXR1czogUHJvZHVjdFN0YXR1cy5BVkFJTEFCTEUsXG4gICAgaXNBY3RpdmU6IHRydWUsXG4gICAgaW1hZ2VzOiBbeyB1cmw6IFwiaHR0cHM6Ly9leGFtcGxlLmNvbS90b21hdG8uanBnXCIsIGlzUHJpbWFyeTogdHJ1ZSB9XSxcbiAgICBwcmltYXJ5UGhvdG9Vcmw6IFwiaHR0cHM6Ly9leGFtcGxlLmNvbS90b21hdG8uanBnXCIsXG4gICAgZmFybTogbW9ja0Zhcm0sXG4gIH07XG5cbiAgYmVmb3JlRWFjaCgoKSA9PiB7XG4gICAgamVzdC5jbGVhckFsbE1vY2tzKCk7XG4gIH0pO1xuXG4gIGRlc2NyaWJlKFwi8J+OryBjcmVhdGVQcm9kdWN0XCIsICgpID0+IHtcbiAgICBjb25zdCB2YWxpZElucHV0ID0ge1xuICAgICAgbmFtZTogXCJPcmdhbmljIFRvbWF0b2VzXCIsXG4gICAgICBmYXJtSWQ6IG1vY2tGYXJtSWQsXG4gICAgICBjYXRlZ29yeTogXCJWRUdFVEFCTEVTXCIsXG4gICAgICBkZXNjcmlwdGlvbjogXCJGcmVzaCBvcmdhbmljIHRvbWF0b2VzXCIsXG4gICAgICBwcmljaW5nOiB7IGJhc2VQcmljZTogeyBhbW91bnQ6IDUwMCwgY3VycmVuY3k6IFwiVVNEXCIgfSB9LFxuICAgICAgaW52ZW50b3J5OiB7XG4gICAgICAgIHF1YW50aXR5OiAxMDAsXG4gICAgICAgIHJlc2VydmVkUXVhbnRpdHk6IDAsXG4gICAgICAgIGxvd1N0b2NrVGhyZXNob2xkOiAyMCxcbiAgICAgIH0sXG4gICAgICBpbWFnZXM6IFt7IHVybDogXCJodHRwczovL2V4YW1wbGUuY29tL3RvbWF0by5qcGdcIiwgaXNQcmltYXJ5OiB0cnVlIH1dLFxuICAgIH07XG5cbiAgICBpdChcInNob3VsZCBjcmVhdGUgcHJvZHVjdCB3aXRoIHZhbGlkIGRhdGFcIiwgYXN5bmMgKCkgPT4ge1xuICAgICAgamVzdC5tb2NrZWQoZGF0YWJhc2UuZmFybS5maW5kVW5pcXVlKS5tb2NrUmVzb2x2ZWRWYWx1ZShtb2NrRmFybSBhcyBhbnkpO1xuICAgICAgamVzdC5tb2NrZWQoZGF0YWJhc2UucHJvZHVjdC5maW5kRmlyc3QpLm1vY2tSZXNvbHZlZFZhbHVlKG51bGwpO1xuICAgICAgamVzdFxuICAgICAgICAubW9ja2VkKGRhdGFiYXNlLnByb2R1Y3QuY3JlYXRlKVxuICAgICAgICAubW9ja1Jlc29sdmVkVmFsdWUobW9ja1Byb2R1Y3QgYXMgYW55KTtcblxuICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgUHJvZHVjdFNlcnZpY2UuY3JlYXRlUHJvZHVjdChcbiAgICAgICAgdmFsaWRJbnB1dCBhcyBhbnksXG4gICAgICAgIG1vY2tVc2VySWQsXG4gICAgICApO1xuXG4gICAgICBleHBlY3QocmVzdWx0KS50b01hdGNoT2JqZWN0KHtcbiAgICAgICAgbmFtZTogXCJPcmdhbmljIFRvbWF0b2VzXCIsXG4gICAgICAgIHNsdWc6IGV4cGVjdC5zdHJpbmdDb250YWluaW5nKFwib3JnYW5pYy10b21hdG9lc1wiKSxcbiAgICAgIH0pO1xuICAgICAgZXhwZWN0KGRhdGFiYXNlLmZhcm0uZmluZFVuaXF1ZSkudG9IYXZlQmVlbkNhbGxlZFdpdGgoe1xuICAgICAgICB3aGVyZTogeyBpZDogbW9ja0Zhcm1JZCB9LFxuICAgICAgICBzZWxlY3Q6IHsgaWQ6IHRydWUsIG93bmVySWQ6IHRydWUsIHN0YXR1czogdHJ1ZSB9LFxuICAgICAgfSk7XG4gICAgfSk7XG5cbiAgICBpdChcInNob3VsZCB0aHJvdyBlcnJvciBpZiBmYXJtIG5vdCBmb3VuZFwiLCBhc3luYyAoKSA9PiB7XG4gICAgICBqZXN0Lm1vY2tlZChkYXRhYmFzZS5mYXJtLmZpbmRVbmlxdWUpLm1vY2tSZXNvbHZlZFZhbHVlKG51bGwpO1xuXG4gICAgICBhd2FpdCBleHBlY3QoXG4gICAgICAgIFByb2R1Y3RTZXJ2aWNlLmNyZWF0ZVByb2R1Y3QodmFsaWRJbnB1dCBhcyBhbnksIG1vY2tVc2VySWQpLFxuICAgICAgKS5yZWplY3RzLnRvVGhyb3coXCJGYXJtIG5vdCBmb3VuZFwiKTtcbiAgICB9KTtcblxuICAgIGl0KFwic2hvdWxkIHRocm93IGVycm9yIGZvciB1bmF1dGhvcml6ZWQgdXNlclwiLCBhc3luYyAoKSA9PiB7XG4gICAgICBqZXN0Lm1vY2tlZChkYXRhYmFzZS5mYXJtLmZpbmRVbmlxdWUpLm1vY2tSZXNvbHZlZFZhbHVlKHtcbiAgICAgICAgLi4ubW9ja0Zhcm0sXG4gICAgICAgIG93bmVySWQ6IFwiZGlmZmVyZW50LXVzZXJcIixcbiAgICAgIH0gYXMgYW55KTtcblxuICAgICAgYXdhaXQgZXhwZWN0KFxuICAgICAgICBQcm9kdWN0U2VydmljZS5jcmVhdGVQcm9kdWN0KHZhbGlkSW5wdXQgYXMgYW55LCBtb2NrVXNlcklkKSxcbiAgICAgICkucmVqZWN0cy50b1Rocm93KFwiVW5hdXRob3JpemVkOiBZb3UgZG9uJ3Qgb3duIHRoaXMgZmFybVwiKTtcbiAgICB9KTtcblxuICAgIGl0KFwic2hvdWxkIHRocm93IGVycm9yIGZvciBpbmFjdGl2ZSBmYXJtXCIsIGFzeW5jICgpID0+IHtcbiAgICAgIGplc3QubW9ja2VkKGRhdGFiYXNlLmZhcm0uZmluZFVuaXF1ZSkubW9ja1Jlc29sdmVkVmFsdWUoe1xuICAgICAgICAuLi5tb2NrRmFybSxcbiAgICAgICAgc3RhdHVzOiBcIklOQUNUSVZFXCIsXG4gICAgICB9IGFzIGFueSk7XG5cbiAgICAgIGF3YWl0IGV4cGVjdChcbiAgICAgICAgUHJvZHVjdFNlcnZpY2UuY3JlYXRlUHJvZHVjdCh2YWxpZElucHV0IGFzIGFueSwgbW9ja1VzZXJJZCksXG4gICAgICApLnJlamVjdHMudG9UaHJvdyhcIkNhbm5vdCBhZGQgcHJvZHVjdHMgdG8gaW5hY3RpdmUgZmFybVwiKTtcbiAgICB9KTtcblxuICAgIGl0KFwic2hvdWxkIHZhbGlkYXRlIHByb2R1Y3QgbmFtZSBsZW5ndGggKHRvbyBzaG9ydClcIiwgYXN5bmMgKCkgPT4ge1xuICAgICAgamVzdC5tb2NrZWQoZGF0YWJhc2UuZmFybS5maW5kVW5pcXVlKS5tb2NrUmVzb2x2ZWRWYWx1ZShtb2NrRmFybSBhcyBhbnkpO1xuXG4gICAgICBjb25zdCBzaG9ydE5hbWVJbnB1dCA9IHsgLi4udmFsaWRJbnB1dCwgbmFtZTogXCJBQlwiIH07XG5cbiAgICAgIGF3YWl0IGV4cGVjdChcbiAgICAgICAgUHJvZHVjdFNlcnZpY2UuY3JlYXRlUHJvZHVjdChzaG9ydE5hbWVJbnB1dCBhcyBhbnksIG1vY2tVc2VySWQpLFxuICAgICAgKS5yZWplY3RzLnRvVGhyb3coXCJQcm9kdWN0IG5hbWUgbXVzdCBiZSBhdCBsZWFzdCAzIGNoYXJhY3RlcnNcIik7XG4gICAgfSk7XG5cbiAgICBpdChcInNob3VsZCB2YWxpZGF0ZSBwcm9kdWN0IG5hbWUgbGVuZ3RoICh0b28gbG9uZylcIiwgYXN5bmMgKCkgPT4ge1xuICAgICAgamVzdC5tb2NrZWQoZGF0YWJhc2UuZmFybS5maW5kVW5pcXVlKS5tb2NrUmVzb2x2ZWRWYWx1ZShtb2NrRmFybSBhcyBhbnkpO1xuXG4gICAgICBjb25zdCBsb25nTmFtZUlucHV0ID0geyAuLi52YWxpZElucHV0LCBuYW1lOiBcIkFcIi5yZXBlYXQoMTAxKSB9O1xuXG4gICAgICBhd2FpdCBleHBlY3QoXG4gICAgICAgIFByb2R1Y3RTZXJ2aWNlLmNyZWF0ZVByb2R1Y3QobG9uZ05hbWVJbnB1dCBhcyBhbnksIG1vY2tVc2VySWQpLFxuICAgICAgKS5yZWplY3RzLnRvVGhyb3coXCJQcm9kdWN0IG5hbWUgbXVzdCBub3QgZXhjZWVkIDEwMCBjaGFyYWN0ZXJzXCIpO1xuICAgIH0pO1xuXG4gICAgaXQoXCJzaG91bGQgdmFsaWRhdGUgcHJpY2UgaXMgcG9zaXRpdmVcIiwgYXN5bmMgKCkgPT4ge1xuICAgICAgamVzdC5tb2NrZWQoZGF0YWJhc2UuZmFybS5maW5kVW5pcXVlKS5tb2NrUmVzb2x2ZWRWYWx1ZShtb2NrRmFybSBhcyBhbnkpO1xuXG4gICAgICBjb25zdCBpbnZhbGlkUHJpY2VJbnB1dCA9IHtcbiAgICAgICAgLi4udmFsaWRJbnB1dCxcbiAgICAgICAgcHJpY2luZzogeyBiYXNlUHJpY2U6IHsgYW1vdW50OiAwLCBjdXJyZW5jeTogXCJVU0RcIiB9IH0sXG4gICAgICB9O1xuXG4gICAgICBhd2FpdCBleHBlY3QoXG4gICAgICAgIFByb2R1Y3RTZXJ2aWNlLmNyZWF0ZVByb2R1Y3QoaW52YWxpZFByaWNlSW5wdXQgYXMgYW55LCBtb2NrVXNlcklkKSxcbiAgICAgICkucmVqZWN0cy50b1Rocm93KFwiUHJpY2UgbXVzdCBiZSBncmVhdGVyIHRoYW4gMFwiKTtcbiAgICB9KTtcblxuICAgIGl0KFwic2hvdWxkIHZhbGlkYXRlIGludmVudG9yeSBxdWFudGl0eSBpcyBub24tbmVnYXRpdmVcIiwgYXN5bmMgKCkgPT4ge1xuICAgICAgamVzdC5tb2NrZWQoZGF0YWJhc2UuZmFybS5maW5kVW5pcXVlKS5tb2NrUmVzb2x2ZWRWYWx1ZShtb2NrRmFybSBhcyBhbnkpO1xuXG4gICAgICBjb25zdCBuZWdhdGl2ZVF1YW50aXR5SW5wdXQgPSB7XG4gICAgICAgIC4uLnZhbGlkSW5wdXQsXG4gICAgICAgIGludmVudG9yeTogeyAuLi52YWxpZElucHV0LmludmVudG9yeSwgcXVhbnRpdHk6IC0xIH0sXG4gICAgICB9O1xuXG4gICAgICBhd2FpdCBleHBlY3QoXG4gICAgICAgIFByb2R1Y3RTZXJ2aWNlLmNyZWF0ZVByb2R1Y3QobmVnYXRpdmVRdWFudGl0eUlucHV0IGFzIGFueSwgbW9ja1VzZXJJZCksXG4gICAgICApLnJlamVjdHMudG9UaHJvdyhcIlF1YW50aXR5IGNhbm5vdCBiZSBuZWdhdGl2ZVwiKTtcbiAgICB9KTtcblxuICAgIGl0KFwic2hvdWxkIHZhbGlkYXRlIHJlc2VydmVkIHF1YW50aXR5IGRvZXMgbm90IGV4Y2VlZCB0b3RhbFwiLCBhc3luYyAoKSA9PiB7XG4gICAgICBqZXN0Lm1vY2tlZChkYXRhYmFzZS5mYXJtLmZpbmRVbmlxdWUpLm1vY2tSZXNvbHZlZFZhbHVlKG1vY2tGYXJtIGFzIGFueSk7XG5cbiAgICAgIGNvbnN0IGludmFsaWRSZXNlcnZlZElucHV0ID0ge1xuICAgICAgICAuLi52YWxpZElucHV0LFxuICAgICAgICBpbnZlbnRvcnk6IHtcbiAgICAgICAgICAuLi52YWxpZElucHV0LmludmVudG9yeSxcbiAgICAgICAgICBxdWFudGl0eTogNTAsXG4gICAgICAgICAgcmVzZXJ2ZWRRdWFudGl0eTogNjAsXG4gICAgICAgIH0sXG4gICAgICB9O1xuXG4gICAgICBhd2FpdCBleHBlY3QoXG4gICAgICAgIFByb2R1Y3RTZXJ2aWNlLmNyZWF0ZVByb2R1Y3QoaW52YWxpZFJlc2VydmVkSW5wdXQgYXMgYW55LCBtb2NrVXNlcklkKSxcbiAgICAgICkucmVqZWN0cy50b1Rocm93KFwiUmVzZXJ2ZWQgcXVhbnRpdHkgY2Fubm90IGV4Y2VlZCB0b3RhbCBxdWFudGl0eVwiKTtcbiAgICB9KTtcblxuICAgIGl0KFwic2hvdWxkIGdlbmVyYXRlIHVuaXF1ZSBzbHVnIHdoZW4gZHVwbGljYXRlIGV4aXN0c1wiLCBhc3luYyAoKSA9PiB7XG4gICAgICBqZXN0Lm1vY2tlZChkYXRhYmFzZS5mYXJtLmZpbmRVbmlxdWUpLm1vY2tSZXNvbHZlZFZhbHVlKG1vY2tGYXJtIGFzIGFueSk7XG4gICAgICBqZXN0XG4gICAgICAgIC5tb2NrZWQoZGF0YWJhc2UucHJvZHVjdC5maW5kRmlyc3QpXG4gICAgICAgIC5tb2NrUmVzb2x2ZWRWYWx1ZU9uY2UoeyBzbHVnOiBcIm9yZ2FuaWMtdG9tYXRvZXNcIiB9IGFzIGFueSlcbiAgICAgICAgLm1vY2tSZXNvbHZlZFZhbHVlT25jZShudWxsKTtcbiAgICAgIGplc3QubW9ja2VkKGRhdGFiYXNlLnByb2R1Y3QuY3JlYXRlKS5tb2NrUmVzb2x2ZWRWYWx1ZSh7XG4gICAgICAgIC4uLm1vY2tQcm9kdWN0LFxuICAgICAgICBzbHVnOiBcIm9yZ2FuaWMtdG9tYXRvZXMtMVwiLFxuICAgICAgfSBhcyBhbnkpO1xuXG4gICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCBQcm9kdWN0U2VydmljZS5jcmVhdGVQcm9kdWN0KFxuICAgICAgICB2YWxpZElucHV0IGFzIGFueSxcbiAgICAgICAgbW9ja1VzZXJJZCxcbiAgICAgICk7XG5cbiAgICAgIGV4cGVjdChyZXN1bHQuc2x1ZykudG9CZShcIm9yZ2FuaWMtdG9tYXRvZXMtMVwiKTtcbiAgICB9KTtcblxuICAgIGl0KFwic2hvdWxkIGNhbGN1bGF0ZSBhdmFpbGFibGUgcXVhbnRpdHkgY29ycmVjdGx5XCIsIGFzeW5jICgpID0+IHtcbiAgICAgIGplc3QubW9ja2VkKGRhdGFiYXNlLmZhcm0uZmluZFVuaXF1ZSkubW9ja1Jlc29sdmVkVmFsdWUobW9ja0Zhcm0gYXMgYW55KTtcbiAgICAgIGplc3QubW9ja2VkKGRhdGFiYXNlLnByb2R1Y3QuZmluZEZpcnN0KS5tb2NrUmVzb2x2ZWRWYWx1ZShudWxsKTtcbiAgICAgIGplc3RcbiAgICAgICAgLm1vY2tlZChkYXRhYmFzZS5wcm9kdWN0LmNyZWF0ZSlcbiAgICAgICAgLm1vY2tSZXNvbHZlZFZhbHVlKG1vY2tQcm9kdWN0IGFzIGFueSk7XG5cbiAgICAgIGF3YWl0IFByb2R1Y3RTZXJ2aWNlLmNyZWF0ZVByb2R1Y3QodmFsaWRJbnB1dCBhcyBhbnksIG1vY2tVc2VySWQpO1xuXG4gICAgICBjb25zdCBjcmVhdGVDYWxsID0gamVzdC5tb2NrZWQoZGF0YWJhc2UucHJvZHVjdC5jcmVhdGUpLm1vY2suY2FsbHNbMF1bMF07XG4gICAgICBleHBlY3QoY3JlYXRlQ2FsbC5kYXRhLmludmVudG9yeS5hdmFpbGFibGVRdWFudGl0eSkudG9CZSgxMDApOyAvLyBxdWFudGl0eSAtIHJlc2VydmVkXG4gICAgfSk7XG5cbiAgICBpdChcInNob3VsZCBzZXQgaXNMb3dTdG9jayBjb3JyZWN0bHlcIiwgYXN5bmMgKCkgPT4ge1xuICAgICAgamVzdC5tb2NrZWQoZGF0YWJhc2UuZmFybS5maW5kVW5pcXVlKS5tb2NrUmVzb2x2ZWRWYWx1ZShtb2NrRmFybSBhcyBhbnkpO1xuICAgICAgamVzdC5tb2NrZWQoZGF0YWJhc2UucHJvZHVjdC5maW5kRmlyc3QpLm1vY2tSZXNvbHZlZFZhbHVlKG51bGwpO1xuICAgICAgamVzdFxuICAgICAgICAubW9ja2VkKGRhdGFiYXNlLnByb2R1Y3QuY3JlYXRlKVxuICAgICAgICAubW9ja1Jlc29sdmVkVmFsdWUobW9ja1Byb2R1Y3QgYXMgYW55KTtcblxuICAgICAgY29uc3QgbG93U3RvY2tJbnB1dCA9IHtcbiAgICAgICAgLi4udmFsaWRJbnB1dCxcbiAgICAgICAgaW52ZW50b3J5OiB7IHF1YW50aXR5OiAxNSwgcmVzZXJ2ZWRRdWFudGl0eTogMCwgbG93U3RvY2tUaHJlc2hvbGQ6IDIwIH0sXG4gICAgICB9O1xuXG4gICAgICBhd2FpdCBQcm9kdWN0U2VydmljZS5jcmVhdGVQcm9kdWN0KGxvd1N0b2NrSW5wdXQgYXMgYW55LCBtb2NrVXNlcklkKTtcblxuICAgICAgY29uc3QgY3JlYXRlQ2FsbCA9IGplc3QubW9ja2VkKGRhdGFiYXNlLnByb2R1Y3QuY3JlYXRlKS5tb2NrLmNhbGxzWzBdWzBdO1xuICAgICAgZXhwZWN0KGNyZWF0ZUNhbGwuZGF0YS5pbnZlbnRvcnkuaXNMb3dTdG9jaykudG9CZSh0cnVlKTtcbiAgICB9KTtcblxuICAgIGl0KFwic2hvdWxkIGV4dHJhY3QgcHJpbWFyeSBwaG90byBVUkxcIiwgYXN5bmMgKCkgPT4ge1xuICAgICAgamVzdC5tb2NrZWQoZGF0YWJhc2UuZmFybS5maW5kVW5pcXVlKS5tb2NrUmVzb2x2ZWRWYWx1ZShtb2NrRmFybSBhcyBhbnkpO1xuICAgICAgamVzdC5tb2NrZWQoZGF0YWJhc2UucHJvZHVjdC5maW5kRmlyc3QpLm1vY2tSZXNvbHZlZFZhbHVlKG51bGwpO1xuICAgICAgamVzdFxuICAgICAgICAubW9ja2VkKGRhdGFiYXNlLnByb2R1Y3QuY3JlYXRlKVxuICAgICAgICAubW9ja1Jlc29sdmVkVmFsdWUobW9ja1Byb2R1Y3QgYXMgYW55KTtcblxuICAgICAgYXdhaXQgUHJvZHVjdFNlcnZpY2UuY3JlYXRlUHJvZHVjdCh2YWxpZElucHV0IGFzIGFueSwgbW9ja1VzZXJJZCk7XG5cbiAgICAgIGNvbnN0IGNyZWF0ZUNhbGwgPSBqZXN0Lm1vY2tlZChkYXRhYmFzZS5wcm9kdWN0LmNyZWF0ZSkubW9jay5jYWxsc1swXVswXTtcbiAgICAgIGV4cGVjdChjcmVhdGVDYWxsLmRhdGEucHJpbWFyeVBob3RvVXJsKS50b0JlKFxuICAgICAgICBcImh0dHBzOi8vZXhhbXBsZS5jb20vdG9tYXRvLmpwZ1wiLFxuICAgICAgKTtcbiAgICB9KTtcbiAgfSk7XG5cbiAgZGVzY3JpYmUoXCLwn5OWIGdldFByb2R1Y3RCeUlkXCIsICgpID0+IHtcbiAgICBpdChcInNob3VsZCBnZXQgcHJvZHVjdCBieSBJRCB3aXRoIGZhcm1cIiwgYXN5bmMgKCkgPT4ge1xuICAgICAgamVzdFxuICAgICAgICAubW9ja2VkKGRhdGFiYXNlLnByb2R1Y3QuZmluZFVuaXF1ZSlcbiAgICAgICAgLm1vY2tSZXNvbHZlZFZhbHVlKG1vY2tQcm9kdWN0IGFzIGFueSk7XG5cbiAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IFByb2R1Y3RTZXJ2aWNlLmdldFByb2R1Y3RCeUlkKG1vY2tQcm9kdWN0SWQpO1xuXG4gICAgICBleHBlY3QocmVzdWx0KS50b01hdGNoT2JqZWN0KHsgaWQ6IG1vY2tQcm9kdWN0SWQgfSk7XG4gICAgICBleHBlY3QoZGF0YWJhc2UucHJvZHVjdC5maW5kVW5pcXVlKS50b0hhdmVCZWVuQ2FsbGVkV2l0aCh7XG4gICAgICAgIHdoZXJlOiB7IGlkOiBtb2NrUHJvZHVjdElkIH0sXG4gICAgICAgIGluY2x1ZGU6IHtcbiAgICAgICAgICBmYXJtOiB7XG4gICAgICAgICAgICBzZWxlY3Q6IHtcbiAgICAgICAgICAgICAgaWQ6IHRydWUsXG4gICAgICAgICAgICAgIG5hbWU6IHRydWUsXG4gICAgICAgICAgICAgIHNsdWc6IHRydWUsXG4gICAgICAgICAgICAgIGxvZ29Vcmw6IHRydWUsXG4gICAgICAgICAgICAgIHZlcmlmaWNhdGlvblN0YXR1czogdHJ1ZSxcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgfSxcbiAgICAgICAgfSxcbiAgICAgIH0pO1xuICAgIH0pO1xuXG4gICAgaXQoXCJzaG91bGQgZ2V0IHByb2R1Y3QgYnkgSUQgd2l0aG91dCBmYXJtXCIsIGFzeW5jICgpID0+IHtcbiAgICAgIGplc3RcbiAgICAgICAgLm1vY2tlZChkYXRhYmFzZS5wcm9kdWN0LmZpbmRVbmlxdWUpXG4gICAgICAgIC5tb2NrUmVzb2x2ZWRWYWx1ZShtb2NrUHJvZHVjdCBhcyBhbnkpO1xuXG4gICAgICBhd2FpdCBQcm9kdWN0U2VydmljZS5nZXRQcm9kdWN0QnlJZChtb2NrUHJvZHVjdElkLCBmYWxzZSk7XG5cbiAgICAgIGV4cGVjdChkYXRhYmFzZS5wcm9kdWN0LmZpbmRVbmlxdWUpLnRvSGF2ZUJlZW5DYWxsZWRXaXRoKHtcbiAgICAgICAgd2hlcmU6IHsgaWQ6IG1vY2tQcm9kdWN0SWQgfSxcbiAgICAgICAgaW5jbHVkZTogeyBmYXJtOiBmYWxzZSB9LFxuICAgICAgfSk7XG4gICAgfSk7XG5cbiAgICBpdChcInNob3VsZCByZXR1cm4gbnVsbCBpZiBwcm9kdWN0IG5vdCBmb3VuZFwiLCBhc3luYyAoKSA9PiB7XG4gICAgICBqZXN0Lm1vY2tlZChkYXRhYmFzZS5wcm9kdWN0LmZpbmRVbmlxdWUpLm1vY2tSZXNvbHZlZFZhbHVlKG51bGwpO1xuXG4gICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCBQcm9kdWN0U2VydmljZS5nZXRQcm9kdWN0QnlJZChcIm5vbmV4aXN0ZW50XCIpO1xuXG4gICAgICBleHBlY3QocmVzdWx0KS50b0JlTnVsbCgpO1xuICAgIH0pO1xuICB9KTtcblxuICBkZXNjcmliZShcIvCflJcgZ2V0UHJvZHVjdEJ5U2x1Z1wiLCAoKSA9PiB7XG4gICAgaXQoXCJzaG91bGQgZ2V0IHByb2R1Y3QgYnkgZmFybSBhbmQgcHJvZHVjdCBzbHVnXCIsIGFzeW5jICgpID0+IHtcbiAgICAgIGplc3RcbiAgICAgICAgLm1vY2tlZChkYXRhYmFzZS5wcm9kdWN0LmZpbmRGaXJzdClcbiAgICAgICAgLm1vY2tSZXNvbHZlZFZhbHVlKG1vY2tQcm9kdWN0IGFzIGFueSk7XG5cbiAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IFByb2R1Y3RTZXJ2aWNlLmdldFByb2R1Y3RCeVNsdWcoXG4gICAgICAgIFwidGVzdC1mYXJtXCIsXG4gICAgICAgIFwib3JnYW5pYy10b21hdG9lc1wiLFxuICAgICAgKTtcblxuICAgICAgZXhwZWN0KHJlc3VsdCkudG9NYXRjaE9iamVjdCh7IHNsdWc6IFwib3JnYW5pYy10b21hdG9lc1wiIH0pO1xuICAgICAgZXhwZWN0KG1vY2tEYXRhYmFzZS5wcm9kdWN0LmZpbmRGaXJzdCkudG9IYXZlQmVlbkNhbGxlZFdpdGgoe1xuICAgICAgICB3aGVyZToge1xuICAgICAgICAgIHNsdWc6IFwib3JnYW5pYy10b21hdG9lc1wiLFxuICAgICAgICAgIGZhcm06IHsgc2x1ZzogXCJ0ZXN0LWZhcm1cIiB9LFxuICAgICAgICB9LFxuICAgICAgICBpbmNsdWRlOiBleHBlY3QuYW55KE9iamVjdCksXG4gICAgICB9KTtcbiAgICB9KTtcblxuICAgIGl0KFwic2hvdWxkIHJldHVybiBudWxsIGlmIHByb2R1Y3Qgbm90IGZvdW5kIGJ5IHNsdWdcIiwgYXN5bmMgKCkgPT4ge1xuICAgICAgamVzdC5tb2NrZWQoZGF0YWJhc2UucHJvZHVjdC5maW5kRmlyc3QpLm1vY2tSZXNvbHZlZFZhbHVlKG51bGwpO1xuXG4gICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCBQcm9kdWN0U2VydmljZS5nZXRQcm9kdWN0QnlTbHVnKFxuICAgICAgICBcInRlc3QtZmFybVwiLFxuICAgICAgICBcIm5vbmV4aXN0ZW50XCIsXG4gICAgICApO1xuXG4gICAgICBleHBlY3QocmVzdWx0KS50b0JlTnVsbCgpO1xuICAgIH0pO1xuICB9KTtcblxuICBkZXNjcmliZShcIvCfk4sgbGlzdFByb2R1Y3RzXCIsICgpID0+IHtcbiAgICBjb25zdCBtb2NrUHJvZHVjdHMgPSBbbW9ja1Byb2R1Y3QsIHsgLi4ubW9ja1Byb2R1Y3QsIGlkOiBcInByb2R1Y3QtNDU2XCIgfV07XG5cbiAgICBpdChcInNob3VsZCBsaXN0IHByb2R1Y3RzIHdpdGggZGVmYXVsdCBwYWdpbmF0aW9uXCIsIGFzeW5jICgpID0+IHtcbiAgICAgIGplc3RcbiAgICAgICAgLm1vY2tlZChkYXRhYmFzZS5wcm9kdWN0LmZpbmRNYW55KVxuICAgICAgICAubW9ja1Jlc29sdmVkVmFsdWUobW9ja1Byb2R1Y3RzIGFzIGFueSk7XG4gICAgICBqZXN0Lm1vY2tlZChkYXRhYmFzZS5wcm9kdWN0LmNvdW50KS5tb2NrUmVzb2x2ZWRWYWx1ZSgyKTtcblxuICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgUHJvZHVjdFNlcnZpY2UubGlzdFByb2R1Y3RzKCk7XG5cbiAgICAgIGV4cGVjdChyZXN1bHQucHJvZHVjdHMpLnRvSGF2ZUxlbmd0aCgyKTtcbiAgICAgIGV4cGVjdChyZXN1bHQucGFnaW5hdGlvbikudG9NYXRjaE9iamVjdCh7XG4gICAgICAgIHBhZ2U6IDEsXG4gICAgICAgIGxpbWl0OiAyMCxcbiAgICAgICAgdG90YWw6IDIsXG4gICAgICAgIHRvdGFsUGFnZXM6IDEsXG4gICAgICAgIGhhc01vcmU6IGZhbHNlLFxuICAgICAgfSk7XG4gICAgfSk7XG5cbiAgICBpdChcInNob3VsZCBmaWx0ZXIgcHJvZHVjdHMgYnkgZmFybSBJRFwiLCBhc3luYyAoKSA9PiB7XG4gICAgICBqZXN0XG4gICAgICAgIC5tb2NrZWQoZGF0YWJhc2UucHJvZHVjdC5maW5kTWFueSlcbiAgICAgICAgLm1vY2tSZXNvbHZlZFZhbHVlKG1vY2tQcm9kdWN0cyBhcyBhbnkpO1xuICAgICAgamVzdC5tb2NrZWQoZGF0YWJhc2UucHJvZHVjdC5jb3VudCkubW9ja1Jlc29sdmVkVmFsdWUoMik7XG5cbiAgICAgIGF3YWl0IFByb2R1Y3RTZXJ2aWNlLmxpc3RQcm9kdWN0cyh7IGZhcm1JZDogbW9ja0Zhcm1JZCB9KTtcblxuICAgICAgY29uc3QgZmluZENhbGwgPSBqZXN0Lm1vY2tlZChkYXRhYmFzZS5wcm9kdWN0LmZpbmRNYW55KS5tb2NrLmNhbGxzWzBdWzBdO1xuICAgICAgZXhwZWN0KGZpbmRDYWxsLndoZXJlKS50b01hdGNoT2JqZWN0KHsgZmFybUlkOiBtb2NrRmFybUlkIH0pO1xuICAgIH0pO1xuXG4gICAgaXQoXCJzaG91bGQgZmlsdGVyIHByb2R1Y3RzIGJ5IGNhdGVnb3J5XCIsIGFzeW5jICgpID0+IHtcbiAgICAgIGplc3RcbiAgICAgICAgLm1vY2tlZChkYXRhYmFzZS5wcm9kdWN0LmZpbmRNYW55KVxuICAgICAgICAubW9ja1Jlc29sdmVkVmFsdWUobW9ja1Byb2R1Y3RzIGFzIGFueSk7XG4gICAgICBqZXN0Lm1vY2tlZChkYXRhYmFzZS5wcm9kdWN0LmNvdW50KS5tb2NrUmVzb2x2ZWRWYWx1ZSgyKTtcblxuICAgICAgYXdhaXQgUHJvZHVjdFNlcnZpY2UubGlzdFByb2R1Y3RzKHsgY2F0ZWdvcnk6IFwiVkVHRVRBQkxFU1wiIH0pO1xuXG4gICAgICBjb25zdCBmaW5kQ2FsbCA9IGplc3QubW9ja2VkKGRhdGFiYXNlLnByb2R1Y3QuZmluZE1hbnkpLm1vY2suY2FsbHNbMF1bMF07XG4gICAgICBleHBlY3QoZmluZENhbGwud2hlcmUpLnRvTWF0Y2hPYmplY3QoeyBjYXRlZ29yeTogXCJWRUdFVEFCTEVTXCIgfSk7XG4gICAgfSk7XG5cbiAgICBpdChcInNob3VsZCBmaWx0ZXIgcHJvZHVjdHMgYnkgc3RhdHVzXCIsIGFzeW5jICgpID0+IHtcbiAgICAgIGplc3RcbiAgICAgICAgLm1vY2tlZChkYXRhYmFzZS5wcm9kdWN0LmZpbmRNYW55KVxuICAgICAgICAubW9ja1Jlc29sdmVkVmFsdWUobW9ja1Byb2R1Y3RzIGFzIGFueSk7XG4gICAgICBqZXN0Lm1vY2tlZChkYXRhYmFzZS5wcm9kdWN0LmNvdW50KS5tb2NrUmVzb2x2ZWRWYWx1ZSgyKTtcblxuICAgICAgYXdhaXQgUHJvZHVjdFNlcnZpY2UubGlzdFByb2R1Y3RzKHsgc3RhdHVzOiBQcm9kdWN0U3RhdHVzLkFWQUlMQUJMRSB9KTtcblxuICAgICAgY29uc3QgZmluZENhbGwgPSBqZXN0Lm1vY2tlZChkYXRhYmFzZS5wcm9kdWN0LmZpbmRNYW55KS5tb2NrLmNhbGxzWzBdWzBdO1xuICAgICAgZXhwZWN0KGZpbmRDYWxsLndoZXJlKS50b01hdGNoT2JqZWN0KHsgc3RhdHVzOiBQcm9kdWN0U3RhdHVzLkFWQUlMQUJMRSB9KTtcbiAgICB9KTtcblxuICAgIGl0KFwic2hvdWxkIGZpbHRlciBwcm9kdWN0cyBpbiBzdG9ja1wiLCBhc3luYyAoKSA9PiB7XG4gICAgICBqZXN0XG4gICAgICAgIC5tb2NrZWQoZGF0YWJhc2UucHJvZHVjdC5maW5kTWFueSlcbiAgICAgICAgLm1vY2tSZXNvbHZlZFZhbHVlKG1vY2tQcm9kdWN0cyBhcyBhbnkpO1xuICAgICAgamVzdC5tb2NrZWQoZGF0YWJhc2UucHJvZHVjdC5jb3VudCkubW9ja1Jlc29sdmVkVmFsdWUoMik7XG5cbiAgICAgIGF3YWl0IFByb2R1Y3RTZXJ2aWNlLmxpc3RQcm9kdWN0cyh7IGluU3RvY2s6IHRydWUgfSk7XG5cbiAgICAgIGNvbnN0IGZpbmRDYWxsID0gamVzdC5tb2NrZWQoZGF0YWJhc2UucHJvZHVjdC5maW5kTWFueSkubW9jay5jYWxsc1swXVswXTtcbiAgICAgIGV4cGVjdChmaW5kQ2FsbC53aGVyZS5pbnZlbnRvcnkpLnRvTWF0Y2hPYmplY3QoeyBpblN0b2NrOiB0cnVlIH0pO1xuICAgIH0pO1xuXG4gICAgaXQoXCJzaG91bGQgZmlsdGVyIGZlYXR1cmVkIHByb2R1Y3RzXCIsIGFzeW5jICgpID0+IHtcbiAgICAgIGplc3RcbiAgICAgICAgLm1vY2tlZChkYXRhYmFzZS5wcm9kdWN0LmZpbmRNYW55KVxuICAgICAgICAubW9ja1Jlc29sdmVkVmFsdWUobW9ja1Byb2R1Y3RzIGFzIGFueSk7XG4gICAgICBqZXN0Lm1vY2tlZChkYXRhYmFzZS5wcm9kdWN0LmNvdW50KS5tb2NrUmVzb2x2ZWRWYWx1ZSgyKTtcblxuICAgICAgYXdhaXQgUHJvZHVjdFNlcnZpY2UubGlzdFByb2R1Y3RzKHsgaXNGZWF0dXJlZDogdHJ1ZSB9KTtcblxuICAgICAgY29uc3QgZmluZENhbGwgPSBqZXN0Lm1vY2tlZChkYXRhYmFzZS5wcm9kdWN0LmZpbmRNYW55KS5tb2NrLmNhbGxzWzBdWzBdO1xuICAgICAgZXhwZWN0KGZpbmRDYWxsLndoZXJlKS50b01hdGNoT2JqZWN0KHsgaXNGZWF0dXJlZDogdHJ1ZSB9KTtcbiAgICB9KTtcblxuICAgIGl0KFwic2hvdWxkIHNlYXJjaCBwcm9kdWN0cyBieSBuYW1lXCIsIGFzeW5jICgpID0+IHtcbiAgICAgIGplc3RcbiAgICAgICAgLm1vY2tlZChkYXRhYmFzZS5wcm9kdWN0LmZpbmRNYW55KVxuICAgICAgICAubW9ja1Jlc29sdmVkVmFsdWUobW9ja1Byb2R1Y3RzIGFzIGFueSk7XG4gICAgICBqZXN0Lm1vY2tlZChkYXRhYmFzZS5wcm9kdWN0LmNvdW50KS5tb2NrUmVzb2x2ZWRWYWx1ZSgyKTtcblxuICAgICAgYXdhaXQgUHJvZHVjdFNlcnZpY2UubGlzdFByb2R1Y3RzKHsgc2VhcmNoOiBcInRvbWF0b1wiIH0pO1xuXG4gICAgICBjb25zdCBmaW5kQ2FsbCA9IGplc3QubW9ja2VkKGRhdGFiYXNlLnByb2R1Y3QuZmluZE1hbnkpLm1vY2suY2FsbHNbMF1bMF07XG4gICAgICBleHBlY3QoZmluZENhbGwud2hlcmUuT1IpLnRvQmVEZWZpbmVkKCk7XG4gICAgfSk7XG5cbiAgICBpdChcInNob3VsZCBoYW5kbGUgcGFnaW5hdGlvbiBjb3JyZWN0bHlcIiwgYXN5bmMgKCkgPT4ge1xuICAgICAgamVzdFxuICAgICAgICAubW9ja2VkKGRhdGFiYXNlLnByb2R1Y3QuZmluZE1hbnkpXG4gICAgICAgIC5tb2NrUmVzb2x2ZWRWYWx1ZShtb2NrUHJvZHVjdHMgYXMgYW55KTtcbiAgICAgIGplc3QubW9ja2VkKGRhdGFiYXNlLnByb2R1Y3QuY291bnQpLm1vY2tSZXNvbHZlZFZhbHVlKDUwKTtcblxuICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgUHJvZHVjdFNlcnZpY2UubGlzdFByb2R1Y3RzKFxuICAgICAgICB7fSxcbiAgICAgICAgeyBwYWdlOiAyLCBsaW1pdDogMTAgfSxcbiAgICAgICk7XG5cbiAgICAgIGV4cGVjdChyZXN1bHQucGFnaW5hdGlvbikudG9NYXRjaE9iamVjdCh7XG4gICAgICAgIHBhZ2U6IDIsXG4gICAgICAgIGxpbWl0OiAxMCxcbiAgICAgICAgdG90YWw6IDUwLFxuICAgICAgICB0b3RhbFBhZ2VzOiA1LFxuICAgICAgICBoYXNNb3JlOiB0cnVlLFxuICAgICAgfSk7XG5cbiAgICAgIGNvbnN0IGZpbmRDYWxsID0gamVzdC5tb2NrZWQoZGF0YWJhc2UucHJvZHVjdC5maW5kTWFueSkubW9jay5jYWxsc1swXVswXTtcbiAgICAgIGV4cGVjdChmaW5kQ2FsbC5za2lwKS50b0JlKDEwKTtcbiAgICAgIGV4cGVjdChmaW5kQ2FsbC50YWtlKS50b0JlKDEwKTtcbiAgICB9KTtcbiAgfSk7XG5cbiAgZGVzY3JpYmUoXCLinI/vuI8gdXBkYXRlUHJvZHVjdFwiLCAoKSA9PiB7XG4gICAgY29uc3QgdXBkYXRlRGF0YSA9IHtcbiAgICAgIG5hbWU6IFwiVXBkYXRlZCBUb21hdG9lc1wiLFxuICAgICAgcHJpY2luZzogeyBiYXNlUHJpY2U6IHsgYW1vdW50OiA2MDAsIGN1cnJlbmN5OiBcIlVTRFwiIH0gfSxcbiAgICB9O1xuXG4gICAgaXQoXCJzaG91bGQgdXBkYXRlIHByb2R1Y3Qgc3VjY2Vzc2Z1bGx5XCIsIGFzeW5jICgpID0+IHtcbiAgICAgIGplc3RcbiAgICAgICAgLm1vY2tlZChkYXRhYmFzZS5wcm9kdWN0LmZpbmRVbmlxdWUpXG4gICAgICAgIC5tb2NrUmVzb2x2ZWRWYWx1ZShtb2NrUHJvZHVjdCBhcyBhbnkpO1xuICAgICAgamVzdC5tb2NrZWQoZGF0YWJhc2UucHJvZHVjdC5maW5kRmlyc3QpLm1vY2tSZXNvbHZlZFZhbHVlKG51bGwpO1xuICAgICAgamVzdC5tb2NrZWQoZGF0YWJhc2UucHJvZHVjdC51cGRhdGUpLm1vY2tSZXNvbHZlZFZhbHVlKHtcbiAgICAgICAgLi4ubW9ja1Byb2R1Y3QsXG4gICAgICAgIC4uLnVwZGF0ZURhdGEsXG4gICAgICB9IGFzIGFueSk7XG5cbiAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IFByb2R1Y3RTZXJ2aWNlLnVwZGF0ZVByb2R1Y3QoXG4gICAgICAgIG1vY2tQcm9kdWN0SWQsXG4gICAgICAgIHVwZGF0ZURhdGEgYXMgYW55LFxuICAgICAgICBtb2NrVXNlcklkLFxuICAgICAgKTtcblxuICAgICAgZXhwZWN0KHJlc3VsdC5uYW1lKS50b0JlKFwiVXBkYXRlZCBUb21hdG9lc1wiKTtcbiAgICB9KTtcblxuICAgIGl0KFwic2hvdWxkIHRocm93IGVycm9yIGlmIHByb2R1Y3Qgbm90IGZvdW5kXCIsIGFzeW5jICgpID0+IHtcbiAgICAgIGplc3QubW9ja2VkKGRhdGFiYXNlLnByb2R1Y3QuZmluZFVuaXF1ZSkubW9ja1Jlc29sdmVkVmFsdWUobnVsbCk7XG5cbiAgICAgIGF3YWl0IGV4cGVjdChcbiAgICAgICAgUHJvZHVjdFNlcnZpY2UudXBkYXRlUHJvZHVjdChcbiAgICAgICAgICBtb2NrUHJvZHVjdElkLFxuICAgICAgICAgIHVwZGF0ZURhdGEgYXMgYW55LFxuICAgICAgICAgIG1vY2tVc2VySWQsXG4gICAgICAgICksXG4gICAgICApLnJlamVjdHMudG9UaHJvdyhcIlByb2R1Y3Qgbm90IGZvdW5kXCIpO1xuICAgIH0pO1xuXG4gICAgaXQoXCJzaG91bGQgdGhyb3cgZXJyb3IgZm9yIHVuYXV0aG9yaXplZCB1c2VyXCIsIGFzeW5jICgpID0+IHtcbiAgICAgIGplc3QubW9ja2VkKGRhdGFiYXNlLnByb2R1Y3QuZmluZFVuaXF1ZSkubW9ja1Jlc29sdmVkVmFsdWUoe1xuICAgICAgICAuLi5tb2NrUHJvZHVjdCxcbiAgICAgICAgZmFybTogeyAuLi5tb2NrRmFybSwgb3duZXJJZDogXCJkaWZmZXJlbnQtdXNlclwiIH0sXG4gICAgICB9IGFzIGFueSk7XG5cbiAgICAgIGF3YWl0IGV4cGVjdChcbiAgICAgICAgUHJvZHVjdFNlcnZpY2UudXBkYXRlUHJvZHVjdChcbiAgICAgICAgICBtb2NrUHJvZHVjdElkLFxuICAgICAgICAgIHVwZGF0ZURhdGEgYXMgYW55LFxuICAgICAgICAgIG1vY2tVc2VySWQsXG4gICAgICAgICksXG4gICAgICApLnJlamVjdHMudG9UaHJvdyhcIlVuYXV0aG9yaXplZDogWW91IGRvbid0IG93biB0aGlzIHByb2R1Y3RcIik7XG4gICAgfSk7XG5cbiAgICBpdChcInNob3VsZCByZWdlbmVyYXRlIHNsdWcgaWYgbmFtZSBjaGFuZ2VzXCIsIGFzeW5jICgpID0+IHtcbiAgICAgIGNvbnN0IG9yaWdpbmFsUHJvZHVjdCA9IHtcbiAgICAgICAgLi4ubW9ja1Byb2R1Y3QsXG4gICAgICAgIG5hbWU6IFwiT3JpZ2luYWwgUHJvZHVjdCBOYW1lXCIsXG4gICAgICAgIHNsdWc6IFwib3JpZ2luYWwtcHJvZHVjdC1uYW1lXCIsXG4gICAgICAgIGZhcm06IHtcbiAgICAgICAgICBvd25lcklkOiBtb2NrVXNlcklkLFxuICAgICAgICB9LFxuICAgICAgfTtcblxuICAgICAgamVzdFxuICAgICAgICAubW9ja2VkKGRhdGFiYXNlLnByb2R1Y3QuZmluZFVuaXF1ZSlcbiAgICAgICAgLm1vY2tSZXNvbHZlZFZhbHVlKG9yaWdpbmFsUHJvZHVjdCBhcyBhbnkpO1xuXG4gICAgICAvLyBNb2NrIGZpbmRGaXJzdCB0byByZXR1cm4gbnVsbCAobm8gZHVwbGljYXRlIHNsdWdzKVxuICAgICAgamVzdC5tb2NrZWQoZGF0YWJhc2UucHJvZHVjdC5maW5kRmlyc3QpLm1vY2tSZXNvbHZlZFZhbHVlKG51bGwpO1xuXG4gICAgICBjb25zdCB1cGRhdGVkUHJvZHVjdCA9IHtcbiAgICAgICAgLi4ub3JpZ2luYWxQcm9kdWN0LFxuICAgICAgICBuYW1lOiBcIk5ldyBQcm9kdWN0IE5hbWVcIixcbiAgICAgICAgc2x1ZzogXCJuZXctcHJvZHVjdC1uYW1lXCIsXG4gICAgICAgIGZhcm06IHtcbiAgICAgICAgICBpZDogbW9ja0Zhcm1JZCxcbiAgICAgICAgICBuYW1lOiBcIlRlc3QgRmFybVwiLFxuICAgICAgICAgIHNsdWc6IFwidGVzdC1mYXJtXCIsXG4gICAgICAgICAgbG9nb1VybDogbnVsbCxcbiAgICAgICAgICB2ZXJpZmljYXRpb25TdGF0dXM6IFwiVkVSSUZJRURcIiBhcyBhbnksXG4gICAgICAgIH0sXG4gICAgICB9O1xuXG4gICAgICBqZXN0XG4gICAgICAgIC5tb2NrZWQoZGF0YWJhc2UucHJvZHVjdC51cGRhdGUpXG4gICAgICAgIC5tb2NrUmVzb2x2ZWRWYWx1ZSh1cGRhdGVkUHJvZHVjdCBhcyBhbnkpO1xuXG4gICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCBQcm9kdWN0U2VydmljZS51cGRhdGVQcm9kdWN0KFxuICAgICAgICBtb2NrUHJvZHVjdElkLFxuICAgICAgICB7IG5hbWU6IFwiTmV3IFByb2R1Y3QgTmFtZVwiIH0gYXMgYW55LFxuICAgICAgICBtb2NrVXNlcklkLFxuICAgICAgKTtcblxuICAgICAgZXhwZWN0KHJlc3VsdC5uYW1lKS50b0JlKFwiTmV3IFByb2R1Y3QgTmFtZVwiKTtcbiAgICAgIGV4cGVjdChyZXN1bHQuc2x1ZykudG9CZShcIm5ldy1wcm9kdWN0LW5hbWVcIik7XG5cbiAgICAgIC8vIFZlcmlmeSBzbHVnIGdlbmVyYXRpb24gd2FzIGNhbGxlZCAoY2hlY2tzIGZvciBkdXBsaWNhdGUgc2x1Z3MpXG4gICAgICBleHBlY3QoZGF0YWJhc2UucHJvZHVjdC5maW5kRmlyc3QpLnRvSGF2ZUJlZW5DYWxsZWQoKTtcblxuICAgICAgLy8gVmVyaWZ5IHVwZGF0ZSB3YXMgY2FsbGVkIHdpdGggdGhlIGRhdGFcbiAgICAgIGNvbnN0IHVwZGF0ZUNhbGwgPSBqZXN0Lm1vY2tlZChkYXRhYmFzZS5wcm9kdWN0LnVwZGF0ZSkubW9jay5jYWxsc1swXVswXTtcblxuICAgICAgLy8gVGhlIHNsdWcgaXMgcGFzc2VkIGFzIGEgc2VwYXJhdGUgZmllbGQgaW4gdGhlIGRhdGEgb2JqZWN0XG4gICAgICAvLyBDaGVjayB0aGF0IHVwZGF0ZSB3YXMgY2FsbGVkIHdpdGggdGhlIG5ldyBuYW1lXG4gICAgICBleHBlY3QodXBkYXRlQ2FsbC53aGVyZS5pZCkudG9CZShtb2NrUHJvZHVjdElkKTtcbiAgICAgIGV4cGVjdCh1cGRhdGVDYWxsLmRhdGEubmFtZSkudG9CZShcIk5ldyBQcm9kdWN0IE5hbWVcIik7XG5cbiAgICAgIC8vIFRoZSBzZXJ2aWNlIHNob3VsZCBoYXZlIGdlbmVyYXRlZCBhIG5ldyBzbHVnICh2ZXJpZmllZCBieSBmaW5kRmlyc3QgY2FsbClcbiAgICAgIGV4cGVjdChkYXRhYmFzZS5wcm9kdWN0LmZpbmRGaXJzdCkudG9IYXZlQmVlbkNhbGxlZFdpdGgoXG4gICAgICAgIGV4cGVjdC5vYmplY3RDb250YWluaW5nKHtcbiAgICAgICAgICB3aGVyZTogZXhwZWN0Lm9iamVjdENvbnRhaW5pbmcoe1xuICAgICAgICAgICAgZmFybUlkOiBtb2NrRmFybUlkLFxuICAgICAgICAgIH0pLFxuICAgICAgICB9KSxcbiAgICAgICk7XG4gICAgfSk7XG5cbiAgICBpdChcInNob3VsZCByZWNhbGN1bGF0ZSBpbnZlbnRvcnkgd2hlbiB1cGRhdGVkXCIsIGFzeW5jICgpID0+IHtcbiAgICAgIGplc3RcbiAgICAgICAgLm1vY2tlZChkYXRhYmFzZS5wcm9kdWN0LmZpbmRVbmlxdWUpXG4gICAgICAgIC5tb2NrUmVzb2x2ZWRWYWx1ZShtb2NrUHJvZHVjdCBhcyBhbnkpO1xuICAgICAgamVzdFxuICAgICAgICAubW9ja2VkKGRhdGFiYXNlLnByb2R1Y3QudXBkYXRlKVxuICAgICAgICAubW9ja1Jlc29sdmVkVmFsdWUobW9ja1Byb2R1Y3QgYXMgYW55KTtcblxuICAgICAgYXdhaXQgUHJvZHVjdFNlcnZpY2UudXBkYXRlUHJvZHVjdChcbiAgICAgICAgbW9ja1Byb2R1Y3RJZCxcbiAgICAgICAgeyBpbnZlbnRvcnk6IHsgcXVhbnRpdHk6IDIwMCwgcmVzZXJ2ZWRRdWFudGl0eTogMjAgfSB9IGFzIGFueSxcbiAgICAgICAgbW9ja1VzZXJJZCxcbiAgICAgICk7XG5cbiAgICAgIGNvbnN0IHVwZGF0ZUNhbGwgPSBqZXN0Lm1vY2tlZChkYXRhYmFzZS5wcm9kdWN0LnVwZGF0ZSkubW9jay5jYWxsc1swXVswXTtcbiAgICAgIGV4cGVjdCh1cGRhdGVDYWxsLmRhdGEuaW52ZW50b3J5LmF2YWlsYWJsZVF1YW50aXR5KS50b0JlKDE4MCk7XG4gICAgfSk7XG5cbiAgICBpdChcInNob3VsZCB1cGRhdGUgcHJpbWFyeSBwaG90byBVUkwgaWYgaW1hZ2VzIGNoYW5nZVwiLCBhc3luYyAoKSA9PiB7XG4gICAgICBqZXN0XG4gICAgICAgIC5tb2NrZWQoZGF0YWJhc2UucHJvZHVjdC5maW5kVW5pcXVlKVxuICAgICAgICAubW9ja1Jlc29sdmVkVmFsdWUobW9ja1Byb2R1Y3QgYXMgYW55KTtcbiAgICAgIGplc3RcbiAgICAgICAgLm1vY2tlZChkYXRhYmFzZS5wcm9kdWN0LnVwZGF0ZSlcbiAgICAgICAgLm1vY2tSZXNvbHZlZFZhbHVlKG1vY2tQcm9kdWN0IGFzIGFueSk7XG5cbiAgICAgIGNvbnN0IG5ld0ltYWdlcyA9IFtcbiAgICAgICAgeyB1cmw6IFwiaHR0cHM6Ly9leGFtcGxlLmNvbS9uZXcuanBnXCIsIGlzUHJpbWFyeTogdHJ1ZSB9LFxuICAgICAgXTtcblxuICAgICAgYXdhaXQgUHJvZHVjdFNlcnZpY2UudXBkYXRlUHJvZHVjdChcbiAgICAgICAgbW9ja1Byb2R1Y3RJZCxcbiAgICAgICAgeyBpbWFnZXM6IG5ld0ltYWdlcyB9IGFzIGFueSxcbiAgICAgICAgbW9ja1VzZXJJZCxcbiAgICAgICk7XG5cbiAgICAgIGNvbnN0IHVwZGF0ZUNhbGwgPSBqZXN0Lm1vY2tlZChkYXRhYmFzZS5wcm9kdWN0LnVwZGF0ZSkubW9jay5jYWxsc1swXVswXTtcbiAgICAgIGV4cGVjdCh1cGRhdGVDYWxsLmRhdGEucHJpbWFyeVBob3RvVXJsKS50b0JlKFxuICAgICAgICBcImh0dHBzOi8vZXhhbXBsZS5jb20vbmV3LmpwZ1wiLFxuICAgICAgKTtcbiAgICB9KTtcbiAgfSk7XG5cbiAgZGVzY3JpYmUoXCLwn5eR77iPIGRlbGV0ZVByb2R1Y3RcIiwgKCkgPT4ge1xuICAgIGl0KFwic2hvdWxkIHNvZnQgZGVsZXRlIHByb2R1Y3Qgc3VjY2Vzc2Z1bGx5XCIsIGFzeW5jICgpID0+IHtcbiAgICAgIGplc3RcbiAgICAgICAgLm1vY2tlZChkYXRhYmFzZS5wcm9kdWN0LmZpbmRVbmlxdWUpXG4gICAgICAgIC5tb2NrUmVzb2x2ZWRWYWx1ZShtb2NrUHJvZHVjdCBhcyBhbnkpO1xuICAgICAgamVzdFxuICAgICAgICAubW9ja2VkKGRhdGFiYXNlLnByb2R1Y3QudXBkYXRlKVxuICAgICAgICAubW9ja1Jlc29sdmVkVmFsdWUobW9ja1Byb2R1Y3QgYXMgYW55KTtcblxuICAgICAgYXdhaXQgUHJvZHVjdFNlcnZpY2UuZGVsZXRlUHJvZHVjdChtb2NrUHJvZHVjdElkLCBtb2NrVXNlcklkKTtcblxuICAgICAgZXhwZWN0KG1vY2tEYXRhYmFzZS5wcm9kdWN0LnVwZGF0ZSkudG9IYXZlQmVlbkNhbGxlZFdpdGgoe1xuICAgICAgICB3aGVyZTogeyBpZDogbW9ja1Byb2R1Y3RJZCB9LFxuICAgICAgICBkYXRhOiB7XG4gICAgICAgICAgc3RhdHVzOiBQcm9kdWN0U3RhdHVzLkRJU0NPTlRJTlVFRCxcbiAgICAgICAgICB1cGRhdGVkQXQ6IGV4cGVjdC5hbnkoRGF0ZSksXG4gICAgICAgIH0sXG4gICAgICB9KTtcbiAgICB9KTtcblxuICAgIGl0KFwic2hvdWxkIHRocm93IGVycm9yIGlmIHByb2R1Y3Qgbm90IGZvdW5kXCIsIGFzeW5jICgpID0+IHtcbiAgICAgIGplc3QubW9ja2VkKGRhdGFiYXNlLnByb2R1Y3QuZmluZFVuaXF1ZSkubW9ja1Jlc29sdmVkVmFsdWUobnVsbCk7XG5cbiAgICAgIGF3YWl0IGV4cGVjdChcbiAgICAgICAgUHJvZHVjdFNlcnZpY2UuZGVsZXRlUHJvZHVjdChtb2NrUHJvZHVjdElkLCBtb2NrVXNlcklkKSxcbiAgICAgICkucmVqZWN0cy50b1Rocm93KFwiUHJvZHVjdCBub3QgZm91bmRcIik7XG4gICAgfSk7XG5cbiAgICBpdChcInNob3VsZCB0aHJvdyBlcnJvciBmb3IgdW5hdXRob3JpemVkIHVzZXJcIiwgYXN5bmMgKCkgPT4ge1xuICAgICAgamVzdC5tb2NrZWQoZGF0YWJhc2UucHJvZHVjdC5maW5kVW5pcXVlKS5tb2NrUmVzb2x2ZWRWYWx1ZSh7XG4gICAgICAgIC4uLm1vY2tQcm9kdWN0LFxuICAgICAgICBmYXJtOiB7IC4uLm1vY2tGYXJtLCBvd25lcklkOiBcImRpZmZlcmVudC11c2VyXCIgfSxcbiAgICAgIH0gYXMgYW55KTtcblxuICAgICAgYXdhaXQgZXhwZWN0KFxuICAgICAgICBQcm9kdWN0U2VydmljZS5kZWxldGVQcm9kdWN0KG1vY2tQcm9kdWN0SWQsIG1vY2tVc2VySWQpLFxuICAgICAgKS5yZWplY3RzLnRvVGhyb3coXCJVbmF1dGhvcml6ZWQ6IFlvdSBkb24ndCBvd24gdGhpcyBwcm9kdWN0XCIpO1xuICAgIH0pO1xuICB9KTtcblxuICBkZXNjcmliZShcIvCfk6YgdXBkYXRlSW52ZW50b3J5XCIsICgpID0+IHtcbiAgICBpdChcInNob3VsZCB1cGRhdGUgaW52ZW50b3J5IHN1Y2Nlc3NmdWxseVwiLCBhc3luYyAoKSA9PiB7XG4gICAgICBqZXN0XG4gICAgICAgIC5tb2NrZWQoZGF0YWJhc2UucHJvZHVjdC5maW5kVW5pcXVlKVxuICAgICAgICAubW9ja1Jlc29sdmVkVmFsdWUobW9ja1Byb2R1Y3QgYXMgYW55KTtcbiAgICAgIGplc3RcbiAgICAgICAgLm1vY2tlZChkYXRhYmFzZS5wcm9kdWN0LnVwZGF0ZSlcbiAgICAgICAgLm1vY2tSZXNvbHZlZFZhbHVlKG1vY2tQcm9kdWN0IGFzIGFueSk7XG5cbiAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IFByb2R1Y3RTZXJ2aWNlLnVwZGF0ZUludmVudG9yeShcbiAgICAgICAgbW9ja1Byb2R1Y3RJZCxcbiAgICAgICAgMTUwLFxuICAgICAgICBtb2NrVXNlcklkLFxuICAgICAgKTtcblxuICAgICAgZXhwZWN0KGRhdGFiYXNlLnByb2R1Y3QudXBkYXRlKS50b0hhdmVCZWVuQ2FsbGVkKCk7XG4gICAgICBleHBlY3QocmVzdWx0KS50b0JlRGVmaW5lZCgpO1xuICAgIH0pO1xuXG4gICAgaXQoXCJzaG91bGQgY2FsY3VsYXRlIGF2YWlsYWJsZSBxdWFudGl0eVwiLCBhc3luYyAoKSA9PiB7XG4gICAgICBqZXN0XG4gICAgICAgIC5tb2NrZWQoZGF0YWJhc2UucHJvZHVjdC5maW5kVW5pcXVlKVxuICAgICAgICAubW9ja1Jlc29sdmVkVmFsdWUobW9ja1Byb2R1Y3QgYXMgYW55KTtcbiAgICAgIGplc3RcbiAgICAgICAgLm1vY2tlZChkYXRhYmFzZS5wcm9kdWN0LnVwZGF0ZSlcbiAgICAgICAgLm1vY2tSZXNvbHZlZFZhbHVlKG1vY2tQcm9kdWN0IGFzIGFueSk7XG5cbiAgICAgIGF3YWl0IFByb2R1Y3RTZXJ2aWNlLnVwZGF0ZUludmVudG9yeShtb2NrUHJvZHVjdElkLCAxNTAsIG1vY2tVc2VySWQpO1xuXG4gICAgICBjb25zdCB1cGRhdGVDYWxsID0gamVzdC5tb2NrZWQoZGF0YWJhc2UucHJvZHVjdC51cGRhdGUpLm1vY2suY2FsbHNbMF1bMF07XG4gICAgICBleHBlY3QodXBkYXRlQ2FsbC5kYXRhLmludmVudG9yeS5hdmFpbGFibGVRdWFudGl0eSkudG9CZSgxNDApOyAvLyAxNTAgLSAxMCByZXNlcnZlZFxuICAgIH0pO1xuXG4gICAgaXQoXCJzaG91bGQgc2V0IHN0YXR1cyB0byBPVVRfT0ZfU1RPQ0sgd2hlbiBxdWFudGl0eSBpcyB6ZXJvXCIsIGFzeW5jICgpID0+IHtcbiAgICAgIGplc3RcbiAgICAgICAgLm1vY2tlZChkYXRhYmFzZS5wcm9kdWN0LmZpbmRVbmlxdWUpXG4gICAgICAgIC5tb2NrUmVzb2x2ZWRWYWx1ZShtb2NrUHJvZHVjdCBhcyBhbnkpO1xuICAgICAgamVzdFxuICAgICAgICAubW9ja2VkKGRhdGFiYXNlLnByb2R1Y3QudXBkYXRlKVxuICAgICAgICAubW9ja1Jlc29sdmVkVmFsdWUobW9ja1Byb2R1Y3QgYXMgYW55KTtcblxuICAgICAgYXdhaXQgUHJvZHVjdFNlcnZpY2UudXBkYXRlSW52ZW50b3J5KG1vY2tQcm9kdWN0SWQsIDEwLCBtb2NrVXNlcklkKTsgLy8gMTAgLSAxMCByZXNlcnZlZCA9IDBcblxuICAgICAgY29uc3QgdXBkYXRlQ2FsbCA9IGplc3QubW9ja2VkKGRhdGFiYXNlLnByb2R1Y3QudXBkYXRlKS5tb2NrLmNhbGxzWzBdWzBdO1xuICAgICAgZXhwZWN0KHVwZGF0ZUNhbGwuZGF0YS5zdGF0dXMpLnRvQmUoUHJvZHVjdFN0YXR1cy5PVVRfT0ZfU1RPQ0spO1xuICAgIH0pO1xuXG4gICAgaXQoXCJzaG91bGQgc2V0IHN0YXR1cyB0byBBVkFJTEFCTEUgd2hlbiBxdWFudGl0eSBpcyBwb3NpdGl2ZVwiLCBhc3luYyAoKSA9PiB7XG4gICAgICBqZXN0XG4gICAgICAgIC5tb2NrZWQoZGF0YWJhc2UucHJvZHVjdC5maW5kVW5pcXVlKVxuICAgICAgICAubW9ja1Jlc29sdmVkVmFsdWUobW9ja1Byb2R1Y3QgYXMgYW55KTtcbiAgICAgIGplc3RcbiAgICAgICAgLm1vY2tlZChkYXRhYmFzZS5wcm9kdWN0LnVwZGF0ZSlcbiAgICAgICAgLm1vY2tSZXNvbHZlZFZhbHVlKG1vY2tQcm9kdWN0IGFzIGFueSk7XG5cbiAgICAgIGF3YWl0IFByb2R1Y3RTZXJ2aWNlLnVwZGF0ZUludmVudG9yeShtb2NrUHJvZHVjdElkLCA1MCwgbW9ja1VzZXJJZCk7XG5cbiAgICAgIGNvbnN0IHVwZGF0ZUNhbGwgPSBqZXN0Lm1vY2tlZChkYXRhYmFzZS5wcm9kdWN0LnVwZGF0ZSkubW9jay5jYWxsc1swXVswXTtcbiAgICAgIGV4cGVjdCh1cGRhdGVDYWxsLmRhdGEuc3RhdHVzKS50b0JlKFByb2R1Y3RTdGF0dXMuQVZBSUxBQkxFKTtcbiAgICB9KTtcblxuICAgIGl0KFwic2hvdWxkIHVwZGF0ZSBsYXN0UmVzdG9ja2VkIHRpbWVzdGFtcFwiLCBhc3luYyAoKSA9PiB7XG4gICAgICBqZXN0XG4gICAgICAgIC5tb2NrZWQoZGF0YWJhc2UucHJvZHVjdC5maW5kVW5pcXVlKVxuICAgICAgICAubW9ja1Jlc29sdmVkVmFsdWUobW9ja1Byb2R1Y3QgYXMgYW55KTtcbiAgICAgIGplc3RcbiAgICAgICAgLm1vY2tlZChkYXRhYmFzZS5wcm9kdWN0LnVwZGF0ZSlcbiAgICAgICAgLm1vY2tSZXNvbHZlZFZhbHVlKG1vY2tQcm9kdWN0IGFzIGFueSk7XG5cbiAgICAgIGF3YWl0IFByb2R1Y3RTZXJ2aWNlLnVwZGF0ZUludmVudG9yeShtb2NrUHJvZHVjdElkLCAxNTAsIG1vY2tVc2VySWQpO1xuXG4gICAgICBjb25zdCB1cGRhdGVDYWxsID0gamVzdC5tb2NrZWQoZGF0YWJhc2UucHJvZHVjdC51cGRhdGUpLm1vY2suY2FsbHNbMF1bMF07XG4gICAgICBleHBlY3QodXBkYXRlQ2FsbC5kYXRhLmludmVudG9yeS5sYXN0UmVzdG9ja2VkKS50b0JlSW5zdGFuY2VPZihEYXRlKTtcbiAgICB9KTtcbiAgfSk7XG5cbiAgZGVzY3JpYmUoXCLwn5SNIHNlYXJjaFByb2R1Y3RzXCIsICgpID0+IHtcbiAgICBpdChcInNob3VsZCBzZWFyY2ggcHJvZHVjdHMgYnkgbmFtZVwiLCBhc3luYyAoKSA9PiB7XG4gICAgICBqZXN0XG4gICAgICAgIC5tb2NrZWQoZGF0YWJhc2UucHJvZHVjdC5maW5kTWFueSlcbiAgICAgICAgLm1vY2tSZXNvbHZlZFZhbHVlKFttb2NrUHJvZHVjdF0gYXMgYW55KTtcblxuICAgICAgY29uc3QgcmVzdWx0cyA9IGF3YWl0IFByb2R1Y3RTZXJ2aWNlLnNlYXJjaFByb2R1Y3RzKFwidG9tYXRvXCIpO1xuXG4gICAgICBleHBlY3QocmVzdWx0cykudG9IYXZlTGVuZ3RoKDEpO1xuICAgICAgY29uc3QgZmluZENhbGwgPSBqZXN0Lm1vY2tlZChkYXRhYmFzZS5wcm9kdWN0LmZpbmRNYW55KS5tb2NrLmNhbGxzWzBdWzBdO1xuICAgICAgZXhwZWN0KGZpbmRDYWxsLndoZXJlLk9SKS50b0JlRGVmaW5lZCgpO1xuICAgIH0pO1xuXG4gICAgaXQoXCJzaG91bGQgbGltaXQgc2VhcmNoIHJlc3VsdHNcIiwgYXN5bmMgKCkgPT4ge1xuICAgICAgamVzdFxuICAgICAgICAubW9ja2VkKGRhdGFiYXNlLnByb2R1Y3QuZmluZE1hbnkpXG4gICAgICAgIC5tb2NrUmVzb2x2ZWRWYWx1ZShbbW9ja1Byb2R1Y3RdIGFzIGFueSk7XG5cbiAgICAgIGF3YWl0IFByb2R1Y3RTZXJ2aWNlLnNlYXJjaFByb2R1Y3RzKFwidG9tYXRvXCIsIDUpO1xuXG4gICAgICBjb25zdCBmaW5kQ2FsbCA9IGplc3QubW9ja2VkKGRhdGFiYXNlLnByb2R1Y3QuZmluZE1hbnkpLm1vY2suY2FsbHNbMF1bMF07XG4gICAgICBleHBlY3QoZmluZENhbGwudGFrZSkudG9CZSg1KTtcbiAgICB9KTtcblxuICAgIGl0KFwic2hvdWxkIG9ubHkgcmV0dXJuIGF2YWlsYWJsZSBwcm9kdWN0c1wiLCBhc3luYyAoKSA9PiB7XG4gICAgICBqZXN0XG4gICAgICAgIC5tb2NrZWQoZGF0YWJhc2UucHJvZHVjdC5maW5kTWFueSlcbiAgICAgICAgLm1vY2tSZXNvbHZlZFZhbHVlKFttb2NrUHJvZHVjdF0gYXMgYW55KTtcblxuICAgICAgYXdhaXQgUHJvZHVjdFNlcnZpY2Uuc2VhcmNoUHJvZHVjdHMoXCJ0b21hdG9cIik7XG5cbiAgICAgIGNvbnN0IGZpbmRDYWxsID0gamVzdC5tb2NrZWQoZGF0YWJhc2UucHJvZHVjdC5maW5kTWFueSkubW9jay5jYWxsc1swXVswXTtcbiAgICAgIGV4cGVjdChmaW5kQ2FsbC53aGVyZS5zdGF0dXMpLnRvQmUoUHJvZHVjdFN0YXR1cy5BVkFJTEFCTEUpO1xuICAgIH0pO1xuICB9KTtcblxuICBkZXNjcmliZShcIvCflIQgYmF0Y2hVcGRhdGVQcm9kdWN0c1wiLCAoKSA9PiB7XG4gICAgY29uc3QgcHJvZHVjdElkcyA9IFtcInByb2R1Y3QtMVwiLCBcInByb2R1Y3QtMlwiLCBcInByb2R1Y3QtM1wiXTtcbiAgICBjb25zdCBiYXRjaFVwZGF0ZXMgPSB7IHN0YXR1czogUHJvZHVjdFN0YXR1cy5BVkFJTEFCTEUgfTtcblxuICAgIGl0KFwic2hvdWxkIHVwZGF0ZSBtdWx0aXBsZSBwcm9kdWN0cyBzdWNjZXNzZnVsbHlcIiwgYXN5bmMgKCkgPT4ge1xuICAgICAgamVzdFxuICAgICAgICAubW9ja2VkKGRhdGFiYXNlLnByb2R1Y3QuZmluZFVuaXF1ZSlcbiAgICAgICAgLm1vY2tSZXNvbHZlZFZhbHVlKG1vY2tQcm9kdWN0IGFzIGFueSk7XG4gICAgICBqZXN0XG4gICAgICAgIC5tb2NrZWQoZGF0YWJhc2UucHJvZHVjdC51cGRhdGUpXG4gICAgICAgIC5tb2NrUmVzb2x2ZWRWYWx1ZShtb2NrUHJvZHVjdCBhcyBhbnkpO1xuXG4gICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCBQcm9kdWN0U2VydmljZS5iYXRjaFVwZGF0ZVByb2R1Y3RzKFxuICAgICAgICBwcm9kdWN0SWRzLFxuICAgICAgICBiYXRjaFVwZGF0ZXMgYXMgYW55LFxuICAgICAgICBtb2NrVXNlcklkLFxuICAgICAgKTtcblxuICAgICAgZXhwZWN0KHJlc3VsdC5zdWNjZXNzQ291bnQpLnRvQmUoMyk7XG4gICAgICBleHBlY3QocmVzdWx0LmZhaWx1cmVDb3VudCkudG9CZSgwKTtcbiAgICAgIGV4cGVjdChyZXN1bHQuc3VjY2Vzc2Z1bCkudG9IYXZlTGVuZ3RoKDMpO1xuICAgIH0pO1xuXG4gICAgaXQoXCJzaG91bGQgaGFuZGxlIHBhcnRpYWwgZmFpbHVyZXNcIiwgYXN5bmMgKCkgPT4ge1xuICAgICAgamVzdFxuICAgICAgICAubW9ja2VkKGRhdGFiYXNlLnByb2R1Y3QuZmluZFVuaXF1ZSlcbiAgICAgICAgLm1vY2tSZXNvbHZlZFZhbHVlT25jZShtb2NrUHJvZHVjdCBhcyBhbnkpXG4gICAgICAgIC5tb2NrUmVzb2x2ZWRWYWx1ZU9uY2UobnVsbClcbiAgICAgICAgLm1vY2tSZXNvbHZlZFZhbHVlT25jZShtb2NrUHJvZHVjdCBhcyBhbnkpO1xuICAgICAgamVzdFxuICAgICAgICAubW9ja2VkKGRhdGFiYXNlLnByb2R1Y3QudXBkYXRlKVxuICAgICAgICAubW9ja1Jlc29sdmVkVmFsdWUobW9ja1Byb2R1Y3QgYXMgYW55KTtcblxuICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgUHJvZHVjdFNlcnZpY2UuYmF0Y2hVcGRhdGVQcm9kdWN0cyhcbiAgICAgICAgcHJvZHVjdElkcyxcbiAgICAgICAgYmF0Y2hVcGRhdGVzIGFzIGFueSxcbiAgICAgICAgbW9ja1VzZXJJZCxcbiAgICAgICk7XG5cbiAgICAgIGV4cGVjdChyZXN1bHQuc3VjY2Vzc0NvdW50KS50b0JlKDIpO1xuICAgICAgZXhwZWN0KHJlc3VsdC5mYWlsdXJlQ291bnQpLnRvQmUoMSk7XG4gICAgICBleHBlY3QocmVzdWx0LmZhaWxlZCkudG9IYXZlTGVuZ3RoKDEpO1xuICAgICAgZXhwZWN0KHJlc3VsdC5mYWlsZWRbMF0uZXJyb3IpLnRvQ29udGFpbihcIlByb2R1Y3Qgbm90IGZvdW5kXCIpO1xuICAgIH0pO1xuXG4gICAgaXQoXCJzaG91bGQgcmV0dXJuIHRvdGFsIGNvdW50XCIsIGFzeW5jICgpID0+IHtcbiAgICAgIGplc3RcbiAgICAgICAgLm1vY2tlZChkYXRhYmFzZS5wcm9kdWN0LmZpbmRVbmlxdWUpXG4gICAgICAgIC5tb2NrUmVzb2x2ZWRWYWx1ZShtb2NrUHJvZHVjdCBhcyBhbnkpO1xuICAgICAgamVzdFxuICAgICAgICAubW9ja2VkKGRhdGFiYXNlLnByb2R1Y3QudXBkYXRlKVxuICAgICAgICAubW9ja1Jlc29sdmVkVmFsdWUobW9ja1Byb2R1Y3QgYXMgYW55KTtcblxuICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgUHJvZHVjdFNlcnZpY2UuYmF0Y2hVcGRhdGVQcm9kdWN0cyhcbiAgICAgICAgcHJvZHVjdElkcyxcbiAgICAgICAgYmF0Y2hVcGRhdGVzIGFzIGFueSxcbiAgICAgICAgbW9ja1VzZXJJZCxcbiAgICAgICk7XG5cbiAgICAgIGV4cGVjdChyZXN1bHQudG90YWwpLnRvQmUoMyk7XG4gICAgfSk7XG4gIH0pO1xuXG4gIGRlc2NyaWJlKFwi8J+TiiBnZXRQcm9kdWN0U3RhdHNcIiwgKCkgPT4ge1xuICAgIGl0KFwic2hvdWxkIHJldHVybiBwcm9kdWN0IHN0YXRpc3RpY3NcIiwgYXN5bmMgKCkgPT4ge1xuICAgICAgY29uc3Qgc3RhdHMgPSBhd2FpdCBQcm9kdWN0U2VydmljZS5nZXRQcm9kdWN0U3RhdHMobW9ja1Byb2R1Y3RJZCk7XG5cbiAgICAgIGV4cGVjdChzdGF0cykudG9NYXRjaE9iamVjdCh7XG4gICAgICAgIHByb2R1Y3RJZDogbW9ja1Byb2R1Y3RJZCxcbiAgICAgICAgdmlld3M6IDAsXG4gICAgICAgIG9yZGVyczogMCxcbiAgICAgICAgcmV2ZW51ZTogMCxcbiAgICAgICAgcmV2aWV3Q291bnQ6IDAsXG4gICAgICAgIGluV2lzaGxpc3RDb3VudDogMCxcbiAgICAgIH0pO1xuICAgIH0pO1xuICB9KTtcbn0pO1xuIl0sInZlcnNpb24iOjN9