{"file":"M:\\Repo\\Farmers Market Platform web and app\\src\\lib\\cache.ts","mappings":"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","names":[],"sources":["M:\\Repo\\Farmers Market Platform web and app\\src\\lib\\cache.ts"],"sourcesContent":["/**\n * âš¡ DIVINE CACHE UTILITY\n * Quantum caching with agricultural consciousness and biodynamic TTL\n */\n\nimport { getRedisCache } from \"@/lib/cache/redis\";\n\ntype Season = \"SPRING\" | \"SUMMER\" | \"FALL\" | \"WINTER\";\n\n/**\n * In-memory cache with agricultural consciousness\n */\nclass BiodynamicCache {\n  private readonly cache: Map<string, { value: unknown; expiresAt: number }> =\n    new Map();\n\n  constructor() {\n    // Clean up expired entries every minute\n    setInterval(() => this.cleanup(), 60000);\n  }\n\n  /**\n   * Set cache value with optional TTL\n   */\n  async set(\n    key: string,\n    value: unknown,\n    ttlSeconds: number = 3600\n  ): Promise<void> {\n    const expiresAt = Date.now() + ttlSeconds * 1000;\n    this.cache.set(key, { value, expiresAt });\n  }\n\n  /**\n   * Get cache value\n   */\n  async get<T = unknown>(key: string): Promise<T | null> {\n    const cached = this.cache.get(key);\n\n    if (!cached) {\n      return null;\n    }\n\n    // Check if expired\n    if (Date.now() > cached.expiresAt) {\n      this.cache.delete(key);\n      return null;\n    }\n\n    return cached.value as T;\n  }\n\n  /**\n   * Delete cache entry\n   */\n  async delete(key: string): Promise<void> {\n    this.cache.delete(key);\n  }\n\n  /**\n   * Clear all cache entries\n   */\n  async clear(): Promise<void> {\n    this.cache.clear();\n  }\n\n  /**\n   * Check if key exists and is not expired\n   */\n  async has(key: string): Promise<boolean> {\n    const cached = this.cache.get(key);\n    if (!cached) return false;\n\n    if (Date.now() > cached.expiresAt) {\n      this.cache.delete(key);\n      return false;\n    }\n\n    return true;\n  }\n\n  /**\n   * Get or set pattern (fetch if not cached)\n   */\n  async getOrSet<T>(\n    key: string,\n    fetcher: () => Promise<T>,\n    ttlSeconds: number = 3600\n  ): Promise<T> {\n    const cached = await this.get<T>(key);\n\n    if (cached !== null) {\n      return cached;\n    }\n\n    const value = await fetcher();\n    await this.set(key, value, ttlSeconds);\n    return value;\n  }\n\n  /**\n   * Set with seasonal awareness\n   * Longer TTL for stable seasonal data\n   */\n  async setSeasonalData(\n    key: string,\n    value: unknown,\n    season: Season\n  ): Promise<void> {\n    const seasonalTTL = {\n      SPRING: 7 * 24 * 3600, // 1 week\n      SUMMER: 14 * 24 * 3600, // 2 weeks\n      FALL: 7 * 24 * 3600, // 1 week\n      WINTER: 30 * 24 * 3600, // 1 month (longer rest period)\n    };\n\n    await this.set(key, value, seasonalTTL[season]);\n  }\n\n  /**\n   * Invalidate cache by pattern\n   */\n  async invalidatePattern(pattern: string): Promise<void> {\n    const regex = new RegExp(pattern);\n    const keysToDelete: string[] = [];\n\n    for (const key of this.cache.keys()) {\n      if (regex.test(key)) {\n        keysToDelete.push(key);\n      }\n    }\n\n    for (const key of keysToDelete) {\n      this.cache.delete(key);\n    }\n  }\n\n  /**\n   * Clean up expired entries\n   */\n  private cleanup(): void {\n    const now = Date.now();\n    const keysToDelete: string[] = [];\n\n    for (const [key, cached] of this.cache.entries()) {\n      if (now > cached.expiresAt) {\n        keysToDelete.push(key);\n      }\n    }\n\n    for (const key of keysToDelete) {\n      this.cache.delete(key);\n    }\n  }\n\n  /**\n   * Get cache statistics\n   */\n  getStats() {\n    return {\n      size: this.cache.size,\n      keys: Array.from(this.cache.keys()),\n    };\n  }\n}\n\n// Adapter interface for cache providers\ninterface CacheAdapter {\n  set(\n    key: string,\n    value: unknown,\n    ttlSeconds?: number\n  ): Promise<void | boolean>;\n  get<T = unknown>(key: string): Promise<T | null>;\n  delete(key: string): Promise<void | boolean>;\n  clear(): Promise<void | boolean>;\n  has(key: string): Promise<boolean>;\n  getOrSet<T>(\n    key: string,\n    fetcher: () => Promise<T>,\n    ttlSeconds?: number\n  ): Promise<T>;\n  setSeasonalData(\n    key: string,\n    value: unknown,\n    season: \"SPRING\" | \"SUMMER\" | \"FALL\" | \"WINTER\"\n  ): Promise<void | boolean>;\n  invalidatePattern(pattern: string): Promise<void | number>;\n  getStats(): unknown;\n}\n\nclass RedisCacheAdapter implements CacheAdapter {\n  private readonly svc = getRedisCache();\n\n  async set(key: string, value: unknown, ttlSeconds: number = 3600) {\n    await this.svc.set(key, value, { ttl: ttlSeconds });\n  }\n\n  async get<T = unknown>(key: string): Promise<T | null> {\n    return this.svc.get<T>(key);\n  }\n\n  async delete(key: string) {\n    await this.svc.delete(key);\n  }\n\n  async clear() {\n    await this.svc.flushAll();\n  }\n\n  async has(key: string): Promise<boolean> {\n    return this.svc.exists(key);\n  }\n\n  async getOrSet<T>(\n    key: string,\n    fetcher: () => Promise<T>,\n    ttlSeconds: number = 3600\n  ): Promise<T> {\n    return this.svc.getOrSet<T>(key, fetcher, { ttl: ttlSeconds });\n  }\n\n  async setSeasonalData(key: string, value: unknown, season: Season) {\n    const seasonalTTL = {\n      SPRING: 7 * 24 * 3600,\n      SUMMER: 14 * 24 * 3600,\n      FALL: 7 * 24 * 3600,\n      WINTER: 30 * 24 * 3600,\n    } as const;\n    await this.set(key, value, seasonalTTL[season]);\n  }\n\n  async invalidatePattern(pattern: string) {\n    await this.svc.deletePattern(pattern);\n  }\n\n  getStats() {\n    return { provider: \"redis\" };\n  }\n}\n\n// Singleton instance - select Redis in production if configured\nconst isRedisEnabled = Boolean(process.env.REDIS_HOST);\nconst cache: CacheAdapter = isRedisEnabled\n  ? new RedisCacheAdapter()\n  : new BiodynamicCache();\n\n/**\n * Cache key generators for consistent naming\n */\nexport const CacheKeys = {\n  // Product caching\n  product: (id: string) => `product:${id}`,\n  productsByFarm: (farmId: string) => `products:farm:${farmId}`,\n  productsByCategory: (category: string) => `products:category:${category}`,\n\n  // Farm caching\n  farm: (id: string) => `farm:${id}`,\n  farmsByRegion: (region: string) => `farms:region:${region}`,\n\n  // Order caching\n  order: (id: string) => `order:${id}`,\n  userOrders: (userId: string) => `orders:user:${userId}`,\n\n  // User caching\n  user: (id: string) => `user:${id}`,\n  userSession: (userId: string) => `session:${userId}`,\n\n  // Seasonal data\n  seasonalCrops: (season: string) => `crops:season:${season}`,\n  seasonalProducts: (season: string) => `products:season:${season}`,\n\n  // Analytics\n  analytics: (type: string, date: string) => `analytics:${type}:${date}`,\n};\n\n/**\n * Cache TTL constants (in seconds)\n */\nexport const CacheTTL = {\n  SHORT: 5 * 60, // 5 minutes\n  MEDIUM: 30 * 60, // 30 minutes\n  LONG: 2 * 3600, // 2 hours\n  DAY: 24 * 3600, // 1 day\n  WEEK: 7 * 24 * 3600, // 1 week\n  SEASONAL: 30 * 24 * 3600, // 1 month\n};\n\nexport { cache };\nexport default cache;\n"],"version":3}