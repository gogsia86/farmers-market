{"file":"M:\\Repo\\Farmers Market Platform web and app\\src\\lib\\__tests__\\cache.memory.test.ts","mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAAA,2CAAuE;AAEvE,IAAA,kBAAQ,EAAC,yBAAyB,EAAE,GAAG,EAAE;IACvC,IAAA,oBAAU,EAAC,KAAK,IAAI,EAAE;QACpB,gEAAgE;QAChE,OAAQ,OAAO,CAAC,GAAW,CAAC,UAAU,CAAC;QACvC,cAAI,CAAC,YAAY,EAAE,CAAC;IACtB,CAAC,CAAC,CAAC;IAEH,IAAA,YAAE,EAAC,gCAAgC,EAAE,KAAK,IAAI,EAAE;QAC9C,MAAM,EAAE,OAAO,EAAE,KAAK,EAAE,GAAG,wDAAa,aAAa,GAAC,CAAC;QACvD,MAAM,GAAG,GAAG,YAAY,IAAI,CAAC,MAAM,EAAE,EAAE,CAAC;QACxC,IAAI,YAAY,GAAG,CAAC,CAAC;QAErB,MAAM,OAAO,GAAG,KAAK,IAAI,EAAE;YACzB,YAAY,IAAI,CAAC,CAAC;YAClB,OAAO,EAAE,KAAK,EAAE,EAAE,EAAE,CAAC;QACvB,CAAC,CAAC;QAEF,MAAM,CAAC,GAAG,MAAO,KAAa,CAAC,QAAQ,CAAC,GAAG,EAAE,OAAO,EAAE,EAAE,CAAC,CAAC;QAC1D,MAAM,CAAC,GAAG,MAAO,KAAa,CAAC,QAAQ,CAAC,GAAG,EAAE,OAAO,EAAE,EAAE,CAAC,CAAC;QAE1D,IAAA,gBAAM,EAAC,CAAC,CAAC,CAAC,OAAO,CAAC,EAAE,KAAK,EAAE,EAAE,EAAE,CAAC,CAAC;QACjC,IAAA,gBAAM,EAAC,CAAC,CAAC,CAAC,OAAO,CAAC,EAAE,KAAK,EAAE,EAAE,EAAE,CAAC,CAAC;QACjC,IAAA,gBAAM,EAAC,YAAY,CAAC,CAAC,IAAI,CAAC,CAAC,CAAC,CAAC;IAC/B,CAAC,CAAC,CAAC;IAEH,IAAA,YAAE,EAAC,yCAAyC,EAAE,KAAK,IAAI,EAAE;QACvD,MAAM,EAAE,OAAO,EAAE,KAAK,EAAE,GAAG,wDAAa,aAAa,GAAC,CAAC;QACvD,MAAM,IAAI,GAAG,0BAA0B,IAAI,CAAC,MAAM,EAAE,CAAC,QAAQ,CAAC,EAAE,CAAC,CAAC,KAAK,CAAC,CAAC,CAAC,EAAE,CAAC;QAC7E,MAAM,EAAE,GAAG,GAAG,IAAI,IAAI,CAAC;QACvB,MAAM,EAAE,GAAG,GAAG,IAAI,IAAI,CAAC;QAEvB,MAAO,KAAa,CAAC,GAAG,CAAC,EAAE,EAAE,EAAE,CAAC,EAAE,CAAC,EAAE,EAAE,EAAE,CAAC,CAAC;QAC3C,MAAO,KAAa,CAAC,GAAG,CAAC,EAAE,EAAE,EAAE,CAAC,EAAE,CAAC,EAAE,EAAE,EAAE,CAAC,CAAC;QAE3C,IAAA,gBAAM,EAAC,MAAO,KAAa,CAAC,GAAG,CAAC,EAAE,CAAC,CAAC,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC;QAChD,IAAA,gBAAM,EAAC,MAAO,KAAa,CAAC,GAAG,CAAC,EAAE,CAAC,CAAC,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC;QAEhD,MAAO,KAAa,CAAC,iBAAiB,CAAC,IAAI,CAAC,CAAC;QAE7C,IAAA,gBAAM,EAAC,MAAO,KAAa,CAAC,GAAG,CAAC,EAAE,CAAC,CAAC,CAAC,IAAI,CAAC,KAAK,CAAC,CAAC;QACjD,IAAA,gBAAM,EAAC,MAAO,KAAa,CAAC,GAAG,CAAC,EAAE,CAAC,CAAC,CAAC,IAAI,CAAC,KAAK,CAAC,CAAC;IACnD,CAAC,CAAC,CAAC;AACL,CAAC,CAAC,CAAC","names":[],"sources":["M:\\Repo\\Farmers Market Platform web and app\\src\\lib\\__tests__\\cache.memory.test.ts"],"sourcesContent":["import { beforeEach, describe, expect, it, jest } from '@jest/globals';\n\ndescribe(\"cache (memory fallback)\", () => {\n  beforeEach(async () => {\n    // Force memory cache by clearing Redis env and reloading module\n    delete (process.env as any).REDIS_HOST;\n    jest.resetModules();\n  });\n\n  it(\"getOrSet caches computed value\", async () => {\n    const { default: cache } = await import(\"@/lib/cache\");\n    const key = `test:key:${Math.random()}`;\n    let computeCount = 0;\n\n    const fetcher = async () => {\n      computeCount += 1;\n      return { value: 42 };\n    };\n\n    const a = await (cache as any).getOrSet(key, fetcher, 10);\n    const b = await (cache as any).getOrSet(key, fetcher, 10);\n\n    expect(a).toEqual({ value: 42 });\n    expect(b).toEqual({ value: 42 });\n    expect(computeCount).toBe(1);\n  });\n\n  it(\"invalidatePattern removes matching keys\", async () => {\n    const { default: cache } = await import(\"@/lib/cache\");\n    const base = `products:season:SPRING:${Math.random().toString(36).slice(2)}`;\n    const k1 = `${base}:a`;\n    const k2 = `${base}:b`;\n\n    await (cache as any).set(k1, { a: 1 }, 60);\n    await (cache as any).set(k2, { b: 2 }, 60);\n\n    expect(await (cache as any).has(k1)).toBe(true);\n    expect(await (cache as any).has(k2)).toBe(true);\n\n    await (cache as any).invalidatePattern(base);\n\n    expect(await (cache as any).has(k1)).toBe(false);\n    expect(await (cache as any).has(k2)).toBe(false);\n  });\n});\n\r\n\r\n"],"version":3}