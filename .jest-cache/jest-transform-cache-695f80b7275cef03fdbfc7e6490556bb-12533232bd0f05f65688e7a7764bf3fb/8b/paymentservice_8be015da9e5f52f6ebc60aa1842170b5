d9b70e75cb364a7f34b222cbe658888c
"use strict";
/**
 * ðŸ’³ PAYMENT SERVICE
 * Handles payment processing via Stripe and PayPal
 */
Object.defineProperty(exports, "__esModule", { value: true });
exports.PaymentService = void 0;
const database_1 = require("@/lib/database");
class PaymentService {
    /**
     * Create payment intent
     */
    static async createPaymentIntent(orderId, amount, currency = "USD") {
        // In production, integrate with Stripe/PayPal
        const paymentIntent = {
            id: `pi_${Date.now()}`,
            amount,
            currency,
            status: "pending",
        };
        // Store payment intent ID in database
        await database_1.database.order.update({
            where: { id: orderId },
            data: {
                paymentIntentId: paymentIntent.id,
                paymentStatus: "PENDING",
            },
        });
        return paymentIntent;
    }
    /**
     * Confirm payment
     */
    static async confirmPayment(paymentIntentId) {
        // In production, confirm with payment provider
        console.log(`Payment confirmed for intent: ${paymentIntentId}`);
        // Update all orders with this payment intent ID
        await database_1.database.order.updateMany({
            where: { paymentIntentId },
            data: {
                paymentStatus: "COMPLETED",
                status: "CONFIRMED",
                paidAt: new Date(),
            },
        });
        return true;
    }
    /**
     * Refund a payment
     */
    static async refundPayment(orderId, _amount) {
        const order = await database_1.database.order.findUnique({
            where: { id: orderId },
        });
        if (!order) {
            throw new Error("Order not found");
        }
        // In production, process refund with payment provider
        await database_1.database.order.update({
            where: { id: orderId },
            data: {
                paymentStatus: "REFUNDED",
                status: "CANCELLED",
            },
        });
        return true;
    }
}
exports.PaymentService = PaymentService;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiTTpcXFJlcG9cXEZhcm1lcnMgTWFya2V0IFBsYXRmb3JtIHdlYiBhbmQgYXBwXFxzcmNcXGxpYlxcc2VydmljZXNcXHBheW1lbnQuc2VydmljZS50cyIsIm1hcHBpbmdzIjoiO0FBQUE7OztHQUdHOzs7QUFFSCw2Q0FBMEM7QUFTMUMsTUFBYSxjQUFjO0lBQ3pCOztPQUVHO0lBQ0gsTUFBTSxDQUFDLEtBQUssQ0FBQyxtQkFBbUIsQ0FDOUIsT0FBZSxFQUNmLE1BQWMsRUFDZCxRQUFRLEdBQUcsS0FBSztRQUVoQiw4Q0FBOEM7UUFDOUMsTUFBTSxhQUFhLEdBQUc7WUFDcEIsRUFBRSxFQUFFLE1BQU0sSUFBSSxDQUFDLEdBQUcsRUFBRSxFQUFFO1lBQ3RCLE1BQU07WUFDTixRQUFRO1lBQ1IsTUFBTSxFQUFFLFNBQVM7U0FDbEIsQ0FBQztRQUVGLHNDQUFzQztRQUN0QyxNQUFNLG1CQUFRLENBQUMsS0FBSyxDQUFDLE1BQU0sQ0FBQztZQUMxQixLQUFLLEVBQUUsRUFBRSxFQUFFLEVBQUUsT0FBTyxFQUFFO1lBQ3RCLElBQUksRUFBRTtnQkFDSixlQUFlLEVBQUUsYUFBYSxDQUFDLEVBQUU7Z0JBQ2pDLGFBQWEsRUFBRSxTQUFTO2FBQ3pCO1NBQ0YsQ0FBQyxDQUFDO1FBRUgsT0FBTyxhQUFhLENBQUM7SUFDdkIsQ0FBQztJQUVEOztPQUVHO0lBQ0gsTUFBTSxDQUFDLEtBQUssQ0FBQyxjQUFjLENBQUMsZUFBdUI7UUFDakQsK0NBQStDO1FBQy9DLE9BQU8sQ0FBQyxHQUFHLENBQUMsaUNBQWlDLGVBQWUsRUFBRSxDQUFDLENBQUM7UUFFaEUsZ0RBQWdEO1FBQ2hELE1BQU0sbUJBQVEsQ0FBQyxLQUFLLENBQUMsVUFBVSxDQUFDO1lBQzlCLEtBQUssRUFBRSxFQUFFLGVBQWUsRUFBRTtZQUMxQixJQUFJLEVBQUU7Z0JBQ0osYUFBYSxFQUFFLFdBQWtCO2dCQUNqQyxNQUFNLEVBQUUsV0FBVztnQkFDbkIsTUFBTSxFQUFFLElBQUksSUFBSSxFQUFFO2FBQ25CO1NBQ0YsQ0FBQyxDQUFDO1FBRUgsT0FBTyxJQUFJLENBQUM7SUFDZCxDQUFDO0lBRUQ7O09BRUc7SUFDSCxNQUFNLENBQUMsS0FBSyxDQUFDLGFBQWEsQ0FDeEIsT0FBZSxFQUNmLE9BQWdCO1FBRWhCLE1BQU0sS0FBSyxHQUFHLE1BQU0sbUJBQVEsQ0FBQyxLQUFLLENBQUMsVUFBVSxDQUFDO1lBQzVDLEtBQUssRUFBRSxFQUFFLEVBQUUsRUFBRSxPQUFPLEVBQUU7U0FDdkIsQ0FBQyxDQUFDO1FBRUgsSUFBSSxDQUFDLEtBQUssRUFBRSxDQUFDO1lBQ1gsTUFBTSxJQUFJLEtBQUssQ0FBQyxpQkFBaUIsQ0FBQyxDQUFDO1FBQ3JDLENBQUM7UUFFRCxzREFBc0Q7UUFFdEQsTUFBTSxtQkFBUSxDQUFDLEtBQUssQ0FBQyxNQUFNLENBQUM7WUFDMUIsS0FBSyxFQUFFLEVBQUUsRUFBRSxFQUFFLE9BQU8sRUFBRTtZQUN0QixJQUFJLEVBQUU7Z0JBQ0osYUFBYSxFQUFFLFVBQVU7Z0JBQ3pCLE1BQU0sRUFBRSxXQUFXO2FBQ3BCO1NBQ0YsQ0FBQyxDQUFDO1FBRUgsT0FBTyxJQUFJLENBQUM7SUFDZCxDQUFDO0NBQ0Y7QUE1RUQsd0NBNEVDIiwibmFtZXMiOltdLCJzb3VyY2VzIjpbIk06XFxSZXBvXFxGYXJtZXJzIE1hcmtldCBQbGF0Zm9ybSB3ZWIgYW5kIGFwcFxcc3JjXFxsaWJcXHNlcnZpY2VzXFxwYXltZW50LnNlcnZpY2UudHMiXSwic291cmNlc0NvbnRlbnQiOlsiLyoqXG4gKiDwn5KzIFBBWU1FTlQgU0VSVklDRVxuICogSGFuZGxlcyBwYXltZW50IHByb2Nlc3NpbmcgdmlhIFN0cmlwZSBhbmQgUGF5UGFsXG4gKi9cblxuaW1wb3J0IHsgZGF0YWJhc2UgfSBmcm9tIFwiQC9saWIvZGF0YWJhc2VcIjtcblxuZXhwb3J0IGludGVyZmFjZSBQYXltZW50SW50ZW50IHtcbiAgaWQ6IHN0cmluZztcbiAgYW1vdW50OiBudW1iZXI7XG4gIGN1cnJlbmN5OiBzdHJpbmc7XG4gIHN0YXR1czogc3RyaW5nO1xufVxuXG5leHBvcnQgY2xhc3MgUGF5bWVudFNlcnZpY2Uge1xuICAvKipcbiAgICogQ3JlYXRlIHBheW1lbnQgaW50ZW50XG4gICAqL1xuICBzdGF0aWMgYXN5bmMgY3JlYXRlUGF5bWVudEludGVudChcbiAgICBvcmRlcklkOiBzdHJpbmcsXG4gICAgYW1vdW50OiBudW1iZXIsXG4gICAgY3VycmVuY3kgPSBcIlVTRFwiXG4gICk6IFByb21pc2U8UGF5bWVudEludGVudD4ge1xuICAgIC8vIEluIHByb2R1Y3Rpb24sIGludGVncmF0ZSB3aXRoIFN0cmlwZS9QYXlQYWxcbiAgICBjb25zdCBwYXltZW50SW50ZW50ID0ge1xuICAgICAgaWQ6IGBwaV8ke0RhdGUubm93KCl9YCxcbiAgICAgIGFtb3VudCxcbiAgICAgIGN1cnJlbmN5LFxuICAgICAgc3RhdHVzOiBcInBlbmRpbmdcIixcbiAgICB9O1xuXG4gICAgLy8gU3RvcmUgcGF5bWVudCBpbnRlbnQgSUQgaW4gZGF0YWJhc2VcbiAgICBhd2FpdCBkYXRhYmFzZS5vcmRlci51cGRhdGUoe1xuICAgICAgd2hlcmU6IHsgaWQ6IG9yZGVySWQgfSxcbiAgICAgIGRhdGE6IHtcbiAgICAgICAgcGF5bWVudEludGVudElkOiBwYXltZW50SW50ZW50LmlkLFxuICAgICAgICBwYXltZW50U3RhdHVzOiBcIlBFTkRJTkdcIixcbiAgICAgIH0sXG4gICAgfSk7XG5cbiAgICByZXR1cm4gcGF5bWVudEludGVudDtcbiAgfVxuXG4gIC8qKlxuICAgKiBDb25maXJtIHBheW1lbnRcbiAgICovXG4gIHN0YXRpYyBhc3luYyBjb25maXJtUGF5bWVudChwYXltZW50SW50ZW50SWQ6IHN0cmluZyk6IFByb21pc2U8Ym9vbGVhbj4ge1xuICAgIC8vIEluIHByb2R1Y3Rpb24sIGNvbmZpcm0gd2l0aCBwYXltZW50IHByb3ZpZGVyXG4gICAgY29uc29sZS5sb2coYFBheW1lbnQgY29uZmlybWVkIGZvciBpbnRlbnQ6ICR7cGF5bWVudEludGVudElkfWApO1xuXG4gICAgLy8gVXBkYXRlIGFsbCBvcmRlcnMgd2l0aCB0aGlzIHBheW1lbnQgaW50ZW50IElEXG4gICAgYXdhaXQgZGF0YWJhc2Uub3JkZXIudXBkYXRlTWFueSh7XG4gICAgICB3aGVyZTogeyBwYXltZW50SW50ZW50SWQgfSxcbiAgICAgIGRhdGE6IHtcbiAgICAgICAgcGF5bWVudFN0YXR1czogXCJDT01QTEVURURcIiBhcyBhbnksXG4gICAgICAgIHN0YXR1czogXCJDT05GSVJNRURcIixcbiAgICAgICAgcGFpZEF0OiBuZXcgRGF0ZSgpLFxuICAgICAgfSxcbiAgICB9KTtcblxuICAgIHJldHVybiB0cnVlO1xuICB9XG5cbiAgLyoqXG4gICAqIFJlZnVuZCBhIHBheW1lbnRcbiAgICovXG4gIHN0YXRpYyBhc3luYyByZWZ1bmRQYXltZW50KFxuICAgIG9yZGVySWQ6IHN0cmluZyxcbiAgICBfYW1vdW50PzogbnVtYmVyXG4gICk6IFByb21pc2U8Ym9vbGVhbj4ge1xuICAgIGNvbnN0IG9yZGVyID0gYXdhaXQgZGF0YWJhc2Uub3JkZXIuZmluZFVuaXF1ZSh7XG4gICAgICB3aGVyZTogeyBpZDogb3JkZXJJZCB9LFxuICAgIH0pO1xuXG4gICAgaWYgKCFvcmRlcikge1xuICAgICAgdGhyb3cgbmV3IEVycm9yKFwiT3JkZXIgbm90IGZvdW5kXCIpO1xuICAgIH1cblxuICAgIC8vIEluIHByb2R1Y3Rpb24sIHByb2Nlc3MgcmVmdW5kIHdpdGggcGF5bWVudCBwcm92aWRlclxuXG4gICAgYXdhaXQgZGF0YWJhc2Uub3JkZXIudXBkYXRlKHtcbiAgICAgIHdoZXJlOiB7IGlkOiBvcmRlcklkIH0sXG4gICAgICBkYXRhOiB7XG4gICAgICAgIHBheW1lbnRTdGF0dXM6IFwiUkVGVU5ERURcIixcbiAgICAgICAgc3RhdHVzOiBcIkNBTkNFTExFRFwiLFxuICAgICAgfSxcbiAgICB9KTtcblxuICAgIHJldHVybiB0cnVlO1xuICB9XG59XG4iXSwidmVyc2lvbiI6M30=