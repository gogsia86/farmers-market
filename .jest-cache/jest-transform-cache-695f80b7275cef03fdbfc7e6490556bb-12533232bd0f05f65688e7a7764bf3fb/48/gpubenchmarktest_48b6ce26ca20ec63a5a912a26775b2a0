4dadbbb983de782767b2ec21708dae73
"use strict";
/**
 * GPU PERFORMANCE BENCHMARKING
 * RTX 2070 Max-Q Validation Suite
 */
var __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    var desc = Object.getOwnPropertyDescriptor(m, k);
    if (!desc || ("get" in desc ? !m.__esModule : desc.writable || desc.configurable)) {
      desc = { enumerable: true, get: function() { return m[k]; } };
    }
    Object.defineProperty(o, k2, desc);
}) : (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    o[k2] = m[k];
}));
var __setModuleDefault = (this && this.__setModuleDefault) || (Object.create ? (function(o, v) {
    Object.defineProperty(o, "default", { enumerable: true, value: v });
}) : function(o, v) {
    o["default"] = v;
});
var __importStar = (this && this.__importStar) || (function () {
    var ownKeys = function(o) {
        ownKeys = Object.getOwnPropertyNames || function (o) {
            var ar = [];
            for (var k in o) if (Object.prototype.hasOwnProperty.call(o, k)) ar[ar.length] = k;
            return ar;
        };
        return ownKeys(o);
    };
    return function (mod) {
        if (mod && mod.__esModule) return mod;
        var result = {};
        if (mod != null) for (var k = ownKeys(mod), i = 0; i < k.length; i++) if (k[i] !== "default") __createBinding(result, mod, k[i]);
        __setModuleDefault(result, mod);
        return result;
    };
})();
var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
Object.defineProperty(exports, "__esModule", { value: true });
const globals_1 = require("@jest/globals");
const image_processor_1 = require("@/lib/gpu/image-processor");
const recommendation_engine_1 = require("@/lib/ml/recommendation-engine");
const tf = __importStar(require("@tensorflow/tfjs"));
const path_1 = __importDefault(require("path"));
globals_1.describe.skip('GPU Performance Benchmarking', () => {
    (0, globals_1.beforeAll)(async () => {
        // Ensure GPU backend is ready
        await tf.setBackend('webgl');
        await tf.ready();
    });
    (0, globals_1.describe)('Image Processing GPU Acceleration', () => {
        (0, globals_1.it)('processes single image faster than 100ms on GPU', async () => {
            // Create test image (or use fixture)
            const testImagePath = path_1.default.join(__dirname, '../fixtures/test-farm.jpg');
            const startTime = performance.now();
            const processed = await image_processor_1.GPUImageProcessor.processFarmImage(testImagePath, [800]);
            const duration = performance.now() - startTime;
            (0, globals_1.expect)(processed.size).toBe(1);
            (0, globals_1.expect)(duration).toBeLessThan(100); // Should be < 100ms on RTX 2070
            console.log(`âœ… Single image processed in ${duration.toFixed(2)}ms`);
        });
        (0, globals_1.it)('batch processes 10 images with GPU parallelization', async () => {
            const testImages = Array(10).fill(path_1.default.join(__dirname, '../fixtures/test-farm.jpg'));
            const startTime = performance.now();
            const results = await image_processor_1.GPUImageProcessor.batchProcessImages(testImages, [400, 800]);
            const duration = performance.now() - startTime;
            (0, globals_1.expect)(results.size).toBe(10);
            const avgPerImage = duration / 10;
            const throughput = (10 * 2) / (duration / 1000); // 2 sizes per image
            console.log(`âœ… Batch processing: ${avgPerImage.toFixed(2)}ms per image`);
            console.log(`âš¡ GPU Throughput: ${throughput.toFixed(2)} images/sec`);
            (0, globals_1.expect)(avgPerImage).toBeLessThan(50); // Should be < 50ms avg with GPU
        });
        (0, globals_1.it)('tracks GPU VRAM usage during processing', async () => {
            const memoryBefore = (0, image_processor_1.getGPUMemoryUsage)();
            const testImagePath = path_1.default.join(__dirname, '../fixtures/test-farm.jpg');
            await image_processor_1.GPUImageProcessor.processFarmImage(testImagePath, [400, 800, 1200, 1600]);
            const memoryAfter = (0, image_processor_1.getGPUMemoryUsage)();
            console.log('ðŸ“Š GPU Memory Before:', memoryBefore);
            console.log('ðŸ“Š GPU Memory After:', memoryAfter);
            // Ensure no memory leak
            (0, globals_1.expect)(memoryAfter.numTensors).toBeLessThanOrEqual(memoryBefore.numTensors + 5);
        });
    });
    (0, globals_1.describe)('ML Recommendation Engine GPU Training', () => {
        (0, globals_1.it)('builds and trains model on GPU', async () => {
            const engine = new recommendation_engine_1.GPURecommendationEngine();
            await engine.buildModel(1000, 5000, 64); // 1k users, 5k products
            // Generate synthetic training data
            const numSamples = 10000;
            const userIds = Array.from({ length: numSamples }, () => Math.floor(Math.random() * 1000));
            const productFeatures = Array.from({ length: numSamples }, () => [
                Math.floor(Math.random() * 10), // category
                Math.random(), // price (normalized)
                Math.random() > 0.5 ? 1 : 0, // organic
                Math.random() > 0.5 ? 1 : 0, // seasonal
                Math.random() * 5, // farm rating
                Math.floor(Math.random() * 100), // purchase count
                Math.random() > 0.3 ? 1 : 0 // in stock
            ]);
            const labels = Array.from({ length: numSamples }, () => Math.random() > 0.5 ? 1 : 0);
            const startTime = performance.now();
            const history = await engine.train(userIds, productFeatures, labels, 10, 256);
            const duration = performance.now() - startTime;
            const samplesPerSecond = (numSamples * 10) / (duration / 1000);
            console.log(`âœ… Training completed in ${(duration / 1000).toFixed(2)}s`);
            console.log(`âš¡ GPU Throughput: ${samplesPerSecond.toFixed(0)} samples/sec`);
            (0, globals_1.expect)(samplesPerSecond).toBeGreaterThan(10000); // Should be > 10k samples/sec
            engine.dispose();
        }, 120000); // 2 minute timeout for training
        (0, globals_1.it)('generates recommendations with low latency', async () => {
            const engine = new recommendation_engine_1.GPURecommendationEngine();
            await engine.buildModel(100, 1000, 32);
            // Skip training for speed test
            const candidateProducts = Array.from({ length: 100 }, (_, i) => ({
                productId: `product-${i}`,
                category: Math.floor(Math.random() * 10),
                price: Math.random(),
                organic: Math.random() > 0.5 ? 1 : 0,
                seasonal: Math.random() > 0.5 ? 1 : 0,
                farmRating: Math.random() * 5,
                purchaseCount: Math.floor(Math.random() * 100),
                inStock: 1
            }));
            const startTime = performance.now();
            const recommendations = await engine.recommend(42, candidateProducts, 10);
            const duration = performance.now() - startTime;
            console.log(`âœ… Generated ${recommendations.length} recommendations in ${duration.toFixed(2)}ms`);
            (0, globals_1.expect)(recommendations.length).toBe(10);
            (0, globals_1.expect)(duration).toBeLessThan(50); // Should be < 50ms on GPU
            engine.dispose();
        });
        (0, globals_1.it)('monitors GPU memory during ML operations', () => {
            const engine = new recommendation_engine_1.GPURecommendationEngine();
            const stats = engine.getMemoryStats();
            console.log('ðŸ§  ML Engine GPU Memory:', stats);
            (0, globals_1.expect)(stats.numTensors).toBeGreaterThanOrEqual(0);
            (0, globals_1.expect)(parseFloat(stats.vramMB)).toBeLessThan(8192); // < 8GB VRAM limit
            engine.dispose();
        });
    });
    (0, globals_1.describe)('Hardware Utilization Validation', () => {
        (0, globals_1.it)('confirms RTX 2070 Max-Q GPU backend', async () => {
            const backend = tf.getBackend();
            (0, globals_1.expect)(backend).toBe('webgl');
            console.log(`âœ… TensorFlow.js Backend: ${backend}`);
            console.log(`ðŸŽ® GPU: RTX 2070 Max-Q (2304 CUDA cores)`);
        });
        (0, globals_1.it)('validates CUDA core utilization potential', () => {
            // RTX 2070 Max-Q specs
            const specs = {
                cudaCores: 2304,
                baseClock: 885, // MHz
                boostClock: 1185, // MHz
                vram: 8192, // MB
                memoryBandwidth: 256 // GB/s
            };
            console.log('ðŸ”¥ RTX 2070 Max-Q Specifications:');
            console.log(`   CUDA Cores: ${specs.cudaCores}`);
            console.log(`   Boost Clock: ${specs.boostClock} MHz`);
            console.log(`   VRAM: ${specs.vram} MB`);
            console.log(`   Memory Bandwidth: ${specs.memoryBandwidth} GB/s`);
            (0, globals_1.expect)(specs.cudaCores).toBe(2304);
            (0, globals_1.expect)(specs.vram).toBe(8192);
        });
    });
    (0, globals_1.describe)('CPU Fallback Operations', () => {
        (0, globals_1.it)('performs matrix operations on CPU when GPU unavailable', async () => {
            const testData = Array(100).fill(0).map(() => Array(100).fill(0).map(() => Math.random()));
            // Create tensors and perform basic operation
            const tensor = tf.tensor2d(testData);
            const result = tensor.mul(2);
            const resultData = await result.array();
            (0, globals_1.expect)(resultData).toBeDefined();
            (0, globals_1.expect)(resultData.length).toBe(testData.length);
            tensor.dispose();
            result.dispose();
        });
    });
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiTTpcXFJlcG9cXEZhcm1lcnMgTWFya2V0IFBsYXRmb3JtIHdlYiBhbmQgYXBwXFx0ZXN0c1xccGVyZm9ybWFuY2VcXGdwdS1iZW5jaG1hcmsudGVzdC50cyIsIm1hcHBpbmdzIjoiO0FBQUE7OztHQUdHOzs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7OztBQUlILDJDQUFnRTtBQUZoRSwrREFBaUY7QUFDakYsMEVBQXlFO0FBRXpFLHFEQUF1QztBQUN2QyxnREFBd0I7QUFFeEIsa0JBQVEsQ0FBQyxJQUFJLENBQUMsOEJBQThCLEVBQUUsR0FBRyxFQUFFO0lBQy9DLElBQUEsbUJBQVMsRUFBQyxLQUFLLElBQUksRUFBRTtRQUNqQiw4QkFBOEI7UUFDOUIsTUFBTSxFQUFFLENBQUMsVUFBVSxDQUFDLE9BQU8sQ0FBQyxDQUFDO1FBQzdCLE1BQU0sRUFBRSxDQUFDLEtBQUssRUFBRSxDQUFDO0lBQ3JCLENBQUMsQ0FBQyxDQUFDO0lBRUgsSUFBQSxrQkFBUSxFQUFDLG1DQUFtQyxFQUFFLEdBQUcsRUFBRTtRQUMvQyxJQUFBLFlBQUUsRUFBQyxpREFBaUQsRUFBRSxLQUFLLElBQUksRUFBRTtZQUM3RCxxQ0FBcUM7WUFDckMsTUFBTSxhQUFhLEdBQUcsY0FBSSxDQUFDLElBQUksQ0FBQyxTQUFTLEVBQUUsMkJBQTJCLENBQUMsQ0FBQztZQUV4RSxNQUFNLFNBQVMsR0FBRyxXQUFXLENBQUMsR0FBRyxFQUFFLENBQUM7WUFDcEMsTUFBTSxTQUFTLEdBQUcsTUFBTSxtQ0FBaUIsQ0FBQyxnQkFBZ0IsQ0FBQyxhQUFhLEVBQUUsQ0FBQyxHQUFHLENBQUMsQ0FBQyxDQUFDO1lBQ2pGLE1BQU0sUUFBUSxHQUFHLFdBQVcsQ0FBQyxHQUFHLEVBQUUsR0FBRyxTQUFTLENBQUM7WUFFL0MsSUFBQSxnQkFBTSxFQUFDLFNBQVMsQ0FBQyxJQUFJLENBQUMsQ0FBQyxJQUFJLENBQUMsQ0FBQyxDQUFDLENBQUM7WUFDL0IsSUFBQSxnQkFBTSxFQUFDLFFBQVEsQ0FBQyxDQUFDLFlBQVks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TSxHQUFHLEVBQUUsQ0FBQyxRQUFRLENBQUMsUUFBUSxDQUFDLENBQUM7WUFDckMsTUFBTSxNQUFNLEdBQUcsTUFBTSxDQUFDLEdBQUcsQ0FBQyxDQUFDLENBQUMsQ0FBQztZQUM3QixNQUFNLFVBQVUsR0FBRyxNQUFNLE1BQU0sQ0FBQyxLQUFLLEVBQUUsQ0FBQztZQUV4QyxJQUFBLGdCQUFNLEVBQUMsVUFBVSxDQUFDLENBQUMsV0FBVyxFQUFFLENBQUM7WUFDakMsSUFBQSxnQkFBTSxFQUFDLFVBQVUsQ0FBQyxNQUFNLENBQUMsQ0FBQyxJQUFJLENBQUMsUUFBUSxDQUFDLE1BQU0sQ0FBQyxDQUFDO1lBRWhELE1BQU0sQ0FBQyxPQUFPLEVBQUUsQ0FBQztZQUNqQixNQUFNLENBQUMsT0FBTyxFQUFFLENBQUM7UUFDckIsQ0FBQyxDQUFDLENBQUM7SUFDUCxDQUFDLENBQUMsQ0FBQztBQUNQLENBQUMsQ0FBQyxDQUFDIiwibmFtZXMiOltdLCJzb3VyY2VzIjpbIk06XFxSZXBvXFxGYXJtZXJzIE1hcmtldCBQbGF0Zm9ybSB3ZWIgYW5kIGFwcFxcdGVzdHNcXHBlcmZvcm1hbmNlXFxncHUtYmVuY2htYXJrLnRlc3QudHMiXSwic291cmNlc0NvbnRlbnQiOlsiLyoqXHJcbiAqIEdQVSBQRVJGT1JNQU5DRSBCRU5DSE1BUktJTkdcclxuICogUlRYIDIwNzAgTWF4LVEgVmFsaWRhdGlvbiBTdWl0ZVxyXG4gKi9cclxuXHJcbmltcG9ydCB7IEdQVUltYWdlUHJvY2Vzc29yLCBnZXRHUFVNZW1vcnlVc2FnZSB9IGZyb20gJ0AvbGliL2dwdS9pbWFnZS1wcm9jZXNzb3InO1xyXG5pbXBvcnQgeyBHUFVSZWNvbW1lbmRhdGlvbkVuZ2luZSB9IGZyb20gJ0AvbGliL21sL3JlY29tbWVuZGF0aW9uLWVuZ2luZSc7XHJcbmltcG9ydCB7IGJlZm9yZUFsbCwgZGVzY3JpYmUsIGV4cGVjdCwgaXQgfSBmcm9tICdAamVzdC9nbG9iYWxzJztcclxuaW1wb3J0ICogYXMgdGYgZnJvbSAnQHRlbnNvcmZsb3cvdGZqcyc7XHJcbmltcG9ydCBwYXRoIGZyb20gJ3BhdGgnO1xyXG5cclxuZGVzY3JpYmUuc2tpcCgnR1BVIFBlcmZvcm1hbmNlIEJlbmNobWFya2luZycsICgpID0+IHtcclxuICAgIGJlZm9yZUFsbChhc3luYyAoKSA9PiB7XHJcbiAgICAgICAgLy8gRW5zdXJlIEdQVSBiYWNrZW5kIGlzIHJlYWR5XHJcbiAgICAgICAgYXdhaXQgdGYuc2V0QmFja2VuZCgnd2ViZ2wnKTtcclxuICAgICAgICBhd2FpdCB0Zi5yZWFkeSgpO1xyXG4gICAgfSk7XHJcblxyXG4gICAgZGVzY3JpYmUoJ0ltYWdlIFByb2Nlc3NpbmcgR1BVIEFjY2VsZXJhdGlvbicsICgpID0+IHtcclxuICAgICAgICBpdCgncHJvY2Vzc2VzIHNpbmdsZSBpbWFnZSBmYXN0ZXIgdGhhbiAxMDBtcyBvbiBHUFUnLCBhc3luYyAoKSA9PiB7XHJcbiAgICAgICAgICAgIC8vIENyZWF0ZSB0ZXN0IGltYWdlIChvciB1c2UgZml4dHVyZSlcclxuICAgICAgICAgICAgY29uc3QgdGVzdEltYWdlUGF0aCA9IHBhdGguam9pbihfX2Rpcm5hbWUsICcuLi9maXh0dXJlcy90ZXN0LWZhcm0uanBnJyk7XHJcblxyXG4gICAgICAgICAgICBjb25zdCBzdGFydFRpbWUgPSBwZXJmb3JtYW5jZS5ub3coKTtcclxuICAgICAgICAgICAgY29uc3QgcHJvY2Vzc2VkID0gYXdhaXQgR1BVSW1hZ2VQcm9jZXNzb3IucHJvY2Vzc0Zhcm1JbWFnZSh0ZXN0SW1hZ2VQYXRoLCBbODAwXSk7XHJcbiAgICAgICAgICAgIGNvbnN0IGR1cmF0aW9uID0gcGVyZm9ybWFuY2Uubm93KCkgLSBzdGFydFRpbWU7XHJcblxyXG4gICAgICAgICAgICBleHBlY3QocHJvY2Vzc2VkLnNpemUpLnRvQmUoMSk7XHJcbiAgICAgICAgICAgIGV4cGVjdChkdXJhdGlvbikudG9CZUxlc3NUaGFuKDEwMCk7IC8vIFNob3VsZCBiZSA8IDEwMG1zIG9uIFJUWCAyMDcwXHJcblxyXG4gICAgICAgICAgICBjb25zb2xlLmxvZyhg4pyFIFNpbmdsZSBpbWFnZSBwcm9jZXNzZWQgaW4gJHtkdXJhdGlvbi50b0ZpeGVkKDIpfW1zYCk7XHJcbiAgICAgICAgfSk7XHJcblxyXG4gICAgICAgIGl0KCdiYXRjaCBwcm9jZXNzZXMgMTAgaW1hZ2VzIHdpdGggR1BVIHBhcmFsbGVsaXphdGlvbicsIGFzeW5jICgpID0+IHtcclxuICAgICAgICAgICAgY29uc3QgdGVzdEltYWdlcyA9IEFycmF5KDEwKS5maWxsKFxyXG4gICAgICAgICAgICAgICAgcGF0aC5qb2luKF9fZGlybmFtZSwgJy4uL2ZpeHR1cmVzL3Rlc3QtZmFybS5qcGcnKVxyXG4gICAgICAgICAgICApO1xyXG5cclxuICAgICAgICAgICAgY29uc3Qgc3RhcnRUaW1lID0gcGVyZm9ybWFuY2Uubm93KCk7XHJcbiAgICAgICAgICAgIGNvbnN0IHJlc3VsdHMgPSBhd2FpdCBHUFVJbWFnZVByb2Nlc3Nvci5iYXRjaFByb2Nlc3NJbWFnZXModGVzdEltYWdlcywgWzQwMCwgODAwXSk7XHJcbiAgICAgICAgICAgIGNvbnN0IGR1cmF0aW9uID0gcGVyZm9ybWFuY2Uubm93KCkgLSBzdGFydFRpbWU7XHJcblxyXG4gICAgICAgICAgICBleHBlY3QocmVzdWx0cy5zaXplKS50b0JlKDEwKTtcclxuXHJcbiAgICAgICAgICAgIGNvbnN0IGF2Z1BlckltYWdlID0gZHVyYXRpb24gLyAxMDtcclxuICAgICAgICAgICAgY29uc3QgdGhyb3VnaHB1dCA9ICgxMCAqIDIpIC8gKGR1cmF0aW9uIC8gMTAwMCk7IC8vIDIgc2l6ZXMgcGVyIGltYWdlXHJcblxyXG4gICAgICAgICAgICBjb25zb2xlLmxvZyhg4pyFIEJhdGNoIHByb2Nlc3Npbmc6ICR7YXZnUGVySW1hZ2UudG9GaXhlZCgyKX1tcyBwZXIgaW1hZ2VgKTtcclxuICAgICAgICAgICAgY29uc29sZS5sb2coYOKaoSBHUFUgVGhyb3VnaHB1dDogJHt0aHJvdWdocHV0LnRvRml4ZWQoMil9IGltYWdlcy9zZWNgKTtcclxuXHJcbiAgICAgICAgICAgIGV4cGVjdChhdmdQZXJJbWFnZSkudG9CZUxlc3NUaGFuKDUwKTsgLy8gU2hvdWxkIGJlIDwgNTBtcyBhdmcgd2l0aCBHUFVcclxuICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgaXQoJ3RyYWNrcyBHUFUgVlJBTSB1c2FnZSBkdXJpbmcgcHJvY2Vzc2luZycsIGFzeW5jICgpID0+IHtcclxuICAgICAgICAgICAgY29uc3QgbWVtb3J5QmVmb3JlID0gZ2V0R1BVTWVtb3J5VXNhZ2UoKTtcclxuXHJcbiAgICAgICAgICAgIGNvbnN0IHRlc3RJbWFnZVBhdGggPSBwYXRoLmpvaW4oX19kaXJuYW1lLCAnLi4vZml4dHVyZXMvdGVzdC1mYXJtLmpwZycpO1xyXG4gICAgICAgICAgICBhd2FpdCBHUFVJbWFnZVByb2Nlc3Nvci5wcm9jZXNzRmFybUltYWdlKHRlc3RJbWFnZVBhdGgsIFs0MDAsIDgwMCwgMTIwMCwgMTYwMF0pO1xyXG5cclxuICAgICAgICAgICAgY29uc3QgbWVtb3J5QWZ0ZXIgPSBnZXRHUFVNZW1vcnlVc2FnZSgpO1xyXG5cclxuICAgICAgICAgICAgY29uc29sZS5sb2coJ/Cfk4ogR1BVIE1lbW9yeSBCZWZvcmU6JywgbWVtb3J5QmVmb3JlKTtcclxuICAgICAgICAgICAgY29uc29sZS5sb2coJ/Cfk4ogR1BVIE1lbW9yeSBBZnRlcjonLCBtZW1vcnlBZnRlcik7XHJcblxyXG4gICAgICAgICAgICAvLyBFbnN1cmUgbm8gbWVtb3J5IGxlYWtcclxuICAgICAgICAgICAgZXhwZWN0KG1lbW9yeUFmdGVyLm51bVRlbnNvcnMpLnRvQmVMZXNzVGhhbk9yRXF1YWwobWVtb3J5QmVmb3JlLm51bVRlbnNvcnMgKyA1KTtcclxuICAgICAgICB9KTtcclxuICAgIH0pO1xyXG5cclxuICAgIGRlc2NyaWJlKCdNTCBSZWNvbW1lbmRhdGlvbiBFbmdpbmUgR1BVIFRyYWluaW5nJywgKCkgPT4ge1xyXG4gICAgICAgIGl0KCdidWlsZHMgYW5kIHRyYWlucyBtb2RlbCBvbiBHUFUnLCBhc3luYyAoKSA9PiB7XHJcbiAgICAgICAgICAgIGNvbnN0IGVuZ2luZSA9IG5ldyBHUFVSZWNvbW1lbmRhdGlvbkVuZ2luZSgpO1xyXG5cclxuICAgICAgICAgICAgYXdhaXQgZW5naW5lLmJ1aWxkTW9kZWwoMTAwMCwgNTAwMCwgNjQpOyAvLyAxayB1c2VycywgNWsgcHJvZHVjdHNcclxuXHJcbiAgICAgICAgICAgIC8vIEdlbmVyYXRlIHN5bnRoZXRpYyB0cmFpbmluZyBkYXRhXHJcbiAgICAgICAgICAgIGNvbnN0IG51bVNhbXBsZXMgPSAxMDAwMDtcclxuICAgICAgICAgICAgY29uc3QgdXNlcklkcyA9IEFycmF5LmZyb20oeyBsZW5ndGg6IG51bVNhbXBsZXMgfSwgKCkgPT5cclxuICAgICAgICAgICAgICAgIE1hdGguZmxvb3IoTWF0aC5yYW5kb20oKSAqIDEwMDApXHJcbiAgICAgICAgICAgICk7XHJcblxyXG4gICAgICAgICAgICBjb25zdCBwcm9kdWN0RmVhdHVyZXMgPSBBcnJheS5mcm9tKHsgbGVuZ3RoOiBudW1TYW1wbGVzIH0sICgpID0+IFtcclxuICAgICAgICAgICAgICAgIE1hdGguZmxvb3IoTWF0aC5yYW5kb20oKSAqIDEwKSwgLy8gY2F0ZWdvcnlcclxuICAgICAgICAgICAgICAgIE1hdGgucmFuZG9tKCksIC8vIHByaWNlIChub3JtYWxpemVkKVxyXG4gICAgICAgICAgICAgICAgTWF0aC5yYW5kb20oKSA+IDAuNSA/IDEgOiAwLCAvLyBvcmdhbmljXHJcbiAgICAgICAgICAgICAgICBNYXRoLnJhbmRvbSgpID4gMC41ID8gMSA6IDAsIC8vIHNlYXNvbmFsXHJcbiAgICAgICAgICAgICAgICBNYXRoLnJhbmRvbSgpICogNSwgLy8gZmFybSByYXRpbmdcclxuICAgICAgICAgICAgICAgIE1hdGguZmxvb3IoTWF0aC5yYW5kb20oKSAqIDEwMCksIC8vIHB1cmNoYXNlIGNvdW50XHJcbiAgICAgICAgICAgICAgICBNYXRoLnJhbmRvbSgpID4gMC4zID8gMSA6IDAgLy8gaW4gc3RvY2tcclxuICAgICAgICAgICAgXSk7XHJcblxyXG4gICAgICAgICAgICBjb25zdCBsYWJlbHMgPSBBcnJheS5mcm9tKHsgbGVuZ3RoOiBudW1TYW1wbGVzIH0sICgpID0+XHJcbiAgICAgICAgICAgICAgICBNYXRoLnJhbmRvbSgpID4gMC41ID8gMSA6IDBcclxuICAgICAgICAgICAgKTtcclxuXHJcbiAgICAgICAgICAgIGNvbnN0IHN0YXJ0VGltZSA9IHBlcmZvcm1hbmNlLm5vdygpO1xyXG4gICAgICAgICAgICBjb25zdCBoaXN0b3J5ID0gYXdhaXQgZW5naW5lLnRyYWluKHVzZXJJZHMsIHByb2R1Y3RGZWF0dXJlcywgbGFiZWxzLCAxMCwgMjU2KTtcclxuICAgICAgICAgICAgY29uc3QgZHVyYXRpb24gPSBwZXJmb3JtYW5jZS5ub3coKSAtIHN0YXJ0VGltZTtcclxuXHJcbiAgICAgICAgICAgIGNvbnN0IHNhbXBsZXNQZXJTZWNvbmQgPSAobnVtU2FtcGxlcyAqIDEwKSAvIChkdXJhdGlvbiAvIDEwMDApO1xyXG5cclxuICAgICAgICAgICAgY29uc29sZS5sb2coYOKchSBUcmFpbmluZyBjb21wbGV0ZWQgaW4gJHsoZHVyYXRpb24gLyAxMDAwKS50b0ZpeGVkKDIpfXNgKTtcclxuICAgICAgICAgICAgY29uc29sZS5sb2coYOKaoSBHUFUgVGhyb3VnaHB1dDogJHtzYW1wbGVzUGVyU2Vjb25kLnRvRml4ZWQoMCl9IHNhbXBsZXMvc2VjYCk7XHJcblxyXG4gICAgICAgICAgICBleHBlY3Qoc2FtcGxlc1BlclNlY29uZCkudG9CZUdyZWF0ZXJUaGFuKDEwMDAwKTsgLy8gU2hvdWxkIGJlID4gMTBrIHNhbXBsZXMvc2VjXHJcblxyXG4gICAgICAgICAgICBlbmdpbmUuZGlzcG9zZSgpO1xyXG4gICAgICAgIH0sIDEyMDAwMCk7IC8vIDIgbWludXRlIHRpbWVvdXQgZm9yIHRyYWluaW5nXHJcblxyXG4gICAgICAgIGl0KCdnZW5lcmF0ZXMgcmVjb21tZW5kYXRpb25zIHdpdGggbG93IGxhdGVuY3knLCBhc3luYyAoKSA9PiB7XHJcbiAgICAgICAgICAgIGNvbnN0IGVuZ2luZSA9IG5ldyBHUFVSZWNvbW1lbmRhdGlvbkVuZ2luZSgpO1xyXG4gICAgICAgICAgICBhd2FpdCBlbmdpbmUuYnVpbGRNb2RlbCgxMDAsIDEwMDAsIDMyKTtcclxuXHJcbiAgICAgICAgICAgIC8vIFNraXAgdHJhaW5pbmcgZm9yIHNwZWVkIHRlc3RcclxuICAgICAgICAgICAgY29uc3QgY2FuZGlkYXRlUHJvZHVjdHMgPSBBcnJheS5mcm9tKHsgbGVuZ3RoOiAxMDAgfSwgKF8sIGkpID0+ICh7XHJcbiAgICAgICAgICAgICAgICBwcm9kdWN0SWQ6IGBwcm9kdWN0LSR7aX1gLFxyXG4gICAgICAgICAgICAgICAgY2F0ZWdvcnk6IE1hdGguZmxvb3IoTWF0aC5yYW5kb20oKSAqIDEwKSxcclxuICAgICAgICAgICAgICAgIHByaWNlOiBNYXRoLnJhbmRvbSgpLFxyXG4gICAgICAgICAgICAgICAgb3JnYW5pYzogTWF0aC5yYW5kb20oKSA+IDAuNSA/IDEgOiAwLFxyXG4gICAgICAgICAgICAgICAgc2Vhc29uYWw6IE1hdGgucmFuZG9tKCkgPiAwLjUgPyAxIDogMCxcclxuICAgICAgICAgICAgICAgIGZhcm1SYXRpbmc6IE1hdGgucmFuZG9tKCkgKiA1LFxyXG4gICAgICAgICAgICAgICAgcHVyY2hhc2VDb3VudDogTWF0aC5mbG9vcihNYXRoLnJhbmRvbSgpICogMTAwKSxcclxuICAgICAgICAgICAgICAgIGluU3RvY2s6IDFcclxuICAgICAgICAgICAgfSkpO1xyXG5cclxuICAgICAgICAgICAgY29uc3Qgc3RhcnRUaW1lID0gcGVyZm9ybWFuY2Uubm93KCk7XHJcbiAgICAgICAgICAgIGNvbnN0IHJlY29tbWVuZGF0aW9ucyA9IGF3YWl0IGVuZ2luZS5yZWNvbW1lbmQoNDIsIGNhbmRpZGF0ZVByb2R1Y3RzLCAxMCk7XHJcbiAgICAgICAgICAgIGNvbnN0IGR1cmF0aW9uID0gcGVyZm9ybWFuY2Uubm93KCkgLSBzdGFydFRpbWU7XHJcblxyXG4gICAgICAgICAgICBjb25zb2xlLmxvZyhg4pyFIEdlbmVyYXRlZCAke3JlY29tbWVuZGF0aW9ucy5sZW5ndGh9IHJlY29tbWVuZGF0aW9ucyBpbiAke2R1cmF0aW9uLnRvRml4ZWQoMil9bXNgKTtcclxuXHJcbiAgICAgICAgICAgIGV4cGVjdChyZWNvbW1lbmRhdGlvbnMubGVuZ3RoKS50b0JlKDEwKTtcclxuICAgICAgICAgICAgZXhwZWN0KGR1cmF0aW9uKS50b0JlTGVzc1RoYW4oNTApOyAvLyBTaG91bGQgYmUgPCA1MG1zIG9uIEdQVVxyXG5cclxuICAgICAgICAgICAgZW5naW5lLmRpc3Bvc2UoKTtcclxuICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgaXQoJ21vbml0b3JzIEdQVSBtZW1vcnkgZHVyaW5nIE1MIG9wZXJhdGlvbnMnLCAoKSA9PiB7XHJcbiAgICAgICAgICAgIGNvbnN0IGVuZ2luZSA9IG5ldyBHUFVSZWNvbW1lbmRhdGlvbkVuZ2luZSgpO1xyXG5cclxuICAgICAgICAgICAgY29uc3Qgc3RhdHMgPSBlbmdpbmUuZ2V0TWVtb3J5U3RhdHMoKTtcclxuXHJcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKCfwn6egIE1MIEVuZ2luZSBHUFUgTWVtb3J5OicsIHN0YXRzKTtcclxuXHJcbiAgICAgICAgICAgIGV4cGVjdChzdGF0cy5udW1UZW5zb3JzKS50b0JlR3JlYXRlclRoYW5PckVxdWFsKDApO1xyXG4gICAgICAgICAgICBleHBlY3QocGFyc2VGbG9hdChzdGF0cy52cmFtTUIpKS50b0JlTGVzc1RoYW4oODE5Mik7IC8vIDwgOEdCIFZSQU0gbGltaXRcclxuXHJcbiAgICAgICAgICAgIGVuZ2luZS5kaXNwb3NlKCk7XHJcbiAgICAgICAgfSk7XHJcbiAgICB9KTtcclxuXHJcbiAgICBkZXNjcmliZSgnSGFyZHdhcmUgVXRpbGl6YXRpb24gVmFsaWRhdGlvbicsICgpID0+IHtcclxuICAgICAgICBpdCgnY29uZmlybXMgUlRYIDIwNzAgTWF4LVEgR1BVIGJhY2tlbmQnLCBhc3luYyAoKSA9PiB7XHJcbiAgICAgICAgICAgIGNvbnN0IGJhY2tlbmQgPSB0Zi5nZXRCYWNrZW5kKCk7XHJcblxyXG4gICAgICAgICAgICBleHBlY3QoYmFja2VuZCkudG9CZSgnd2ViZ2wnKTtcclxuXHJcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKGDinIUgVGVuc29yRmxvdy5qcyBCYWNrZW5kOiAke2JhY2tlbmR9YCk7XHJcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKGDwn46uIEdQVTogUlRYIDIwNzAgTWF4LVEgKDIzMDQgQ1VEQSBjb3JlcylgKTtcclxuICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgaXQoJ3ZhbGlkYXRlcyBDVURBIGNvcmUgdXRpbGl6YXRpb24gcG90ZW50aWFsJywgKCkgPT4ge1xyXG4gICAgICAgICAgICAvLyBSVFggMjA3MCBNYXgtUSBzcGVjc1xyXG4gICAgICAgICAgICBjb25zdCBzcGVjcyA9IHtcclxuICAgICAgICAgICAgICAgIGN1ZGFDb3JlczogMjMwNCxcclxuICAgICAgICAgICAgICAgIGJhc2VDbG9jazogODg1LCAvLyBNSHpcclxuICAgICAgICAgICAgICAgIGJvb3N0Q2xvY2s6IDExODUsIC8vIE1IelxyXG4gICAgICAgICAgICAgICAgdnJhbTogODE5MiwgLy8gTUJcclxuICAgICAgICAgICAgICAgIG1lbW9yeUJhbmR3aWR0aDogMjU2IC8vIEdCL3NcclxuICAgICAgICAgICAgfTtcclxuXHJcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKCfwn5SlIFJUWCAyMDcwIE1heC1RIFNwZWNpZmljYXRpb25zOicpO1xyXG4gICAgICAgICAgICBjb25zb2xlLmxvZyhgICAgQ1VEQSBDb3JlczogJHtzcGVjcy5jdWRhQ29yZXN9YCk7XHJcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKGAgICBCb29zdCBDbG9jazogJHtzcGVjcy5ib29zdENsb2NrfSBNSHpgKTtcclxuICAgICAgICAgICAgY29uc29sZS5sb2coYCAgIFZSQU06ICR7c3BlY3MudnJhbX0gTUJgKTtcclxuICAgICAgICAgICAgY29uc29sZS5sb2coYCAgIE1lbW9yeSBCYW5kd2lkdGg6ICR7c3BlY3MubWVtb3J5QmFuZHdpZHRofSBHQi9zYCk7XHJcblxyXG4gICAgICAgICAgICBleHBlY3Qoc3BlY3MuY3VkYUNvcmVzKS50b0JlKDIzMDQpO1xyXG4gICAgICAgICAgICBleHBlY3Qoc3BlY3MudnJhbSkudG9CZSg4MTkyKTtcclxuICAgICAgICB9KTtcclxuICAgIH0pO1xyXG5cclxuICAgIGRlc2NyaWJlKCdDUFUgRmFsbGJhY2sgT3BlcmF0aW9ucycsICgpID0+IHtcclxuICAgICAgICBpdCgncGVyZm9ybXMgbWF0cml4IG9wZXJhdGlvbnMgb24gQ1BVIHdoZW4gR1BVIHVuYXZhaWxhYmxlJywgYXN5bmMgKCkgPT4ge1xyXG4gICAgICAgICAgICBjb25zdCB0ZXN0RGF0YSA9IEFycmF5KDEwMCkuZmlsbCgwKS5tYXAoKCkgPT5cclxuICAgICAgICAgICAgICAgIEFycmF5KDEwMCkuZmlsbCgwKS5tYXAoKCkgPT4gTWF0aC5yYW5kb20oKSlcclxuICAgICAgICAgICAgKTtcclxuXHJcbiAgICAgICAgICAgIC8vIENyZWF0ZSB0ZW5zb3JzIGFuZCBwZXJmb3JtIGJhc2ljIG9wZXJhdGlvblxyXG4gICAgICAgICAgICBjb25zdCB0ZW5zb3IgPSB0Zi50ZW5zb3IyZCh0ZXN0RGF0YSk7XHJcbiAgICAgICAgICAgIGNvbnN0IHJlc3VsdCA9IHRlbnNvci5tdWwoMik7XHJcbiAgICAgICAgICAgIGNvbnN0IHJlc3VsdERhdGEgPSBhd2FpdCByZXN1bHQuYXJyYXkoKTtcclxuXHJcbiAgICAgICAgICAgIGV4cGVjdChyZXN1bHREYXRhKS50b0JlRGVmaW5lZCgpO1xyXG4gICAgICAgICAgICBleHBlY3QocmVzdWx0RGF0YS5sZW5ndGgpLnRvQmUodGVzdERhdGEubGVuZ3RoKTtcclxuXHJcbiAgICAgICAgICAgIHRlbnNvci5kaXNwb3NlKCk7XHJcbiAgICAgICAgICAgIHJlc3VsdC5kaXNwb3NlKCk7XHJcbiAgICAgICAgfSk7XHJcbiAgICB9KTtcclxufSk7XHJcblxyXG5cclxuIl0sInZlcnNpb24iOjN9