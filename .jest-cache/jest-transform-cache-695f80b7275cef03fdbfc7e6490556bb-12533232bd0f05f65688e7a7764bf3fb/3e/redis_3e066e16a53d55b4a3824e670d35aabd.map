{"file":"M:\\Repo\\Farmers Market Platform web and app\\src\\lib\\cache\\redis.ts","mappings":"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","names":[],"sources":["M:\\Repo\\Farmers Market Platform web and app\\src\\lib\\cache\\redis.ts"],"sourcesContent":["/**\n * REDIS CACHE INFRASTRUCTURE\n * Divine caching with agricultural consciousness\n *\n * Reference: 03_PERFORMANCE_REALITY_BENDING.instructions.md\n * Domain: Agricultural cache management with seasonal awareness\n */\n\nimport Redis from \"ioredis\";\n\nexport interface RedisCacheConfig {\n  host: string;\n  port: number;\n  password?: string;\n  db?: number;\n  keyPrefix: string;\n  maxRetries: number;\n  retryStrategy?: (times: number) => number;\n}\n\nexport interface CacheOptions {\n  ttl?: number; // seconds\n  seasonal?: boolean;\n  compress?: boolean;\n}\n\n/**\n * REDIS QUANTUM CLIENT\n * High-performance Redis client with connection management\n */\nclass RedisQuantumClient {\n  private client: Redis | null = null;\n  private readonly config: RedisCacheConfig;\n  private isConnecting = false;\n  private connectionPromise: Promise<void> | null = null;\n\n  constructor(config: RedisCacheConfig) {\n    this.config = config;\n  }\n\n  /**\n   * Connect to Redis with retry logic\n   */\n  async connect(): Promise<void> {\n    if (\n      this.client &&\n      (this.client.status === \"ready\" || this.client.status === \"connecting\")\n    ) {\n      return;\n    }\n\n    if (this.isConnecting && this.connectionPromise) {\n      return this.connectionPromise;\n    }\n\n    this.isConnecting = true;\n    this.connectionPromise = this.performConnection();\n\n    try {\n      await this.connectionPromise;\n    } finally {\n      this.isConnecting = false;\n      this.connectionPromise = null;\n    }\n  }\n\n  private async performConnection(): Promise<void> {\n    try {\n      this.client = new Redis({\n        host: this.config.host,\n        port: this.config.port,\n        password: this.config.password,\n        db: this.config.db || 0,\n        retryStrategy:\n          this.config.retryStrategy || ((times) => Math.min(times * 100, 3000)),\n      });\n\n      this.client.on(\"error\", (error) => {\n        console.error(\"Redis client error\", error);\n      });\n\n      this.client.on(\"connect\", () => {\n        console.info(\"Redis client connected\", {\n          host: this.config.host,\n          port: this.config.port,\n        });\n      });\n\n      this.client.on(\"close\", () => {\n        console.warn(\"Redis client disconnected\");\n      });\n\n      // ioredis connects automatically on instantiation, but ensure readiness\n      await this.client.connect();\n    } catch (error) {\n      console.error(\"Failed to connect to Redis\", error);\n      throw error;\n    }\n  }\n\n  /**\n   * Disconnect from Redis\n   */\n  async disconnect(): Promise<void> {\n    if (this.client) {\n      await this.client.quit();\n      this.client = null;\n    }\n  }\n\n  /**\n   * Get Redis client instance\n   */\n  async getClient(): Promise<Redis> {\n    await this.connect();\n    if (!this.client) {\n      throw new Error(\"Redis client not initialized\");\n    }\n    return this.client;\n  }\n\n  /**\n   * Build cache key with prefix\n   */\n  buildKey(key: string): string {\n    return `${this.config.keyPrefix}${key}`;\n  }\n}\n\n/**\n * REDIS CACHE SERVICE\n * High-level caching operations with agricultural consciousness\n */\nexport class RedisCacheService {\n  private readonly redisClient: RedisQuantumClient;\n  private readonly DEFAULT_TTL = 3600; // 1 hour\n\n  constructor(config: RedisCacheConfig) {\n    this.redisClient = new RedisQuantumClient(config);\n  }\n\n  /**\n   * Get value from cache\n   */\n  async get<T>(key: string): Promise<T | null> {\n    try {\n      const client = await this.redisClient.getClient();\n      const fullKey = this.redisClient.buildKey(key);\n\n      const value = await client.get(fullKey);\n\n      if (!value) {\n        console.debug(\"Cache miss\", { key });\n        return null;\n      }\n\n      console.debug(\"Cache hit\", { key });\n      return JSON.parse(value) as T;\n    } catch (error) {\n      console.error(\"Redis get error\", error, { key });\n      return null;\n    }\n  }\n\n  /**\n   * Set value in cache\n   */\n  async set<T>(\n    key: string,\n    value: T,\n    options: CacheOptions = {}\n  ): Promise<boolean> {\n    try {\n      const client = await this.redisClient.getClient();\n      const fullKey = this.redisClient.buildKey(key);\n\n      const serialized = JSON.stringify(value);\n      const ttl = options.ttl || this.DEFAULT_TTL;\n\n      await client.setex(fullKey, ttl, serialized);\n\n      console.debug(\"Cache set\", { key, ttl });\n      return true;\n    } catch (error) {\n      console.error(\"Redis set error\", error, { key });\n      return false;\n    }\n  }\n\n  /**\n   * Delete key from cache\n   */\n  async delete(key: string): Promise<boolean> {\n    try {\n      const client = await this.redisClient.getClient();\n      const fullKey = this.redisClient.buildKey(key);\n\n      await client.del(fullKey);\n\n      console.debug(\"Cache delete\", { key });\n      return true;\n    } catch (error) {\n      console.error(\"Redis delete error\", error, { key });\n      return false;\n    }\n  }\n\n  /**\n   * Delete keys matching pattern\n   */\n  async deletePattern(pattern: string): Promise<number> {\n    try {\n      const client = await this.redisClient.getClient();\n      const fullPattern = this.redisClient.buildKey(pattern);\n\n      const keys = await client.keys(fullPattern);\n\n      if (keys.length === 0) {\n        return 0;\n      }\n\n      await client.del(keys);\n\n      console.debug(\"Cache pattern delete\", { pattern, count: keys.length });\n      return keys.length;\n    } catch (error) {\n      console.error(\"Redis pattern delete error\", error, { pattern });\n      return 0;\n    }\n  }\n\n  /**\n   * Get or set pattern - fetch from cache or compute\n   */\n  async getOrSet<T>(\n    key: string,\n    factory: () => Promise<T>,\n    options: CacheOptions = {}\n  ): Promise<T> {\n    // Try to get from cache first\n    const cached = await this.get<T>(key);\n    if (cached !== null) {\n      return cached;\n    }\n\n    // Compute value\n    const value = await factory();\n\n    // Store in cache\n    await this.set(key, value, options);\n\n    return value;\n  }\n\n  /**\n   * Check if key exists\n   */\n  async exists(key: string): Promise<boolean> {\n    try {\n      const client = await this.redisClient.getClient();\n      const fullKey = this.redisClient.buildKey(key);\n\n      const exists = await client.exists(fullKey);\n      return exists === 1;\n    } catch (error) {\n      console.error(\"Redis exists error\", error, { key });\n      return false;\n    }\n  }\n\n  /**\n   * Get TTL for key\n   */\n  async ttl(key: string): Promise<number> {\n    try {\n      const client = await this.redisClient.getClient();\n      const fullKey = this.redisClient.buildKey(key);\n\n      return await client.ttl(fullKey);\n    } catch (error) {\n      console.error(\"Redis TTL error\", error, { key });\n      return -1;\n    }\n  }\n\n  /**\n   * Increment counter\n   */\n  async increment(key: string, amount: number = 1): Promise<number> {\n    try {\n      const client = await this.redisClient.getClient();\n      const fullKey = this.redisClient.buildKey(key);\n\n      return await client.incrby(fullKey, amount);\n    } catch (error) {\n      console.error(\"Redis increment error\", error, { key });\n      return 0;\n    }\n  }\n\n  /**\n   * Flush all cache\n   */\n  async flushAll(): Promise<boolean> {\n    try {\n      const client = await this.redisClient.getClient();\n      await client.flushdb();\n\n      console.warn(\"Cache flushed\");\n      return true;\n    } catch (error) {\n      console.error(\"Redis flush error\", error);\n      return false;\n    }\n  }\n\n  /**\n   * Disconnect from Redis\n   */\n  async disconnect(): Promise<void> {\n    await this.redisClient.disconnect();\n  }\n}\n\n/**\n * SINGLETON REDIS INSTANCE\n * Global Redis cache service\n */\nlet redisInstance: RedisCacheService | null = null;\n\nexport function getRedisCache(): RedisCacheService {\n  if (!redisInstance) {\n    const config: RedisCacheConfig = {\n      host: process.env.REDIS_HOST || \"localhost\",\n      port: Number.parseInt(process.env.REDIS_PORT || \"6379\", 10),\n      password: process.env.REDIS_PASSWORD,\n      db: Number.parseInt(process.env.REDIS_DB || \"0\", 10),\n      keyPrefix: process.env.REDIS_KEY_PREFIX || \"fm:\",\n      maxRetries: 3,\n    };\n\n    redisInstance = new RedisCacheService(config);\n  }\n\n  return redisInstance;\n}\n\n/**\n * HEALTH CHECK\n */\nexport async function checkRedisHealth(): Promise<boolean> {\n  try {\n    const redis = getRedisCache();\n    await redis.set(\"health:check\", { timestamp: Date.now() }, { ttl: 10 });\n    const result = await redis.get<{ timestamp: number }>(\"health:check\");\n    return result !== null;\n  } catch (error) {\n    console.error(\"Redis health check failed\", error as Error);\n    return false;\n  }\n}\n"],"version":3}