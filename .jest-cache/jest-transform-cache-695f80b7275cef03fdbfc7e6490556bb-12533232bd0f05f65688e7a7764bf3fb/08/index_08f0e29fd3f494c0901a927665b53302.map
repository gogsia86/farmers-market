{"file":"M:\\Repo\\Farmers Market Platform web and app\\src\\lib\\cache\\index.ts","mappings":"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","names":[],"sources":["M:\\Repo\\Farmers Market Platform web and app\\src\\lib\\cache\\index.ts"],"sourcesContent":["// ðŸ§  DIVINE PATTERN: Multi-Layer Caching with Agricultural Consciousness\n// ðŸ“š Reference: 03_PERFORMANCE_REALITY_BENDING.instructions.md\n// ðŸŒ¾ Domain: Biodynamic Cache with Seasonal TTL\n// âš¡ Performance: Redis + Memory Layer\n\nimport { logger } from \"@/lib/monitoring/logger\";\nimport { Redis } from \"ioredis\";\n\n/**\n * CACHE CONFIGURATION\n */\nconst REDIS_CONFIG = {\n  host: process.env.REDIS_HOST || \"localhost\",\n  port: parseInt(process.env.REDIS_PORT || \"6379\", 10),\n  password: process.env.REDIS_PASSWORD,\n  keyPrefix: \"fm:\", // Farmers Market prefix\n  maxRetriesPerRequest: 3,\n  retryStrategy: (times: number) => {\n    const delay = Math.min(times * 50, 2000);\n    return delay;\n  },\n};\n\n/**\n * SEASON-AWARE TTL CONFIGURATION\n * Agricultural consciousness: different cache durations per season\n */\nconst SEASONAL_TTL = {\n  SPRING: 3600, // 1 hour (planting season - frequent updates)\n  SUMMER: 7200, // 2 hours (growing season - moderate updates)\n  FALL: 1800, // 30 minutes (harvest season - rapid changes)\n  WINTER: 14400, // 4 hours (rest season - slower updates)\n} as const;\n\ntype Season = keyof typeof SEASONAL_TTL;\n\n/**\n * CACHE KEY PATTERNS\n */\nexport const CacheKeys = {\n  farm: (id: string) => `farm:${id}`,\n  farmList: (filters: string) => `farms:list:${filters}`,\n  product: (id: string) => `product:${id}`,\n  productList: (farmId: string, filters: string) =>\n    `products:${farmId}:${filters}`,\n  userProfile: (id: string) => `user:${id}`,\n  seasonalData: (season: Season) => `seasonal:${season}`,\n} as const;\n\n/**\n * CACHE LAYER INTERFACE\n */\nexport interface CacheLayer {\n  get<T>(key: string): Promise<T | null>;\n  set<T>(key: string, value: T, ttl?: number): Promise<void>;\n  del(key: string): Promise<void>;\n  delPattern(pattern: string): Promise<void>;\n  clear(): Promise<void>;\n}\n\n/**\n * MEMORY CACHE LAYER\n * Fast in-memory cache for frequently accessed data\n */\nclass MemoryCache implements CacheLayer {\n  private cache: Map<string, { value: any; expiry: number }> = new Map();\n  private readonly maxSize = 1000;\n\n  async get<T>(key: string): Promise<T | null> {\n    const entry = this.cache.get(key);\n    if (!entry) return null;\n\n    if (Date.now() > entry.expiry) {\n      this.cache.delete(key);\n      return null;\n    }\n\n    return entry.value as T;\n  }\n\n  async set<T>(key: string, value: T, ttl: number = 300): Promise<void> {\n    // LRU eviction if cache is full\n    if (this.cache.size >= this.maxSize) {\n      const firstKey = this.cache.keys().next().value;\n      if (firstKey) this.cache.delete(firstKey);\n    }\n\n    this.cache.set(key, {\n      value,\n      expiry: Date.now() + ttl * 1000,\n    });\n  }\n\n  async del(key: string): Promise<void> {\n    this.cache.delete(key);\n  }\n\n  async delPattern(pattern: string): Promise<void> {\n    const regex = new RegExp(pattern.replace(\"*\", \".*\"));\n    for (const key of this.cache.keys()) {\n      if (regex.test(key)) {\n        this.cache.delete(key);\n      }\n    }\n  }\n\n  async clear(): Promise<void> {\n    this.cache.clear();\n  }\n}\n\n/**\n * REDIS CACHE LAYER\n * Distributed cache for multi-instance deployments\n */\nclass RedisCache implements CacheLayer {\n  private client: Redis | null = null;\n  private isConnected = false;\n\n  constructor() {\n    this.connect();\n  }\n\n  private connect() {\n    try {\n      this.client = new Redis(REDIS_CONFIG);\n\n      this.client.on(\"connect\", () => {\n        this.isConnected = true;\n        logger.info(\"Redis cache connected\");\n      });\n\n      this.client.on(\"error\", (error) => {\n        logger.error(\"Redis cache error\", { error });\n        this.isConnected = false;\n      });\n    } catch (error) {\n      logger.error(\"Failed to initialize Redis\", { error });\n    }\n  }\n\n  async get<T>(key: string): Promise<T | null> {\n    if (!this.client || !this.isConnected) return null;\n\n    try {\n      const value = await this.client.get(key);\n      if (!value) return null;\n\n      return JSON.parse(value) as T;\n    } catch (error) {\n      logger.error(\"Redis get error\", { key, error });\n      return null;\n    }\n  }\n\n  async set<T>(key: string, value: T, ttl: number = 300): Promise<void> {\n    if (!this.client || !this.isConnected) return;\n\n    try {\n      await this.client.setex(key, ttl, JSON.stringify(value));\n    } catch (error) {\n      logger.error(\"Redis set error\", { key, error });\n    }\n  }\n\n  async del(key: string): Promise<void> {\n    if (!this.client || !this.isConnected) return;\n\n    try {\n      await this.client.del(key);\n    } catch (error) {\n      logger.error(\"Redis del error\", { key, error });\n    }\n  }\n\n  async delPattern(pattern: string): Promise<void> {\n    if (!this.client || !this.isConnected) return;\n\n    try {\n      const keys = await this.client.keys(pattern);\n      if (keys.length > 0) {\n        await this.client.del(...keys);\n      }\n    } catch (error) {\n      logger.error(\"Redis delPattern error\", { pattern, error });\n    }\n  }\n\n  async clear(): Promise<void> {\n    if (!this.client || !this.isConnected) return;\n\n    try {\n      await this.client.flushdb();\n    } catch (error) {\n      logger.error(\"Redis clear error\", { error });\n    }\n  }\n\n  async disconnect(): Promise<void> {\n    if (this.client) {\n      await this.client.quit();\n      this.isConnected = false;\n    }\n  }\n}\n\n/**\n * MULTI-LAYER CACHE MANAGER\n * Combines memory and Redis layers with fallback strategy\n */\nclass MultiLayerCache {\n  private memoryCache: MemoryCache;\n  private redisCache: RedisCache;\n  private useRedis: boolean;\n\n  constructor() {\n    this.memoryCache = new MemoryCache();\n    this.redisCache = new RedisCache();\n    this.useRedis = process.env.REDIS_ENABLED === \"true\";\n  }\n\n  /**\n   * Get value from cache (tries memory first, then Redis)\n   */\n  async get<T>(key: string): Promise<T | null> {\n    // Try memory cache first\n    const memoryValue = await this.memoryCache.get<T>(key);\n    if (memoryValue) {\n      logger.debug(\"Cache hit (memory)\", { key });\n      return memoryValue;\n    }\n\n    // Try Redis if enabled\n    if (this.useRedis) {\n      const redisValue = await this.redisCache.get<T>(key);\n      if (redisValue) {\n        logger.debug(\"Cache hit (Redis)\", { key });\n        // Backfill memory cache\n        await this.memoryCache.set(key, redisValue, 300);\n        return redisValue;\n      }\n    }\n\n    logger.debug(\"Cache miss\", { key });\n    return null;\n  }\n\n  /**\n   * Set value in cache (writes to both layers)\n   */\n  async set<T>(key: string, value: T, ttl?: number): Promise<void> {\n    const finalTtl = ttl || this.getSeasonalTTL();\n\n    // Write to both layers\n    await Promise.all([\n      this.memoryCache.set(key, value, finalTtl),\n      this.useRedis\n        ? this.redisCache.set(key, value, finalTtl)\n        : Promise.resolve(),\n    ]);\n\n    logger.debug(\"Cache set\", { key, ttl: finalTtl });\n  }\n\n  /**\n   * Delete key from cache\n   */\n  async del(key: string): Promise<void> {\n    await Promise.all([\n      this.memoryCache.del(key),\n      this.useRedis ? this.redisCache.del(key) : Promise.resolve(),\n    ]);\n\n    logger.debug(\"Cache deleted\", { key });\n  }\n\n  /**\n   * Delete keys matching pattern\n   */\n  async delPattern(pattern: string): Promise<void> {\n    await Promise.all([\n      this.memoryCache.delPattern(pattern),\n      this.useRedis ? this.redisCache.delPattern(pattern) : Promise.resolve(),\n    ]);\n\n    logger.debug(\"Cache pattern deleted\", { pattern });\n  }\n\n  /**\n   * Clear all cache\n   */\n  async clear(): Promise<void> {\n    await Promise.all([\n      this.memoryCache.clear(),\n      this.useRedis ? this.redisCache.clear() : Promise.resolve(),\n    ]);\n\n    logger.info(\"Cache cleared\");\n  }\n\n  /**\n   * Get seasonal TTL based on current season\n   */\n  private getSeasonalTTL(): number {\n    const month = new Date().getMonth();\n    const season = this.getCurrentSeason(month);\n    return SEASONAL_TTL[season];\n  }\n\n  /**\n   * Determine current season based on month\n   */\n  private getCurrentSeason(month: number): Season {\n    if (month >= 2 && month <= 4) return \"SPRING\"; // Mar-May\n    if (month >= 5 && month <= 7) return \"SUMMER\"; // Jun-Aug\n    if (month >= 8 && month <= 10) return \"FALL\"; // Sep-Nov\n    return \"WINTER\"; // Dec-Feb\n  }\n\n  /**\n   * Cache wrapper for async functions\n   */\n  async wrap<T>(key: string, fn: () => Promise<T>, ttl?: number): Promise<T> {\n    const cached = await this.get<T>(key);\n    if (cached) return cached;\n\n    const value = await fn();\n    await this.set(key, value, ttl);\n    return value;\n  }\n}\n\n/**\n * SINGLETON CACHE INSTANCE\n */\nexport const cache = new MultiLayerCache();\n\n/**\n * CACHE WARMING STRATEGY\n * Pre-populate cache with frequently accessed data\n */\nexport async function warmCache(): Promise<void> {\n  logger.info(\"Starting cache warming...\");\n\n  try {\n    // This would be implemented to pre-load critical data\n    // Example: Top farms, featured products, seasonal data\n    logger.info(\"Cache warming complete\");\n  } catch (error) {\n    logger.error(\"Cache warming failed\", { error });\n  }\n}\n\n// Re-export AgriculturalCache from separate module for better type resolution\nexport { AgriculturalCache } from \"./agricultural-cache\";\n"],"version":3}