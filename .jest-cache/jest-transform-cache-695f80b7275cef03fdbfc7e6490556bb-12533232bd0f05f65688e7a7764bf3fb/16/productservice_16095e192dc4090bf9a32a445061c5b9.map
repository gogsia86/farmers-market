{"file":"M:\\Repo\\Farmers Market Platform web and app\\src\\lib\\services\\product.service.ts","mappings":"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","names":[],"sources":["M:\\Repo\\Farmers Market Platform web and app\\src\\lib\\services\\product.service.ts"],"sourcesContent":["/**\n * PRODUCT SERVICE LAYER\n * Divine business logic for agricultural product management\n * Quantum operations for farm product consciousness\n */\n\nimport { database } from \"@/lib/database\";\nimport { generateSlug } from \"@/lib/utils/slug\";\nimport {\n  BatchProductResult,\n  CreateProductInput,\n  PaginatedProducts,\n  PaginationOptions,\n  Product,\n  ProductFilters,\n  ProductStats,\n  ProductStatus,\n  ProductValidation,\n  UpdateProductInput,\n} from \"@/types/product\";\n\n// ============================================\n// PRODUCT SERVICE CLASS\n// ============================================\n\nexport class ProductService {\n  /**\n   * Create a new product for a farm\n   * Validates farm ownership and generates unique slug\n   */\n  static async createProduct(\n    productData: CreateProductInput,\n    userId: string\n  ): Promise<Product & { id: string }> {\n    // Input validation\n    if (!userId || typeof userId !== \"string\") {\n      throw new Error(\"Valid user ID is required\");\n    }\n\n    if (!productData?.name || productData.name.trim().length < 3) {\n      throw new Error(\"Product name must be at least 3 characters\");\n    }\n\n    if (!productData?.farmId) {\n      throw new Error(\"Farm ID is required\");\n    }\n\n    // 1. Verify farm ownership\n    const farm = await database.farm.findUnique({\n      where: { id: productData.farmId },\n      select: { id: true, ownerId: true, status: true },\n    });\n\n    if (!farm) {\n      throw new Error(\"Farm not found\");\n    }\n\n    if (farm.ownerId !== userId) {\n      throw new Error(\"Unauthorized: You don't own this farm\");\n    }\n\n    if (farm.status !== \"ACTIVE\") {\n      throw new Error(\"Cannot add products to inactive farm\");\n    }\n\n    // 2. Validate product data\n    const validation = await ProductService.validateProduct(productData);\n    if (!validation.isValid) {\n      throw new Error(\n        `Validation failed: ${validation.errors.map((e) => e.message).join(\", \")}`\n      );\n    }\n\n    // 3. Generate unique slug\n    const baseSlug = generateSlug(productData.name);\n    const slug = await ProductService.generateUniqueSlug(\n      baseSlug,\n      productData.farmId\n    );\n\n    // 4. Calculate derived values\n    const availableQuantity =\n      productData.inventory.quantity - productData.inventory.reservedQuantity;\n    const isLowStock =\n      availableQuantity <= productData.inventory.lowStockThreshold;\n    const primaryPhotoUrl = productData.images.find(\n      (img) => img.isPrimary\n    )?.url;\n\n    // 5. Create product\n    const product = await database.product.create({\n      data: {\n        ...(productData as any),\n        slug,\n        inventory: {\n          ...productData.inventory,\n          availableQuantity,\n          isLowStock,\n        },\n        primaryPhotoUrl,\n      },\n      include: {\n        farm: {\n          select: {\n            id: true,\n            name: true,\n            slug: true,\n            logoUrl: true,\n            verificationStatus: true,\n          },\n        },\n      },\n    });\n\n    return product as unknown as Product;\n  }\n\n  /**\n   * Get product by ID with optional relations\n   */\n  static async getProductById(\n    productId: string,\n    includeFarm: boolean = true\n  ): Promise<Product | null> {\n    const product = await database.product.findUnique({\n      where: { id: productId },\n      include: {\n        farm: includeFarm\n          ? {\n              select: {\n                id: true,\n                name: true,\n                slug: true,\n                logoUrl: true,\n                verificationStatus: true,\n              },\n            }\n          : false,\n      },\n    });\n\n    return product as Product | null;\n  }\n\n  /**\n   * Get product by slug (for public URLs)\n   */\n  static async getProductBySlug(\n    farmSlug: string,\n    productSlug: string\n  ): Promise<Product | null> {\n    const product = await database.product.findFirst({\n      where: {\n        slug: productSlug,\n        farm: {\n          slug: farmSlug,\n        },\n      },\n      include: {\n        farm: {\n          select: {\n            id: true,\n            name: true,\n            slug: true,\n            logoUrl: true,\n            verificationStatus: true,\n          },\n        },\n      },\n    });\n\n    return product as Product | null;\n  }\n\n  /**\n   * List products with filters and pagination\n   */\n  static async listProducts(\n    filters: ProductFilters = {},\n    options?: PaginationOptions\n  ): Promise<PaginatedProducts> {\n    const { page = 1, limit = 20 } = options || {};\n    const skip = (page - 1) * limit;\n\n    // Build where clause\n    const where = this.buildWhereClause(filters);\n\n    // Farm filtering\n    if (filters.farmId) {\n      where.farmId = filters.farmId;\n    }\n    if (filters.farmIds && filters.farmIds.length > 0) {\n      where.farmId = { in: filters.farmIds };\n    }\n\n    // Category filtering\n    if (filters.category) {\n      where.category = filters.category;\n    }\n    if (filters.categories && filters.categories.length > 0) {\n      where.category = { in: filters.categories };\n    }\n    if (filters.subCategory) {\n      where.subCategory = filters.subCategory;\n    }\n\n    // Status filtering\n    if (filters.status) {\n      where.status = filters.status;\n    }\n    if (filters.isActive !== undefined) {\n      where.isActive = filters.isActive;\n    }\n    if (filters.inStock !== undefined) {\n      where.inventory = {\n        inStock: filters.inStock,\n      };\n    }\n    if (filters.isFeatured !== undefined) {\n      where.isFeatured = filters.isFeatured;\n    }\n\n    // Attribute filtering\n    if (filters.isOrganic !== undefined) {\n      where.attributes = {\n        path: [\"isOrganic\"],\n        equals: filters.isOrganic,\n      };\n    }\n    if (filters.isNonGMO !== undefined) {\n      where.attributes = {\n        path: [\"isNonGMO\"],\n        equals: filters.isNonGMO,\n      };\n    }\n\n    // Seasonal filtering\n    if (filters.season) {\n      where.seasons = {\n        has: filters.season,\n      };\n    }\n\n    // Price filtering\n    if (filters.minPrice !== undefined || filters.maxPrice !== undefined) {\n      where.pricing = {\n        path: [\"basePrice\", \"amount\"],\n        gte: filters.minPrice,\n        lte: filters.maxPrice,\n      };\n    }\n\n    // Search\n    if (filters.search) {\n      where.OR = [\n        { name: { contains: filters.search, mode: \"insensitive\" } },\n        { description: { contains: filters.search, mode: \"insensitive\" } },\n        { tags: { has: filters.search } },\n      ];\n    }\n\n    // Build orderBy clause\n    const orderBy: any = {};\n    if (filters.sortBy) {\n      switch (filters.sortBy) {\n        case \"name\":\n          orderBy.name = filters.sortOrder || \"asc\";\n          break;\n        case \"price\":\n          orderBy.pricing = {\n            path: [\"basePrice\", \"amount\"],\n            order: filters.sortOrder || \"asc\",\n          };\n          break;\n        case \"newest\":\n          orderBy.createdAt = \"desc\";\n          break;\n        case \"popular\":\n          // Would need to join with order stats\n          orderBy.createdAt = \"desc\";\n          break;\n        default:\n          orderBy.createdAt = \"desc\";\n      }\n    } else {\n      orderBy.createdAt = \"desc\";\n    }\n\n    // Execute queries\n    const [products, total] = await Promise.all([\n      database.product.findMany({\n        where,\n        orderBy,\n        skip,\n        take: limit,\n        include: {\n          farm: {\n            select: {\n              id: true,\n              name: true,\n              slug: true,\n              logoUrl: true,\n              verificationStatus: true,\n            },\n          },\n        },\n      }),\n      database.product.count({ where }),\n    ]);\n\n    return {\n      products: products as unknown as Product[],\n      pagination: {\n        page,\n        limit,\n        total,\n        totalPages: Math.ceil(total / limit),\n        hasMore: skip + products.length < total,\n      },\n    };\n  }\n\n  /**\n   * Update product (owner only)\n   */\n  static async updateProduct(\n    productId: string,\n    updates: UpdateProductInput,\n    userId: string\n  ): Promise<Product> {\n    // 1. Get existing product with farm\n    const existing = await database.product.findUnique({\n      where: { id: productId },\n      include: {\n        farm: {\n          select: { ownerId: true },\n        },\n      },\n    });\n\n    if (!existing) {\n      throw new Error(\"Product not found\");\n    }\n\n    if (existing.farm.ownerId !== userId) {\n      throw new Error(\"Unauthorized: You don't own this product\");\n    }\n\n    // 2. If name changed, regenerate slug\n    let slug = existing.slug;\n    if (updates.name && updates.name !== existing.name) {\n      const baseSlug = generateSlug(updates.name);\n      slug = await ProductService.generateUniqueSlug(baseSlug, existing.farmId);\n    }\n\n    // 3. Calculate derived inventory values if inventory updated\n    let inventoryUpdates = updates.inventory;\n    if (inventoryUpdates && existing.inventory) {\n      const existingInventory = existing.inventory as any;\n      const availableQuantity =\n        (inventoryUpdates.quantity ?? existingInventory.quantity ?? 0) -\n        (inventoryUpdates.reservedQuantity ??\n          existingInventory.reservedQuantity ??\n          0);\n\n      const lowStockThreshold =\n        inventoryUpdates.lowStockThreshold ??\n        existingInventory.lowStockThreshold ??\n        0;\n\n      inventoryUpdates = {\n        ...inventoryUpdates,\n        availableQuantity,\n        isLowStock: availableQuantity <= lowStockThreshold,\n        inStock: availableQuantity > 0,\n      };\n    }\n\n    // 4. Update primary image URL if images changed\n    let primaryPhotoUrl = existing.primaryPhotoUrl || null;\n    if (updates.images) {\n      primaryPhotoUrl =\n        updates.images.find((img) => img.isPrimary)?.url || null;\n    }\n\n    // 5. Apply updates\n    const product = await database.product.update({\n      where: { id: productId },\n      data: {\n        ...(updates as any),\n        slug,\n        inventory: inventoryUpdates as any,\n        primaryPhotoUrl,\n        updatedAt: new Date(),\n      },\n      include: {\n        farm: {\n          select: {\n            id: true,\n            name: true,\n            slug: true,\n            logoUrl: true,\n            verificationStatus: true,\n          },\n        },\n      },\n    });\n\n    return product as unknown as Product;\n  }\n\n  /**\n   * Delete product (soft delete - mark as inactive)\n   */\n  static async deleteProduct(productId: string, userId: string): Promise<void> {\n    // Verify ownership\n    const product = await database.product.findUnique({\n      where: { id: productId },\n      include: {\n        farm: {\n          select: { ownerId: true },\n        },\n      },\n    });\n\n    if (!product) {\n      throw new Error(\"Product not found\");\n    }\n\n    if (product.farm.ownerId !== userId) {\n      throw new Error(\"Unauthorized: You don't own this product\");\n    }\n\n    // Soft delete\n    await database.product.update({\n      where: { id: productId },\n      data: {\n        status: ProductStatus.DISCONTINUED as any,\n        updatedAt: new Date(),\n      },\n    });\n  }\n\n  /**\n   * Update product inventory\n   */\n  static async updateInventory(\n    productId: string,\n    quantity: number,\n    userId: string\n  ): Promise<Product> {\n    const product = await database.product.findUnique({\n      where: { id: productId },\n      include: {\n        farm: {\n          select: { ownerId: true },\n        },\n      },\n    });\n\n    if (!product) {\n      throw new Error(\"Product not found\");\n    }\n\n    if (product.farm.ownerId !== userId) {\n      throw new Error(\"Unauthorized: You don't own this product\");\n    }\n\n    const inventory = (product.inventory as any) || {};\n    const availableQuantity = quantity - (inventory.reservedQuantity || 0);\n    const isLowStock = availableQuantity <= (inventory.lowStockThreshold || 0);\n\n    const updated = await database.product.update({\n      where: { id: productId },\n      data: {\n        inventory: {\n          ...inventory,\n          quantity,\n          availableQuantity,\n          isLowStock,\n          inStock: availableQuantity > 0,\n          lastRestocked: new Date(),\n        } as any,\n        status: (availableQuantity > 0\n          ? ProductStatus.AVAILABLE\n          : ProductStatus.OUT_OF_STOCK) as any,\n      },\n      include: {\n        farm: {\n          select: {\n            id: true,\n            name: true,\n            slug: true,\n            logoUrl: true,\n            verificationStatus: true,\n          },\n        },\n      },\n    });\n\n    return updated as unknown as Product;\n  }\n\n  /**\n   * Get product statistics\n   */\n  static async getProductStats(productId: string): Promise<ProductStats> {\n    // This would integrate with analytics/orders\n    // For now, return basic structure\n    return {\n      productId,\n      views: 0,\n      orders: 0,\n      revenue: 0,\n      reviewCount: 0,\n      inWishlistCount: 0,\n    };\n  }\n\n  /**\n   * Search products by name or description\n   */\n  static async searchProducts(\n    query: string,\n    limit: number = 20\n  ): Promise<Product[]> {\n    const products = await database.product.findMany({\n      where: {\n        status: ProductStatus.AVAILABLE as any,\n        OR: [\n          { name: { contains: query, mode: \"insensitive\" } },\n          { description: { contains: query, mode: \"insensitive\" } },\n        ],\n      },\n      take: limit,\n      orderBy: { createdAt: \"desc\" },\n      include: {\n        farm: {\n          select: {\n            id: true,\n            name: true,\n            slug: true,\n            logoUrl: true,\n            verificationStatus: true,\n          },\n        },\n      },\n    });\n\n    return products as unknown as Product[];\n  }\n\n  /**\n   * Batch update products\n   */\n  static async batchUpdateProducts(\n    productIds: string[],\n    updates: Partial<UpdateProductInput>,\n    userId: string\n  ): Promise<BatchProductResult> {\n    const result: BatchProductResult = {\n      successful: [],\n      failed: [],\n      total: productIds.length,\n      successCount: 0,\n      failureCount: 0,\n    };\n\n    for (const productId of productIds) {\n      try {\n        await this.updateProduct(productId, updates, userId);\n        result.successful.push(productId);\n        result.successCount++;\n      } catch (error) {\n        result.failed.push({\n          productId,\n          error: error instanceof Error ? error.message : \"Unknown error\",\n        });\n        result.failureCount++;\n      }\n    }\n\n    return result;\n  }\n\n  // ============================================\n  // HELPER METHODS\n  // ============================================\n\n  /**\n   * Build where clause for filtering products\n   */\n  private static buildWhereClause(\n    filters: ProductFilters\n  ): Record<string, unknown> {\n    const where: Record<string, unknown> = {};\n\n    // Farm filtering\n    if (filters.farmId) {\n      where.farmId = filters.farmId;\n    }\n    if (filters.farmIds && filters.farmIds.length > 0) {\n      where.farmId = { in: filters.farmIds };\n    }\n\n    // Category filtering\n    if (filters.category) {\n      where.category = filters.category;\n    }\n    if (filters.categories && filters.categories.length > 0) {\n      where.category = { in: filters.categories };\n    }\n    if (filters.subCategory) {\n      where.subCategory = filters.subCategory;\n    }\n\n    // Status filtering\n    if (filters.status) {\n      where.status = filters.status;\n    }\n    if (filters.isActive !== undefined) {\n      where.isActive = filters.isActive;\n    }\n    if (filters.inStock !== undefined) {\n      where.inventory = { inStock: filters.inStock };\n    }\n    if (filters.isFeatured !== undefined) {\n      where.isFeatured = filters.isFeatured;\n    }\n\n    // Attribute filtering\n    if (filters.isOrganic !== undefined) {\n      where.attributes = { path: [\"isOrganic\"], equals: filters.isOrganic };\n    }\n    if (filters.isNonGMO !== undefined) {\n      where.attributes = { path: [\"isNonGMO\"], equals: filters.isNonGMO };\n    }\n\n    // Seasonal filtering\n    if (filters.season) {\n      where.seasons = { has: filters.season };\n    }\n\n    // Price filtering\n    if (filters.minPrice !== undefined || filters.maxPrice !== undefined) {\n      where.pricing = {\n        path: [\"basePrice\", \"amount\"],\n        gte: filters.minPrice,\n        lte: filters.maxPrice,\n      };\n    }\n\n    // Search\n    if (filters.search) {\n      where.OR = [\n        { name: { contains: filters.search, mode: \"insensitive\" } },\n        { description: { contains: filters.search, mode: \"insensitive\" } },\n        { tags: { has: filters.search } },\n      ];\n    }\n\n    return where;\n  }\n\n  /**\n   * Build orderBy clause for sorting products\n   */\n  // @ts-ignore - Reserved for future use\n  private static buildOrderByClause(\n    filters: ProductFilters\n  ): Record<string, unknown> {\n    const orderBy: Record<string, unknown> = {};\n\n    if (filters.sortBy) {\n      switch (filters.sortBy) {\n        case \"name\":\n          orderBy.name = filters.sortOrder || \"asc\";\n          break;\n        case \"price\":\n          orderBy.pricing = {\n            path: [\"basePrice\", \"amount\"],\n            order: filters.sortOrder || \"asc\",\n          };\n          break;\n        case \"newest\":\n          orderBy.createdAt = \"desc\";\n          break;\n        case \"popular\":\n          orderBy.createdAt = \"desc\";\n          break;\n        default:\n          orderBy.createdAt = \"desc\";\n      }\n    } else {\n      orderBy.createdAt = \"desc\";\n    }\n\n    return orderBy;\n  }\n\n  /**\n   * Generate unique slug for product within farm\n   */\n  private static async generateUniqueSlug(\n    baseSlug: string,\n    farmId: string\n  ): Promise<string> {\n    let slug = baseSlug;\n    let counter = 1;\n\n    while (true) {\n      const existing = await database.product.findFirst({\n        where: { slug, farmId },\n      });\n\n      if (!existing) {\n        return slug;\n      }\n\n      slug = `${baseSlug}-${counter}`;\n      counter++;\n    }\n  }\n\n  /**\n   * Validate product data\n   */\n  private static async validateProduct(\n    input: CreateProductInput | UpdateProductInput\n  ): Promise<ProductValidation> {\n    const errors: { field: string; message: string }[] = [];\n\n    // Name validation\n    if (\"name\" in input) {\n      if (!input.name || input.name.trim() === \"\") {\n        errors.push({\n          field: \"name\",\n          message: \"Product name is required\",\n        });\n      } else if (input.name.length < 3) {\n        errors.push({\n          field: \"name\",\n          message: \"Product name must be at least 3 characters\",\n        });\n      } else if (input.name.length > 100) {\n        errors.push({\n          field: \"name\",\n          message: \"Product name must not exceed 100 characters\",\n        });\n      }\n    }\n\n    // Price validation\n    if (\"pricing\" in input && input.pricing) {\n      if (input.pricing.basePrice.amount <= 0) {\n        errors.push({\n          field: \"pricing.basePrice.amount\",\n          message: \"Price must be greater than 0\",\n        });\n      }\n    }\n\n    // Inventory validation\n    if (\"inventory\" in input && input.inventory) {\n      if (input.inventory.quantity < 0) {\n        errors.push({\n          field: \"inventory.quantity\",\n          message: \"Quantity cannot be negative\",\n        });\n      }\n      if (input.inventory.reservedQuantity < 0) {\n        errors.push({\n          field: \"inventory.reservedQuantity\",\n          message: \"Reserved quantity cannot be negative\",\n        });\n      }\n      if (input.inventory.reservedQuantity > input.inventory.quantity) {\n        errors.push({\n          field: \"inventory.reservedQuantity\",\n          message: \"Reserved quantity cannot exceed total quantity\",\n        });\n      }\n    }\n\n    return {\n      isValid: errors.length === 0,\n      errors,\n    };\n  }\n}\n"],"version":3}