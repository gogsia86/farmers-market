{"file":"M:\\Repo\\Farmers Market Platform web and app\\src\\lib\\services\\order.service.ts","mappings":"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","names":[],"sources":["M:\\Repo\\Farmers Market Platform web and app\\src\\lib\\services\\order.service.ts"],"sourcesContent":["/**\n * ðŸ“¦ ORDER SERVICE\n * Handles order creation, management, and tracking\n */\n\nimport { database } from \"@/lib/database\";\nimport type { Order, OrderItem } from \"@prisma/client\";\n\nexport interface CreateOrderInput {\n  userId: string;\n  farmId: string;\n  items: Array<{\n    productId: string;\n    productName: string;\n    quantity: number;\n    price: number;\n    unit: string;\n  }>;\n  shippingAddress: {\n    street: string;\n    city: string;\n    state: string;\n    zipCode: string;\n    country?: string;\n  };\n  fulfillmentMethod: \"DELIVERY\" | \"FARM_PICKUP\" | \"MARKET_PICKUP\";\n  notes?: string;\n}\n\nexport interface OrderWithDetails extends Order {\n  items: OrderItem[];\n  farm: {\n    id: string;\n    name: string;\n  };\n}\n\nexport class OrderService {\n  /**\n   * Create new order\n   */\n  static async createOrder(input: CreateOrderInput): Promise<OrderWithDetails> {\n    const { userId, farmId, items, shippingAddress, fulfillmentMethod, notes } =\n      input;\n\n    // Calculate totals\n    const subtotal = items.reduce(\n      (sum, item) => sum + item.price * item.quantity,\n      0\n    );\n    const tax = subtotal * 0.08; // 8% tax\n    const platformFee = subtotal * 0.15; // 15% platform commission\n    const farmerAmount = subtotal - platformFee;\n    const total = subtotal + tax;\n\n    // Generate order number\n    const orderNumber = `FM-${Date.now()}-${Math.random().toString(36).substring(2, 8).toUpperCase()}`;\n\n    // Create order with items\n    const order = await database.order.create({\n      data: {\n        orderNumber,\n        customerId: userId,\n        farmId,\n        status: \"PENDING\",\n        paymentStatus: \"PENDING\",\n        subtotal,\n        tax,\n        platformFee,\n        farmerAmount,\n        total,\n        deliveryFee: 0,\n        discount: 0,\n        fulfillmentMethod,\n        shippingAddress: JSON.stringify(shippingAddress),\n        specialInstructions: notes,\n        items: {\n          create: items.map((item) => ({\n            productId: item.productId,\n            productName: item.productName,\n            quantity: item.quantity,\n            unit: item.unit,\n            unitPrice: item.price,\n            subtotal: item.price * item.quantity,\n          })),\n        },\n      },\n      include: {\n        items: true,\n        farm: {\n          select: {\n            id: true,\n            name: true,\n          },\n        },\n      },\n    });\n\n    return order as OrderWithDetails;\n  }\n\n  /**\n   * Get order by ID\n   */\n  static async getOrderById(orderId: string): Promise<OrderWithDetails | null> {\n    const order = await database.order.findUnique({\n      where: { id: orderId },\n      include: {\n        items: true,\n        farm: {\n          select: {\n            id: true,\n            name: true,\n          },\n        },\n      },\n    });\n\n    return order as OrderWithDetails | null;\n  }\n\n  /**\n   * Update order status\n   */\n  static async updateOrderStatus(\n    orderId: string,\n    status:\n      | \"PENDING\"\n      | \"CONFIRMED\"\n      | \"PREPARING\"\n      | \"READY\"\n      | \"FULFILLED\"\n      | \"COMPLETED\"\n      | \"CANCELLED\"\n  ): Promise<Order> {\n    return database.order.update({\n      where: { id: orderId },\n      data: { status },\n    });\n  }\n\n  /**\n   * Get orders for user\n   */\n  static async getUserOrders(userId: string): Promise<OrderWithDetails[]> {\n    const orders = await database.order.findMany({\n      where: { customerId: userId },\n      include: {\n        items: true,\n        farm: {\n          select: {\n            id: true,\n            name: true,\n          },\n        },\n      },\n      orderBy: { createdAt: \"desc\" },\n    });\n\n    return orders as OrderWithDetails[];\n  }\n\n  /**\n   * Get orders for farm\n   */\n  static async getFarmOrders(farmId: string): Promise<OrderWithDetails[]> {\n    const orders = await database.order.findMany({\n      where: { farmId },\n      include: {\n        items: true,\n        farm: {\n          select: {\n            id: true,\n            name: true,\n          },\n        },\n      },\n      orderBy: { createdAt: \"desc\" },\n    });\n\n    return orders as OrderWithDetails[];\n  }\n}\n"],"version":3}