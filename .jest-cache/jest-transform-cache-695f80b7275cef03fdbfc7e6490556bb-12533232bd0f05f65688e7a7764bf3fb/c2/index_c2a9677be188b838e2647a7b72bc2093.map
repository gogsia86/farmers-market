{"file":"M:\\Repo\\Farmers Market Platform web and app\\src\\lib\\database\\index.ts","mappings":"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","names":[],"sources":["M:\\Repo\\Farmers Market Platform web and app\\src\\lib\\database\\index.ts"],"sourcesContent":["/**\n * ðŸ—„ï¸ PRISMA DATABASE SINGLETON\n * Divine database connection with quantum consciousness\n * @reference .github/instructions/07_DATABASE_QUANTUM_MASTERY.instructions.md\n */\nimport { PrismaClient } from \"@prisma/client\";\n\ndeclare global {\n  // eslint-disable-next-line no-var\n  var prisma: PrismaClient | undefined;\n  // eslint-disable-next-line no-var\n  var databaseConnected: boolean | undefined;\n}\n\nlet connectionAttempts = 0;\nconst MAX_RETRIES = 3;\nconst RETRY_DELAY = 2000; // 2 seconds\n\n// Prisma v7 configuration with adapter support\nconst createPrismaClient = () => {\n  const client = new PrismaClient({\n    log:\n      process.env.NODE_ENV === \"development\"\n        ? [\"query\", \"error\", \"warn\"]\n        : [\"error\"],\n    // Prisma v7: Pass datasourceUrl via client config\n    datasourceUrl: process.env.DATABASE_URL,\n  });\n\n  return client;\n};\n\n// Sleep utility for retries\nconst sleep = (ms: number) => new Promise((resolve) => setTimeout(resolve, ms));\n\n// Enhanced connection handling with retries\nconst connectWithRetry = async (client: PrismaClient) => {\n  while (connectionAttempts < MAX_RETRIES) {\n    try {\n      await client.$connect();\n      console.log(\"âœ… Database connection established successfully\");\n      globalThis.databaseConnected = true;\n      return;\n    } catch (error) {\n      connectionAttempts++;\n      console.warn(\n        `âš ï¸  Database connection attempt ${connectionAttempts}/${MAX_RETRIES} failed:`,\n        error instanceof Error ? error.message : error\n      );\n\n      if (connectionAttempts < MAX_RETRIES) {\n        console.log(`ðŸ”„ Retrying in ${RETRY_DELAY / 1000} seconds...`);\n        await sleep(RETRY_DELAY);\n      } else {\n        console.error(\n          \"âŒ Database connection failed after\",\n          MAX_RETRIES,\n          \"attempts\"\n        );\n        console.error(\"âš ï¸  Server will start but database operations will fail\");\n        console.error(\n          \"ðŸ’¡ Tip: Make sure PostgreSQL is running and DATABASE_URL is correct\"\n        );\n        globalThis.databaseConnected = false;\n        // Don't exit - allow server to start for development\n        if (process.env.NODE_ENV === \"production\") {\n          throw error;\n        }\n      }\n    }\n  }\n};\n\n// Initialize with logging configuration based on environment\nconst initializeDatabase = () => {\n  const client = createPrismaClient();\n\n  // Attempt connection asynchronously (non-blocking)\n  connectWithRetry(client).catch((error) => {\n    console.error(\"ðŸš¨ Fatal database connection error:\", error);\n  });\n\n  return client;\n};\n\nexport const database = globalThis.prisma ?? initializeDatabase();\n\n// Prevent hot reload from creating new instances in development\nif (process.env.NODE_ENV !== \"production\") {\n  globalThis.prisma = database;\n}\n\n// Helper to check database connection status\nexport const isDatabaseConnected = () => globalThis.databaseConnected ?? false;\n\n// Re-export as both database and prisma for compatibility\nexport const prisma = database;\nexport default database;\n"],"version":3}