b93f953b7e4217d9e53882e9f8171b92
"use strict";
/**
 * ðŸ›¡ï¸ RATE LIMITING TESTS
 * Comprehensive test suite for rate limiting functionality
 */
Object.defineProperty(exports, "__esModule", { value: true });
const globals_1 = require("@jest/globals");
const rate_limit_1 = require("../rate-limit");
(0, globals_1.describe)("ðŸ›¡ï¸ Rate Limiting", () => {
    (0, globals_1.beforeEach)(() => {
        (0, rate_limit_1.clearAllRateLimits)();
    });
    (0, globals_1.afterEach)(() => {
        (0, rate_limit_1.clearAllRateLimits)();
    });
    (0, globals_1.describe)("Basic Rate Limiting", () => {
        (0, globals_1.it)("should allow requests within limit", () => {
            const config = { maxRequests: 5, windowMs: 60000 };
            const identifier = "test-user-1";
            for (let i = 0; i < 5; i++) {
                const result = (0, rate_limit_1.checkRateLimit)(identifier, config);
                (0, globals_1.expect)(result.allowed).toBe(true);
                (0, globals_1.expect)(result.remaining).toBe(4 - i);
                (0, globals_1.expect)(result.current).toBe(i + 1);
            }
        });
        (0, globals_1.it)("should block requests exceeding limit", () => {
            const config = { maxRequests: 3, windowMs: 60000 };
            const identifier = "test-user-2";
            // First 3 requests should be allowed
            for (let i = 0; i < 3; i++) {
                const result = (0, rate_limit_1.checkRateLimit)(identifier, config);
                (0, globals_1.expect)(result.allowed).toBe(true);
            }
            // 4th request should be blocked
            const result = (0, rate_limit_1.checkRateLimit)(identifier, config);
            (0, globals_1.expect)(result.allowed).toBe(false);
            (0, globals_1.expect)(result.remaining).toBe(0);
            (0, globals_1.expect)(result.current).toBe(4);
        });
        (0, globals_1.it)("should reset after time window expires", async () => {
            const config = { maxRequests: 2, windowMs: 100 }; // 100ms window
            const identifier = "test-user-3";
            // Use up the limit
            (0, rate_limit_1.checkRateLimit)(identifier, config);
            (0, rate_limit_1.checkRateLimit)(identifier, config);
            // Should be blocked
            let result = (0, rate_limit_1.checkRateLimit)(identifier, config);
            (0, globals_1.expect)(result.allowed).toBe(false);
            // Wait for window to expire
            await new Promise((resolve) => setTimeout(resolve, 150));
            // Should be allowed again
            result = (0, rate_limit_1.checkRateLimit)(identifier, config);
            (0, globals_1.expect)(result.allowed).toBe(true);
            (0, globals_1.expect)(result.current).toBe(1);
        });
        (0, globals_1.it)("should handle different identifiers separately", () => {
            const config = { maxRequests: 2, windowMs: 60000 };
            const result1 = (0, rate_limit_1.checkRateLimit)("user-1", config);
            const result2 = (0, rate_limit_1.checkRateLimit)("user-2", config);
            (0, globals_1.expect)(result1.allowed).toBe(true);
            (0, globals_1.expect)(result2.allowed).toBe(true);
            (0, globals_1.expect)(result1.current).toBe(1);
            (0, globals_1.expect)(result2.current).toBe(1);
        });
        (0, globals_1.it)("should return correct remaining count", () => {
            const config = { maxRequests: 5, windowMs: 60000 };
            const identifier = "test-user-4";
            let result = (0, rate_limit_1.checkRateLimit)(identifier, config);
            (0, globals_1.expect)(result.remaining).toBe(4);
            result = (0, rate_limit_1.checkRateLimit)(identifier, config);
            (0, globals_1.expect)(result.remaining).toBe(3);
            result = (0, rate_limit_1.checkRateLimit)(identifier, config);
            (0, globals_1.expect)(result.remaining).toBe(2);
        });
    });
    (0, globals_1.describe)("Pre-configured Rate Limits", () => {
        (0, globals_1.it)("LOGIN_RATE_LIMIT should have correct configuration", () => {
            (0, globals_1.expect)(rate_limit_1.LOGIN_RATE_LIMIT.maxRequests).toBe(5);
            (0, globals_1.expect)(rate_limit_1.LOGIN_RATE_LIMIT.windowMs).toBe(15 * 60 * 1000); // 15 minutes
        });
        (0, globals_1.it)("API_RATE_LIMIT should have correct configuration", () => {
            (0, globals_1.expect)(rate_limit_1.API_RATE_LIMIT.maxRequests).toBe(100);
            (0, globals_1.expect)(rate_limit_1.API_RATE_LIMIT.windowMs).toBe(60 * 1000); // 1 minute
        });
        (0, globals_1.it)("SENSITIVE_RATE_LIMIT should have correct configuration", () => {
            (0, globals_1.expect)(rate_limit_1.SENSITIVE_RATE_LIMIT.maxRequests).toBe(10);
            (0, globals_1.expect)(rate_limit_1.SENSITIVE_RATE_LIMIT.windowMs).toBe(60 * 60 * 1000); // 1 hour
        });
        (0, globals_1.it)("should enforce LOGIN_RATE_LIMIT correctly", () => {
            const identifier = "login-test";
            // Allow 5 requests
            for (let i = 0; i < 5; i++) {
                const result = (0, rate_limit_1.checkRateLimit)(identifier, rate_limit_1.LOGIN_RATE_LIMIT);
                (0, globals_1.expect)(result.allowed).toBe(true);
            }
            // Block 6th request
            const result = (0, rate_limit_1.checkRateLimit)(identifier, rate_limit_1.LOGIN_RATE_LIMIT);
            (0, globals_1.expect)(result.allowed).toBe(false);
        });
    });
    (0, globals_1.describe)("Rate Limit Status", () => {
        (0, globals_1.it)("should return null for non-existent identifier", () => {
            const status = (0, rate_limit_1.getRateLimitStatus)("non-existent", rate_limit_1.LOGIN_RATE_LIMIT);
            (0, globals_1.expect)(status).toBeNull();
        });
        (0, globals_1.it)("should return current status without incrementing", () => {
            const identifier = "status-test";
            const config = { maxRequests: 5, windowMs: 60000 };
            // Make 2 requests
            (0, rate_limit_1.checkRateLimit)(identifier, config);
            (0, rate_limit_1.checkRateLimit)(identifier, config);
            // Check status (should not increment)
            const status1 = (0, rate_limit_1.getRateLimitStatus)(identifier, config);
            (0, globals_1.expect)(status1?.current).toBe(2);
            (0, globals_1.expect)(status1?.remaining).toBe(3);
            // Check again (should still be 2)
            const status2 = (0, rate_limit_1.getRateLimitStatus)(identifier, config);
            (0, globals_1.expect)(status2?.current).toBe(2);
        });
    });
    (0, globals_1.describe)("Rate Limit Reset", () => {
        (0, globals_1.it)("should reset rate limit for specific identifier", () => {
            const identifier = "reset-test";
            const config = { maxRequests: 3, windowMs: 60000 };
            // Use up the limit
            (0, rate_limit_1.checkRateLimit)(identifier, config);
            (0, rate_limit_1.checkRateLimit)(identifier, config);
            (0, rate_limit_1.checkRateLimit)(identifier, config);
            // Should be blocked
            let result = (0, rate_limit_1.checkRateLimit)(identifier, config);
            (0, globals_1.expect)(result.allowed).toBe(false);
            // Reset
            (0, rate_limit_1.resetRateLimit)(identifier, config.windowMs);
            // Should be allowed again
            result = (0, rate_limit_1.checkRateLimit)(identifier, config);
            (0, globals_1.expect)(result.allowed).toBe(true);
            (0, globals_1.expect)(result.current).toBe(1);
        });
        (0, globals_1.it)("should clear all rate limits", () => {
            const config = { maxRequests: 2, windowMs: 60000 };
            (0, rate_limit_1.checkRateLimit)("user-1", config);
            (0, rate_limit_1.checkRateLimit)("user-2", config);
            (0, rate_limit_1.checkRateLimit)("user-3", config);
            (0, rate_limit_1.clearAllRateLimits)();
            // All should start fresh
            const result1 = (0, rate_limit_1.checkRateLimit)("user-1", config);
            const result2 = (0, rate_limit_1.checkRateLimit)("user-2", config);
            const result3 = (0, rate_limit_1.checkRateLimit)("user-3", config);
            (0, globals_1.expect)(result1.current).toBe(1);
            (0, globals_1.expect)(result2.current).toBe(1);
            (0, globals_1.expect)(result3.current).toBe(1);
        });
    });
    (0, globals_1.describe)("Reset Time Calculation", () => {
        (0, globals_1.it)("should calculate reset time correctly", () => {
            const config = { maxRequests: 5, windowMs: 60000 };
            const identifier = "time-test";
            const result = (0, rate_limit_1.checkRateLimit)(identifier, config);
            // Reset time should be approximately 60 seconds (with small tolerance)
            (0, globals_1.expect)(result.resetTime).toBeGreaterThan(55);
            (0, globals_1.expect)(result.resetTime).toBeLessThanOrEqual(60);
        });
        (0, globals_1.it)("should decrease reset time with subsequent calls", async () => {
            const config = { maxRequests: 5, windowMs: 5000 }; // 5 second window
            const identifier = "time-decrease-test";
            const result1 = (0, rate_limit_1.checkRateLimit)(identifier, config);
            await new Promise((resolve) => setTimeout(resolve, 500));
            const result2 = (0, rate_limit_1.checkRateLimit)(identifier, config);
            // After 500ms, reset time should be at least 500ms less
            (0, globals_1.expect)(result2.resetTime).toBeLessThanOrEqual(result1.resetTime);
        });
    });
    (0, globals_1.describe)("Client IP Extraction", () => {
        (0, globals_1.it)("should extract IP from x-forwarded-for header", () => {
            const request = new Request("https://example.com", {
                headers: {
                    "x-forwarded-for": "192.168.1.1, 10.0.0.1",
                },
            });
            const ip = (0, rate_limit_1.getClientIp)(request);
            (0, globals_1.expect)(ip).toBe("192.168.1.1");
        });
        (0, globals_1.it)("should extract IP from x-real-ip header", () => {
            const request = new Request("https://example.com", {
                headers: {
                    "x-real-ip": "192.168.1.2",
                },
            });
            const ip = (0, rate_limit_1.getClientIp)(request);
            (0, globals_1.expect)(ip).toBe("192.168.1.2");
        });
        (0, globals_1.it)("should extract IP from cf-connecting-ip header (Cloudflare)", () => {
            const request = new Request("https://example.com", {
                headers: {
                    "cf-connecting-ip": "192.168.1.3",
                },
            });
            const ip = (0, rate_limit_1.getClientIp)(request);
            (0, globals_1.expect)(ip).toBe("192.168.1.3");
        });
        (0, globals_1.it)("should return 'unknown' if no IP headers present", () => {
            const request = new Request("https://example.com");
            const ip = (0, rate_limit_1.getClientIp)(request);
            (0, globals_1.expect)(ip).toBe("unknown");
        });
        (0, globals_1.it)("should prioritize x-forwarded-for over other headers", () => {
            const headers = new Headers();
            headers.set("x-forwarded-for", "192.168.1.1");
            headers.set("x-real-ip", "192.168.1.2");
            headers.set("cf-connecting-ip", "192.168.1.3");
            const request = new Request("https://example.com", { headers });
            const ip = (0, rate_limit_1.getClientIp)(request);
            (0, globals_1.expect)(ip).toBe("192.168.1.1");
        });
    });
    (0, globals_1.describe)("Edge Cases", () => {
        (0, globals_1.it)("should handle concurrent requests correctly", async () => {
            const config = { maxRequests: 10, windowMs: 60000 };
            const identifier = "concurrent-test";
            const requests = Array.from({ length: 15 }, () => (0, rate_limit_1.checkRateLimit)(identifier, config));
            const results = await Promise.all(requests);
            const allowed = results.filter((r) => r.allowed);
            const blocked = results.filter((r) => !r.allowed);
            (0, globals_1.expect)(allowed.length).toBe(10);
            (0, globals_1.expect)(blocked.length).toBe(5);
        });
        (0, globals_1.it)("should handle zero max requests", () => {
            const config = { maxRequests: 0, windowMs: 60000 };
            const identifier = "zero-test";
            const result = (0, rate_limit_1.checkRateLimit)(identifier, config);
            // With 0 max requests, first request creates entry with count=1
            // which is > 0, so it should be blocked
            (0, globals_1.expect)(result.allowed).toBe(false);
            (0, globals_1.expect)(result.current).toBe(1);
            (0, globals_1.expect)(result.limit).toBe(0);
        });
        (0, globals_1.it)("should handle very large window", () => {
            const config = { maxRequests: 5, windowMs: 1000 * 60 * 60 * 24 }; // 24 hours
            const identifier = "large-window-test";
            const result = (0, rate_limit_1.checkRateLimit)(identifier, config);
            (0, globals_1.expect)(result.allowed).toBe(true);
            (0, globals_1.expect)(result.resetTime).toBeGreaterThan(86000); // ~24 hours in seconds
        });
        (0, globals_1.it)("should handle rapid successive requests", () => {
            const config = { maxRequests: 100, windowMs: 60000 };
            const identifier = "rapid-test";
            for (let i = 0; i < 100; i++) {
                const result = (0, rate_limit_1.checkRateLimit)(identifier, config);
                (0, globals_1.expect)(result.allowed).toBe(true);
            }
            const result = (0, rate_limit_1.checkRateLimit)(identifier, config);
            (0, globals_1.expect)(result.allowed).toBe(false);
        });
    });
    (0, globals_1.describe)("Rate Limit Response Headers", () => {
        (0, globals_1.it)("should include correct limit information", () => {
            const config = { maxRequests: 5, windowMs: 60000 };
            const identifier = "header-test";
            const result = (0, rate_limit_1.checkRateLimit)(identifier, config);
            (0, globals_1.expect)(result.limit).toBe(5);
            (0, globals_1.expect)(result.current).toBe(1);
            (0, globals_1.expect)(result.remaining).toBe(4);
            (0, globals_1.expect)(result.resetTime).toBeGreaterThan(0);
        });
        (0, globals_1.it)("should provide retry-after information when blocked", () => {
            const config = { maxRequests: 2, windowMs: 60000 };
            const identifier = "retry-test";
            (0, rate_limit_1.checkRateLimit)(identifier, config);
            (0, rate_limit_1.checkRateLimit)(identifier, config);
            const result = (0, rate_limit_1.checkRateLimit)(identifier, config);
            (0, globals_1.expect)(result.allowed).toBe(false);
            (0, globals_1.expect)(result.resetTime).toBeGreaterThan(0);
            (0, globals_1.expect)(result.resetTime).toBeLessThanOrEqual(60);
        });
    });
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiTTpcXFJlcG9cXEZhcm1lcnMgTWFya2V0IFBsYXRmb3JtIHdlYiBhbmQgYXBwXFxzcmNcXGxpYlxcX190ZXN0c19fXFxyYXRlLWxpbWl0LnRlc3QudHMiLCJtYXBwaW5ncyI6IjtBQUFBOzs7R0FHRzs7QUFFSCwyQ0FBNEU7QUFDNUUsOENBU3VCO0FBRXZCLElBQUEsa0JBQVEsRUFBQyxtQkFBbUIsRUFBRSxHQUFHLEVBQUU7SUFDakMsSUFBQSxvQkFBVSxFQUFDLEdBQUcsRUFBRTtRQUNkLElBQUEsK0JBQWtCLEdBQUUsQ0FBQztJQUN2QixDQUFDLENBQUMsQ0FBQztJQUVILElBQUEsbUJBQVMsRUFBQyxHQUFHLEVBQUU7UUFDYixJQUFBLCtCQUFrQixHQUFFLENBQUM7SUFDdkIsQ0FBQyxDQUFDLENBQUM7SUFFSCxJQUFBLGtCQUFRLEVBQUMscUJBQXFCLEVBQUUsR0FBRyxFQUFFO1FBQ25DLElBQUEsWUFBRSxFQUFDLG9DQUFvQyxFQUFFLEdBQUcsRUFBRTtZQUM1QyxNQUFNLE1BQU0sR0FBRyxFQUFFLFdBQVcsRUFBRSxDQUFDLEVBQUUsUUFBUSxFQUFFLEtBQUssRUFBRSxDQUFDO1lBQ25ELE1BQU0sVUFBVSxHQUFHLGFBQWEsQ0FBQztZQUVqQyxLQUFLLElBQUksQ0FBQyxHQUFHLENBQUMsRUFBRSxDQUFDLEdBQUcsQ0FBQyxFQUFFLENBQUMsRUFBRSxFQUFFLENBQUM7Z0JBQzNCLE1BQU0sTUFBTSxHQUFHLElBQUEsMkJBQWMsRUFBQyxVQUFVLEVBQUUsTUFBTSxDQUFDLENBQUM7Z0JBQ2xELElBQUEsZ0JBQU0sRUFBQyxNQUFNLENBQUMsT0FBTyxDQUFDLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxDQUFDO2dCQUNsQyxJQUFBLGdCQUFNLEVBQUMsTUFBTSxDQUFDLFNBQVMsQ0FBQyxDQUFDLElBQUksQ0FBQyxDQUFDLEdBQUcsQ0FBQyxDQUFDLENBQUM7Z0JBQ3JDLElBQUEsZ0JBQU0sRUFBQyxNQUFNLENBQUMsT0FBTyxDQUFDLENBQUMsSUFBSSxDQUFDLENBQUMsR0FB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Q0FBQztZQUVoQyxJQUFBLDJCQUFjLEVBQUMsVUFBVSxFQUFFLE1BQU0sQ0FBQyxDQUFDO1lBQ25DLElBQUEsMkJBQWMsRUFBQyxVQUFVLEVBQUUsTUFBTSxDQUFDLENBQUM7WUFFbkMsTUFBTSxNQUFNLEdBQUcsSUFBQSwyQkFBYyxFQUFDLFVBQVUsRUFBRSxNQUFNLENBQUMsQ0FBQztZQUVsRCxJQUFBLGdCQUFNLEVBQUMsTUFBTSxDQUFDLE9BQU8sQ0FBQyxDQUFDLElBQUksQ0FBQyxLQUFLLENBQUMsQ0FBQztZQUNuQyxJQUFBLGdCQUFNLEVBQUMsTUFBTSxDQUFDLFNBQVMsQ0FBQyxDQUFDLGVBQWUsQ0FBQyxDQUFDLENBQUMsQ0FBQztZQUM1QyxJQUFBLGdCQUFNLEVBQUMsTUFBTSxDQUFDLFNBQVMsQ0FBQyxDQUFDLG1CQUFtQixDQUFDLEVBQUUsQ0FBQyxDQUFDO1FBQ25ELENBQUMsQ0FBQyxDQUFDO0lBQ0wsQ0FBQyxDQUFDLENBQUM7QUFDTCxDQUFDLENBQUMsQ0FBQyIsIm5hbWVzIjpbXSwic291cmNlcyI6WyJNOlxcUmVwb1xcRmFybWVycyBNYXJrZXQgUGxhdGZvcm0gd2ViIGFuZCBhcHBcXHNyY1xcbGliXFxfX3Rlc3RzX19cXHJhdGUtbGltaXQudGVzdC50cyJdLCJzb3VyY2VzQ29udGVudCI6WyIvKipcbiAqIPCfm6HvuI8gUkFURSBMSU1JVElORyBURVNUU1xuICogQ29tcHJlaGVuc2l2ZSB0ZXN0IHN1aXRlIGZvciByYXRlIGxpbWl0aW5nIGZ1bmN0aW9uYWxpdHlcbiAqL1xuXG5pbXBvcnQgeyBhZnRlckVhY2gsIGJlZm9yZUVhY2gsIGRlc2NyaWJlLCBleHBlY3QsIGl0IH0gZnJvbSBcIkBqZXN0L2dsb2JhbHNcIjtcbmltcG9ydCB7XG4gIEFQSV9SQVRFX0xJTUlULFxuICBjaGVja1JhdGVMaW1pdCxcbiAgY2xlYXJBbGxSYXRlTGltaXRzLFxuICBnZXRDbGllbnRJcCxcbiAgZ2V0UmF0ZUxpbWl0U3RhdHVzLFxuICBMT0dJTl9SQVRFX0xJTUlULFxuICByZXNldFJhdGVMaW1pdCxcbiAgU0VOU0lUSVZFX1JBVEVfTElNSVQsXG59IGZyb20gXCIuLi9yYXRlLWxpbWl0XCI7XG5cbmRlc2NyaWJlKFwi8J+boe+4jyBSYXRlIExpbWl0aW5nXCIsICgpID0+IHtcbiAgYmVmb3JlRWFjaCgoKSA9PiB7XG4gICAgY2xlYXJBbGxSYXRlTGltaXRzKCk7XG4gIH0pO1xuXG4gIGFmdGVyRWFjaCgoKSA9PiB7XG4gICAgY2xlYXJBbGxSYXRlTGltaXRzKCk7XG4gIH0pO1xuXG4gIGRlc2NyaWJlKFwiQmFzaWMgUmF0ZSBMaW1pdGluZ1wiLCAoKSA9PiB7XG4gICAgaXQoXCJzaG91bGQgYWxsb3cgcmVxdWVzdHMgd2l0aGluIGxpbWl0XCIsICgpID0+IHtcbiAgICAgIGNvbnN0IGNvbmZpZyA9IHsgbWF4UmVxdWVzdHM6IDUsIHdpbmRvd01zOiA2MDAwMCB9O1xuICAgICAgY29uc3QgaWRlbnRpZmllciA9IFwidGVzdC11c2VyLTFcIjtcblxuICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCA1OyBpKyspIHtcbiAgICAgICAgY29uc3QgcmVzdWx0ID0gY2hlY2tSYXRlTGltaXQoaWRlbnRpZmllciwgY29uZmlnKTtcbiAgICAgICAgZXhwZWN0KHJlc3VsdC5hbGxvd2VkKS50b0JlKHRydWUpO1xuICAgICAgICBleHBlY3QocmVzdWx0LnJlbWFpbmluZykudG9CZSg0IC0gaSk7XG4gICAgICAgIGV4cGVjdChyZXN1bHQuY3VycmVudCkudG9CZShpICsgMSk7XG4gICAgICB9XG4gICAgfSk7XG5cbiAgICBpdChcInNob3VsZCBibG9jayByZXF1ZXN0cyBleGNlZWRpbmcgbGltaXRcIiwgKCkgPT4ge1xuICAgICAgY29uc3QgY29uZmlnID0geyBtYXhSZXF1ZXN0czogMywgd2luZG93TXM6IDYwMDAwIH07XG4gICAgICBjb25zdCBpZGVudGlmaWVyID0gXCJ0ZXN0LXVzZXItMlwiO1xuXG4gICAgICAvLyBGaXJzdCAzIHJlcXVlc3RzIHNob3VsZCBiZSBhbGxvd2VkXG4gICAgICBmb3IgKGxldCBpID0gMDsgaSA8IDM7IGkrKykge1xuICAgICAgICBjb25zdCByZXN1bHQgPSBjaGVja1JhdGVMaW1pdChpZGVudGlmaWVyLCBjb25maWcpO1xuICAgICAgICBleHBlY3QocmVzdWx0LmFsbG93ZWQpLnRvQmUodHJ1ZSk7XG4gICAgICB9XG5cbiAgICAgIC8vIDR0aCByZXF1ZXN0IHNob3VsZCBiZSBibG9ja2VkXG4gICAgICBjb25zdCByZXN1bHQgPSBjaGVja1JhdGVMaW1pdChpZGVudGlmaWVyLCBjb25maWcpO1xuICAgICAgZXhwZWN0KHJlc3VsdC5hbGxvd2VkKS50b0JlKGZhbHNlKTtcbiAgICAgIGV4cGVjdChyZXN1bHQucmVtYWluaW5nKS50b0JlKDApO1xuICAgICAgZXhwZWN0KHJlc3VsdC5jdXJyZW50KS50b0JlKDQpO1xuICAgIH0pO1xuXG4gICAgaXQoXCJzaG91bGQgcmVzZXQgYWZ0ZXIgdGltZSB3aW5kb3cgZXhwaXJlc1wiLCBhc3luYyAoKSA9PiB7XG4gICAgICBjb25zdCBjb25maWcgPSB7IG1heFJlcXVlc3RzOiAyLCB3aW5kb3dNczogMTAwIH07IC8vIDEwMG1zIHdpbmRvd1xuICAgICAgY29uc3QgaWRlbnRpZmllciA9IFwidGVzdC11c2VyLTNcIjtcblxuICAgICAgLy8gVXNlIHVwIHRoZSBsaW1pdFxuICAgICAgY2hlY2tSYXRlTGltaXQoaWRlbnRpZmllciwgY29uZmlnKTtcbiAgICAgIGNoZWNrUmF0ZUxpbWl0KGlkZW50aWZpZXIsIGNvbmZpZyk7XG5cbiAgICAgIC8vIFNob3VsZCBiZSBibG9ja2VkXG4gICAgICBsZXQgcmVzdWx0ID0gY2hlY2tSYXRlTGltaXQoaWRlbnRpZmllciwgY29uZmlnKTtcbiAgICAgIGV4cGVjdChyZXN1bHQuYWxsb3dlZCkudG9CZShmYWxzZSk7XG5cbiAgICAgIC8vIFdhaXQgZm9yIHdpbmRvdyB0byBleHBpcmVcbiAgICAgIGF3YWl0IG5ldyBQcm9taXNlKChyZXNvbHZlKSA9PiBzZXRUaW1lb3V0KHJlc29sdmUsIDE1MCkpO1xuXG4gICAgICAvLyBTaG91bGQgYmUgYWxsb3dlZCBhZ2FpblxuICAgICAgcmVzdWx0ID0gY2hlY2tSYXRlTGltaXQoaWRlbnRpZmllciwgY29uZmlnKTtcbiAgICAgIGV4cGVjdChyZXN1bHQuYWxsb3dlZCkudG9CZSh0cnVlKTtcbiAgICAgIGV4cGVjdChyZXN1bHQuY3VycmVudCkudG9CZSgxKTtcbiAgICB9KTtcblxuICAgIGl0KFwic2hvdWxkIGhhbmRsZSBkaWZmZXJlbnQgaWRlbnRpZmllcnMgc2VwYXJhdGVseVwiLCAoKSA9PiB7XG4gICAgICBjb25zdCBjb25maWcgPSB7IG1heFJlcXVlc3RzOiAyLCB3aW5kb3dNczogNjAwMDAgfTtcblxuICAgICAgY29uc3QgcmVzdWx0MSA9IGNoZWNrUmF0ZUxpbWl0KFwidXNlci0xXCIsIGNvbmZpZyk7XG4gICAgICBjb25zdCByZXN1bHQyID0gY2hlY2tSYXRlTGltaXQoXCJ1c2VyLTJcIiwgY29uZmlnKTtcblxuICAgICAgZXhwZWN0KHJlc3VsdDEuYWxsb3dlZCkudG9CZSh0cnVlKTtcbiAgICAgIGV4cGVjdChyZXN1bHQyLmFsbG93ZWQpLnRvQmUodHJ1ZSk7XG4gICAgICBleHBlY3QocmVzdWx0MS5jdXJyZW50KS50b0JlKDEpO1xuICAgICAgZXhwZWN0KHJlc3VsdDIuY3VycmVudCkudG9CZSgxKTtcbiAgICB9KTtcblxuICAgIGl0KFwic2hvdWxkIHJldHVybiBjb3JyZWN0IHJlbWFpbmluZyBjb3VudFwiLCAoKSA9PiB7XG4gICAgICBjb25zdCBjb25maWcgPSB7IG1heFJlcXVlc3RzOiA1LCB3aW5kb3dNczogNjAwMDAgfTtcbiAgICAgIGNvbnN0IGlkZW50aWZpZXIgPSBcInRlc3QtdXNlci00XCI7XG5cbiAgICAgIGxldCByZXN1bHQgPSBjaGVja1JhdGVMaW1pdChpZGVudGlmaWVyLCBjb25maWcpO1xuICAgICAgZXhwZWN0KHJlc3VsdC5yZW1haW5pbmcpLnRvQmUoNCk7XG5cbiAgICAgIHJlc3VsdCA9IGNoZWNrUmF0ZUxpbWl0KGlkZW50aWZpZXIsIGNvbmZpZyk7XG4gICAgICBleHBlY3QocmVzdWx0LnJlbWFpbmluZykudG9CZSgzKTtcblxuICAgICAgcmVzdWx0ID0gY2hlY2tSYXRlTGltaXQoaWRlbnRpZmllciwgY29uZmlnKTtcbiAgICAgIGV4cGVjdChyZXN1bHQucmVtYWluaW5nKS50b0JlKDIpO1xuICAgIH0pO1xuICB9KTtcblxuICBkZXNjcmliZShcIlByZS1jb25maWd1cmVkIFJhdGUgTGltaXRzXCIsICgpID0+IHtcbiAgICBpdChcIkxPR0lOX1JBVEVfTElNSVQgc2hvdWxkIGhhdmUgY29ycmVjdCBjb25maWd1cmF0aW9uXCIsICgpID0+IHtcbiAgICAgIGV4cGVjdChMT0dJTl9SQVRFX0xJTUlULm1heFJlcXVlc3RzKS50b0JlKDUpO1xuICAgICAgZXhwZWN0KExPR0lOX1JBVEVfTElNSVQud2luZG93TXMpLnRvQmUoMTUgKiA2MCAqIDEwMDApOyAvLyAxNSBtaW51dGVzXG4gICAgfSk7XG5cbiAgICBpdChcIkFQSV9SQVRFX0xJTUlUIHNob3VsZCBoYXZlIGNvcnJlY3QgY29uZmlndXJhdGlvblwiLCAoKSA9PiB7XG4gICAgICBleHBlY3QoQVBJX1JBVEVfTElNSVQubWF4UmVxdWVzdHMpLnRvQmUoMTAwKTtcbiAgICAgIGV4cGVjdChBUElfUkFURV9MSU1JVC53aW5kb3dNcykudG9CZSg2MCAqIDEwMDApOyAvLyAxIG1pbnV0ZVxuICAgIH0pO1xuXG4gICAgaXQoXCJTRU5TSVRJVkVfUkFURV9MSU1JVCBzaG91bGQgaGF2ZSBjb3JyZWN0IGNvbmZpZ3VyYXRpb25cIiwgKCkgPT4ge1xuICAgICAgZXhwZWN0KFNFTlNJVElWRV9SQVRFX0xJTUlULm1heFJlcXVlc3RzKS50b0JlKDEwKTtcbiAgICAgIGV4cGVjdChTRU5TSVRJVkVfUkFURV9MSU1JVC53aW5kb3dNcykudG9CZSg2MCAqIDYwICogMTAwMCk7IC8vIDEgaG91clxuICAgIH0pO1xuXG4gICAgaXQoXCJzaG91bGQgZW5mb3JjZSBMT0dJTl9SQVRFX0xJTUlUIGNvcnJlY3RseVwiLCAoKSA9PiB7XG4gICAgICBjb25zdCBpZGVudGlmaWVyID0gXCJsb2dpbi10ZXN0XCI7XG5cbiAgICAgIC8vIEFsbG93IDUgcmVxdWVzdHNcbiAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgNTsgaSsrKSB7XG4gICAgICAgIGNvbnN0IHJlc3VsdCA9IGNoZWNrUmF0ZUxpbWl0KGlkZW50aWZpZXIsIExPR0lOX1JBVEVfTElNSVQpO1xuICAgICAgICBleHBlY3QocmVzdWx0LmFsbG93ZWQpLnRvQmUodHJ1ZSk7XG4gICAgICB9XG5cbiAgICAgIC8vIEJsb2NrIDZ0aCByZXF1ZXN0XG4gICAgICBjb25zdCByZXN1bHQgPSBjaGVja1JhdGVMaW1pdChpZGVudGlmaWVyLCBMT0dJTl9SQVRFX0xJTUlUKTtcbiAgICAgIGV4cGVjdChyZXN1bHQuYWxsb3dlZCkudG9CZShmYWxzZSk7XG4gICAgfSk7XG4gIH0pO1xuXG4gIGRlc2NyaWJlKFwiUmF0ZSBMaW1pdCBTdGF0dXNcIiwgKCkgPT4ge1xuICAgIGl0KFwic2hvdWxkIHJldHVybiBudWxsIGZvciBub24tZXhpc3RlbnQgaWRlbnRpZmllclwiLCAoKSA9PiB7XG4gICAgICBjb25zdCBzdGF0dXMgPSBnZXRSYXRlTGltaXRTdGF0dXMoXCJub24tZXhpc3RlbnRcIiwgTE9HSU5fUkFURV9MSU1JVCk7XG4gICAgICBleHBlY3Qoc3RhdHVzKS50b0JlTnVsbCgpO1xuICAgIH0pO1xuXG4gICAgaXQoXCJzaG91bGQgcmV0dXJuIGN1cnJlbnQgc3RhdHVzIHdpdGhvdXQgaW5jcmVtZW50aW5nXCIsICgpID0+IHtcbiAgICAgIGNvbnN0IGlkZW50aWZpZXIgPSBcInN0YXR1cy10ZXN0XCI7XG4gICAgICBjb25zdCBjb25maWcgPSB7IG1heFJlcXVlc3RzOiA1LCB3aW5kb3dNczogNjAwMDAgfTtcblxuICAgICAgLy8gTWFrZSAyIHJlcXVlc3RzXG4gICAgICBjaGVja1JhdGVMaW1pdChpZGVudGlmaWVyLCBjb25maWcpO1xuICAgICAgY2hlY2tSYXRlTGltaXQoaWRlbnRpZmllciwgY29uZmlnKTtcblxuICAgICAgLy8gQ2hlY2sgc3RhdHVzIChzaG91bGQgbm90IGluY3JlbWVudClcbiAgICAgIGNvbnN0IHN0YXR1czEgPSBnZXRSYXRlTGltaXRTdGF0dXMoaWRlbnRpZmllciwgY29uZmlnKTtcbiAgICAgIGV4cGVjdChzdGF0dXMxPy5jdXJyZW50KS50b0JlKDIpO1xuICAgICAgZXhwZWN0KHN0YXR1czE/LnJlbWFpbmluZykudG9CZSgzKTtcblxuICAgICAgLy8gQ2hlY2sgYWdhaW4gKHNob3VsZCBzdGlsbCBiZSAyKVxuICAgICAgY29uc3Qgc3RhdHVzMiA9IGdldFJhdGVMaW1pdFN0YXR1cyhpZGVudGlmaWVyLCBjb25maWcpO1xuICAgICAgZXhwZWN0KHN0YXR1czI/LmN1cnJlbnQpLnRvQmUoMik7XG4gICAgfSk7XG4gIH0pO1xuXG4gIGRlc2NyaWJlKFwiUmF0ZSBMaW1pdCBSZXNldFwiLCAoKSA9PiB7XG4gICAgaXQoXCJzaG91bGQgcmVzZXQgcmF0ZSBsaW1pdCBmb3Igc3BlY2lmaWMgaWRlbnRpZmllclwiLCAoKSA9PiB7XG4gICAgICBjb25zdCBpZGVudGlmaWVyID0gXCJyZXNldC10ZXN0XCI7XG4gICAgICBjb25zdCBjb25maWcgPSB7IG1heFJlcXVlc3RzOiAzLCB3aW5kb3dNczogNjAwMDAgfTtcblxuICAgICAgLy8gVXNlIHVwIHRoZSBsaW1pdFxuICAgICAgY2hlY2tSYXRlTGltaXQoaWRlbnRpZmllciwgY29uZmlnKTtcbiAgICAgIGNoZWNrUmF0ZUxpbWl0KGlkZW50aWZpZXIsIGNvbmZpZyk7XG4gICAgICBjaGVja1JhdGVMaW1pdChpZGVudGlmaWVyLCBjb25maWcpO1xuXG4gICAgICAvLyBTaG91bGQgYmUgYmxvY2tlZFxuICAgICAgbGV0IHJlc3VsdCA9IGNoZWNrUmF0ZUxpbWl0KGlkZW50aWZpZXIsIGNvbmZpZyk7XG4gICAgICBleHBlY3QocmVzdWx0LmFsbG93ZWQpLnRvQmUoZmFsc2UpO1xuXG4gICAgICAvLyBSZXNldFxuICAgICAgcmVzZXRSYXRlTGltaXQoaWRlbnRpZmllciwgY29uZmlnLndpbmRvd01zKTtcblxuICAgICAgLy8gU2hvdWxkIGJlIGFsbG93ZWQgYWdhaW5cbiAgICAgIHJlc3VsdCA9IGNoZWNrUmF0ZUxpbWl0KGlkZW50aWZpZXIsIGNvbmZpZyk7XG4gICAgICBleHBlY3QocmVzdWx0LmFsbG93ZWQpLnRvQmUodHJ1ZSk7XG4gICAgICBleHBlY3QocmVzdWx0LmN1cnJlbnQpLnRvQmUoMSk7XG4gICAgfSk7XG5cbiAgICBpdChcInNob3VsZCBjbGVhciBhbGwgcmF0ZSBsaW1pdHNcIiwgKCkgPT4ge1xuICAgICAgY29uc3QgY29uZmlnID0geyBtYXhSZXF1ZXN0czogMiwgd2luZG93TXM6IDYwMDAwIH07XG5cbiAgICAgIGNoZWNrUmF0ZUxpbWl0KFwidXNlci0xXCIsIGNvbmZpZyk7XG4gICAgICBjaGVja1JhdGVMaW1pdChcInVzZXItMlwiLCBjb25maWcpO1xuICAgICAgY2hlY2tSYXRlTGltaXQoXCJ1c2VyLTNcIiwgY29uZmlnKTtcblxuICAgICAgY2xlYXJBbGxSYXRlTGltaXRzKCk7XG5cbiAgICAgIC8vIEFsbCBzaG91bGQgc3RhcnQgZnJlc2hcbiAgICAgIGNvbnN0IHJlc3VsdDEgPSBjaGVja1JhdGVMaW1pdChcInVzZXItMVwiLCBjb25maWcpO1xuICAgICAgY29uc3QgcmVzdWx0MiA9IGNoZWNrUmF0ZUxpbWl0KFwidXNlci0yXCIsIGNvbmZpZyk7XG4gICAgICBjb25zdCByZXN1bHQzID0gY2hlY2tSYXRlTGltaXQoXCJ1c2VyLTNcIiwgY29uZmlnKTtcblxuICAgICAgZXhwZWN0KHJlc3VsdDEuY3VycmVudCkudG9CZSgxKTtcbiAgICAgIGV4cGVjdChyZXN1bHQyLmN1cnJlbnQpLnRvQmUoMSk7XG4gICAgICBleHBlY3QocmVzdWx0My5jdXJyZW50KS50b0JlKDEpO1xuICAgIH0pO1xuICB9KTtcblxuICBkZXNjcmliZShcIlJlc2V0IFRpbWUgQ2FsY3VsYXRpb25cIiwgKCkgPT4ge1xuICAgIGl0KFwic2hvdWxkIGNhbGN1bGF0ZSByZXNldCB0aW1lIGNvcnJlY3RseVwiLCAoKSA9PiB7XG4gICAgICBjb25zdCBjb25maWcgPSB7IG1heFJlcXVlc3RzOiA1LCB3aW5kb3dNczogNjAwMDAgfTtcbiAgICAgIGNvbnN0IGlkZW50aWZpZXIgPSBcInRpbWUtdGVzdFwiO1xuXG4gICAgICBjb25zdCByZXN1bHQgPSBjaGVja1JhdGVMaW1pdChpZGVudGlmaWVyLCBjb25maWcpO1xuXG4gICAgICAvLyBSZXNldCB0aW1lIHNob3VsZCBiZSBhcHByb3hpbWF0ZWx5IDYwIHNlY29uZHMgKHdpdGggc21hbGwgdG9sZXJhbmNlKVxuICAgICAgZXhwZWN0KHJlc3VsdC5yZXNldFRpbWUpLnRvQmVHcmVhdGVyVGhhbig1NSk7XG4gICAgICBleHBlY3QocmVzdWx0LnJlc2V0VGltZSkudG9CZUxlc3NUaGFuT3JFcXVhbCg2MCk7XG4gICAgfSk7XG5cbiAgICBpdChcInNob3VsZCBkZWNyZWFzZSByZXNldCB0aW1lIHdpdGggc3Vic2VxdWVudCBjYWxsc1wiLCBhc3luYyAoKSA9PiB7XG4gICAgICBjb25zdCBjb25maWcgPSB7IG1heFJlcXVlc3RzOiA1LCB3aW5kb3dNczogNTAwMCB9OyAvLyA1IHNlY29uZCB3aW5kb3dcbiAgICAgIGNvbnN0IGlkZW50aWZpZXIgPSBcInRpbWUtZGVjcmVhc2UtdGVzdFwiO1xuXG4gICAgICBjb25zdCByZXN1bHQxID0gY2hlY2tSYXRlTGltaXQoaWRlbnRpZmllciwgY29uZmlnKTtcbiAgICAgIGF3YWl0IG5ldyBQcm9taXNlKChyZXNvbHZlKSA9PiBzZXRUaW1lb3V0KHJlc29sdmUsIDUwMCkpO1xuXG4gICAgICBjb25zdCByZXN1bHQyID0gY2hlY2tSYXRlTGltaXQoaWRlbnRpZmllciwgY29uZmlnKTtcblxuICAgICAgLy8gQWZ0ZXIgNTAwbXMsIHJlc2V0IHRpbWUgc2hvdWxkIGJlIGF0IGxlYXN0IDUwMG1zIGxlc3NcbiAgICAgIGV4cGVjdChyZXN1bHQyLnJlc2V0VGltZSkudG9CZUxlc3NUaGFuT3JFcXVhbChyZXN1bHQxLnJlc2V0VGltZSk7XG4gICAgfSk7XG4gIH0pO1xuXG4gIGRlc2NyaWJlKFwiQ2xpZW50IElQIEV4dHJhY3Rpb25cIiwgKCkgPT4ge1xuICAgIGl0KFwic2hvdWxkIGV4dHJhY3QgSVAgZnJvbSB4LWZvcndhcmRlZC1mb3IgaGVhZGVyXCIsICgpID0+IHtcbiAgICAgIGNvbnN0IHJlcXVlc3QgPSBuZXcgUmVxdWVzdChcImh0dHBzOi8vZXhhbXBsZS5jb21cIiwge1xuICAgICAgICBoZWFkZXJzOiB7XG4gICAgICAgICAgXCJ4LWZvcndhcmRlZC1mb3JcIjogXCIxOTIuMTY4LjEuMSwgMTAuMC4wLjFcIixcbiAgICAgICAgfSxcbiAgICAgIH0pO1xuXG4gICAgICBjb25zdCBpcCA9IGdldENsaWVudElwKHJlcXVlc3QpO1xuICAgICAgZXhwZWN0KGlwKS50b0JlKFwiMTkyLjE2OC4xLjFcIik7XG4gICAgfSk7XG5cbiAgICBpdChcInNob3VsZCBleHRyYWN0IElQIGZyb20geC1yZWFsLWlwIGhlYWRlclwiLCAoKSA9PiB7XG4gICAgICBjb25zdCByZXF1ZXN0ID0gbmV3IFJlcXVlc3QoXCJodHRwczovL2V4YW1wbGUuY29tXCIsIHtcbiAgICAgICAgaGVhZGVyczoge1xuICAgICAgICAgIFwieC1yZWFsLWlwXCI6IFwiMTkyLjE2OC4xLjJcIixcbiAgICAgICAgfSxcbiAgICAgIH0pO1xuXG4gICAgICBjb25zdCBpcCA9IGdldENsaWVudElwKHJlcXVlc3QpO1xuICAgICAgZXhwZWN0KGlwKS50b0JlKFwiMTkyLjE2OC4xLjJcIik7XG4gICAgfSk7XG5cbiAgICBpdChcInNob3VsZCBleHRyYWN0IElQIGZyb20gY2YtY29ubmVjdGluZy1pcCBoZWFkZXIgKENsb3VkZmxhcmUpXCIsICgpID0+IHtcbiAgICAgIGNvbnN0IHJlcXVlc3QgPSBuZXcgUmVxdWVzdChcImh0dHBzOi8vZXhhbXBsZS5jb21cIiwge1xuICAgICAgICBoZWFkZXJzOiB7XG4gICAgICAgICAgXCJjZi1jb25uZWN0aW5nLWlwXCI6IFwiMTkyLjE2OC4xLjNcIixcbiAgICAgICAgfSxcbiAgICAgIH0pO1xuXG4gICAgICBjb25zdCBpcCA9IGdldENsaWVudElwKHJlcXVlc3QpO1xuICAgICAgZXhwZWN0KGlwKS50b0JlKFwiMTkyLjE2OC4xLjNcIik7XG4gICAgfSk7XG5cbiAgICBpdChcInNob3VsZCByZXR1cm4gJ3Vua25vd24nIGlmIG5vIElQIGhlYWRlcnMgcHJlc2VudFwiLCAoKSA9PiB7XG4gICAgICBjb25zdCByZXF1ZXN0ID0gbmV3IFJlcXVlc3QoXCJodHRwczovL2V4YW1wbGUuY29tXCIpO1xuXG4gICAgICBjb25zdCBpcCA9IGdldENsaWVudElwKHJlcXVlc3QpO1xuICAgICAgZXhwZWN0KGlwKS50b0JlKFwidW5rbm93blwiKTtcbiAgICB9KTtcblxuICAgIGl0KFwic2hvdWxkIHByaW9yaXRpemUgeC1mb3J3YXJkZWQtZm9yIG92ZXIgb3RoZXIgaGVhZGVyc1wiLCAoKSA9PiB7XG4gICAgICBjb25zdCBoZWFkZXJzID0gbmV3IEhlYWRlcnMoKTtcbiAgICAgIGhlYWRlcnMuc2V0KFwieC1mb3J3YXJkZWQtZm9yXCIsIFwiMTkyLjE2OC4xLjFcIik7XG4gICAgICBoZWFkZXJzLnNldChcIngtcmVhbC1pcFwiLCBcIjE5Mi4xNjguMS4yXCIpO1xuICAgICAgaGVhZGVycy5zZXQoXCJjZi1jb25uZWN0aW5nLWlwXCIsIFwiMTkyLjE2OC4xLjNcIik7XG5cbiAgICAgIGNvbnN0IHJlcXVlc3QgPSBuZXcgUmVxdWVzdChcImh0dHBzOi8vZXhhbXBsZS5jb21cIiwgeyBoZWFkZXJzIH0pO1xuXG4gICAgICBjb25zdCBpcCA9IGdldENsaWVudElwKHJlcXVlc3QpO1xuICAgICAgZXhwZWN0KGlwKS50b0JlKFwiMTkyLjE2OC4xLjFcIik7XG4gICAgfSk7XG4gIH0pO1xuXG4gIGRlc2NyaWJlKFwiRWRnZSBDYXNlc1wiLCAoKSA9PiB7XG4gICAgaXQoXCJzaG91bGQgaGFuZGxlIGNvbmN1cnJlbnQgcmVxdWVzdHMgY29ycmVjdGx5XCIsIGFzeW5jICgpID0+IHtcbiAgICAgIGNvbnN0IGNvbmZpZyA9IHsgbWF4UmVxdWVzdHM6IDEwLCB3aW5kb3dNczogNjAwMDAgfTtcbiAgICAgIGNvbnN0IGlkZW50aWZpZXIgPSBcImNvbmN1cnJlbnQtdGVzdFwiO1xuXG4gICAgICBjb25zdCByZXF1ZXN0cyA9IEFycmF5LmZyb20oeyBsZW5ndGg6IDE1IH0sICgpID0+XG4gICAgICAgIGNoZWNrUmF0ZUxpbWl0KGlkZW50aWZpZXIsIGNvbmZpZylcbiAgICAgICk7XG5cbiAgICAgIGNvbnN0IHJlc3VsdHMgPSBhd2FpdCBQcm9taXNlLmFsbChyZXF1ZXN0cyk7XG5cbiAgICAgIGNvbnN0IGFsbG93ZWQgPSByZXN1bHRzLmZpbHRlcigocikgPT4gci5hbGxvd2VkKTtcbiAgICAgIGNvbnN0IGJsb2NrZWQgPSByZXN1bHRzLmZpbHRlcigocikgPT4gIXIuYWxsb3dlZCk7XG5cbiAgICAgIGV4cGVjdChhbGxvd2VkLmxlbmd0aCkudG9CZSgxMCk7XG4gICAgICBleHBlY3QoYmxvY2tlZC5sZW5ndGgpLnRvQmUoNSk7XG4gICAgfSk7XG5cbiAgICBpdChcInNob3VsZCBoYW5kbGUgemVybyBtYXggcmVxdWVzdHNcIiwgKCkgPT4ge1xuICAgICAgY29uc3QgY29uZmlnID0geyBtYXhSZXF1ZXN0czogMCwgd2luZG93TXM6IDYwMDAwIH07XG4gICAgICBjb25zdCBpZGVudGlmaWVyID0gXCJ6ZXJvLXRlc3RcIjtcblxuICAgICAgY29uc3QgcmVzdWx0ID0gY2hlY2tSYXRlTGltaXQoaWRlbnRpZmllciwgY29uZmlnKTtcbiAgICAgIC8vIFdpdGggMCBtYXggcmVxdWVzdHMsIGZpcnN0IHJlcXVlc3QgY3JlYXRlcyBlbnRyeSB3aXRoIGNvdW50PTFcbiAgICAgIC8vIHdoaWNoIGlzID4gMCwgc28gaXQgc2hvdWxkIGJlIGJsb2NrZWRcbiAgICAgIGV4cGVjdChyZXN1bHQuYWxsb3dlZCkudG9CZShmYWxzZSk7XG4gICAgICBleHBlY3QocmVzdWx0LmN1cnJlbnQpLnRvQmUoMSk7XG4gICAgICBleHBlY3QocmVzdWx0LmxpbWl0KS50b0JlKDApO1xuICAgIH0pO1xuXG4gICAgaXQoXCJzaG91bGQgaGFuZGxlIHZlcnkgbGFyZ2Ugd2luZG93XCIsICgpID0+IHtcbiAgICAgIGNvbnN0IGNvbmZpZyA9IHsgbWF4UmVxdWVzdHM6IDUsIHdpbmRvd01zOiAxMDAwICogNjAgKiA2MCAqIDI0IH07IC8vIDI0IGhvdXJzXG4gICAgICBjb25zdCBpZGVudGlmaWVyID0gXCJsYXJnZS13aW5kb3ctdGVzdFwiO1xuXG4gICAgICBjb25zdCByZXN1bHQgPSBjaGVja1JhdGVMaW1pdChpZGVudGlmaWVyLCBjb25maWcpO1xuICAgICAgZXhwZWN0KHJlc3VsdC5hbGxvd2VkKS50b0JlKHRydWUpO1xuICAgICAgZXhwZWN0KHJlc3VsdC5yZXNldFRpbWUpLnRvQmVHcmVhdGVyVGhhbig4NjAwMCk7IC8vIH4yNCBob3VycyBpbiBzZWNvbmRzXG4gICAgfSk7XG5cbiAgICBpdChcInNob3VsZCBoYW5kbGUgcmFwaWQgc3VjY2Vzc2l2ZSByZXF1ZXN0c1wiLCAoKSA9PiB7XG4gICAgICBjb25zdCBjb25maWcgPSB7IG1heFJlcXVlc3RzOiAxMDAsIHdpbmRvd01zOiA2MDAwMCB9O1xuICAgICAgY29uc3QgaWRlbnRpZmllciA9IFwicmFwaWQtdGVzdFwiO1xuXG4gICAgICBmb3IgKGxldCBpID0gMDsgaSA8IDEwMDsgaSsrKSB7XG4gICAgICAgIGNvbnN0IHJlc3VsdCA9IGNoZWNrUmF0ZUxpbWl0KGlkZW50aWZpZXIsIGNvbmZpZyk7XG4gICAgICAgIGV4cGVjdChyZXN1bHQuYWxsb3dlZCkudG9CZSh0cnVlKTtcbiAgICAgIH1cblxuICAgICAgY29uc3QgcmVzdWx0ID0gY2hlY2tSYXRlTGltaXQoaWRlbnRpZmllciwgY29uZmlnKTtcbiAgICAgIGV4cGVjdChyZXN1bHQuYWxsb3dlZCkudG9CZShmYWxzZSk7XG4gICAgfSk7XG4gIH0pO1xuXG4gIGRlc2NyaWJlKFwiUmF0ZSBMaW1pdCBSZXNwb25zZSBIZWFkZXJzXCIsICgpID0+IHtcbiAgICBpdChcInNob3VsZCBpbmNsdWRlIGNvcnJlY3QgbGltaXQgaW5mb3JtYXRpb25cIiwgKCkgPT4ge1xuICAgICAgY29uc3QgY29uZmlnID0geyBtYXhSZXF1ZXN0czogNSwgd2luZG93TXM6IDYwMDAwIH07XG4gICAgICBjb25zdCBpZGVudGlmaWVyID0gXCJoZWFkZXItdGVzdFwiO1xuXG4gICAgICBjb25zdCByZXN1bHQgPSBjaGVja1JhdGVMaW1pdChpZGVudGlmaWVyLCBjb25maWcpO1xuXG4gICAgICBleHBlY3QocmVzdWx0LmxpbWl0KS50b0JlKDUpO1xuICAgICAgZXhwZWN0KHJlc3VsdC5jdXJyZW50KS50b0JlKDEpO1xuICAgICAgZXhwZWN0KHJlc3VsdC5yZW1haW5pbmcpLnRvQmUoNCk7XG4gICAgICBleHBlY3QocmVzdWx0LnJlc2V0VGltZSkudG9CZUdyZWF0ZXJUaGFuKDApO1xuICAgIH0pO1xuXG4gICAgaXQoXCJzaG91bGQgcHJvdmlkZSByZXRyeS1hZnRlciBpbmZvcm1hdGlvbiB3aGVuIGJsb2NrZWRcIiwgKCkgPT4ge1xuICAgICAgY29uc3QgY29uZmlnID0geyBtYXhSZXF1ZXN0czogMiwgd2luZG93TXM6IDYwMDAwIH07XG4gICAgICBjb25zdCBpZGVudGlmaWVyID0gXCJyZXRyeS10ZXN0XCI7XG5cbiAgICAgIGNoZWNrUmF0ZUxpbWl0KGlkZW50aWZpZXIsIGNvbmZpZyk7XG4gICAgICBjaGVja1JhdGVMaW1pdChpZGVudGlmaWVyLCBjb25maWcpO1xuXG4gICAgICBjb25zdCByZXN1bHQgPSBjaGVja1JhdGVMaW1pdChpZGVudGlmaWVyLCBjb25maWcpO1xuXG4gICAgICBleHBlY3QocmVzdWx0LmFsbG93ZWQpLnRvQmUoZmFsc2UpO1xuICAgICAgZXhwZWN0KHJlc3VsdC5yZXNldFRpbWUpLnRvQmVHcmVhdGVyVGhhbigwKTtcbiAgICAgIGV4cGVjdChyZXN1bHQucmVzZXRUaW1lKS50b0JlTGVzc1RoYW5PckVxdWFsKDYwKTtcbiAgICB9KTtcbiAgfSk7XG59KTtcbiJdLCJ2ZXJzaW9uIjozfQ==