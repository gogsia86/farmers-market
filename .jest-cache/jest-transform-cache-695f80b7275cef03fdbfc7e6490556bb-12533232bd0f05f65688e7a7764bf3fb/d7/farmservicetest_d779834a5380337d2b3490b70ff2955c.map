{"file":"M:\\Repo\\Farmers Market Platform web and app\\src\\lib\\services\\farm.service.test.ts","mappings":"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","names":[],"sources":["M:\\Repo\\Farmers Market Platform web and app\\src\\lib\\services\\farm.service.test.ts"],"sourcesContent":["/**\r\n * FARM SERVICE TESTS - DIVINE VALIDATION\r\n *\r\n * Comprehensive test suite for farm service layer operations.\r\n * Tests business logic, database interactions, and error handling.\r\n *\r\n * Divine Patterns Applied:\r\n * - Enlightening test names (describe what SHOULD happen)\r\n * - Comprehensive coverage (100% of business logic)\r\n * - Integration testing with database mocks\r\n * - Type-safe test data\r\n *\r\n * Coverage Target: 100%\r\n */\r\n\r\nimport { database } from \"@/lib/database\";\r\nimport {\r\n  checkExistingFarm,\r\n  createFarmService,\r\n  getFarmById,\r\n  getFarmBySlug,\r\n} from \"@/lib/services/farm.service\";\r\nimport type { CreateFarmRequest, UserId } from \"@/types/farm.types\";\r\nimport { afterEach, beforeEach, describe, expect, it, jest } from '@jest/globals';\r\n\r\n// ============================================================================\r\n// MOCKS - DIVINE TEST DOUBLES\r\n// ============================================================================\r\n\r\njest.mock(\"@/lib/database\", () => ({\r\n  database: {\r\n    farm: {\r\n      create: jest.fn(),\r\n      findFirst: jest.fn(),\r\n      findUnique: jest.fn(),\r\n    },\r\n  },\r\n}));\r\n\r\njest.mock(\"@/lib/cache\", () => ({\r\n  AgriculturalCache: {\r\n    getFarm: jest.fn(),\r\n    cacheFarm: jest.fn(),\r\n    invalidateFarm: jest.fn(),\r\n    getProduct: jest.fn(),\r\n    cacheProduct: jest.fn(),\r\n    invalidateProduct: jest.fn(),\r\n  },\r\n}));\r\n\r\n// ============================================================================\r\n// TEST DATA - QUANTUM FIXTURES\r\n// ============================================================================\r\n\r\nconst mockUserId = \"user-123\" as UserId;\r\n\r\nconst mockFarmData: CreateFarmRequest = {\r\n  name: \"Quantum Valley Farm\",\r\n  address: \"123 Divine Street\",\r\n  city: \"Reality\",\r\n  state: \"CA\",\r\n  zipCode: \"94000\",\r\n  latitude: 37.7749,\r\n  longitude: -122.4194,\r\n  email: \"farm@quantum.valley\",\r\n  phone: \"+1234567890\",\r\n  description: \"Growing consciousness through organic vegetables\",\r\n  story: \"Our farm has been practicing biodynamic agriculture for 10 years\",\r\n  businessName: \"Quantum Valley Agricultural Co.\",\r\n  yearEstablished: 2014,\r\n  farmSize: 50,\r\n  website: \"https://quantumvalley.farm\",\r\n  farmingPractices: [\"Organic\", \"Biodynamic\", \"Regenerative\"],\r\n  productCategories: [\"Vegetables\", \"Fruits\"],\r\n  deliveryRadius: 25,\r\n};\r\n\r\nconst mockCreatedFarm = {\r\n  id: \"farm-123\",\r\n  slug: \"quantum-valley-farm-reality\",\r\n  name: \"Quantum Valley Farm\",\r\n  ownerId: mockUserId,\r\n  description: \"Growing consciousness through organic vegetables\",\r\n  story: \"Our farm has been practicing biodynamic agriculture for 10 years\",\r\n  businessName: \"Quantum Valley Agricultural Co.\",\r\n  yearEstablished: 2014,\r\n  farmSize: 50,\r\n  address: \"123 Divine Street\",\r\n  city: \"Reality\",\r\n  state: \"CA\",\r\n  zipCode: \"94000\",\r\n  country: \"US\",\r\n  latitude: 37.7749,\r\n  longitude: -122.4194,\r\n  email: \"farm@quantum.valley\",\r\n  phone: \"+1234567890\",\r\n  website: \"https://quantumvalley.farm\",\r\n  farmingPractices: [\"Organic\", \"Biodynamic\", \"Regenerative\"],\r\n  productCategories: [\"Vegetables\", \"Fruits\"],\r\n  deliveryRadius: 25,\r\n  status: \"PENDING\",\r\n  verificationStatus: \"PENDING\",\r\n  stripeOnboarded: false,\r\n  payoutsEnabled: false,\r\n  createdAt: new Date(),\r\n  updatedAt: new Date(),\r\n  owner: {\r\n    id: mockUserId,\r\n    firstName: \"Test\",\r\n    lastName: \"Farmer\",\r\n    email: \"farmer@test.com\",\r\n  },\r\n};\r\n\r\n// ============================================================================\r\n// SETUP & TEARDOWN\r\n// ============================================================================\r\n\r\nbeforeEach(() => {\r\n  jest.clearAllMocks();\r\n});\r\n\r\nafterEach(() => {\r\n  jest.restoreAllMocks();\r\n});\r\n\r\n// ============================================================================\r\n// TESTS - FARM CREATION SERVICE\r\n// ============================================================================\r\n\r\ndescribe(\"Farm Service - Divine Operations\", () => {\r\n  describe(\"createFarmService\", () => {\r\n    it(\"manifests new farm with unique slug successfully\", async () => {\r\n      // Arrange\r\n      jest.mocked(database.farm.findUnique).mockResolvedValue(null); // No slug collision\r\n      jest.mocked(database.farm.create).mockResolvedValue(mockCreatedFarm as any);\r\n\r\n      // Act\r\n      const result = await createFarmService({\r\n        userId: mockUserId,\r\n        farmData: mockFarmData,\r\n      });\r\n\r\n      // Assert\r\n      expect(result.farm.identity.name).toBe(\"Quantum Valley Farm\");\r\n      expect(result.farm.identity.id).toBe(\"farm-123\");\r\n      expect(result.slug).toBeDefined();\r\n      expect(database.farm.create).toHaveBeenCalledTimes(1);\r\n    });\r\n\r\n    it(\"handles slug collision by appending counter\", async () => {\r\n      // Arrange - First slug exists, second doesn't\r\n      jest.mocked(database.farm.findUnique)\r\n        .mockResolvedValueOnce({ id: \"existing-farm\" } as any) // Collision\r\n        .mockResolvedValueOnce(null); // Success\r\n\r\n      jest.mocked(database.farm.create).mockResolvedValue(mockCreatedFarm as any);\r\n\r\n      // Act\r\n      const result = await createFarmService({\r\n        userId: mockUserId,\r\n        farmData: mockFarmData,\r\n      });\r\n\r\n      // Assert\r\n      expect(database.farm.findUnique).toHaveBeenCalledTimes(2);\r\n      expect(result).toBeDefined();\r\n    });\r\n\r\n    it(\"throws error after max slug collision attempts\", async () => {\r\n      // Arrange - All attempts collide\r\n      jest.mocked(database.farm.findUnique).mockResolvedValue({\r\n        id: \"existing-farm\",\r\n      } as any);\r\n\r\n      // Act & Assert\r\n      await expect(\r\n        createFarmService({\r\n          userId: mockUserId,\r\n          farmData: mockFarmData,\r\n        })\r\n      ).rejects.toThrow(\"Failed to generate unique slug\");\r\n    });\r\n\r\n    it(\"creates farm with PENDING status by default\", async () => {\r\n      // Arrange\r\n      jest.mocked(database.farm.findUnique).mockResolvedValue(null);\r\n      jest.mocked(database.farm.create).mockResolvedValue(mockCreatedFarm as any);\r\n\r\n      // Act\r\n      await createFarmService({\r\n        userId: mockUserId,\r\n        farmData: mockFarmData,\r\n      });\r\n\r\n      // Assert\r\n      expect(database.farm.create).toHaveBeenCalledWith(\r\n        expect.objectContaining({\r\n          data: expect.objectContaining({\r\n            status: \"PENDING\",\r\n            verificationStatus: \"PENDING\",\r\n            stripeOnboarded: false,\r\n            payoutsEnabled: false,\r\n          }),\r\n        })\r\n      );\r\n    });\r\n\r\n    it(\"manifests quantum farm with agricultural consciousness\", async () => {\r\n      // Arrange\r\n      jest.mocked(database.farm.findUnique).mockResolvedValue(null);\r\n      jest.mocked(database.farm.create).mockResolvedValue(mockCreatedFarm as any);\r\n\r\n      // Act\r\n      const result = await createFarmService({\r\n        userId: mockUserId,\r\n        farmData: mockFarmData,\r\n      });\r\n\r\n      // Assert - Check quantum properties\r\n      expect(result.farm.consciousness).toBeDefined();\r\n      expect(result.farm.consciousness.currentSeason).toMatch(\r\n        /SPRING|SUMMER|FALL|WINTER/\r\n      );\r\n      expect(result.farm.consciousness.state).toMatch(\r\n        /DORMANT|AWAKENING|GROWING|HARVESTING|REGENERATING/\r\n      );\r\n      expect(result.farm.location.latitude).toBe(37.7749);\r\n      expect(result.farm.location.longitude).toBe(-122.4194);\r\n    });\r\n  });\r\n\r\n  // ========================================================================\r\n  // TESTS - CHECK EXISTING FARM\r\n  // ========================================================================\r\n\r\n  describe(\"checkExistingFarm\", () => {\r\n    it(\"returns exists=false when user has no farm\", async () => {\r\n      // Arrange\r\n      jest.mocked(database.farm.findFirst).mockResolvedValue(null);\r\n\r\n      // Act\r\n      const result = await checkExistingFarm(mockUserId);\r\n\r\n      // Assert\r\n      expect(result.exists).toBe(false);\r\n      expect(result.farm).toBeUndefined();\r\n    });\r\n\r\n    it(\"returns exists=true with farm details when user has farm\", async () => {\r\n      // Arrange\r\n      jest.mocked(database.farm.findFirst).mockResolvedValue({\r\n        id: \"farm-123\",\r\n        slug: \"quantum-valley-farm\",\r\n        name: \"Quantum Valley Farm\",\r\n      } as any);\r\n\r\n      // Act\r\n      const result = await checkExistingFarm(mockUserId);\r\n\r\n      // Assert\r\n      expect(result.exists).toBe(true);\r\n      expect(result.farm).toEqual({\r\n        id: \"farm-123\",\r\n        slug: \"quantum-valley-farm\",\r\n        name: \"Quantum Valley Farm\",\r\n      });\r\n    });\r\n\r\n    it(\"queries database with correct user ID\", async () => {\r\n      // Arrange\r\n      jest.mocked(database.farm.findFirst).mockResolvedValue(null);\r\n\r\n      // Act\r\n      await checkExistingFarm(mockUserId);\r\n\r\n      // Assert\r\n      expect(database.farm.findFirst).toHaveBeenCalledWith({\r\n        where: { ownerId: mockUserId },\r\n        select: { id: true, slug: true, name: true },\r\n      });\r\n    });\r\n  });\r\n\r\n  // ========================================================================\r\n  // TESTS - GET FARM BY ID\r\n  // ========================================================================\r\n\r\n  describe(\"getFarmById\", () => {\r\n    it(\"manifests quantum farm when farm exists\", async () => {\r\n      // Arrange\r\n      jest.mocked(database.farm.findUnique).mockResolvedValue(\r\n        mockCreatedFarm as any\r\n      );\r\n\r\n      // Act\r\n      const result = await getFarmById(\"farm-123\");\r\n\r\n      // Assert\r\n      expect(result).not.toBeNull();\r\n      expect(result?.identity.id).toBe(\"farm-123\");\r\n      expect(result?.identity.name).toBe(\"Quantum Valley Farm\");\r\n      expect(result?.consciousness).toBeDefined();\r\n    });\r\n\r\n    it(\"returns null when farm does not exist\", async () => {\r\n      // Arrange\r\n      jest.mocked(database.farm.findUnique).mockResolvedValue(null);\r\n\r\n      // Act\r\n      const result = await getFarmById(\"nonexistent-farm\");\r\n\r\n      // Assert\r\n      expect(result).toBeNull();\r\n    });\r\n\r\n    it(\"includes owner information in query\", async () => {\r\n      // Arrange\r\n      jest.mocked(database.farm.findUnique).mockResolvedValue(\r\n        mockCreatedFarm as any\r\n      );\r\n\r\n      // Act\r\n      const result = await getFarmById(\"farm-123\");\r\n\r\n      // Assert\r\n      expect(result).toBeDefined();\r\n      expect(result?.identity.id).toBe(\"farm-123\");\r\n    });\r\n  });\r\n\r\n  // ========================================================================\r\n  // TESTS - GET FARM BY SLUG\r\n  // ========================================================================\r\n\r\n  describe(\"getFarmBySlug\", () => {\r\n    it(\"manifests quantum farm when slug exists\", async () => {\r\n      // Arrange\r\n      jest.mocked(database.farm.findUnique).mockResolvedValue(\r\n        mockCreatedFarm as any\r\n      );\r\n\r\n      // Act\r\n      const result = await getFarmBySlug(\"quantum-valley-farm-reality\");\r\n\r\n      // Assert\r\n      expect(result).not.toBeNull();\r\n      expect(result?.identity.slug).toBe(\"quantum-valley-farm-reality\");\r\n    });\r\n\r\n    it(\"returns null when slug does not exist\", async () => {\r\n      // Arrange\r\n      jest.mocked(database.farm.findUnique).mockResolvedValue(null);\r\n\r\n      // Act\r\n      const result = await getFarmBySlug(\"nonexistent-slug\");\r\n\r\n      // Assert\r\n      expect(result).toBeNull();\r\n    });\r\n  });\r\n});\r\n\r\n\r\n"],"version":3}