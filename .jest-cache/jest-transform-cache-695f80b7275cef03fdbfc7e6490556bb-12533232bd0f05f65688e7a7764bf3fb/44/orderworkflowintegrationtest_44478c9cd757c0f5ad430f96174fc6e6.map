{"file":"M:\\Repo\\Farmers Market Platform web and app\\src\\__tests__\\integration\\order-workflow.integration.test.ts","mappings":"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","names":[],"sources":["M:\\Repo\\Farmers Market Platform web and app\\src\\__tests__\\integration\\order-workflow.integration.test.ts"],"sourcesContent":["/**\n * ðŸ”— INTEGRATION TESTS - Order Workflow\n * Tests the complete order processing flow with real database interactions\n *\n * These tests require a running database and test actual service interactions\n */\n\nimport { database } from \"@/lib/database\";\nimport { OrderService } from \"@/lib/services/order.service\";\nimport { PaymentService } from \"@/lib/services/payment.service\";\nimport { ProductService } from \"@/lib/services/product.service\";\nimport { ShippingService } from \"@/lib/services/shipping.service\";\nimport { afterAll, beforeAll, describe, expect, it } from '@jest/globals';\n\n// Test data\nlet testFarmId: string;\nlet testUserId: string;\nlet testProductId: string;\nlet testOrderId: string;\n\ndescribe.skip(\"ðŸ”— Integration: Complete Order Workflow\", () => {\n  beforeAll(async () => {\n    // Create test user\n    const testUser = await database.user.create({\n      data: {\n        email: `test-${Date.now()}@integration.test`,\n        firstName: \"Test\",\n        lastName: \"User\",\n        role: \"CONSUMER\",\n        status: \"ACTIVE\",\n      },\n    });\n    testUserId = testUser.id;\n\n    // Create test farm\n    const testFarm = await database.farm.create({\n      data: {\n        name: \"Integration Test Farm\",\n        slug: `integration-farm-${Date.now()}`,\n        ownerId: testUserId,\n        status: \"ACTIVE\",\n        verificationStatus: \"VERIFIED\",\n        description: \"Test farm for integration tests\",\n        location: {\n          address: \"123 Test St\",\n          city: \"Test City\",\n          state: \"CA\",\n          zipCode: \"90210\",\n          country: \"USA\",\n        },\n      },\n    });\n    testFarmId = testFarm.id;\n\n    // Create test product\n    const testProduct = await ProductService.createProduct(\n      {\n        name: \"Integration Test Tomatoes\",\n        farmId: testFarmId,\n        category: \"VEGETABLES\",\n        description: \"Fresh tomatoes for testing\",\n        pricing: {\n          basePrice: {\n            amount: 500, // $5.00\n            currency: \"USD\",\n          },\n        },\n        inventory: {\n          quantity: 100,\n          reservedQuantity: 0,\n          lowStockThreshold: 20,\n        },\n        images: [\n          {\n            url: \"https://example.com/tomato.jpg\",\n            isPrimary: true,\n          },\n        ],\n      } as any,\n      testUserId\n    );\n    testProductId = testProduct.id;\n  });\n\n  afterAll(async () => {\n    // Cleanup test data\n    if (testOrderId) {\n      await database.order.delete({\n        where: { id: testOrderId },\n      });\n    }\n\n    if (testProductId) {\n      await database.product.delete({\n        where: { id: testProductId },\n      });\n    }\n\n    if (testFarmId) {\n      await database.farm.delete({\n        where: { id: testFarmId },\n      });\n    }\n\n    if (testUserId) {\n      await database.user.delete({\n        where: { id: testUserId },\n      });\n    }\n\n    await database.$disconnect();\n  });\n\n  describe(\"ðŸ“¦ End-to-End Order Processing\", () => {\n    it(\"should complete full order workflow: create â†’ pay â†’ ship â†’ deliver\", async () => {\n      // Step 1: Create order\n      const orderInput = {\n        customerId: testUserId,\n        items: [\n          {\n            productId: testProductId,\n            quantity: 2,\n            price: 500,\n          },\n        ],\n        shippingAddress: {\n          address: \"456 Customer St\",\n          city: \"Los Angeles\",\n          state: \"CA\",\n          zipCode: \"90001\",\n          country: \"USA\",\n        },\n        fulfillmentMethod: \"DELIVERY\",\n      };\n\n      const order = await OrderService.createOrder(orderInput as any);\n      testOrderId = order.id;\n\n      expect(order).toMatchObject({\n        id: expect.any(String),\n        customerId: testUserId,\n        status: \"PENDING\",\n        paymentStatus: \"PENDING\",\n      });\n\n      // Step 2: Calculate shipping\n      const shippingRates = await ShippingService.calculateShippingRates(\n        order.id,\n        {\n          city: \"Los Angeles\",\n          state: \"CA\",\n          zipCode: \"90001\",\n        }\n      );\n\n      expect(shippingRates).toHaveLength(3);\n      const selectedRate = shippingRates[0]; // STANDARD\n\n      // Step 3: Create payment intent\n      const totalAmount = order.total + selectedRate.cost * 100; // Convert to cents\n      const paymentIntent = await PaymentService.createPaymentIntent(\n        order.id,\n        totalAmount,\n        \"USD\"\n      );\n\n      expect(paymentIntent).toMatchObject({\n        id: expect.stringContaining(\"pi_\"),\n        amount: totalAmount,\n        currency: \"USD\",\n        status: \"pending\",\n      });\n\n      // Step 4: Confirm payment\n      const paymentConfirmed = await PaymentService.confirmPayment(\n        paymentIntent.id\n      );\n\n      expect(paymentConfirmed).toBe(true);\n\n      // Verify order status updated\n      const updatedOrder = await database.order.findUnique({\n        where: { id: order.id },\n      });\n\n      expect(updatedOrder?.paymentStatus).toBe(\"COMPLETED\");\n      expect(updatedOrder?.status).toBe(\"CONFIRMED\");\n\n      // Step 5: Create shipment\n      const shipment = await ShippingService.createShipment(\n        order.id,\n        selectedRate.service\n      );\n\n      expect(shipment).toMatchObject({\n        orderId: order.id,\n        trackingNumber: expect.any(String),\n        status: \"PENDING\",\n      });\n\n      // Step 6: Update shipment status\n      await ShippingService.updateShipmentStatus(shipment.id, \"IN_TRANSIT\");\n\n      const updatedShipment = await database.order.findUnique({\n        where: { id: order.id },\n        select: { fulfillmentStatus: true },\n      });\n\n      expect(updatedShipment?.fulfillmentStatus).toBe(\"IN_TRANSIT\");\n\n      // Step 7: Deliver order\n      await ShippingService.updateShipmentStatus(shipment.id, \"DELIVERED\");\n\n      const deliveredOrder = await database.order.findUnique({\n        where: { id: order.id },\n      });\n\n      expect(deliveredOrder?.fulfillmentStatus).toBe(\"DELIVERED\");\n      expect(deliveredOrder?.status).toBe(\"FULFILLED\");\n    }, 60000); // 60 second timeout for full workflow\n\n    it(\"should handle inventory updates during order creation\", async () => {\n      // Get initial inventory\n      const productBefore = await database.product.findUnique({\n        where: { id: testProductId },\n        select: { inventory: true },\n      });\n\n      const initialAvailable = productBefore?.inventory.availableQuantity;\n\n      // Create order\n      const order = await OrderService.createOrder({\n        customerId: testUserId,\n        items: [\n          {\n            productId: testProductId,\n            quantity: 5,\n            price: 500,\n          },\n        ],\n        shippingAddress: {\n          address: \"789 Test Ave\",\n          city: \"San Francisco\",\n          state: \"CA\",\n          zipCode: \"94102\",\n          country: \"USA\",\n        },\n        fulfillmentMethod: \"DELIVERY\",\n      } as any);\n\n      // Check inventory was reserved\n      const productAfter = await database.product.findUnique({\n        where: { id: testProductId },\n        select: { inventory: true },\n      });\n\n      expect(productAfter?.inventory.reservedQuantity).toBe(\n        (productBefore?.inventory.reservedQuantity || 0) + 5\n      );\n\n      expect(productAfter?.inventory.availableQuantity).toBe(\n        (initialAvailable || 0) - 5\n      );\n\n      // Cleanup\n      await database.order.delete({\n        where: { id: order.id },\n      });\n    });\n\n    it(\"should rollback inventory on payment failure\", async () => {\n      const productBefore = await database.product.findUnique({\n        where: { id: testProductId },\n        select: { inventory: true },\n      });\n\n      const initialReserved = productBefore?.inventory.reservedQuantity || 0;\n\n      // Create order\n      const order = await OrderService.createOrder({\n        customerId: testUserId,\n        items: [\n          {\n            productId: testProductId,\n            quantity: 3,\n            price: 500,\n          },\n        ],\n        shippingAddress: {\n          address: \"111 Fail St\",\n          city: \"Test City\",\n          state: \"CA\",\n          zipCode: \"90210\",\n          country: \"USA\",\n        },\n        fulfillmentMethod: \"DELIVERY\",\n      } as any);\n\n      // Simulate payment failure by canceling order\n      await OrderService.cancelOrder(order.id, testUserId);\n\n      // Check inventory was released\n      const productAfter = await database.product.findUnique({\n        where: { id: testProductId },\n        select: { inventory: true },\n      });\n\n      expect(productAfter?.inventory.reservedQuantity).toBe(initialReserved);\n\n      // Cleanup\n      await database.order.delete({\n        where: { id: order.id },\n      });\n    });\n  });\n\n  describe(\"ðŸ”„ Multi-Service Interactions\", () => {\n    it(\"should coordinate product, order, and payment services\", async () => {\n      // Create product\n      const product = await ProductService.createProduct(\n        {\n          name: \"Multi-Service Test Product\",\n          farmId: testFarmId,\n          category: \"FRUITS\",\n          description: \"Test coordination\",\n          pricing: {\n            basePrice: {\n              amount: 1000,\n              currency: \"USD\",\n            },\n          },\n          inventory: {\n            quantity: 50,\n            reservedQuantity: 0,\n            lowStockThreshold: 10,\n          },\n          images: [],\n        } as any,\n        testUserId\n      );\n\n      // Create order with product\n      const order = await OrderService.createOrder({\n        customerId: testUserId,\n        items: [\n          {\n            productId: product.id,\n            quantity: 2,\n            price: 1000,\n          },\n        ],\n        shippingAddress: {\n          address: \"222 Coordination Blvd\",\n          city: \"Test City\",\n          state: \"CA\",\n          zipCode: \"90210\",\n          country: \"USA\",\n        },\n        fulfillmentMethod: \"FARM_PICKUP\",\n      } as any);\n\n      // Process payment\n      const paymentIntent = await PaymentService.createPaymentIntent(\n        order.id,\n        order.total,\n        \"USD\"\n      );\n\n      await PaymentService.confirmPayment(paymentIntent.id);\n\n      // Verify all services updated correctly\n      const finalOrder = await database.order.findUnique({\n        where: { id: order.id },\n        include: {\n          items: true,\n        },\n      });\n\n      const finalProduct = await database.product.findUnique({\n        where: { id: product.id },\n        select: { inventory: true },\n      });\n\n      expect(finalOrder?.paymentStatus).toBe(\"COMPLETED\");\n      expect(finalOrder?.items[0].productId).toBe(product.id);\n      expect(finalProduct?.inventory.reservedQuantity).toBe(2);\n\n      // Cleanup\n      await database.order.delete({\n        where: { id: order.id },\n      });\n\n      await database.product.delete({\n        where: { id: product.id },\n      });\n    });\n  });\n\n  describe(\"âš¡ Error Recovery\", () => {\n    it(\"should handle database connection errors gracefully\", async () => {\n      // This tests error handling when database operations fail\n      // In production, this would test retry logic and circuit breakers\n\n      try {\n        await OrderService.createOrder({\n          customerId: \"invalid-user-id\",\n          items: [],\n          shippingAddress: {\n            address: \"Test\",\n            city: \"Test\",\n            state: \"CA\",\n            zipCode: \"90210\",\n            country: \"USA\",\n          },\n          fulfillmentMethod: \"DELIVERY\",\n        } as any);\n\n        // Should not reach here\n        expect(true).toBe(false);\n      } catch (error) {\n        // Should throw validation error\n        expect(error).toBeDefined();\n      }\n    });\n  });\n});\n\r\n\r\n"],"version":3}