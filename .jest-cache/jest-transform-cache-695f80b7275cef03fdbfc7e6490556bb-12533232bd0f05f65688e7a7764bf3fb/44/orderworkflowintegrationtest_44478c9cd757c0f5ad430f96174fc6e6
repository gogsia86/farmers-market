cb569d9512ca6753386148c2d9a8482b
"use strict";
/**
 * ðŸ”— INTEGRATION TESTS - Order Workflow
 * Tests the complete order processing flow with real database interactions
 *
 * These tests require a running database and test actual service interactions
 */
Object.defineProperty(exports, "__esModule", { value: true });
const globals_1 = require("@jest/globals");
const database_1 = require("@/lib/database");
const order_service_1 = require("@/lib/services/order.service");
const payment_service_1 = require("@/lib/services/payment.service");
const product_service_1 = require("@/lib/services/product.service");
const shipping_service_1 = require("@/lib/services/shipping.service");
// Test data
let testFarmId;
let testUserId;
let testProductId;
let testOrderId;
globals_1.describe.skip("ðŸ”— Integration: Complete Order Workflow", () => {
    (0, globals_1.beforeAll)(async () => {
        // Create test user
        const testUser = await database_1.database.user.create({
            data: {
                email: `test-${Date.now()}@integration.test`,
                firstName: "Test",
                lastName: "User",
                role: "CONSUMER",
                status: "ACTIVE",
            },
        });
        testUserId = testUser.id;
        // Create test farm
        const testFarm = await database_1.database.farm.create({
            data: {
                name: "Integration Test Farm",
                slug: `integration-farm-${Date.now()}`,
                ownerId: testUserId,
                status: "ACTIVE",
                verificationStatus: "VERIFIED",
                description: "Test farm for integration tests",
                location: {
                    address: "123 Test St",
                    city: "Test City",
                    state: "CA",
                    zipCode: "90210",
                    country: "USA",
                },
            },
        });
        testFarmId = testFarm.id;
        // Create test product
        const testProduct = await product_service_1.ProductService.createProduct({
            name: "Integration Test Tomatoes",
            farmId: testFarmId,
            category: "VEGETABLES",
            description: "Fresh tomatoes for testing",
            pricing: {
                basePrice: {
                    amount: 500, // $5.00
                    currency: "USD",
                },
            },
            inventory: {
                quantity: 100,
                reservedQuantity: 0,
                lowStockThreshold: 20,
            },
            images: [
                {
                    url: "https://example.com/tomato.jpg",
                    isPrimary: true,
                },
            ],
        }, testUserId);
        testProductId = testProduct.id;
    });
    (0, globals_1.afterAll)(async () => {
        // Cleanup test data
        if (testOrderId) {
            await database_1.database.order.delete({
                where: { id: testOrderId },
            });
        }
        if (testProductId) {
            await database_1.database.product.delete({
                where: { id: testProductId },
            });
        }
        if (testFarmId) {
            await database_1.database.farm.delete({
                where: { id: testFarmId },
            });
        }
        if (testUserId) {
            await database_1.database.user.delete({
                where: { id: testUserId },
            });
        }
        await database_1.database.$disconnect();
    });
    (0, globals_1.describe)("ðŸ“¦ End-to-End Order Processing", () => {
        (0, globals_1.it)("should complete full order workflow: create â†’ pay â†’ ship â†’ deliver", async () => {
            // Step 1: Create order
            const orderInput = {
                customerId: testUserId,
                items: [
                    {
                        productId: testProductId,
                        quantity: 2,
                        price: 500,
                    },
                ],
                shippingAddress: {
                    address: "456 Customer St",
                    city: "Los Angeles",
                    state: "CA",
                    zipCode: "90001",
                    country: "USA",
                },
                fulfillmentMethod: "DELIVERY",
            };
            const order = await order_service_1.OrderService.createOrder(orderInput);
            testOrderId = order.id;
            (0, globals_1.expect)(order).toMatchObject({
                id: globals_1.expect.any(String),
                customerId: testUserId,
                status: "PENDING",
                paymentStatus: "PENDING",
            });
            // Step 2: Calculate shipping
            const shippingRates = await shipping_service_1.ShippingService.calculateShippingRates(order.id, {
                city: "Los Angeles",
                state: "CA",
                zipCode: "90001",
            });
            (0, globals_1.expect)(shippingRates).toHaveLength(3);
            const selectedRate = shippingRates[0]; // STANDARD
            // Step 3: Create payment intent
            const totalAmount = order.total + selectedRate.cost * 100; // Convert to cents
            const paymentIntent = await payment_service_1.PaymentService.createPaymentIntent(order.id, totalAmount, "USD");
            (0, globals_1.expect)(paymentIntent).toMatchObject({
                id: globals_1.expect.stringContaining("pi_"),
                amount: totalAmount,
                currency: "USD",
                status: "pending",
            });
            // Step 4: Confirm payment
            const paymentConfirmed = await payment_service_1.PaymentService.confirmPayment(paymentIntent.id);
            (0, globals_1.expect)(paymentConfirmed).toBe(true);
            // Verify order status updated
            const updatedOrder = await database_1.database.order.findUnique({
                where: { id: order.id },
            });
            (0, globals_1.expect)(updatedOrder?.paymentStatus).toBe("COMPLETED");
            (0, globals_1.expect)(updatedOrder?.status).toBe("CONFIRMED");
            // Step 5: Create shipment
            const shipment = await shipping_service_1.ShippingService.createShipment(order.id, selectedRate.service);
            (0, globals_1.expect)(shipment).toMatchObject({
                orderId: order.id,
                trackingNumber: globals_1.expect.any(String),
                status: "PENDING",
            });
            // Step 6: Update shipment status
            await shipping_service_1.ShippingService.updateShipmentStatus(shipment.id, "IN_TRANSIT");
            const updatedShipment = await database_1.database.order.findUnique({
                where: { id: order.id },
                select: { fulfillmentStatus: true },
            });
            (0, globals_1.expect)(updatedShipment?.fulfillmentStatus).toBe("IN_TRANSIT");
            // Step 7: Deliver order
            await shipping_service_1.ShippingService.updateShipmentStatus(shipment.id, "DELIVERED");
            const deliveredOrder = await database_1.database.order.findUnique({
                where: { id: order.id },
            });
            (0, globals_1.expect)(deliveredOrder?.fulfillmentStatus).toBe("DELIVERED");
            (0, globals_1.expect)(deliveredOrder?.status).toBe("FULFILLED");
        }, 60000); // 60 second timeout for full workflow
        (0, globals_1.it)("should handle inventory updates during order creation", async () => {
            // Get initial inventory
            const productBefore = await database_1.database.product.findUnique({
                where: { id: testProductId },
                select: { inventory: true },
            });
            const initialAvailable = productBefore?.inventory.availableQuantity;
            // Create order
            const order = await order_service_1.OrderService.createOrder({
                customerId: testUserId,
                items: [
                    {
                        productId: testProductId,
                        quantity: 5,
                        price: 500,
                    },
                ],
                shippingAddress: {
                    address: "789 Test Ave",
                    city: "San Francisco",
                    state: "CA",
                    zipCode: "94102",
                    country: "USA",
                },
                fulfillmentMethod: "DELIVERY",
            });
            // Check inventory was reserved
            const productAfter = await database_1.database.product.findUnique({
                where: { id: testProductId },
                select: { inventory: true },
            });
            (0, globals_1.expect)(productAfter?.inventory.reservedQuantity).toBe((productBefore?.inventory.reservedQuantity || 0) + 5);
            (0, globals_1.expect)(productAfter?.inventory.availableQuantity).toBe((initialAvailable || 0) - 5);
            // Cleanup
            await database_1.database.order.delete({
                where: { id: order.id },
            });
        });
        (0, globals_1.it)("should rollback inventory on payment failure", async () => {
            const productBefore = await database_1.database.product.findUnique({
                where: { id: testProductId },
                select: { inventory: true },
            });
            const initialReserved = productBefore?.inventory.reservedQuantity || 0;
            // Create order
            const order = await order_service_1.OrderService.createOrder({
                customerId: testUserId,
                items: [
                    {
                        productId: testProductId,
                        quantity: 3,
                        price: 500,
                    },
                ],
                shippingAddress: {
                    address: "111 Fail St",
                    city: "Test City",
                    state: "CA",
                    zipCode: "90210",
                    country: "USA",
                },
                fulfillmentMethod: "DELIVERY",
            });
            // Simulate payment failure by canceling order
            await order_service_1.OrderService.cancelOrder(order.id, testUserId);
            // Check inventory was released
            const productAfter = await database_1.database.product.findUnique({
                where: { id: testProductId },
                select: { inventory: true },
            });
            (0, globals_1.expect)(productAfter?.inventory.reservedQuantity).toBe(initialReserved);
            // Cleanup
            await database_1.database.order.delete({
                where: { id: order.id },
            });
        });
    });
    (0, globals_1.describe)("ðŸ”„ Multi-Service Interactions", () => {
        (0, globals_1.it)("should coordinate product, order, and payment services", async () => {
            // Create product
            const product = await product_service_1.ProductService.createProduct({
                name: "Multi-Service Test Product",
                farmId: testFarmId,
                category: "FRUITS",
                description: "Test coordination",
                pricing: {
                    basePrice: {
                        amount: 1000,
                        currency: "USD",
                    },
                },
                inventory: {
                    quantity: 50,
                    reservedQuantity: 0,
                    lowStockThreshold: 10,
                },
                images: [],
            }, testUserId);
            // Create order with product
            const order = await order_service_1.OrderService.createOrder({
                customerId: testUserId,
                items: [
                    {
                        productId: product.id,
                        quantity: 2,
                        price: 1000,
                    },
                ],
                shippingAddress: {
                    address: "222 Coordination Blvd",
                    city: "Test City",
                    state: "CA",
                    zipCode: "90210",
                    country: "USA",
                },
                fulfillmentMethod: "FARM_PICKUP",
            });
            // Process payment
            const paymentIntent = await payment_service_1.PaymentService.createPaymentIntent(order.id, order.total, "USD");
            await payment_service_1.PaymentService.confirmPayment(paymentIntent.id);
            // Verify all services updated correctly
            const finalOrder = await database_1.database.order.findUnique({
                where: { id: order.id },
                include: {
                    items: true,
                },
            });
            const finalProduct = await database_1.database.product.findUnique({
                where: { id: product.id },
                select: { inventory: true },
            });
            (0, globals_1.expect)(finalOrder?.paymentStatus).toBe("COMPLETED");
            (0, globals_1.expect)(finalOrder?.items[0].productId).toBe(product.id);
            (0, globals_1.expect)(finalProduct?.inventory.reservedQuantity).toBe(2);
            // Cleanup
            await database_1.database.order.delete({
                where: { id: order.id },
            });
            await database_1.database.product.delete({
                where: { id: product.id },
            });
        });
    });
    (0, globals_1.describe)("âš¡ Error Recovery", () => {
        (0, globals_1.it)("should handle database connection errors gracefully", async () => {
            // This tests error handling when database operations fail
            // In production, this would test retry logic and circuit breakers
            try {
                await order_service_1.OrderService.createOrder({
                    customerId: "invalid-user-id",
                    items: [],
                    shippingAddress: {
                        address: "Test",
                        city: "Test",
                        state: "CA",
                        zipCode: "90210",
                        country: "USA",
                    },
                    fulfillmentMethod: "DELIVERY",
                });
                // Should not reach here
                (0, globals_1.expect)(true).toBe(false);
            }
            catch (error) {
                // Should throw validation error
                (0, globals_1.expect)(error).toBeDefined();
            }
        });
    });
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiTTpcXFJlcG9cXEZhcm1lcnMgTWFya2V0IFBsYXRmb3JtIHdlYiBhbmQgYXBwXFxzcmNcXF9fdGVzdHNfX1xcaW50ZWdyYXRpb25cXG9yZGVyLXdvcmtmbG93LmludGVncmF0aW9uLnRlc3QudHMiLCJtYXBwaW5ncyI6IjtBQUFBOzs7OztHQUtHOztBQU9ILDJDQUEwRTtBQUwxRSw2Q0FBMEM7QUFDMUMsZ0VBQTREO0FBQzVELG9FQUFnRTtBQUNoRSxvRUFBZ0U7QUFDaEUsc0VBQWtFO0FBR2xFLFlBQVk7QUFDWixJQUFJLFVBQWtCLENBQUM7QUFDdkIsSUFBSSxVQUFrQixDQUFDO0FBQ3ZCLElBQUksYUFBcUIsQ0FBQztBQUMxQixJQUFJLFdBQW1CLENBQUM7QUFFeEIsa0JBQVEsQ0FBQyxJQUFJLENBQUMseUNBQXlDLEVBQUUsR0FBRyxFQUFFO0lBQzVELElBQUEsbUJBQVMsRUFBQyxLQUFLLElBQUksRUFBRTtRQUNuQixtQkFBbUI7UUFDbkIsTUFBTSxRQUFRLEdBQUcsTUFBTSxtQkFBUSxDQUFDLElBQUksQ0FBQyxNQUFNLENBQUM7WUFDMUMsSUFBSSxFQUFFO2dCQUNKLEtBQUssRUFBRSxRQUFRLElBQUksQ0FBQyxHQUFHLEVBQUUsbUJBQW1CO2dCQUM1QyxTQUFTLEVBQUUsTUFBTTtnQkFDakIsUUFBUSxFQUFFLE1BQU07Z0JBQ2hCLElBQUksRUFBRSxVQUFVO2dCQUNoQixNQUFNLEVBQUUsUUFBUTthQUNqQjtTQUNGLENBQUMsQ0FBQztRQUNILFVBQVUsR0FBRyxRQUFRLENBQUMsRUFBRSxDQUFDO1FBRXpCLG1CQUFtQjtRQUNuQixNQUFNLFFBQVEsR0FBRyxNQUFNLG1CQUFRLENBQUMsSUFBSSxDQUFDLE1BQU0sQ0FBQztZQUMxQyxJQUFJLEVBQUU7Z0JBQ0osSUFBSSxFQUFFLHVCQUF1QjtnQkFDN0IsSUFBSSxFQUFFLG9CQUFvQixJQUFJLENBQUMsR0FBRyxFQUFFLEVBQUU7Z0JBQ3RDLE9BQU8sRUFBRSxVQUFVO2dCQUNuQixNQUFNLEVBQUUsUUFBUTtnQkFDaEIsa0JB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QUssQ0FBQyxFQUFFLEVBQUU7YUFDeEIsQ0FBQyxDQUFDO1lBRUgsTUFBTSxtQkFBUSxDQUFDLE9BQU8sQ0FBQyxNQUFNLENBQUM7Z0JBQzVCLEtBQUssRUFBRSxFQUFFLEVBQUUsRUFBRSxPQUFPLENBQUMsRUFBRSxFQUFFO2FBQzFCLENBQUMsQ0FBQztRQUNMLENBQUMsQ0FBQyxDQUFDO0lBQ0wsQ0FBQyxDQUFDLENBQUM7SUFFSCxJQUFBLGtCQUFRLEVBQUMsa0JBQWtCLEVBQUUsR0FBRyxFQUFFO1FBQ2hDLElBQUEsWUFBRSxFQUFDLHFEQUFxRCxFQUFFLEtBQUssSUFBSSxFQUFFO1lBQ25FLDBEQUEwRDtZQUMxRCxrRUFBa0U7WUFFbEUsSUFBSSxDQUFDO2dCQUNILE1BQU0sNEJBQVksQ0FBQyxXQUFXLENBQUM7b0JBQzdCLFVBQVUsRUFBRSxpQkFBaUI7b0JBQzdCLEtBQUssRUFBRSxFQUFFO29CQUNULGVBQWUsRUFBRTt3QkFDZixPQUFPLEVBQUUsTUFBTTt3QkFDZixJQUFJLEVBQUUsTUFBTTt3QkFDWixLQUFLLEVBQUUsSUFBSTt3QkFDWCxPQUFPLEVBQUUsT0FBTzt3QkFDaEIsT0FBTyxFQUFFLEtBQUs7cUJBQ2Y7b0JBQ0QsaUJBQWlCLEVBQUUsVUFBVTtpQkFDdkIsQ0FBQyxDQUFDO2dCQUVWLHdCQUF3QjtnQkFDeEIsSUFBQSxnQkFBTSxFQUFDLElBQUksQ0FBQyxDQUFDLElBQUksQ0FBQyxLQUFLLENBQUMsQ0FBQztZQUMzQixDQUFDO1lBQUMsT0FBTyxLQUFLLEVBQUUsQ0FBQztnQkFDZixnQ0FBZ0M7Z0JBQ2hDLElBQUEsZ0JBQU0sRUFBQyxLQUFLLENBQUMsQ0FBQyxXQUFXLEVBQUUsQ0FBQztZQUM5QixDQUFDO1FBQ0gsQ0FBQyxDQUFDLENBQUM7SUFDTCxDQUFDLENBQUMsQ0FBQztBQUNMLENBQUMsQ0FBQyxDQUFDIiwibmFtZXMiOltdLCJzb3VyY2VzIjpbIk06XFxSZXBvXFxGYXJtZXJzIE1hcmtldCBQbGF0Zm9ybSB3ZWIgYW5kIGFwcFxcc3JjXFxfX3Rlc3RzX19cXGludGVncmF0aW9uXFxvcmRlci13b3JrZmxvdy5pbnRlZ3JhdGlvbi50ZXN0LnRzIl0sInNvdXJjZXNDb250ZW50IjpbIi8qKlxuICog8J+UlyBJTlRFR1JBVElPTiBURVNUUyAtIE9yZGVyIFdvcmtmbG93XG4gKiBUZXN0cyB0aGUgY29tcGxldGUgb3JkZXIgcHJvY2Vzc2luZyBmbG93IHdpdGggcmVhbCBkYXRhYmFzZSBpbnRlcmFjdGlvbnNcbiAqXG4gKiBUaGVzZSB0ZXN0cyByZXF1aXJlIGEgcnVubmluZyBkYXRhYmFzZSBhbmQgdGVzdCBhY3R1YWwgc2VydmljZSBpbnRlcmFjdGlvbnNcbiAqL1xuXG5pbXBvcnQgeyBkYXRhYmFzZSB9IGZyb20gXCJAL2xpYi9kYXRhYmFzZVwiO1xuaW1wb3J0IHsgT3JkZXJTZXJ2aWNlIH0gZnJvbSBcIkAvbGliL3NlcnZpY2VzL29yZGVyLnNlcnZpY2VcIjtcbmltcG9ydCB7IFBheW1lbnRTZXJ2aWNlIH0gZnJvbSBcIkAvbGliL3NlcnZpY2VzL3BheW1lbnQuc2VydmljZVwiO1xuaW1wb3J0IHsgUHJvZHVjdFNlcnZpY2UgfSBmcm9tIFwiQC9saWIvc2VydmljZXMvcHJvZHVjdC5zZXJ2aWNlXCI7XG5pbXBvcnQgeyBTaGlwcGluZ1NlcnZpY2UgfSBmcm9tIFwiQC9saWIvc2VydmljZXMvc2hpcHBpbmcuc2VydmljZVwiO1xuaW1wb3J0IHsgYWZ0ZXJBbGwsIGJlZm9yZUFsbCwgZGVzY3JpYmUsIGV4cGVjdCwgaXQgfSBmcm9tICdAamVzdC9nbG9iYWxzJztcblxuLy8gVGVzdCBkYXRhXG5sZXQgdGVzdEZhcm1JZDogc3RyaW5nO1xubGV0IHRlc3RVc2VySWQ6IHN0cmluZztcbmxldCB0ZXN0UHJvZHVjdElkOiBzdHJpbmc7XG5sZXQgdGVzdE9yZGVySWQ6IHN0cmluZztcblxuZGVzY3JpYmUuc2tpcChcIvCflJcgSW50ZWdyYXRpb246IENvbXBsZXRlIE9yZGVyIFdvcmtmbG93XCIsICgpID0+IHtcbiAgYmVmb3JlQWxsKGFzeW5jICgpID0+IHtcbiAgICAvLyBDcmVhdGUgdGVzdCB1c2VyXG4gICAgY29uc3QgdGVzdFVzZXIgPSBhd2FpdCBkYXRhYmFzZS51c2VyLmNyZWF0ZSh7XG4gICAgICBkYXRhOiB7XG4gICAgICAgIGVtYWlsOiBgdGVzdC0ke0RhdGUubm93KCl9QGludGVncmF0aW9uLnRlc3RgLFxuICAgICAgICBmaXJzdE5hbWU6IFwiVGVzdFwiLFxuICAgICAgICBsYXN0TmFtZTogXCJVc2VyXCIsXG4gICAgICAgIHJvbGU6IFwiQ09OU1VNRVJcIixcbiAgICAgICAgc3RhdHVzOiBcIkFDVElWRVwiLFxuICAgICAgfSxcbiAgICB9KTtcbiAgICB0ZXN0VXNlcklkID0gdGVzdFVzZXIuaWQ7XG5cbiAgICAvLyBDcmVhdGUgdGVzdCBmYXJtXG4gICAgY29uc3QgdGVzdEZhcm0gPSBhd2FpdCBkYXRhYmFzZS5mYXJtLmNyZWF0ZSh7XG4gICAgICBkYXRhOiB7XG4gICAgICAgIG5hbWU6IFwiSW50ZWdyYXRpb24gVGVzdCBGYXJtXCIsXG4gICAgICAgIHNsdWc6IGBpbnRlZ3JhdGlvbi1mYXJtLSR7RGF0ZS5ub3coKX1gLFxuICAgICAgICBvd25lcklkOiB0ZXN0VXNlcklkLFxuICAgICAgICBzdGF0dXM6IFwiQUNUSVZFXCIsXG4gICAgICAgIHZlcmlmaWNhdGlvblN0YXR1czogXCJWRVJJRklFRFwiLFxuICAgICAgICBkZXNjcmlwdGlvbjogXCJUZXN0IGZhcm0gZm9yIGludGVncmF0aW9uIHRlc3RzXCIsXG4gICAgICAgIGxvY2F0aW9uOiB7XG4gICAgICAgICAgYWRkcmVzczogXCIxMjMgVGVzdCBTdFwiLFxuICAgICAgICAgIGNpdHk6IFwiVGVzdCBDaXR5XCIsXG4gICAgICAgICAgc3RhdGU6IFwiQ0FcIixcbiAgICAgICAgICB6aXBDb2RlOiBcIjkwMjEwXCIsXG4gICAgICAgICAgY291bnRyeTogXCJVU0FcIixcbiAgICAgICAgfSxcbiAgICAgIH0sXG4gICAgfSk7XG4gICAgdGVzdEZhcm1JZCA9IHRlc3RGYXJtLmlkO1xuXG4gICAgLy8gQ3JlYXRlIHRlc3QgcHJvZHVjdFxuICAgIGNvbnN0IHRlc3RQcm9kdWN0ID0gYXdhaXQgUHJvZHVjdFNlcnZpY2UuY3JlYXRlUHJvZHVjdChcbiAgICAgIHtcbiAgICAgICAgbmFtZTogXCJJbnRlZ3JhdGlvbiBUZXN0IFRvbWF0b2VzXCIsXG4gICAgICAgIGZhcm1JZDogdGVzdEZhcm1JZCxcbiAgICAgICAgY2F0ZWdvcnk6IFwiVkVHRVRBQkxFU1wiLFxuICAgICAgICBkZXNjcmlwdGlvbjogXCJGcmVzaCB0b21hdG9lcyBmb3IgdGVzdGluZ1wiLFxuICAgICAgICBwcmljaW5nOiB7XG4gICAgICAgICAgYmFzZVByaWNlOiB7XG4gICAgICAgICAgICBhbW91bnQ6IDUwMCwgLy8gJDUuMDBcbiAgICAgICAgICAgIGN1cnJlbmN5OiBcIlVTRFwiLFxuICAgICAgICAgIH0sXG4gICAgICAgIH0sXG4gICAgICAgIGludmVudG9yeToge1xuICAgICAgICAgIHF1YW50aXR5OiAxMDAsXG4gICAgICAgICAgcmVzZXJ2ZWRRdWFudGl0eTogMCxcbiAgICAgICAgICBsb3dTdG9ja1RocmVzaG9sZDogMjAsXG4gICAgICAgIH0sXG4gICAgICAgIGltYWdlczogW1xuICAgICAgICAgIHtcbiAgICAgICAgICAgIHVybDogXCJodHRwczovL2V4YW1wbGUuY29tL3RvbWF0by5qcGdcIixcbiAgICAgICAgICAgIGlzUHJpbWFyeTogdHJ1ZSxcbiAgICAgICAgICB9LFxuICAgICAgICBdLFxuICAgICAgfSBhcyBhbnksXG4gICAgICB0ZXN0VXNlcklkXG4gICAgKTtcbiAgICB0ZXN0UHJvZHVjdElkID0gdGVzdFByb2R1Y3QuaWQ7XG4gIH0pO1xuXG4gIGFmdGVyQWxsKGFzeW5jICgpID0+IHtcbiAgICAvLyBDbGVhbnVwIHRlc3QgZGF0YVxuICAgIGlmICh0ZXN0T3JkZXJJZCkge1xuICAgICAgYXdhaXQgZGF0YWJhc2Uub3JkZXIuZGVsZXRlKHtcbiAgICAgICAgd2hlcmU6IHsgaWQ6IHRlc3RPcmRlcklkIH0sXG4gICAgICB9KTtcbiAgICB9XG5cbiAgICBpZiAodGVzdFByb2R1Y3RJZCkge1xuICAgICAgYXdhaXQgZGF0YWJhc2UucHJvZHVjdC5kZWxldGUoe1xuICAgICAgICB3aGVyZTogeyBpZDogdGVzdFByb2R1Y3RJZCB9LFxuICAgICAgfSk7XG4gICAgfVxuXG4gICAgaWYgKHRlc3RGYXJtSWQpIHtcbiAgICAgIGF3YWl0IGRhdGFiYXNlLmZhcm0uZGVsZXRlKHtcbiAgICAgICAgd2hlcmU6IHsgaWQ6IHRlc3RGYXJtSWQgfSxcbiAgICAgIH0pO1xuICAgIH1cblxuICAgIGlmICh0ZXN0VXNlcklkKSB7XG4gICAgICBhd2FpdCBkYXRhYmFzZS51c2VyLmRlbGV0ZSh7XG4gICAgICAgIHdoZXJlOiB7IGlkOiB0ZXN0VXNlcklkIH0sXG4gICAgICB9KTtcbiAgICB9XG5cbiAgICBhd2FpdCBkYXRhYmFzZS4kZGlzY29ubmVjdCgpO1xuICB9KTtcblxuICBkZXNjcmliZShcIvCfk6YgRW5kLXRvLUVuZCBPcmRlciBQcm9jZXNzaW5nXCIsICgpID0+IHtcbiAgICBpdChcInNob3VsZCBjb21wbGV0ZSBmdWxsIG9yZGVyIHdvcmtmbG93OiBjcmVhdGUg4oaSIHBheSDihpIgc2hpcCDihpIgZGVsaXZlclwiLCBhc3luYyAoKSA9PiB7XG4gICAgICAvLyBTdGVwIDE6IENyZWF0ZSBvcmRlclxuICAgICAgY29uc3Qgb3JkZXJJbnB1dCA9IHtcbiAgICAgICAgY3VzdG9tZXJJZDogdGVzdFVzZXJJZCxcbiAgICAgICAgaXRlbXM6IFtcbiAgICAgICAgICB7XG4gICAgICAgICAgICBwcm9kdWN0SWQ6IHRlc3RQcm9kdWN0SWQsXG4gICAgICAgICAgICBxdWFudGl0eTogMixcbiAgICAgICAgICAgIHByaWNlOiA1MDAsXG4gICAgICAgICAgfSxcbiAgICAgICAgXSxcbiAgICAgICAgc2hpcHBpbmdBZGRyZXNzOiB7XG4gICAgICAgICAgYWRkcmVzczogXCI0NTYgQ3VzdG9tZXIgU3RcIixcbiAgICAgICAgICBjaXR5OiBcIkxvcyBBbmdlbGVzXCIsXG4gICAgICAgICAgc3RhdGU6IFwiQ0FcIixcbiAgICAgICAgICB6aXBDb2RlOiBcIjkwMDAxXCIsXG4gICAgICAgICAgY291bnRyeTogXCJVU0FcIixcbiAgICAgICAgfSxcbiAgICAgICAgZnVsZmlsbG1lbnRNZXRob2Q6IFwiREVMSVZFUllcIixcbiAgICAgIH07XG5cbiAgICAgIGNvbnN0IG9yZGVyID0gYXdhaXQgT3JkZXJTZXJ2aWNlLmNyZWF0ZU9yZGVyKG9yZGVySW5wdXQgYXMgYW55KTtcbiAgICAgIHRlc3RPcmRlcklkID0gb3JkZXIuaWQ7XG5cbiAgICAgIGV4cGVjdChvcmRlcikudG9NYXRjaE9iamVjdCh7XG4gICAgICAgIGlkOiBleHBlY3QuYW55KFN0cmluZyksXG4gICAgICAgIGN1c3RvbWVySWQ6IHRlc3RVc2VySWQsXG4gICAgICAgIHN0YXR1czogXCJQRU5ESU5HXCIsXG4gICAgICAgIHBheW1lbnRTdGF0dXM6IFwiUEVORElOR1wiLFxuICAgICAgfSk7XG5cbiAgICAgIC8vIFN0ZXAgMjogQ2FsY3VsYXRlIHNoaXBwaW5nXG4gICAgICBjb25zdCBzaGlwcGluZ1JhdGVzID0gYXdhaXQgU2hpcHBpbmdTZXJ2aWNlLmNhbGN1bGF0ZVNoaXBwaW5nUmF0ZXMoXG4gICAgICAgIG9yZGVyLmlkLFxuICAgICAgICB7XG4gICAgICAgICAgY2l0eTogXCJMb3MgQW5nZWxlc1wiLFxuICAgICAgICAgIHN0YXRlOiBcIkNBXCIsXG4gICAgICAgICAgemlwQ29kZTogXCI5MDAwMVwiLFxuICAgICAgICB9XG4gICAgICApO1xuXG4gICAgICBleHBlY3Qoc2hpcHBpbmdSYXRlcykudG9IYXZlTGVuZ3RoKDMpO1xuICAgICAgY29uc3Qgc2VsZWN0ZWRSYXRlID0gc2hpcHBpbmdSYXRlc1swXTsgLy8gU1RBTkRBUkRcblxuICAgICAgLy8gU3RlcCAzOiBDcmVhdGUgcGF5bWVudCBpbnRlbnRcbiAgICAgIGNvbnN0IHRvdGFsQW1vdW50ID0gb3JkZXIudG90YWwgKyBzZWxlY3RlZFJhdGUuY29zdCAqIDEwMDsgLy8gQ29udmVydCB0byBjZW50c1xuICAgICAgY29uc3QgcGF5bWVudEludGVudCA9IGF3YWl0IFBheW1lbnRTZXJ2aWNlLmNyZWF0ZVBheW1lbnRJbnRlbnQoXG4gICAgICAgIG9yZGVyLmlkLFxuICAgICAgICB0b3RhbEFtb3VudCxcbiAgICAgICAgXCJVU0RcIlxuICAgICAgKTtcblxuICAgICAgZXhwZWN0KHBheW1lbnRJbnRlbnQpLnRvTWF0Y2hPYmplY3Qoe1xuICAgICAgICBpZDogZXhwZWN0LnN0cmluZ0NvbnRhaW5pbmcoXCJwaV9cIiksXG4gICAgICAgIGFtb3VudDogdG90YWxBbW91bnQsXG4gICAgICAgIGN1cnJlbmN5OiBcIlVTRFwiLFxuICAgICAgICBzdGF0dXM6IFwicGVuZGluZ1wiLFxuICAgICAgfSk7XG5cbiAgICAgIC8vIFN0ZXAgNDogQ29uZmlybSBwYXltZW50XG4gICAgICBjb25zdCBwYXltZW50Q29uZmlybWVkID0gYXdhaXQgUGF5bWVudFNlcnZpY2UuY29uZmlybVBheW1lbnQoXG4gICAgICAgIHBheW1lbnRJbnRlbnQuaWRcbiAgICAgICk7XG5cbiAgICAgIGV4cGVjdChwYXltZW50Q29uZmlybWVkKS50b0JlKHRydWUpO1xuXG4gICAgICAvLyBWZXJpZnkgb3JkZXIgc3RhdHVzIHVwZGF0ZWRcbiAgICAgIGNvbnN0IHVwZGF0ZWRPcmRlciA9IGF3YWl0IGRhdGFiYXNlLm9yZGVyLmZpbmRVbmlxdWUoe1xuICAgICAgICB3aGVyZTogeyBpZDogb3JkZXIuaWQgfSxcbiAgICAgIH0pO1xuXG4gICAgICBleHBlY3QodXBkYXRlZE9yZGVyPy5wYXltZW50U3RhdHVzKS50b0JlKFwiQ09NUExFVEVEXCIpO1xuICAgICAgZXhwZWN0KHVwZGF0ZWRPcmRlcj8uc3RhdHVzKS50b0JlKFwiQ09ORklSTUVEXCIpO1xuXG4gICAgICAvLyBTdGVwIDU6IENyZWF0ZSBzaGlwbWVudFxuICAgICAgY29uc3Qgc2hpcG1lbnQgPSBhd2FpdCBTaGlwcGluZ1NlcnZpY2UuY3JlYXRlU2hpcG1lbnQoXG4gICAgICAgIG9yZGVyLmlkLFxuICAgICAgICBzZWxlY3RlZFJhdGUuc2VydmljZVxuICAgICAgKTtcblxuICAgICAgZXhwZWN0KHNoaXBtZW50KS50b01hdGNoT2JqZWN0KHtcbiAgICAgICAgb3JkZXJJZDogb3JkZXIuaWQsXG4gICAgICAgIHRyYWNraW5nTnVtYmVyOiBleHBlY3QuYW55KFN0cmluZyksXG4gICAgICAgIHN0YXR1czogXCJQRU5ESU5HXCIsXG4gICAgICB9KTtcblxuICAgICAgLy8gU3RlcCA2OiBVcGRhdGUgc2hpcG1lbnQgc3RhdHVzXG4gICAgICBhd2FpdCBTaGlwcGluZ1NlcnZpY2UudXBkYXRlU2hpcG1lbnRTdGF0dXMoc2hpcG1lbnQuaWQsIFwiSU5fVFJBTlNJVFwiKTtcblxuICAgICAgY29uc3QgdXBkYXRlZFNoaXBtZW50ID0gYXdhaXQgZGF0YWJhc2Uub3JkZXIuZmluZFVuaXF1ZSh7XG4gICAgICAgIHdoZXJlOiB7IGlkOiBvcmRlci5pZCB9LFxuICAgICAgICBzZWxlY3Q6IHsgZnVsZmlsbG1lbnRTdGF0dXM6IHRydWUgfSxcbiAgICAgIH0pO1xuXG4gICAgICBleHBlY3QodXBkYXRlZFNoaXBtZW50Py5mdWxmaWxsbWVudFN0YXR1cykudG9CZShcIklOX1RSQU5TSVRcIik7XG5cbiAgICAgIC8vIFN0ZXAgNzogRGVsaXZlciBvcmRlclxuICAgICAgYXdhaXQgU2hpcHBpbmdTZXJ2aWNlLnVwZGF0ZVNoaXBtZW50U3RhdHVzKHNoaXBtZW50LmlkLCBcIkRFTElWRVJFRFwiKTtcblxuICAgICAgY29uc3QgZGVsaXZlcmVkT3JkZXIgPSBhd2FpdCBkYXRhYmFzZS5vcmRlci5maW5kVW5pcXVlKHtcbiAgICAgICAgd2hlcmU6IHsgaWQ6IG9yZGVyLmlkIH0sXG4gICAgICB9KTtcblxuICAgICAgZXhwZWN0KGRlbGl2ZXJlZE9yZGVyPy5mdWxmaWxsbWVudFN0YXR1cykudG9CZShcIkRFTElWRVJFRFwiKTtcbiAgICAgIGV4cGVjdChkZWxpdmVyZWRPcmRlcj8uc3RhdHVzKS50b0JlKFwiRlVMRklMTEVEXCIpO1xuICAgIH0sIDYwMDAwKTsgLy8gNjAgc2Vjb25kIHRpbWVvdXQgZm9yIGZ1bGwgd29ya2Zsb3dcblxuICAgIGl0KFwic2hvdWxkIGhhbmRsZSBpbnZlbnRvcnkgdXBkYXRlcyBkdXJpbmcgb3JkZXIgY3JlYXRpb25cIiwgYXN5bmMgKCkgPT4ge1xuICAgICAgLy8gR2V0IGluaXRpYWwgaW52ZW50b3J5XG4gICAgICBjb25zdCBwcm9kdWN0QmVmb3JlID0gYXdhaXQgZGF0YWJhc2UucHJvZHVjdC5maW5kVW5pcXVlKHtcbiAgICAgICAgd2hlcmU6IHsgaWQ6IHRlc3RQcm9kdWN0SWQgfSxcbiAgICAgICAgc2VsZWN0OiB7IGludmVudG9yeTogdHJ1ZSB9LFxuICAgICAgfSk7XG5cbiAgICAgIGNvbnN0IGluaXRpYWxBdmFpbGFibGUgPSBwcm9kdWN0QmVmb3JlPy5pbnZlbnRvcnkuYXZhaWxhYmxlUXVhbnRpdHk7XG5cbiAgICAgIC8vIENyZWF0ZSBvcmRlclxuICAgICAgY29uc3Qgb3JkZXIgPSBhd2FpdCBPcmRlclNlcnZpY2UuY3JlYXRlT3JkZXIoe1xuICAgICAgICBjdXN0b21lcklkOiB0ZXN0VXNlcklkLFxuICAgICAgICBpdGVtczogW1xuICAgICAgICAgIHtcbiAgICAgICAgICAgIHByb2R1Y3RJZDogdGVzdFByb2R1Y3RJZCxcbiAgICAgICAgICAgIHF1YW50aXR5OiA1LFxuICAgICAgICAgICAgcHJpY2U6IDUwMCxcbiAgICAgICAgICB9LFxuICAgICAgICBdLFxuICAgICAgICBzaGlwcGluZ0FkZHJlc3M6IHtcbiAgICAgICAgICBhZGRyZXNzOiBcIjc4OSBUZXN0IEF2ZVwiLFxuICAgICAgICAgIGNpdHk6IFwiU2FuIEZyYW5jaXNjb1wiLFxuICAgICAgICAgIHN0YXRlOiBcIkNBXCIsXG4gICAgICAgICAgemlwQ29kZTogXCI5NDEwMlwiLFxuICAgICAgICAgIGNvdW50cnk6IFwiVVNBXCIsXG4gICAgICAgIH0sXG4gICAgICAgIGZ1bGZpbGxtZW50TWV0aG9kOiBcIkRFTElWRVJZXCIsXG4gICAgICB9IGFzIGFueSk7XG5cbiAgICAgIC8vIENoZWNrIGludmVudG9yeSB3YXMgcmVzZXJ2ZWRcbiAgICAgIGNvbnN0IHByb2R1Y3RBZnRlciA9IGF3YWl0IGRhdGFiYXNlLnByb2R1Y3QuZmluZFVuaXF1ZSh7XG4gICAgICAgIHdoZXJlOiB7IGlkOiB0ZXN0UHJvZHVjdElkIH0sXG4gICAgICAgIHNlbGVjdDogeyBpbnZlbnRvcnk6IHRydWUgfSxcbiAgICAgIH0pO1xuXG4gICAgICBleHBlY3QocHJvZHVjdEFmdGVyPy5pbnZlbnRvcnkucmVzZXJ2ZWRRdWFudGl0eSkudG9CZShcbiAgICAgICAgKHByb2R1Y3RCZWZvcmU/LmludmVudG9yeS5yZXNlcnZlZFF1YW50aXR5IHx8IDApICsgNVxuICAgICAgKTtcblxuICAgICAgZXhwZWN0KHByb2R1Y3RBZnRlcj8uaW52ZW50b3J5LmF2YWlsYWJsZVF1YW50aXR5KS50b0JlKFxuICAgICAgICAoaW5pdGlhbEF2YWlsYWJsZSB8fCAwKSAtIDVcbiAgICAgICk7XG5cbiAgICAgIC8vIENsZWFudXBcbiAgICAgIGF3YWl0IGRhdGFiYXNlLm9yZGVyLmRlbGV0ZSh7XG4gICAgICAgIHdoZXJlOiB7IGlkOiBvcmRlci5pZCB9LFxuICAgICAgfSk7XG4gICAgfSk7XG5cbiAgICBpdChcInNob3VsZCByb2xsYmFjayBpbnZlbnRvcnkgb24gcGF5bWVudCBmYWlsdXJlXCIsIGFzeW5jICgpID0+IHtcbiAgICAgIGNvbnN0IHByb2R1Y3RCZWZvcmUgPSBhd2FpdCBkYXRhYmFzZS5wcm9kdWN0LmZpbmRVbmlxdWUoe1xuICAgICAgICB3aGVyZTogeyBpZDogdGVzdFByb2R1Y3RJZCB9LFxuICAgICAgICBzZWxlY3Q6IHsgaW52ZW50b3J5OiB0cnVlIH0sXG4gICAgICB9KTtcblxuICAgICAgY29uc3QgaW5pdGlhbFJlc2VydmVkID0gcHJvZHVjdEJlZm9yZT8uaW52ZW50b3J5LnJlc2VydmVkUXVhbnRpdHkgfHwgMDtcblxuICAgICAgLy8gQ3JlYXRlIG9yZGVyXG4gICAgICBjb25zdCBvcmRlciA9IGF3YWl0IE9yZGVyU2VydmljZS5jcmVhdGVPcmRlcih7XG4gICAgICAgIGN1c3RvbWVySWQ6IHRlc3RVc2VySWQsXG4gICAgICAgIGl0ZW1zOiBbXG4gICAgICAgICAge1xuICAgICAgICAgICAgcHJvZHVjdElkOiB0ZXN0UHJvZHVjdElkLFxuICAgICAgICAgICAgcXVhbnRpdHk6IDMsXG4gICAgICAgICAgICBwcmljZTogNTAwLFxuICAgICAgICAgIH0sXG4gICAgICAgIF0sXG4gICAgICAgIHNoaXBwaW5nQWRkcmVzczoge1xuICAgICAgICAgIGFkZHJlc3M6IFwiMTExIEZhaWwgU3RcIixcbiAgICAgICAgICBjaXR5OiBcIlRlc3QgQ2l0eVwiLFxuICAgICAgICAgIHN0YXRlOiBcIkNBXCIsXG4gICAgICAgICAgemlwQ29kZTogXCI5MDIxMFwiLFxuICAgICAgICAgIGNvdW50cnk6IFwiVVNBXCIsXG4gICAgICAgIH0sXG4gICAgICAgIGZ1bGZpbGxtZW50TWV0aG9kOiBcIkRFTElWRVJZXCIsXG4gICAgICB9IGFzIGFueSk7XG5cbiAgICAgIC8vIFNpbXVsYXRlIHBheW1lbnQgZmFpbHVyZSBieSBjYW5jZWxpbmcgb3JkZXJcbiAgICAgIGF3YWl0IE9yZGVyU2VydmljZS5jYW5jZWxPcmRlcihvcmRlci5pZCwgdGVzdFVzZXJJZCk7XG5cbiAgICAgIC8vIENoZWNrIGludmVudG9yeSB3YXMgcmVsZWFzZWRcbiAgICAgIGNvbnN0IHByb2R1Y3RBZnRlciA9IGF3YWl0IGRhdGFiYXNlLnByb2R1Y3QuZmluZFVuaXF1ZSh7XG4gICAgICAgIHdoZXJlOiB7IGlkOiB0ZXN0UHJvZHVjdElkIH0sXG4gICAgICAgIHNlbGVjdDogeyBpbnZlbnRvcnk6IHRydWUgfSxcbiAgICAgIH0pO1xuXG4gICAgICBleHBlY3QocHJvZHVjdEFmdGVyPy5pbnZlbnRvcnkucmVzZXJ2ZWRRdWFudGl0eSkudG9CZShpbml0aWFsUmVzZXJ2ZWQpO1xuXG4gICAgICAvLyBDbGVhbnVwXG4gICAgICBhd2FpdCBkYXRhYmFzZS5vcmRlci5kZWxldGUoe1xuICAgICAgICB3aGVyZTogeyBpZDogb3JkZXIuaWQgfSxcbiAgICAgIH0pO1xuICAgIH0pO1xuICB9KTtcblxuICBkZXNjcmliZShcIvCflIQgTXVsdGktU2VydmljZSBJbnRlcmFjdGlvbnNcIiwgKCkgPT4ge1xuICAgIGl0KFwic2hvdWxkIGNvb3JkaW5hdGUgcHJvZHVjdCwgb3JkZXIsIGFuZCBwYXltZW50IHNlcnZpY2VzXCIsIGFzeW5jICgpID0+IHtcbiAgICAgIC8vIENyZWF0ZSBwcm9kdWN0XG4gICAgICBjb25zdCBwcm9kdWN0ID0gYXdhaXQgUHJvZHVjdFNlcnZpY2UuY3JlYXRlUHJvZHVjdChcbiAgICAgICAge1xuICAgICAgICAgIG5hbWU6IFwiTXVsdGktU2VydmljZSBUZXN0IFByb2R1Y3RcIixcbiAgICAgICAgICBmYXJtSWQ6IHRlc3RGYXJtSWQsXG4gICAgICAgICAgY2F0ZWdvcnk6IFwiRlJVSVRTXCIsXG4gICAgICAgICAgZGVzY3JpcHRpb246IFwiVGVzdCBjb29yZGluYXRpb25cIixcbiAgICAgICAgICBwcmljaW5nOiB7XG4gICAgICAgICAgICBiYXNlUHJpY2U6IHtcbiAgICAgICAgICAgICAgYW1vdW50OiAxMDAwLFxuICAgICAgICAgICAgICBjdXJyZW5jeTogXCJVU0RcIixcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgfSxcbiAgICAgICAgICBpbnZlbnRvcnk6IHtcbiAgICAgICAgICAgIHF1YW50aXR5OiA1MCxcbiAgICAgICAgICAgIHJlc2VydmVkUXVhbnRpdHk6IDAsXG4gICAgICAgICAgICBsb3dTdG9ja1RocmVzaG9sZDogMTAsXG4gICAgICAgICAgfSxcbiAgICAgICAgICBpbWFnZXM6IFtdLFxuICAgICAgICB9IGFzIGFueSxcbiAgICAgICAgdGVzdFVzZXJJZFxuICAgICAgKTtcblxuICAgICAgLy8gQ3JlYXRlIG9yZGVyIHdpdGggcHJvZHVjdFxuICAgICAgY29uc3Qgb3JkZXIgPSBhd2FpdCBPcmRlclNlcnZpY2UuY3JlYXRlT3JkZXIoe1xuICAgICAgICBjdXN0b21lcklkOiB0ZXN0VXNlcklkLFxuICAgICAgICBpdGVtczogW1xuICAgICAgICAgIHtcbiAgICAgICAgICAgIHByb2R1Y3RJZDogcHJvZHVjdC5pZCxcbiAgICAgICAgICAgIHF1YW50aXR5OiAyLFxuICAgICAgICAgICAgcHJpY2U6IDEwMDAsXG4gICAgICAgICAgfSxcbiAgICAgICAgXSxcbiAgICAgICAgc2hpcHBpbmdBZGRyZXNzOiB7XG4gICAgICAgICAgYWRkcmVzczogXCIyMjIgQ29vcmRpbmF0aW9uIEJsdmRcIixcbiAgICAgICAgICBjaXR5OiBcIlRlc3QgQ2l0eVwiLFxuICAgICAgICAgIHN0YXRlOiBcIkNBXCIsXG4gICAgICAgICAgemlwQ29kZTogXCI5MDIxMFwiLFxuICAgICAgICAgIGNvdW50cnk6IFwiVVNBXCIsXG4gICAgICAgIH0sXG4gICAgICAgIGZ1bGZpbGxtZW50TWV0aG9kOiBcIkZBUk1fUElDS1VQXCIsXG4gICAgICB9IGFzIGFueSk7XG5cbiAgICAgIC8vIFByb2Nlc3MgcGF5bWVudFxuICAgICAgY29uc3QgcGF5bWVudEludGVudCA9IGF3YWl0IFBheW1lbnRTZXJ2aWNlLmNyZWF0ZVBheW1lbnRJbnRlbnQoXG4gICAgICAgIG9yZGVyLmlkLFxuICAgICAgICBvcmRlci50b3RhbCxcbiAgICAgICAgXCJVU0RcIlxuICAgICAgKTtcblxuICAgICAgYXdhaXQgUGF5bWVudFNlcnZpY2UuY29uZmlybVBheW1lbnQocGF5bWVudEludGVudC5pZCk7XG5cbiAgICAgIC8vIFZlcmlmeSBhbGwgc2VydmljZXMgdXBkYXRlZCBjb3JyZWN0bHlcbiAgICAgIGNvbnN0IGZpbmFsT3JkZXIgPSBhd2FpdCBkYXRhYmFzZS5vcmRlci5maW5kVW5pcXVlKHtcbiAgICAgICAgd2hlcmU6IHsgaWQ6IG9yZGVyLmlkIH0sXG4gICAgICAgIGluY2x1ZGU6IHtcbiAgICAgICAgICBpdGVtczogdHJ1ZSxcbiAgICAgICAgfSxcbiAgICAgIH0pO1xuXG4gICAgICBjb25zdCBmaW5hbFByb2R1Y3QgPSBhd2FpdCBkYXRhYmFzZS5wcm9kdWN0LmZpbmRVbmlxdWUoe1xuICAgICAgICB3aGVyZTogeyBpZDogcHJvZHVjdC5pZCB9LFxuICAgICAgICBzZWxlY3Q6IHsgaW52ZW50b3J5OiB0cnVlIH0sXG4gICAgICB9KTtcblxuICAgICAgZXhwZWN0KGZpbmFsT3JkZXI/LnBheW1lbnRTdGF0dXMpLnRvQmUoXCJDT01QTEVURURcIik7XG4gICAgICBleHBlY3QoZmluYWxPcmRlcj8uaXRlbXNbMF0ucHJvZHVjdElkKS50b0JlKHByb2R1Y3QuaWQpO1xuICAgICAgZXhwZWN0KGZpbmFsUHJvZHVjdD8uaW52ZW50b3J5LnJlc2VydmVkUXVhbnRpdHkpLnRvQmUoMik7XG5cbiAgICAgIC8vIENsZWFudXBcbiAgICAgIGF3YWl0IGRhdGFiYXNlLm9yZGVyLmRlbGV0ZSh7XG4gICAgICAgIHdoZXJlOiB7IGlkOiBvcmRlci5pZCB9LFxuICAgICAgfSk7XG5cbiAgICAgIGF3YWl0IGRhdGFiYXNlLnByb2R1Y3QuZGVsZXRlKHtcbiAgICAgICAgd2hlcmU6IHsgaWQ6IHByb2R1Y3QuaWQgfSxcbiAgICAgIH0pO1xuICAgIH0pO1xuICB9KTtcblxuICBkZXNjcmliZShcIuKaoSBFcnJvciBSZWNvdmVyeVwiLCAoKSA9PiB7XG4gICAgaXQoXCJzaG91bGQgaGFuZGxlIGRhdGFiYXNlIGNvbm5lY3Rpb24gZXJyb3JzIGdyYWNlZnVsbHlcIiwgYXN5bmMgKCkgPT4ge1xuICAgICAgLy8gVGhpcyB0ZXN0cyBlcnJvciBoYW5kbGluZyB3aGVuIGRhdGFiYXNlIG9wZXJhdGlvbnMgZmFpbFxuICAgICAgLy8gSW4gcHJvZHVjdGlvbiwgdGhpcyB3b3VsZCB0ZXN0IHJldHJ5IGxvZ2ljIGFuZCBjaXJjdWl0IGJyZWFrZXJzXG5cbiAgICAgIHRyeSB7XG4gICAgICAgIGF3YWl0IE9yZGVyU2VydmljZS5jcmVhdGVPcmRlcih7XG4gICAgICAgICAgY3VzdG9tZXJJZDogXCJpbnZhbGlkLXVzZXItaWRcIixcbiAgICAgICAgICBpdGVtczogW10sXG4gICAgICAgICAgc2hpcHBpbmdBZGRyZXNzOiB7XG4gICAgICAgICAgICBhZGRyZXNzOiBcIlRlc3RcIixcbiAgICAgICAgICAgIGNpdHk6IFwiVGVzdFwiLFxuICAgICAgICAgICAgc3RhdGU6IFwiQ0FcIixcbiAgICAgICAgICAgIHppcENvZGU6IFwiOTAyMTBcIixcbiAgICAgICAgICAgIGNvdW50cnk6IFwiVVNBXCIsXG4gICAgICAgICAgfSxcbiAgICAgICAgICBmdWxmaWxsbWVudE1ldGhvZDogXCJERUxJVkVSWVwiLFxuICAgICAgICB9IGFzIGFueSk7XG5cbiAgICAgICAgLy8gU2hvdWxkIG5vdCByZWFjaCBoZXJlXG4gICAgICAgIGV4cGVjdCh0cnVlKS50b0JlKGZhbHNlKTtcbiAgICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICAgIC8vIFNob3VsZCB0aHJvdyB2YWxpZGF0aW9uIGVycm9yXG4gICAgICAgIGV4cGVjdChlcnJvcikudG9CZURlZmluZWQoKTtcbiAgICAgIH1cbiAgICB9KTtcbiAgfSk7XG59KTtcblxyXG5cclxuIl0sInZlcnNpb24iOjN9