0e695135eeb924f7a05de24dd61db470
"use strict";
/**
 * FARM SERVICE - DIVINE DATABASE OPERATIONS
 *
 * Business logic layer for farm entity operations.
 * Separates database concerns from API routes for cleaner architecture.
 *
 * Divine Patterns Applied:
 * - Service layer separation (from divine core principles)
 * - Type-safe database operations
 * - Enlightening error messages
 * - Quantum entity manifestation
 *
 * Functional Requirements: FR-011 (Farm Profile Creation)
 */
Object.defineProperty(exports, "__esModule", { value: true });
exports.createFarmService = createFarmService;
exports.checkExistingFarm = checkExistingFarm;
exports.getFarmById = getFarmById;
exports.getFarmBySlug = getFarmBySlug;
exports.updateFarmService = updateFarmService;
exports.deleteFarmService = deleteFarmService;
exports.listFarmsService = listFarmsService;
exports.searchFarmsService = searchFarmsService;
const agricultural_cache_1 = require("@/lib/cache/agricultural-cache");
const database_1 = require("@/lib/database");
const farm_types_1 = require("@/types/farm.types");
/**
 * Create farm with unique slug generation
 *
 * Handles slug collision detection and quantum farm manifestation.
 * Separates business logic from HTTP concerns.
 *
 * @param options - User ID and farm data
 * @returns Created quantum farm entity
 * @throws Error if slug generation fails or validation fails
 */
async function createFarmService(options) {
    const { userId, farmData } = options;
    // Input validation
    if (!userId || typeof userId !== "string") {
        throw new Error("Valid user ID is required");
    }
    if (!farmData.name || farmData.name.trim().length < 3) {
        throw new Error("Farm name must be at least 3 characters");
    }
    if (!farmData.city || !farmData.state) {
        throw new Error("City and state are required");
    }
    if (farmData.email && !validateEmail(farmData.email)) {
        throw new Error("Invalid email format");
    }
    // Email validation helper
    function validateEmail(email) {
        const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
        return emailRegex.test(email);
    }
    if (farmData.deliveryRadius && farmData.deliveryRadius < 0) {
        throw new Error("Delivery radius must be positive");
    }
    // Generate unique slug with collision detection
    const slug = await generateUniqueSlug(farmData.name, farmData.city);
    // Create farm in database
    const farm = await database_1.database.farm.create({
        data: {
            // Identity
            name: farmData.name,
            slug,
            ownerId: userId,
            // Business
            description: farmData.description,
            story: farmData.story,
            businessName: farmData.businessName,
            yearEstablished: farmData.yearEstablished,
            farmSize: farmData.farmSize,
            // Location
            address: farmData.address,
            city: farmData.city,
            state: farmData.state,
            zipCode: farmData.zipCode,
            country: "US",
            latitude: farmData.latitude,
            longitude: farmData.longitude,
            // Contact
            email: farmData.email || "",
            phone: farmData.phone || "",
            website: farmData.website || null,
            // Practices
            farmingPractices: farmData.farmingPractices || [],
            productCategories: farmData.productCategories || [],
            // Delivery
            deliveryRadius: farmData.deliveryRadius,
            // Status - PENDING until Stripe onboarded
            status: "PENDING",
            verificationStatus: "PENDING",
            stripeOnboarded: false,
            payoutsEnabled: false,
        },
        include: {
            owner: {
                select: {
                    id: true,
                    firstName: true,
                    lastName: true,
                    email: true,
                },
            },
        },
    });
    // Manifest quantum farm entity
    const quantumFarm = (0, farm_types_1.manifestQuantumFarm)(farm);
    return {
        farm: quantumFarm,
        slug: slug,
    };
}
/**
 * Check if user already has a farm
 *
 * @param userId - User ID to check
 * @returns Existing farm info if found
 */
async function checkExistingFarm(userId) {
    const farm = await database_1.database.farm.findFirst({
        where: {
            ownerId: userId,
        },
        select: {
            id: true,
            slug: true,
            name: true,
        },
    });
    if (!farm) {
        return { exists: false };
    }
    return {
        exists: true,
        farm,
    };
}
// ============================================================================
// UNIQUE SLUG GENERATION
// ============================================================================
const MAX_SLUG_ATTEMPTS = 10;
/**
 * Generate unique farm slug with collision detection
 *
 * Tries base slug first, then appends counter if collision detected.
 *
 * @param name - Farm name
 * @param city - Farm city
 * @returns Unique slug
 * @throws Error if max attempts exceeded
 */
async function generateUniqueSlug(name, city) {
    let slug = (0, farm_types_1.generateFarmSlug)(name, city);
    let attempt = 0;
    while (attempt < MAX_SLUG_ATTEMPTS) {
        const existing = await database_1.database.farm.findUnique({
            where: { slug },
            select: { id: true },
        });
        if (!existing) {
            return slug;
        }
        // Collision detected - try with counter
        attempt++;
        slug = `${(0, farm_types_1.generateFarmSlug)(name, city)}-${attempt}`;
    }
    throw new Error(`Failed to generate unique slug after ${MAX_SLUG_ATTEMPTS} attempts`);
}
// ============================================================================
// FARM RETRIEVAL SERVICES
// ============================================================================
/**
 * Get farm by ID with quantum manifestation
 * Uses agricultural cache for performance
 */
async function getFarmById(farmId) {
    // Try cache first
    const cached = await agricultural_cache_1.AgriculturalCache.getFarm(farmId);
    if (cached) {
        return cached;
    }
    // Fetch from database
    const farm = await database_1.database.farm.findUnique({
        where: { id: farmId },
        include: {
            owner: {
                select: {
                    id: true,
                    firstName: true,
                    lastName: true,
                    email: true,
                },
            },
        },
    });
    if (!farm) {
        return null;
    }
    const quantumFarm = (0, farm_types_1.manifestQuantumFarm)(farm);
    // Cache the result
    await agricultural_cache_1.AgriculturalCache.cacheFarm(farmId, quantumFarm);
    return quantumFarm;
}
/**
 * Get farm by slug with quantum manifestation
 * Uses agricultural cache for performance
 */
async function getFarmBySlug(slug) {
    // Try cache first (using slug as key)
    const cacheKey = `farm:slug:${slug}`;
    const cached = await agricultural_cache_1.AgriculturalCache.getFarm(cacheKey);
    if (cached) {
        return cached;
    }
    // Fetch from database
    const farm = await database_1.database.farm.findUnique({
        where: { slug },
        include: {
            owner: {
                select: {
                    id: true,
                    firstName: true,
                    lastName: true,
                    email: true,
                },
            },
        },
    });
    if (!farm) {
        return null;
    }
    const quantumFarm = (0, farm_types_1.manifestQuantumFarm)(farm);
    // Cache by both ID and slug
    await Promise.all([
        agricultural_cache_1.AgriculturalCache.cacheFarm(farm.id, quantumFarm),
        agricultural_cache_1.AgriculturalCache.cacheFarm(cacheKey, quantumFarm),
    ]);
    return quantumFarm;
}
/**
 * Update farm with ownership validation
 *
 * @param options - Farm ID, User ID, and update data
 * @returns Updated quantum farm entity
 * @throws Error if user doesn't own the farm
 */
async function updateFarmService(options) {
    const { farmId, userId, updateData } = options;
    // Verify ownership
    const existingFarm = await database_1.database.farm.findUnique({
        where: { id: farmId },
        select: { ownerId: true },
    });
    if (!existingFarm) {
        throw new Error("Farm not found");
    }
    if (existingFarm.ownerId !== userId) {
        throw new Error("Unauthorized: You don't own this farm");
    }
    // Update farm
    const updatedFarm = await database_1.database.farm.update({
        where: { id: farmId },
        data: {
            // Only update provided fields
            ...(updateData.name && { name: updateData.name }),
            ...(updateData.description && { description: updateData.description }),
            ...(updateData.story && { story: updateData.story }),
            ...(updateData.businessName && { businessName: updateData.businessName }),
            ...(updateData.yearEstablished && {
                yearEstablished: updateData.yearEstablished,
            }),
            ...(updateData.farmSize && { farmSize: updateData.farmSize }),
            ...(updateData.address && { address: updateData.address }),
            ...(updateData.city && { city: updateData.city }),
            ...(updateData.state && { state: updateData.state }),
            ...(updateData.zipCode && { zipCode: updateData.zipCode }),
            ...(updateData.latitude !== undefined && {
                latitude: updateData.latitude,
            }),
            ...(updateData.longitude !== undefined && {
                longitude: updateData.longitude,
            }),
            ...(updateData.email && { email: updateData.email }),
            ...(updateData.phone && { phone: updateData.phone }),
            ...(updateData.website !== undefined && { website: updateData.website }),
            ...(updateData.farmingPractices && {
                farmingPractices: updateData.farmingPractices,
            }),
            ...(updateData.productCategories && {
                productCategories: updateData.productCategories,
            }),
            ...(updateData.deliveryRadius !== undefined && {
                deliveryRadius: updateData.deliveryRadius,
            }),
        },
        include: {
            owner: {
                select: {
                    id: true,
                    firstName: true,
                    lastName: true,
                    email: true,
                },
            },
        },
    });
    const quantumFarm = (0, farm_types_1.manifestQuantumFarm)(updatedFarm);
    // Invalidate cache
    await agricultural_cache_1.AgriculturalCache.invalidateFarm(farmId);
    return quantumFarm;
}
/**
 * Delete farm with ownership validation
 *
 * Soft delete by setting status to INACTIVE
 *
 * @param options - Farm ID and User ID
 * @throws Error if user doesn't own the farm
 */
async function deleteFarmService(options) {
    const { farmId, userId } = options;
    // Verify ownership
    const existingFarm = await database_1.database.farm.findUnique({
        where: { id: farmId },
        select: { ownerId: true },
    });
    if (!existingFarm) {
        throw new Error("Farm not found");
    }
    if (existingFarm.ownerId !== userId) {
        throw new Error("Unauthorized: You don't own this farm");
    }
    // Soft delete (set status to INACTIVE)
    await database_1.database.farm.update({
        where: { id: farmId },
        data: {
            status: "INACTIVE",
        },
    });
    // Invalidate cache
    await agricultural_cache_1.AgriculturalCache.invalidateFarm(farmId);
}
/**
 * List farms with pagination and filtering
 *
 * @param options - Pagination and filter options
 * @returns Paginated list of quantum farms
 */
async function listFarmsService(options = {}) {
    const { page = 1, limit = 20, status, city, state, farmingPractices, sortBy = "createdAt", sortOrder = "desc", } = options;
    const skip = (page - 1) * limit;
    // Note: List queries are not cached due to complexity of filters and pagination
    // Individual farms are cached when retrieved
    // Build where clause
    const where = {
        status: { not: "INACTIVE" }, // Only active farms
    };
    if (status) {
        where.status = status; // Override with specific status if provided
    }
    if (city) {
        where.city = { contains: city, mode: "insensitive" };
    }
    if (state) {
        where.state = state;
    }
    if (farmingPractices && farmingPractices.length > 0) {
        where.farmingPractices = {
            hasSome: farmingPractices,
        };
    }
    // Get total count
    const total = await database_1.database.farm.count({ where });
    // Get paginated farms
    const farms = await database_1.database.farm.findMany({
        where,
        include: {
            owner: {
                select: {
                    id: true,
                    firstName: true,
                    lastName: true,
                    email: true,
                },
            },
        },
        orderBy: { [sortBy]: sortOrder },
        skip,
        take: limit,
    });
    return {
        farms: farms.map(farm_types_1.manifestQuantumFarm),
        total,
        page,
        totalPages: Math.ceil(total / limit),
    };
}
/**
 * Search farms by name, description, or location
 *
 * @param options - Search query and limit
 * @returns Matching quantum farms
 */
async function searchFarmsService(options) {
    const { query, limit = 10 } = options;
    const farms = await database_1.database.farm.findMany({
        where: {
            status: "ACTIVE",
            OR: [
                { name: { contains: query, mode: "insensitive" } },
                { description: { contains: query, mode: "insensitive" } },
                { city: { contains: query, mode: "insensitive" } },
                { state: { contains: query, mode: "insensitive" } },
            ],
        },
        include: {
            owner: {
                select: {
                    id: true,
                    firstName: true,
                    lastName: true,
                    email: true,
                },
            },
        },
        take: limit,
        orderBy: { name: "asc" },
    });
    return farms.map(farm_types_1.manifestQuantumFarm);
}
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiTTpcXFJlcG9cXEZhcm1lcnMgTWFya2V0IFBsYXRmb3JtIHdlYiBhbmQgYXBwXFxzcmNcXGxpYlxcc2VydmljZXNcXGZhcm0uc2VydmljZS50cyIsIm1hcHBpbmdzIjoiO0FBQUE7Ozs7Ozs7Ozs7Ozs7R0FhRzs7QUFxQ0gsOENBZ0dDO0FBcUJELDhDQXNCQztBQXFERCxrQ0FnQ0M7QUFNRCxzQ0FvQ0M7QUFtQkQsOENBeUVDO0FBbUJELDhDQTZCQztBQThCRCw0Q0FxRUM7QUFpQkQsZ0RBOEJDO0FBM2tCRCx1RUFBbUU7QUFDbkUsNkNBQTBDO0FBQzFDLG1EQU80QjtBQWdCNUI7Ozs7Ozs7OztHQVNHO0FBQ0ksS0FBSyxVQUFVLGlCQUFpQixDQUNyQyxPQUFpQztJQUVqQyxNQUFNLEVBQUUsTUFBTSxFQUFFLFFBQVEsRUFBRSxHQUFHLE9BQU8sQ0FBQztJQUVyQyxtQkFBbUI7SUFDbkIsSUFBSSxDQUFDLE1BQU0sSUFBSSxPQUFPLE1BQU0sS0FBSyxRQUFRLEVBQUUsQ0FBQztRQUMxQyxNQUFNLElBQUksS0FBSyxDQUFDLDJCQUEyQixDQUFDLENBQUM7SUFDL0MsQ0FBQztJQUVELElBQUksQ0FBQyxRQUFRLENBQUMsSUFBSSxJQUFJLFFBQVEsQ0FBQyxJQUFJLENBQUMsSUFBSSxFQUFFLENBQUMsTUFBTSxHQUFHLENBQUMsRUFBRSxDQUFDO1FBQ3RELE1BQU0sSUFBSSxLQUFLLENBQUMseUNBQXlDLENBQUMsQ0FBQztJQUM3RCxDQUFDO0lBRUQsSUFBSSxDQUFDLFFBQVEsQ0FBQyxJQUFJLElBQUksQ0FBQyxRQUFRLENBQUMsS0FBSyxFQUFFLENBQUM7UUFDdEMsTUFBTSxJQUFJLEtBQUssQ0FBQyw2QkFBNkIsQ0FBQyxDQUFDO0lBQ2pELENBQUM7SUFFRCxJQUFJLFFBQVEsQ0FBQyxLQUFLLElBQUksQ0FBQyxhQUFhLENBQUMsUUFBUSxDQUFDLEtBQUssQ0FBQyxFQUFFLENBQUM7UUFDckQsTUFBTSxJQUFJLEtBQUssQ0FBQyxzQkFBc0IsQ0FBQyxDQUFDO0lBQzFDLENBQUM7SUFF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QkFDTCxNQUFNLEVBQUU7b0JBQ04sRUFBRSxFQUFFLElBQUk7b0JBQ1IsU0FBUyxFQUFFLElBQUk7b0JBQ2YsUUFBUSxFQUFFLElBQUk7b0JBQ2QsS0FBSyxFQUFFLElBQUk7aUJBQ1o7YUFDRjtTQUNGO1FBQ0QsSUFBSSxFQUFFLEtBQUs7UUFDWCxPQUFPLEVBQUUsRUFBRSxJQUFJLEVBQUUsS0FBSyxFQUFFO0tBQ3pCLENBQUMsQ0FBQztJQUVILE9BQU8sS0FBSyxDQUFDLEdBQUcsQ0FBQyxnQ0FBbUIsQ0FBQyxDQUFDO0FBQ3hDLENBQUMiLCJuYW1lcyI6W10sInNvdXJjZXMiOlsiTTpcXFJlcG9cXEZhcm1lcnMgTWFya2V0IFBsYXRmb3JtIHdlYiBhbmQgYXBwXFxzcmNcXGxpYlxcc2VydmljZXNcXGZhcm0uc2VydmljZS50cyJdLCJzb3VyY2VzQ29udGVudCI6WyIvKipcbiAqIEZBUk0gU0VSVklDRSAtIERJVklORSBEQVRBQkFTRSBPUEVSQVRJT05TXG4gKlxuICogQnVzaW5lc3MgbG9naWMgbGF5ZXIgZm9yIGZhcm0gZW50aXR5IG9wZXJhdGlvbnMuXG4gKiBTZXBhcmF0ZXMgZGF0YWJhc2UgY29uY2VybnMgZnJvbSBBUEkgcm91dGVzIGZvciBjbGVhbmVyIGFyY2hpdGVjdHVyZS5cbiAqXG4gKiBEaXZpbmUgUGF0dGVybnMgQXBwbGllZDpcbiAqIC0gU2VydmljZSBsYXllciBzZXBhcmF0aW9uIChmcm9tIGRpdmluZSBjb3JlIHByaW5jaXBsZXMpXG4gKiAtIFR5cGUtc2FmZSBkYXRhYmFzZSBvcGVyYXRpb25zXG4gKiAtIEVubGlnaHRlbmluZyBlcnJvciBtZXNzYWdlc1xuICogLSBRdWFudHVtIGVudGl0eSBtYW5pZmVzdGF0aW9uXG4gKlxuICogRnVuY3Rpb25hbCBSZXF1aXJlbWVudHM6IEZSLTAxMSAoRmFybSBQcm9maWxlIENyZWF0aW9uKVxuICovXG5cbmltcG9ydCB7IEFncmljdWx0dXJhbENhY2hlIH0gZnJvbSBcIkAvbGliL2NhY2hlL2FncmljdWx0dXJhbC1jYWNoZVwiO1xuaW1wb3J0IHsgZGF0YWJhc2UgfSBmcm9tIFwiQC9saWIvZGF0YWJhc2VcIjtcbmltcG9ydCB7XG4gIGdlbmVyYXRlRmFybVNsdWcsXG4gIG1hbmlmZXN0UXVhbnR1bUZhcm0sXG4gIHR5cGUgQ3JlYXRlRmFybVJlcXVlc3QsXG4gIHR5cGUgRmFybVNsdWcsXG4gIHR5cGUgUXVhbnR1bUZhcm0sXG4gIHR5cGUgVXNlcklkLFxufSBmcm9tIFwiQC90eXBlcy9mYXJtLnR5cGVzXCI7XG5cbi8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cbi8vIEZBUk0gQ1JFQVRJT04gU0VSVklDRVxuLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuXG5leHBvcnQgaW50ZXJmYWNlIENyZWF0ZUZhcm1TZXJ2aWNlT3B0aW9ucyB7XG4gIHVzZXJJZDogVXNlcklkO1xuICBmYXJtRGF0YTogQ3JlYXRlRmFybVJlcXVlc3Q7XG59XG5cbmV4cG9ydCBpbnRlcmZhY2UgQ3JlYXRlRmFybVNlcnZpY2VSZXN1bHQge1xuICBmYXJtOiBRdWFudHVtRmFybTtcbiAgc2x1ZzogRmFybVNsdWc7XG59XG5cbi8qKlxuICogQ3JlYXRlIGZhcm0gd2l0aCB1bmlxdWUgc2x1ZyBnZW5lcmF0aW9uXG4gKlxuICogSGFuZGxlcyBzbHVnIGNvbGxpc2lvbiBkZXRlY3Rpb24gYW5kIHF1YW50dW0gZmFybSBtYW5pZmVzdGF0aW9uLlxuICogU2VwYXJhdGVzIGJ1c2luZXNzIGxvZ2ljIGZyb20gSFRUUCBjb25jZXJucy5cbiAqXG4gKiBAcGFyYW0gb3B0aW9ucyAtIFVzZXIgSUQgYW5kIGZhcm0gZGF0YVxuICogQHJldHVybnMgQ3JlYXRlZCBxdWFudHVtIGZhcm0gZW50aXR5XG4gKiBAdGhyb3dzIEVycm9yIGlmIHNsdWcgZ2VuZXJhdGlvbiBmYWlscyBvciB2YWxpZGF0aW9uIGZhaWxzXG4gKi9cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBjcmVhdGVGYXJtU2VydmljZShcbiAgb3B0aW9uczogQ3JlYXRlRmFybVNlcnZpY2VPcHRpb25zXG4pOiBQcm9taXNlPENyZWF0ZUZhcm1TZXJ2aWNlUmVzdWx0PiB7XG4gIGNvbnN0IHsgdXNlcklkLCBmYXJtRGF0YSB9ID0gb3B0aW9ucztcblxuICAvLyBJbnB1dCB2YWxpZGF0aW9uXG4gIGlmICghdXNlcklkIHx8IHR5cGVvZiB1c2VySWQgIT09IFwic3RyaW5nXCIpIHtcbiAgICB0aHJvdyBuZXcgRXJyb3IoXCJWYWxpZCB1c2VyIElEIGlzIHJlcXVpcmVkXCIpO1xuICB9XG5cbiAgaWYgKCFmYXJtRGF0YS5uYW1lIHx8IGZhcm1EYXRhLm5hbWUudHJpbSgpLmxlbmd0aCA8IDMpIHtcbiAgICB0aHJvdyBuZXcgRXJyb3IoXCJGYXJtIG5hbWUgbXVzdCBiZSBhdCBsZWFzdCAzIGNoYXJhY3RlcnNcIik7XG4gIH1cblxuICBpZiAoIWZhcm1EYXRhLmNpdHkgfHwgIWZhcm1EYXRhLnN0YXRlKSB7XG4gICAgdGhyb3cgbmV3IEVycm9yKFwiQ2l0eSBhbmQgc3RhdGUgYXJlIHJlcXVpcmVkXCIpO1xuICB9XG5cbiAgaWYgKGZhcm1EYXRhLmVtYWlsICYmICF2YWxpZGF0ZUVtYWlsKGZhcm1EYXRhLmVtYWlsKSkge1xuICAgIHRocm93IG5ldyBFcnJvcihcIkludmFsaWQgZW1haWwgZm9ybWF0XCIpO1xuICB9XG5cbi8vIEVtYWlsIHZhbGlkYXRpb24gaGVscGVyXG5mdW5jdGlvbiB2YWxpZGF0ZUVtYWlsKGVtYWlsOiBzdHJpbmcpOiBib29sZWFuIHtcbiAgY29uc3QgZW1haWxSZWdleCA9IC9eW15cXHNAXStAW15cXHNAXStcXC5bXlxcc0BdKyQvO1xuICByZXR1cm4gZW1haWxSZWdleC50ZXN0KGVtYWlsKTtcbn1cblxuICBpZiAoZmFybURhdGEuZGVsaXZlcnlSYWRpdXMgJiYgZmFybURhdGEuZGVsaXZlcnlSYWRpdXMgPCAwKSB7XG4gICAgdGhyb3cgbmV3IEVycm9yKFwiRGVsaXZlcnkgcmFkaXVzIG11c3QgYmUgcG9zaXRpdmVcIik7XG4gIH1cblxuICAvLyBHZW5lcmF0ZSB1bmlxdWUgc2x1ZyB3aXRoIGNvbGxpc2lvbiBkZXRlY3Rpb25cbiAgY29uc3Qgc2x1ZyA9IGF3YWl0IGdlbmVyYXRlVW5pcXVlU2x1ZyhmYXJtRGF0YS5uYW1lLCBmYXJtRGF0YS5jaXR5KTtcblxuICAvLyBDcmVhdGUgZmFybSBpbiBkYXRhYmFzZVxuICBjb25zdCBmYXJtID0gYXdhaXQgZGF0YWJhc2UuZmFybS5jcmVhdGUoe1xuICAgIGRhdGE6IHtcbiAgICAgIC8vIElkZW50aXR5XG4gICAgICBuYW1lOiBmYXJtRGF0YS5uYW1lLFxuICAgICAgc2x1ZyxcbiAgICAgIG93bmVySWQ6IHVzZXJJZCxcblxuICAgICAgLy8gQnVzaW5lc3NcbiAgICAgIGRlc2NyaXB0aW9uOiBmYXJtRGF0YS5kZXNjcmlwdGlvbixcbiAgICAgIHN0b3J5OiBmYXJtRGF0YS5zdG9yeSxcbiAgICAgIGJ1c2luZXNzTmFtZTogZmFybURhdGEuYnVzaW5lc3NOYW1lLFxuICAgICAgeWVhckVzdGFibGlzaGVkOiBmYXJtRGF0YS55ZWFyRXN0YWJsaXNoZWQsXG4gICAgICBmYXJtU2l6ZTogZmFybURhdGEuZmFybVNpemUsXG5cbiAgICAgIC8vIExvY2F0aW9uXG4gICAgICBhZGRyZXNzOiBmYXJtRGF0YS5hZGRyZXNzLFxuICAgICAgY2l0eTogZmFybURhdGEuY2l0eSxcbiAgICAgIHN0YXRlOiBmYXJtRGF0YS5zdGF0ZSxcbiAgICAgIHppcENvZGU6IGZhcm1EYXRhLnppcENvZGUsXG4gICAgICBjb3VudHJ5OiBcIlVTXCIsXG4gICAgICBsYXRpdHVkZTogZmFybURhdGEubGF0aXR1ZGUsXG4gICAgICBsb25naXR1ZGU6IGZhcm1EYXRhLmxvbmdpdHVkZSxcblxuICAgICAgLy8gQ29udGFjdFxuICAgICAgZW1haWw6IGZhcm1EYXRhLmVtYWlsIHx8IFwiXCIsXG4gICAgICBwaG9uZTogZmFybURhdGEucGhvbmUgfHwgXCJcIixcbiAgICAgIHdlYnNpdGU6IGZhcm1EYXRhLndlYnNpdGUgfHwgbnVsbCxcblxuICAgICAgLy8gUHJhY3RpY2VzXG4gICAgICBmYXJtaW5nUHJhY3RpY2VzOiBmYXJtRGF0YS5mYXJtaW5nUHJhY3RpY2VzIHx8IFtdLFxuICAgICAgcHJvZHVjdENhdGVnb3JpZXM6IGZhcm1EYXRhLnByb2R1Y3RDYXRlZ29yaWVzIHx8IFtdLFxuXG4gICAgICAvLyBEZWxpdmVyeVxuICAgICAgZGVsaXZlcnlSYWRpdXM6IGZhcm1EYXRhLmRlbGl2ZXJ5UmFkaXVzLFxuXG4gICAgICAvLyBTdGF0dXMgLSBQRU5ESU5HIHVudGlsIFN0cmlwZSBvbmJvYXJkZWRcbiAgICAgIHN0YXR1czogXCJQRU5ESU5HXCIsXG4gICAgICB2ZXJpZmljYXRpb25TdGF0dXM6IFwiUEVORElOR1wiLFxuICAgICAgc3RyaXBlT25ib2FyZGVkOiBmYWxzZSxcbiAgICAgIHBheW91dHNFbmFibGVkOiBmYWxzZSxcbiAgICB9LFxuICAgIGluY2x1ZGU6IHtcbiAgICAgIG93bmVyOiB7XG4gICAgICAgIHNlbGVjdDoge1xuICAgICAgICAgIGlkOiB0cnVlLFxuICAgICAgICAgIGZpcnN0TmFtZTogdHJ1ZSxcbiAgICAgICAgICBsYXN0TmFtZTogdHJ1ZSxcbiAgICAgICAgICBlbWFpbDogdHJ1ZSxcbiAgICAgICAgfSxcbiAgICAgIH0sXG4gICAgfSxcbiAgfSk7XG5cbiAgLy8gTWFuaWZlc3QgcXVhbnR1bSBmYXJtIGVudGl0eVxuICBjb25zdCBxdWFudHVtRmFybSA9IG1hbmlmZXN0UXVhbnR1bUZhcm0oZmFybSk7XG5cbiAgcmV0dXJuIHtcbiAgICBmYXJtOiBxdWFudHVtRmFybSxcbiAgICBzbHVnOiBzbHVnIGFzIEZhcm1TbHVnLFxuICB9O1xufVxuXG4vLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG4vLyBDSEVDSyBFWElTVElORyBGQVJNXG4vLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG5cbmV4cG9ydCBpbnRlcmZhY2UgRXhpc3RpbmdGYXJtQ2hlY2sge1xuICBleGlzdHM6IGJvb2xlYW47XG4gIGZhcm0/OiB7XG4gICAgaWQ6IHN0cmluZztcbiAgICBzbHVnOiBzdHJpbmc7XG4gICAgbmFtZTogc3RyaW5nO1xuICB9O1xufVxuXG4vKipcbiAqIENoZWNrIGlmIHVzZXIgYWxyZWFkeSBoYXMgYSBmYXJtXG4gKlxuICogQHBhcmFtIHVzZXJJZCAtIFVzZXIgSUQgdG8gY2hlY2tcbiAqIEByZXR1cm5zIEV4aXN0aW5nIGZhcm0gaW5mbyBpZiBmb3VuZFxuICovXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gY2hlY2tFeGlzdGluZ0Zhcm0oXG4gIHVzZXJJZDogVXNlcklkXG4pOiBQcm9taXNlPEV4aXN0aW5nRmFybUNoZWNrPiB7XG4gIGNvbnN0IGZhcm0gPSBhd2FpdCBkYXRhYmFzZS5mYXJtLmZpbmRGaXJzdCh7XG4gICAgd2hlcmU6IHtcbiAgICAgIG93bmVySWQ6IHVzZXJJZCxcbiAgICB9LFxuICAgIHNlbGVjdDoge1xuICAgICAgaWQ6IHRydWUsXG4gICAgICBzbHVnOiB0cnVlLFxuICAgICAgbmFtZTogdHJ1ZSxcbiAgICB9LFxuICB9KTtcblxuICBpZiAoIWZhcm0pIHtcbiAgICByZXR1cm4geyBleGlzdHM6IGZhbHNlIH07XG4gIH1cblxuICByZXR1cm4ge1xuICAgIGV4aXN0czogdHJ1ZSxcbiAgICBmYXJtLFxuICB9O1xufVxuXG4vLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG4vLyBVTklRVUUgU0xVRyBHRU5FUkFUSU9OXG4vLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG5cbmNvbnN0IE1BWF9TTFVHX0FUVEVNUFRTID0gMTA7XG5cbi8qKlxuICogR2VuZXJhdGUgdW5pcXVlIGZhcm0gc2x1ZyB3aXRoIGNvbGxpc2lvbiBkZXRlY3Rpb25cbiAqXG4gKiBUcmllcyBiYXNlIHNsdWcgZmlyc3QsIHRoZW4gYXBwZW5kcyBjb3VudGVyIGlmIGNvbGxpc2lvbiBkZXRlY3RlZC5cbiAqXG4gKiBAcGFyYW0gbmFtZSAtIEZhcm0gbmFtZVxuICogQHBhcmFtIGNpdHkgLSBGYXJtIGNpdHlcbiAqIEByZXR1cm5zIFVuaXF1ZSBzbHVnXG4gKiBAdGhyb3dzIEVycm9yIGlmIG1heCBhdHRlbXB0cyBleGNlZWRlZFxuICovXG5hc3luYyBmdW5jdGlvbiBnZW5lcmF0ZVVuaXF1ZVNsdWcoXG4gIG5hbWU6IHN0cmluZyxcbiAgY2l0eTogc3RyaW5nXG4pOiBQcm9taXNlPEZhcm1TbHVnPiB7XG4gIGxldCBzbHVnID0gZ2VuZXJhdGVGYXJtU2x1ZyhuYW1lLCBjaXR5KTtcbiAgbGV0IGF0dGVtcHQgPSAwO1xuXG4gIHdoaWxlIChhdHRlbXB0IDwgTUFYX1NMVUdfQVRURU1QVFMpIHtcbiAgICBjb25zdCBleGlzdGluZyA9IGF3YWl0IGRhdGFiYXNlLmZhcm0uZmluZFVuaXF1ZSh7XG4gICAgICB3aGVyZTogeyBzbHVnIH0sXG4gICAgICBzZWxlY3Q6IHsgaWQ6IHRydWUgfSxcbiAgICB9KTtcblxuICAgIGlmICghZXhpc3RpbmcpIHtcbiAgICAgIHJldHVybiBzbHVnO1xuICAgIH1cblxuICAgIC8vIENvbGxpc2lvbiBkZXRlY3RlZCAtIHRyeSB3aXRoIGNvdW50ZXJcbiAgICBhdHRlbXB0Kys7XG4gICAgc2x1ZyA9IGAke2dlbmVyYXRlRmFybVNsdWcobmFtZSwgY2l0eSl9LSR7YXR0ZW1wdH1gIGFzIEZhcm1TbHVnO1xuICB9XG5cbiAgdGhyb3cgbmV3IEVycm9yKFxuICAgIGBGYWlsZWQgdG8gZ2VuZXJhdGUgdW5pcXVlIHNsdWcgYWZ0ZXIgJHtNQVhfU0xVR19BVFRFTVBUU30gYXR0ZW1wdHNgXG4gICk7XG59XG5cbi8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cbi8vIEZBUk0gUkVUUklFVkFMIFNFUlZJQ0VTXG4vLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG5cbi8qKlxuICogR2V0IGZhcm0gYnkgSUQgd2l0aCBxdWFudHVtIG1hbmlmZXN0YXRpb25cbiAqIFVzZXMgYWdyaWN1bHR1cmFsIGNhY2hlIGZvciBwZXJmb3JtYW5jZVxuICovXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gZ2V0RmFybUJ5SWQoZmFybUlkOiBzdHJpbmcpOiBQcm9taXNlPFF1YW50dW1GYXJtIHwgbnVsbD4ge1xuICAvLyBUcnkgY2FjaGUgZmlyc3RcbiAgY29uc3QgY2FjaGVkID0gYXdhaXQgQWdyaWN1bHR1cmFsQ2FjaGUuZ2V0RmFybShmYXJtSWQpO1xuICBpZiAoY2FjaGVkKSB7XG4gICAgcmV0dXJuIGNhY2hlZDtcbiAgfVxuXG4gIC8vIEZldGNoIGZyb20gZGF0YWJhc2VcbiAgY29uc3QgZmFybSA9IGF3YWl0IGRhdGFiYXNlLmZhcm0uZmluZFVuaXF1ZSh7XG4gICAgd2hlcmU6IHsgaWQ6IGZhcm1JZCB9LFxuICAgIGluY2x1ZGU6IHtcbiAgICAgIG93bmVyOiB7XG4gICAgICAgIHNlbGVjdDoge1xuICAgICAgICAgIGlkOiB0cnVlLFxuICAgICAgICAgIGZpcnN0TmFtZTogdHJ1ZSxcbiAgICAgICAgICBsYXN0TmFtZTogdHJ1ZSxcbiAgICAgICAgICBlbWFpbDogdHJ1ZSxcbiAgICAgICAgfSxcbiAgICAgIH0sXG4gICAgfSxcbiAgfSk7XG5cbiAgaWYgKCFmYXJtKSB7XG4gICAgcmV0dXJuIG51bGw7XG4gIH1cblxuICBjb25zdCBxdWFudHVtRmFybSA9IG1hbmlmZXN0UXVhbnR1bUZhcm0oZmFybSk7XG5cbiAgLy8gQ2FjaGUgdGhlIHJlc3VsdFxuICBhd2FpdCBBZ3JpY3VsdHVyYWxDYWNoZS5jYWNoZUZhcm0oZmFybUlkLCBxdWFudHVtRmFybSk7XG5cbiAgcmV0dXJuIHF1YW50dW1GYXJtO1xufVxuXG4vKipcbiAqIEdldCBmYXJtIGJ5IHNsdWcgd2l0aCBxdWFudHVtIG1hbmlmZXN0YXRpb25cbiAqIFVzZXMgYWdyaWN1bHR1cmFsIGNhY2hlIGZvciBwZXJmb3JtYW5jZVxuICovXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gZ2V0RmFybUJ5U2x1ZyhzbHVnOiBzdHJpbmcpOiBQcm9taXNlPFF1YW50dW1GYXJtIHwgbnVsbD4ge1xuICAvLyBUcnkgY2FjaGUgZmlyc3QgKHVzaW5nIHNsdWcgYXMga2V5KVxuICBjb25zdCBjYWNoZUtleSA9IGBmYXJtOnNsdWc6JHtzbHVnfWA7XG4gIGNvbnN0IGNhY2hlZCA9IGF3YWl0IEFncmljdWx0dXJhbENhY2hlLmdldEZhcm0oY2FjaGVLZXkpO1xuICBpZiAoY2FjaGVkKSB7XG4gICAgcmV0dXJuIGNhY2hlZDtcbiAgfVxuXG4gIC8vIEZldGNoIGZyb20gZGF0YWJhc2VcbiAgY29uc3QgZmFybSA9IGF3YWl0IGRhdGFiYXNlLmZhcm0uZmluZFVuaXF1ZSh7XG4gICAgd2hlcmU6IHsgc2x1ZyB9LFxuICAgIGluY2x1ZGU6IHtcbiAgICAgIG93bmVyOiB7XG4gICAgICAgIHNlbGVjdDoge1xuICAgICAgICAgIGlkOiB0cnVlLFxuICAgICAgICAgIGZpcnN0TmFtZTogdHJ1ZSxcbiAgICAgICAgICBsYXN0TmFtZTogdHJ1ZSxcbiAgICAgICAgICBlbWFpbDogdHJ1ZSxcbiAgICAgICAgfSxcbiAgICAgIH0sXG4gICAgfSxcbiAgfSk7XG5cbiAgaWYgKCFmYXJtKSB7XG4gICAgcmV0dXJuIG51bGw7XG4gIH1cblxuICBjb25zdCBxdWFudHVtRmFybSA9IG1hbmlmZXN0UXVhbnR1bUZhcm0oZmFybSk7XG5cbiAgLy8gQ2FjaGUgYnkgYm90aCBJRCBhbmQgc2x1Z1xuICBhd2FpdCBQcm9taXNlLmFsbChbXG4gICAgQWdyaWN1bHR1cmFsQ2FjaGUuY2FjaGVGYXJtKGZhcm0uaWQsIHF1YW50dW1GYXJtKSxcbiAgICBBZ3JpY3VsdHVyYWxDYWNoZS5jYWNoZUZhcm0oY2FjaGVLZXksIHF1YW50dW1GYXJtKSxcbiAgXSk7XG5cbiAgcmV0dXJuIHF1YW50dW1GYXJtO1xufVxuXG4vLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG4vLyBGQVJNIFVQREFURSBTRVJWSUNFXG4vLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG5cbmV4cG9ydCBpbnRlcmZhY2UgVXBkYXRlRmFybVNlcnZpY2VPcHRpb25zIHtcbiAgZmFybUlkOiBzdHJpbmc7XG4gIHVzZXJJZDogVXNlcklkO1xuICB1cGRhdGVEYXRhOiBQYXJ0aWFsPENyZWF0ZUZhcm1SZXF1ZXN0Pjtcbn1cblxuLyoqXG4gKiBVcGRhdGUgZmFybSB3aXRoIG93bmVyc2hpcCB2YWxpZGF0aW9uXG4gKlxuICogQHBhcmFtIG9wdGlvbnMgLSBGYXJtIElELCBVc2VyIElELCBhbmQgdXBkYXRlIGRhdGFcbiAqIEByZXR1cm5zIFVwZGF0ZWQgcXVhbnR1bSBmYXJtIGVudGl0eVxuICogQHRocm93cyBFcnJvciBpZiB1c2VyIGRvZXNuJ3Qgb3duIHRoZSBmYXJtXG4gKi9cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiB1cGRhdGVGYXJtU2VydmljZShcbiAgb3B0aW9uczogVXBkYXRlRmFybVNlcnZpY2VPcHRpb25zXG4pOiBQcm9taXNlPFF1YW50dW1GYXJtPiB7XG4gIGNvbnN0IHsgZmFybUlkLCB1c2VySWQsIHVwZGF0ZURhdGEgfSA9IG9wdGlvbnM7XG5cbiAgLy8gVmVyaWZ5IG93bmVyc2hpcFxuICBjb25zdCBleGlzdGluZ0Zhcm0gPSBhd2FpdCBkYXRhYmFzZS5mYXJtLmZpbmRVbmlxdWUoe1xuICAgIHdoZXJlOiB7IGlkOiBmYXJtSWQgfSxcbiAgICBzZWxlY3Q6IHsgb3duZXJJZDogdHJ1ZSB9LFxuICB9KTtcblxuICBpZiAoIWV4aXN0aW5nRmFybSkge1xuICAgIHRocm93IG5ldyBFcnJvcihcIkZhcm0gbm90IGZvdW5kXCIpO1xuICB9XG5cbiAgaWYgKGV4aXN0aW5nRmFybS5vd25lcklkICE9PSB1c2VySWQpIHtcbiAgICB0aHJvdyBuZXcgRXJyb3IoXCJVbmF1dGhvcml6ZWQ6IFlvdSBkb24ndCBvd24gdGhpcyBmYXJtXCIpO1xuICB9XG5cbiAgLy8gVXBkYXRlIGZhcm1cbiAgY29uc3QgdXBkYXRlZEZhcm0gPSBhd2FpdCBkYXRhYmFzZS5mYXJtLnVwZGF0ZSh7XG4gICAgd2hlcmU6IHsgaWQ6IGZhcm1JZCB9LFxuICAgIGRhdGE6IHtcbiAgICAgIC8vIE9ubHkgdXBkYXRlIHByb3ZpZGVkIGZpZWxkc1xuICAgICAgLi4uKHVwZGF0ZURhdGEubmFtZSAmJiB7IG5hbWU6IHVwZGF0ZURhdGEubmFtZSB9KSxcbiAgICAgIC4uLih1cGRhdGVEYXRhLmRlc2NyaXB0aW9uICYmIHsgZGVzY3JpcHRpb246IHVwZGF0ZURhdGEuZGVzY3JpcHRpb24gfSksXG4gICAgICAuLi4odXBkYXRlRGF0YS5zdG9yeSAmJiB7IHN0b3J5OiB1cGRhdGVEYXRhLnN0b3J5IH0pLFxuICAgICAgLi4uKHVwZGF0ZURhdGEuYnVzaW5lc3NOYW1lICYmIHsgYnVzaW5lc3NOYW1lOiB1cGRhdGVEYXRhLmJ1c2luZXNzTmFtZSB9KSxcbiAgICAgIC4uLih1cGRhdGVEYXRhLnllYXJFc3RhYmxpc2hlZCAmJiB7XG4gICAgICAgIHllYXJFc3RhYmxpc2hlZDogdXBkYXRlRGF0YS55ZWFyRXN0YWJsaXNoZWQsXG4gICAgICB9KSxcbiAgICAgIC4uLih1cGRhdGVEYXRhLmZhcm1TaXplICYmIHsgZmFybVNpemU6IHVwZGF0ZURhdGEuZmFybVNpemUgfSksXG4gICAgICAuLi4odXBkYXRlRGF0YS5hZGRyZXNzICYmIHsgYWRkcmVzczogdXBkYXRlRGF0YS5hZGRyZXNzIH0pLFxuICAgICAgLi4uKHVwZGF0ZURhdGEuY2l0eSAmJiB7IGNpdHk6IHVwZGF0ZURhdGEuY2l0eSB9KSxcbiAgICAgIC4uLih1cGRhdGVEYXRhLnN0YXRlICYmIHsgc3RhdGU6IHVwZGF0ZURhdGEuc3RhdGUgfSksXG4gICAgICAuLi4odXBkYXRlRGF0YS56aXBDb2RlICYmIHsgemlwQ29kZTogdXBkYXRlRGF0YS56aXBDb2RlIH0pLFxuICAgICAgLi4uKHVwZGF0ZURhdGEubGF0aXR1ZGUgIT09IHVuZGVmaW5lZCAmJiB7XG4gICAgICAgIGxhdGl0dWRlOiB1cGRhdGVEYXRhLmxhdGl0dWRlLFxuICAgICAgfSksXG4gICAgICAuLi4odXBkYXRlRGF0YS5sb25naXR1ZGUgIT09IHVuZGVmaW5lZCAmJiB7XG4gICAgICAgIGxvbmdpdHVkZTogdXBkYXRlRGF0YS5sb25naXR1ZGUsXG4gICAgICB9KSxcbiAgICAgIC4uLih1cGRhdGVEYXRhLmVtYWlsICYmIHsgZW1haWw6IHVwZGF0ZURhdGEuZW1haWwgfSksXG4gICAgICAuLi4odXBkYXRlRGF0YS5waG9uZSAmJiB7IHBob25lOiB1cGRhdGVEYXRhLnBob25lIH0pLFxuICAgICAgLi4uKHVwZGF0ZURhdGEud2Vic2l0ZSAhPT0gdW5kZWZpbmVkICYmIHsgd2Vic2l0ZTogdXBkYXRlRGF0YS53ZWJzaXRlIH0pLFxuICAgICAgLi4uKHVwZGF0ZURhdGEuZmFybWluZ1ByYWN0aWNlcyAmJiB7XG4gICAgICAgIGZhcm1pbmdQcmFjdGljZXM6IHVwZGF0ZURhdGEuZmFybWluZ1ByYWN0aWNlcyxcbiAgICAgIH0pLFxuICAgICAgLi4uKHVwZGF0ZURhdGEucHJvZHVjdENhdGVnb3JpZXMgJiYge1xuICAgICAgICBwcm9kdWN0Q2F0ZWdvcmllczogdXBkYXRlRGF0YS5wcm9kdWN0Q2F0ZWdvcmllcyxcbiAgICAgIH0pLFxuICAgICAgLi4uKHVwZGF0ZURhdGEuZGVsaXZlcnlSYWRpdXMgIT09IHVuZGVmaW5lZCAmJiB7XG4gICAgICAgIGRlbGl2ZXJ5UmFkaXVzOiB1cGRhdGVEYXRhLmRlbGl2ZXJ5UmFkaXVzLFxuICAgICAgfSksXG4gICAgfSxcbiAgICBpbmNsdWRlOiB7XG4gICAgICBvd25lcjoge1xuICAgICAgICBzZWxlY3Q6IHtcbiAgICAgICAgICBpZDogdHJ1ZSxcbiAgICAgICAgICBmaXJzdE5hbWU6IHRydWUsXG4gICAgICAgICAgbGFzdE5hbWU6IHRydWUsXG4gICAgICAgICAgZW1haWw6IHRydWUsXG4gICAgICAgIH0sXG4gICAgICB9LFxuICAgIH0sXG4gIH0pO1xuXG4gIGNvbnN0IHF1YW50dW1GYXJtID0gbWFuaWZlc3RRdWFudHVtRmFybSh1cGRhdGVkRmFybSk7XG5cbiAgLy8gSW52YWxpZGF0ZSBjYWNoZVxuICBhd2FpdCBBZ3JpY3VsdHVyYWxDYWNoZS5pbnZhbGlkYXRlRmFybShmYXJtSWQpO1xuXG4gIHJldHVybiBxdWFudHVtRmFybTtcbn1cblxuLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuLy8gRkFSTSBERUxFVElPTiBTRVJWSUNFXG4vLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG5cbmV4cG9ydCBpbnRlcmZhY2UgRGVsZXRlRmFybVNlcnZpY2VPcHRpb25zIHtcbiAgZmFybUlkOiBzdHJpbmc7XG4gIHVzZXJJZDogVXNlcklkO1xufVxuXG4vKipcbiAqIERlbGV0ZSBmYXJtIHdpdGggb3duZXJzaGlwIHZhbGlkYXRpb25cbiAqXG4gKiBTb2Z0IGRlbGV0ZSBieSBzZXR0aW5nIHN0YXR1cyB0byBJTkFDVElWRVxuICpcbiAqIEBwYXJhbSBvcHRpb25zIC0gRmFybSBJRCBhbmQgVXNlciBJRFxuICogQHRocm93cyBFcnJvciBpZiB1c2VyIGRvZXNuJ3Qgb3duIHRoZSBmYXJtXG4gKi9cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBkZWxldGVGYXJtU2VydmljZShcbiAgb3B0aW9uczogRGVsZXRlRmFybVNlcnZpY2VPcHRpb25zXG4pOiBQcm9taXNlPHZvaWQ+IHtcbiAgY29uc3QgeyBmYXJtSWQsIHVzZXJJZCB9ID0gb3B0aW9ucztcblxuICAvLyBWZXJpZnkgb3duZXJzaGlwXG4gIGNvbnN0IGV4aXN0aW5nRmFybSA9IGF3YWl0IGRhdGFiYXNlLmZhcm0uZmluZFVuaXF1ZSh7XG4gICAgd2hlcmU6IHsgaWQ6IGZhcm1JZCB9LFxuICAgIHNlbGVjdDogeyBvd25lcklkOiB0cnVlIH0sXG4gIH0pO1xuXG4gIGlmICghZXhpc3RpbmdGYXJtKSB7XG4gICAgdGhyb3cgbmV3IEVycm9yKFwiRmFybSBub3QgZm91bmRcIik7XG4gIH1cblxuICBpZiAoZXhpc3RpbmdGYXJtLm93bmVySWQgIT09IHVzZXJJZCkge1xuICAgIHRocm93IG5ldyBFcnJvcihcIlVuYXV0aG9yaXplZDogWW91IGRvbid0IG93biB0aGlzIGZhcm1cIik7XG4gIH1cblxuICAvLyBTb2Z0IGRlbGV0ZSAoc2V0IHN0YXR1cyB0byBJTkFDVElWRSlcbiAgYXdhaXQgZGF0YWJhc2UuZmFybS51cGRhdGUoe1xuICAgIHdoZXJlOiB7IGlkOiBmYXJtSWQgfSxcbiAgICBkYXRhOiB7XG4gICAgICBzdGF0dXM6IFwiSU5BQ1RJVkVcIixcbiAgICB9LFxuICB9KTtcblxuICAvLyBJbnZhbGlkYXRlIGNhY2hlXG4gIGF3YWl0IEFncmljdWx0dXJhbENhY2hlLmludmFsaWRhdGVGYXJtKGZhcm1JZCk7XG59XG5cbi8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cbi8vIEZBUk0gTElTVElORyBTRVJWSUNFXG4vLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG5cbmV4cG9ydCBpbnRlcmZhY2UgTGlzdEZhcm1zT3B0aW9ucyB7XG4gIHBhZ2U/OiBudW1iZXI7XG4gIGxpbWl0PzogbnVtYmVyO1xuICBzdGF0dXM/OiBzdHJpbmc7XG4gIGNpdHk/OiBzdHJpbmc7XG4gIHN0YXRlPzogc3RyaW5nO1xuICBmYXJtaW5nUHJhY3RpY2VzPzogc3RyaW5nW107XG4gIHNvcnRCeT86IFwibmFtZVwiIHwgXCJjcmVhdGVkQXRcIiB8IFwicmF0aW5nXCI7XG4gIHNvcnRPcmRlcj86IFwiYXNjXCIgfCBcImRlc2NcIjtcbn1cblxuZXhwb3J0IGludGVyZmFjZSBMaXN0RmFybXNSZXN1bHQge1xuICBmYXJtczogUXVhbnR1bUZhcm1bXTtcbiAgdG90YWw6IG51bWJlcjtcbiAgcGFnZTogbnVtYmVyO1xuICB0b3RhbFBhZ2VzOiBudW1iZXI7XG59XG5cbi8qKlxuICogTGlzdCBmYXJtcyB3aXRoIHBhZ2luYXRpb24gYW5kIGZpbHRlcmluZ1xuICpcbiAqIEBwYXJhbSBvcHRpb25zIC0gUGFnaW5hdGlvbiBhbmQgZmlsdGVyIG9wdGlvbnNcbiAqIEByZXR1cm5zIFBhZ2luYXRlZCBsaXN0IG9mIHF1YW50dW0gZmFybXNcbiAqL1xuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIGxpc3RGYXJtc1NlcnZpY2UoXG4gIG9wdGlvbnM6IExpc3RGYXJtc09wdGlvbnMgPSB7fVxuKTogUHJvbWlzZTxMaXN0RmFybXNSZXN1bHQ+IHtcbiAgY29uc3Qge1xuICAgIHBhZ2UgPSAxLFxuICAgIGxpbWl0ID0gMjAsXG4gICAgc3RhdHVzLFxuICAgIGNpdHksXG4gICAgc3RhdGUsXG4gICAgZmFybWluZ1ByYWN0aWNlcyxcbiAgICBzb3J0QnkgPSBcImNyZWF0ZWRBdFwiLFxuICAgIHNvcnRPcmRlciA9IFwiZGVzY1wiLFxuICB9ID0gb3B0aW9ucztcblxuICBjb25zdCBza2lwID0gKHBhZ2UgLSAxKSAqIGxpbWl0O1xuXG4gIC8vIE5vdGU6IExpc3QgcXVlcmllcyBhcmUgbm90IGNhY2hlZCBkdWUgdG8gY29tcGxleGl0eSBvZiBmaWx0ZXJzIGFuZCBwYWdpbmF0aW9uXG4gIC8vIEluZGl2aWR1YWwgZmFybXMgYXJlIGNhY2hlZCB3aGVuIHJldHJpZXZlZFxuXG4gIC8vIEJ1aWxkIHdoZXJlIGNsYXVzZVxuICBjb25zdCB3aGVyZTogYW55ID0ge1xuICAgIHN0YXR1czogeyBub3Q6IFwiSU5BQ1RJVkVcIiB9LCAvLyBPbmx5IGFjdGl2ZSBmYXJtc1xuICB9O1xuXG4gIGlmIChzdGF0dXMpIHtcbiAgICB3aGVyZS5zdGF0dXMgPSBzdGF0dXM7IC8vIE92ZXJyaWRlIHdpdGggc3BlY2lmaWMgc3RhdHVzIGlmIHByb3ZpZGVkXG4gIH1cblxuICBpZiAoY2l0eSkge1xuICAgIHdoZXJlLmNpdHkgPSB7IGNvbnRhaW5zOiBjaXR5LCBtb2RlOiBcImluc2Vuc2l0aXZlXCIgfTtcbiAgfVxuXG4gIGlmIChzdGF0ZSkge1xuICAgIHdoZXJlLnN0YXRlID0gc3RhdGU7XG4gIH1cblxuICBpZiAoZmFybWluZ1ByYWN0aWNlcyAmJiBmYXJtaW5nUHJhY3RpY2VzLmxlbmd0aCA+IDApIHtcbiAgICB3aGVyZS5mYXJtaW5nUHJhY3RpY2VzID0ge1xuICAgICAgaGFzU29tZTogZmFybWluZ1ByYWN0aWNlcyxcbiAgICB9O1xuICB9XG5cbiAgLy8gR2V0IHRvdGFsIGNvdW50XG4gIGNvbnN0IHRvdGFsID0gYXdhaXQgZGF0YWJhc2UuZmFybS5jb3VudCh7IHdoZXJlIH0pO1xuXG4gIC8vIEdldCBwYWdpbmF0ZWQgZmFybXNcbiAgY29uc3QgZmFybXMgPSBhd2FpdCBkYXRhYmFzZS5mYXJtLmZpbmRNYW55KHtcbiAgICB3aGVyZSxcbiAgICBpbmNsdWRlOiB7XG4gICAgICBvd25lcjoge1xuICAgICAgICBzZWxlY3Q6IHtcbiAgICAgICAgICBpZDogdHJ1ZSxcbiAgICAgICAgICBmaXJzdE5hbWU6IHRydWUsXG4gICAgICAgICAgbGFzdE5hbWU6IHRydWUsXG4gICAgICAgICAgZW1haWw6IHRydWUsXG4gICAgICAgIH0sXG4gICAgICB9LFxuICAgIH0sXG4gICAgb3JkZXJCeTogeyBbc29ydEJ5XTogc29ydE9yZGVyIH0sXG4gICAgc2tpcCxcbiAgICB0YWtlOiBsaW1pdCxcbiAgfSk7XG5cbiAgcmV0dXJuIHtcbiAgICBmYXJtczogZmFybXMubWFwKG1hbmlmZXN0UXVhbnR1bUZhcm0pLFxuICAgIHRvdGFsLFxuICAgIHBhZ2UsXG4gICAgdG90YWxQYWdlczogTWF0aC5jZWlsKHRvdGFsIC8gbGltaXQpLFxuICB9O1xufVxuXG4vLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG4vLyBGQVJNIFNFQVJDSCBTRVJWSUNFXG4vLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG5cbmV4cG9ydCBpbnRlcmZhY2UgU2VhcmNoRmFybXNPcHRpb25zIHtcbiAgcXVlcnk6IHN0cmluZztcbiAgbGltaXQ/OiBudW1iZXI7XG59XG5cbi8qKlxuICogU2VhcmNoIGZhcm1zIGJ5IG5hbWUsIGRlc2NyaXB0aW9uLCBvciBsb2NhdGlvblxuICpcbiAqIEBwYXJhbSBvcHRpb25zIC0gU2VhcmNoIHF1ZXJ5IGFuZCBsaW1pdFxuICogQHJldHVybnMgTWF0Y2hpbmcgcXVhbnR1bSBmYXJtc1xuICovXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gc2VhcmNoRmFybXNTZXJ2aWNlKFxuICBvcHRpb25zOiBTZWFyY2hGYXJtc09wdGlvbnNcbik6IFByb21pc2U8UXVhbnR1bUZhcm1bXT4ge1xuICBjb25zdCB7IHF1ZXJ5LCBsaW1pdCA9IDEwIH0gPSBvcHRpb25zO1xuXG4gIGNvbnN0IGZhcm1zID0gYXdhaXQgZGF0YWJhc2UuZmFybS5maW5kTWFueSh7XG4gICAgd2hlcmU6IHtcbiAgICAgIHN0YXR1czogXCJBQ1RJVkVcIixcbiAgICAgIE9SOiBbXG4gICAgICAgIHsgbmFtZTogeyBjb250YWluczogcXVlcnksIG1vZGU6IFwiaW5zZW5zaXRpdmVcIiB9IH0sXG4gICAgICAgIHsgZGVzY3JpcHRpb246IHsgY29udGFpbnM6IHF1ZXJ5LCBtb2RlOiBcImluc2Vuc2l0aXZlXCIgfSB9LFxuICAgICAgICB7IGNpdHk6IHsgY29udGFpbnM6IHF1ZXJ5LCBtb2RlOiBcImluc2Vuc2l0aXZlXCIgfSB9LFxuICAgICAgICB7IHN0YXRlOiB7IGNvbnRhaW5zOiBxdWVyeSwgbW9kZTogXCJpbnNlbnNpdGl2ZVwiIH0gfSxcbiAgICAgIF0sXG4gICAgfSxcbiAgICBpbmNsdWRlOiB7XG4gICAgICBvd25lcjoge1xuICAgICAgICBzZWxlY3Q6IHtcbiAgICAgICAgICBpZDogdHJ1ZSxcbiAgICAgICAgICBmaXJzdE5hbWU6IHRydWUsXG4gICAgICAgICAgbGFzdE5hbWU6IHRydWUsXG4gICAgICAgICAgZW1haWw6IHRydWUsXG4gICAgICAgIH0sXG4gICAgICB9LFxuICAgIH0sXG4gICAgdGFrZTogbGltaXQsXG4gICAgb3JkZXJCeTogeyBuYW1lOiBcImFzY1wiIH0sXG4gIH0pO1xuXG4gIHJldHVybiBmYXJtcy5tYXAobWFuaWZlc3RRdWFudHVtRmFybSk7XG59XG4iXSwidmVyc2lvbiI6M30=