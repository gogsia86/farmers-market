{"file":"M:\\Repo\\Farmers Market Platform web and app\\src\\lib\\services\\farm.service.ts","mappings":"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","names":[],"sources":["M:\\Repo\\Farmers Market Platform web and app\\src\\lib\\services\\farm.service.ts"],"sourcesContent":["/**\n * FARM SERVICE - DIVINE DATABASE OPERATIONS\n *\n * Business logic layer for farm entity operations.\n * Separates database concerns from API routes for cleaner architecture.\n *\n * Divine Patterns Applied:\n * - Service layer separation (from divine core principles)\n * - Type-safe database operations\n * - Enlightening error messages\n * - Quantum entity manifestation\n *\n * Functional Requirements: FR-011 (Farm Profile Creation)\n */\n\nimport { AgriculturalCache } from \"@/lib/cache/agricultural-cache\";\nimport { database } from \"@/lib/database\";\nimport {\n  generateFarmSlug,\n  manifestQuantumFarm,\n  type CreateFarmRequest,\n  type FarmSlug,\n  type QuantumFarm,\n  type UserId,\n} from \"@/types/farm.types\";\n\n// ============================================================================\n// FARM CREATION SERVICE\n// ============================================================================\n\nexport interface CreateFarmServiceOptions {\n  userId: UserId;\n  farmData: CreateFarmRequest;\n}\n\nexport interface CreateFarmServiceResult {\n  farm: QuantumFarm;\n  slug: FarmSlug;\n}\n\n/**\n * Create farm with unique slug generation\n *\n * Handles slug collision detection and quantum farm manifestation.\n * Separates business logic from HTTP concerns.\n *\n * @param options - User ID and farm data\n * @returns Created quantum farm entity\n * @throws Error if slug generation fails or validation fails\n */\nexport async function createFarmService(\n  options: CreateFarmServiceOptions\n): Promise<CreateFarmServiceResult> {\n  const { userId, farmData } = options;\n\n  // Input validation\n  if (!userId || typeof userId !== \"string\") {\n    throw new Error(\"Valid user ID is required\");\n  }\n\n  if (!farmData.name || farmData.name.trim().length < 3) {\n    throw new Error(\"Farm name must be at least 3 characters\");\n  }\n\n  if (!farmData.city || !farmData.state) {\n    throw new Error(\"City and state are required\");\n  }\n\n  if (farmData.email && !validateEmail(farmData.email)) {\n    throw new Error(\"Invalid email format\");\n  }\n\n// Email validation helper\nfunction validateEmail(email: string): boolean {\n  const emailRegex = /^[^\\s@]+@[^\\s@]+\\.[^\\s@]+$/;\n  return emailRegex.test(email);\n}\n\n  if (farmData.deliveryRadius && farmData.deliveryRadius < 0) {\n    throw new Error(\"Delivery radius must be positive\");\n  }\n\n  // Generate unique slug with collision detection\n  const slug = await generateUniqueSlug(farmData.name, farmData.city);\n\n  // Create farm in database\n  const farm = await database.farm.create({\n    data: {\n      // Identity\n      name: farmData.name,\n      slug,\n      ownerId: userId,\n\n      // Business\n      description: farmData.description,\n      story: farmData.story,\n      businessName: farmData.businessName,\n      yearEstablished: farmData.yearEstablished,\n      farmSize: farmData.farmSize,\n\n      // Location\n      address: farmData.address,\n      city: farmData.city,\n      state: farmData.state,\n      zipCode: farmData.zipCode,\n      country: \"US\",\n      latitude: farmData.latitude,\n      longitude: farmData.longitude,\n\n      // Contact\n      email: farmData.email || \"\",\n      phone: farmData.phone || \"\",\n      website: farmData.website || null,\n\n      // Practices\n      farmingPractices: farmData.farmingPractices || [],\n      productCategories: farmData.productCategories || [],\n\n      // Delivery\n      deliveryRadius: farmData.deliveryRadius,\n\n      // Status - PENDING until Stripe onboarded\n      status: \"PENDING\",\n      verificationStatus: \"PENDING\",\n      stripeOnboarded: false,\n      payoutsEnabled: false,\n    },\n    include: {\n      owner: {\n        select: {\n          id: true,\n          firstName: true,\n          lastName: true,\n          email: true,\n        },\n      },\n    },\n  });\n\n  // Manifest quantum farm entity\n  const quantumFarm = manifestQuantumFarm(farm);\n\n  return {\n    farm: quantumFarm,\n    slug: slug as FarmSlug,\n  };\n}\n\n// ============================================================================\n// CHECK EXISTING FARM\n// ============================================================================\n\nexport interface ExistingFarmCheck {\n  exists: boolean;\n  farm?: {\n    id: string;\n    slug: string;\n    name: string;\n  };\n}\n\n/**\n * Check if user already has a farm\n *\n * @param userId - User ID to check\n * @returns Existing farm info if found\n */\nexport async function checkExistingFarm(\n  userId: UserId\n): Promise<ExistingFarmCheck> {\n  const farm = await database.farm.findFirst({\n    where: {\n      ownerId: userId,\n    },\n    select: {\n      id: true,\n      slug: true,\n      name: true,\n    },\n  });\n\n  if (!farm) {\n    return { exists: false };\n  }\n\n  return {\n    exists: true,\n    farm,\n  };\n}\n\n// ============================================================================\n// UNIQUE SLUG GENERATION\n// ============================================================================\n\nconst MAX_SLUG_ATTEMPTS = 10;\n\n/**\n * Generate unique farm slug with collision detection\n *\n * Tries base slug first, then appends counter if collision detected.\n *\n * @param name - Farm name\n * @param city - Farm city\n * @returns Unique slug\n * @throws Error if max attempts exceeded\n */\nasync function generateUniqueSlug(\n  name: string,\n  city: string\n): Promise<FarmSlug> {\n  let slug = generateFarmSlug(name, city);\n  let attempt = 0;\n\n  while (attempt < MAX_SLUG_ATTEMPTS) {\n    const existing = await database.farm.findUnique({\n      where: { slug },\n      select: { id: true },\n    });\n\n    if (!existing) {\n      return slug;\n    }\n\n    // Collision detected - try with counter\n    attempt++;\n    slug = `${generateFarmSlug(name, city)}-${attempt}` as FarmSlug;\n  }\n\n  throw new Error(\n    `Failed to generate unique slug after ${MAX_SLUG_ATTEMPTS} attempts`\n  );\n}\n\n// ============================================================================\n// FARM RETRIEVAL SERVICES\n// ============================================================================\n\n/**\n * Get farm by ID with quantum manifestation\n * Uses agricultural cache for performance\n */\nexport async function getFarmById(farmId: string): Promise<QuantumFarm | null> {\n  // Try cache first\n  const cached = await AgriculturalCache.getFarm(farmId);\n  if (cached) {\n    return cached;\n  }\n\n  // Fetch from database\n  const farm = await database.farm.findUnique({\n    where: { id: farmId },\n    include: {\n      owner: {\n        select: {\n          id: true,\n          firstName: true,\n          lastName: true,\n          email: true,\n        },\n      },\n    },\n  });\n\n  if (!farm) {\n    return null;\n  }\n\n  const quantumFarm = manifestQuantumFarm(farm);\n\n  // Cache the result\n  await AgriculturalCache.cacheFarm(farmId, quantumFarm);\n\n  return quantumFarm;\n}\n\n/**\n * Get farm by slug with quantum manifestation\n * Uses agricultural cache for performance\n */\nexport async function getFarmBySlug(slug: string): Promise<QuantumFarm | null> {\n  // Try cache first (using slug as key)\n  const cacheKey = `farm:slug:${slug}`;\n  const cached = await AgriculturalCache.getFarm(cacheKey);\n  if (cached) {\n    return cached;\n  }\n\n  // Fetch from database\n  const farm = await database.farm.findUnique({\n    where: { slug },\n    include: {\n      owner: {\n        select: {\n          id: true,\n          firstName: true,\n          lastName: true,\n          email: true,\n        },\n      },\n    },\n  });\n\n  if (!farm) {\n    return null;\n  }\n\n  const quantumFarm = manifestQuantumFarm(farm);\n\n  // Cache by both ID and slug\n  await Promise.all([\n    AgriculturalCache.cacheFarm(farm.id, quantumFarm),\n    AgriculturalCache.cacheFarm(cacheKey, quantumFarm),\n  ]);\n\n  return quantumFarm;\n}\n\n// ============================================================================\n// FARM UPDATE SERVICE\n// ============================================================================\n\nexport interface UpdateFarmServiceOptions {\n  farmId: string;\n  userId: UserId;\n  updateData: Partial<CreateFarmRequest>;\n}\n\n/**\n * Update farm with ownership validation\n *\n * @param options - Farm ID, User ID, and update data\n * @returns Updated quantum farm entity\n * @throws Error if user doesn't own the farm\n */\nexport async function updateFarmService(\n  options: UpdateFarmServiceOptions\n): Promise<QuantumFarm> {\n  const { farmId, userId, updateData } = options;\n\n  // Verify ownership\n  const existingFarm = await database.farm.findUnique({\n    where: { id: farmId },\n    select: { ownerId: true },\n  });\n\n  if (!existingFarm) {\n    throw new Error(\"Farm not found\");\n  }\n\n  if (existingFarm.ownerId !== userId) {\n    throw new Error(\"Unauthorized: You don't own this farm\");\n  }\n\n  // Update farm\n  const updatedFarm = await database.farm.update({\n    where: { id: farmId },\n    data: {\n      // Only update provided fields\n      ...(updateData.name && { name: updateData.name }),\n      ...(updateData.description && { description: updateData.description }),\n      ...(updateData.story && { story: updateData.story }),\n      ...(updateData.businessName && { businessName: updateData.businessName }),\n      ...(updateData.yearEstablished && {\n        yearEstablished: updateData.yearEstablished,\n      }),\n      ...(updateData.farmSize && { farmSize: updateData.farmSize }),\n      ...(updateData.address && { address: updateData.address }),\n      ...(updateData.city && { city: updateData.city }),\n      ...(updateData.state && { state: updateData.state }),\n      ...(updateData.zipCode && { zipCode: updateData.zipCode }),\n      ...(updateData.latitude !== undefined && {\n        latitude: updateData.latitude,\n      }),\n      ...(updateData.longitude !== undefined && {\n        longitude: updateData.longitude,\n      }),\n      ...(updateData.email && { email: updateData.email }),\n      ...(updateData.phone && { phone: updateData.phone }),\n      ...(updateData.website !== undefined && { website: updateData.website }),\n      ...(updateData.farmingPractices && {\n        farmingPractices: updateData.farmingPractices,\n      }),\n      ...(updateData.productCategories && {\n        productCategories: updateData.productCategories,\n      }),\n      ...(updateData.deliveryRadius !== undefined && {\n        deliveryRadius: updateData.deliveryRadius,\n      }),\n    },\n    include: {\n      owner: {\n        select: {\n          id: true,\n          firstName: true,\n          lastName: true,\n          email: true,\n        },\n      },\n    },\n  });\n\n  const quantumFarm = manifestQuantumFarm(updatedFarm);\n\n  // Invalidate cache\n  await AgriculturalCache.invalidateFarm(farmId);\n\n  return quantumFarm;\n}\n\n// ============================================================================\n// FARM DELETION SERVICE\n// ============================================================================\n\nexport interface DeleteFarmServiceOptions {\n  farmId: string;\n  userId: UserId;\n}\n\n/**\n * Delete farm with ownership validation\n *\n * Soft delete by setting status to INACTIVE\n *\n * @param options - Farm ID and User ID\n * @throws Error if user doesn't own the farm\n */\nexport async function deleteFarmService(\n  options: DeleteFarmServiceOptions\n): Promise<void> {\n  const { farmId, userId } = options;\n\n  // Verify ownership\n  const existingFarm = await database.farm.findUnique({\n    where: { id: farmId },\n    select: { ownerId: true },\n  });\n\n  if (!existingFarm) {\n    throw new Error(\"Farm not found\");\n  }\n\n  if (existingFarm.ownerId !== userId) {\n    throw new Error(\"Unauthorized: You don't own this farm\");\n  }\n\n  // Soft delete (set status to INACTIVE)\n  await database.farm.update({\n    where: { id: farmId },\n    data: {\n      status: \"INACTIVE\",\n    },\n  });\n\n  // Invalidate cache\n  await AgriculturalCache.invalidateFarm(farmId);\n}\n\n// ============================================================================\n// FARM LISTING SERVICE\n// ============================================================================\n\nexport interface ListFarmsOptions {\n  page?: number;\n  limit?: number;\n  status?: string;\n  city?: string;\n  state?: string;\n  farmingPractices?: string[];\n  sortBy?: \"name\" | \"createdAt\" | \"rating\";\n  sortOrder?: \"asc\" | \"desc\";\n}\n\nexport interface ListFarmsResult {\n  farms: QuantumFarm[];\n  total: number;\n  page: number;\n  totalPages: number;\n}\n\n/**\n * List farms with pagination and filtering\n *\n * @param options - Pagination and filter options\n * @returns Paginated list of quantum farms\n */\nexport async function listFarmsService(\n  options: ListFarmsOptions = {}\n): Promise<ListFarmsResult> {\n  const {\n    page = 1,\n    limit = 20,\n    status,\n    city,\n    state,\n    farmingPractices,\n    sortBy = \"createdAt\",\n    sortOrder = \"desc\",\n  } = options;\n\n  const skip = (page - 1) * limit;\n\n  // Note: List queries are not cached due to complexity of filters and pagination\n  // Individual farms are cached when retrieved\n\n  // Build where clause\n  const where: any = {\n    status: { not: \"INACTIVE\" }, // Only active farms\n  };\n\n  if (status) {\n    where.status = status; // Override with specific status if provided\n  }\n\n  if (city) {\n    where.city = { contains: city, mode: \"insensitive\" };\n  }\n\n  if (state) {\n    where.state = state;\n  }\n\n  if (farmingPractices && farmingPractices.length > 0) {\n    where.farmingPractices = {\n      hasSome: farmingPractices,\n    };\n  }\n\n  // Get total count\n  const total = await database.farm.count({ where });\n\n  // Get paginated farms\n  const farms = await database.farm.findMany({\n    where,\n    include: {\n      owner: {\n        select: {\n          id: true,\n          firstName: true,\n          lastName: true,\n          email: true,\n        },\n      },\n    },\n    orderBy: { [sortBy]: sortOrder },\n    skip,\n    take: limit,\n  });\n\n  return {\n    farms: farms.map(manifestQuantumFarm),\n    total,\n    page,\n    totalPages: Math.ceil(total / limit),\n  };\n}\n\n// ============================================================================\n// FARM SEARCH SERVICE\n// ============================================================================\n\nexport interface SearchFarmsOptions {\n  query: string;\n  limit?: number;\n}\n\n/**\n * Search farms by name, description, or location\n *\n * @param options - Search query and limit\n * @returns Matching quantum farms\n */\nexport async function searchFarmsService(\n  options: SearchFarmsOptions\n): Promise<QuantumFarm[]> {\n  const { query, limit = 10 } = options;\n\n  const farms = await database.farm.findMany({\n    where: {\n      status: \"ACTIVE\",\n      OR: [\n        { name: { contains: query, mode: \"insensitive\" } },\n        { description: { contains: query, mode: \"insensitive\" } },\n        { city: { contains: query, mode: \"insensitive\" } },\n        { state: { contains: query, mode: \"insensitive\" } },\n      ],\n    },\n    include: {\n      owner: {\n        select: {\n          id: true,\n          firstName: true,\n          lastName: true,\n          email: true,\n        },\n      },\n    },\n    take: limit,\n    orderBy: { name: \"asc\" },\n  });\n\n  return farms.map(manifestQuantumFarm);\n}\n"],"version":3}