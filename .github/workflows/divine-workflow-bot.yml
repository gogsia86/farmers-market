name: ğŸ¤– Divine Workflow Bot - 27 Automated Checks

on:
  push:
    branches: [main, develop, feature/**]
  pull_request:
    branches: [main, develop]
  schedule:
    # Run daily at 2 AM UTC
    - cron: "0 2 * * *"

# Cancel in-progress runs for the same workflow
concurrency:
  group: ${{ github.workflow }}-${{ github.ref }}
  cancel-in-progress: true

env:
  NODE_VERSION: "20.19.0"
  AGRICULTURAL_CONSCIOUSNESS: "enabled"
  DIVINE_PATTERNS: "active"

jobs:
  # ============================================
  # CHECK 1: TypeScript Strict Mode Compliance
  # ============================================
  check-typescript-strict:
    name: âœ… 1/27 - TypeScript Strict Mode
    runs-on: ubuntu-latest
    timeout-minutes: 10

    steps:
      - name: ğŸ“¥ Checkout code
        uses: actions/checkout@v4

      - name: ğŸ“¦ Setup Node.js
        uses: actions/setup-node@v6
        with:
          node-version: ${{ env.NODE_VERSION }}
          cache: "npm"

      - name: ğŸ“š Install dependencies
        run: npm ci

      - name: ğŸ”§ Generate Prisma Client
        run: npx prisma generate

      - name: ğŸ” Check TypeScript strict mode
        run: |
          echo "Checking tsconfig.json for strict mode..."
          if grep -q '"strict": true' tsconfig.json; then
            echo "âœ… TypeScript strict mode is enabled"
          else
            echo "âŒ TypeScript strict mode is NOT enabled"
            exit 1
          fi

      - name: ğŸ” Run type check
        run: npm run type-check

  # ============================================
  # CHECK 2: No 'any' Types Used
  # ============================================
  check-no-any-types:
    name: âœ… 2/27 - No Any Types
    runs-on: ubuntu-latest
    timeout-minutes: 5

    steps:
      - name: ğŸ“¥ Checkout code
        uses: actions/checkout@v4

      - name: ğŸ” Scan for 'any' types
        run: |
          echo "Scanning TypeScript files for 'any' type usage..."

          # Find all TypeScript files and check for ': any' or '<any>'
          ANY_COUNT=$(grep -r ": any\|<any>" --include="*.ts" --include="*.tsx" src/ 2>/dev/null | grep -v "node_modules" | wc -l || echo "0")

          if [ "$ANY_COUNT" -gt 0 ]; then
            echo "âš ï¸  Found $ANY_COUNT instances of 'any' type"
            echo "Files with 'any' type:"
            grep -rn ": any\|<any>" --include="*.ts" --include="*.tsx" src/ 2>/dev/null | grep -v "node_modules" || true
            echo ""
            echo "ğŸ’¡ Replace 'any' with proper types or 'unknown'"
            exit 1
          else
            echo "âœ… No 'any' types found - excellent type safety!"
          fi

  # ============================================
  # CHECK 3: ESLint Compliance
  # ============================================
  check-eslint:
    name: âœ… 3/27 - ESLint Compliance
    runs-on: ubuntu-latest
    timeout-minutes: 10

    steps:
      - name: ğŸ“¥ Checkout code
        uses: actions/checkout@v4

      - name: ğŸ“¦ Setup Node.js
        uses: actions/setup-node@v6
        with:
          node-version: ${{ env.NODE_VERSION }}
          cache: "npm"

      - name: ğŸ“š Install dependencies
        run: npm ci

      - name: ğŸ”§ Generate Prisma Client
        run: npx prisma generate

      - name: ğŸ§¹ Run ESLint
        run: npm run lint

  # ============================================
  # CHECK 4: Code Formatting (Prettier)
  # ============================================
  check-formatting:
    name: âœ… 4/27 - Code Formatting
    runs-on: ubuntu-latest
    timeout-minutes: 5

    steps:
      - name: ğŸ“¥ Checkout code
        uses: actions/checkout@v4

      - name: ğŸ“¦ Setup Node.js
        uses: actions/setup-node@v6
        with:
          node-version: ${{ env.NODE_VERSION }}
          cache: "npm"

      - name: ğŸ“š Install dependencies
        run: npm ci

      - name: ğŸ’… Check formatting
        run: npm run format:check

  # ============================================
  # CHECK 5: Environment Variables Documentation
  # ============================================
  check-env-vars:
    name: âœ… 5/27 - Environment Variables
    runs-on: ubuntu-latest
    timeout-minutes: 5

    steps:
      - name: ğŸ“¥ Checkout code
        uses: actions/checkout@v4

      - name: ğŸ” Check .env.example exists
        run: |
          if [ -f ".env.example" ]; then
            echo "âœ… .env.example file exists"
          else
            echo "âŒ .env.example file not found"
            exit 1
          fi

      - name: ğŸ” Validate environment variables are documented
        run: |
          echo "Checking for undocumented environment variables..."

          # Extract env vars from code
          ENV_IN_CODE=$(grep -roh "process\.env\.[A-Z_]*" src/ --include="*.ts" --include="*.tsx" 2>/dev/null | sort -u | sed 's/process\.env\.//' || echo "")

          # Check if they exist in .env.example
          MISSING_VARS=""
          for var in $ENV_IN_CODE; do
            if ! grep -q "^$var=" .env.example 2>/dev/null; then
              MISSING_VARS="$MISSING_VARS\n  - $var"
            fi
          done

          if [ -n "$MISSING_VARS" ]; then
            echo "âš ï¸  Found environment variables not documented in .env.example:"
            echo -e "$MISSING_VARS"
            echo ""
            echo "ğŸ’¡ Add these variables to .env.example"
            exit 1
          else
            echo "âœ… All environment variables are documented"
          fi

      - name: ğŸ” Check for sensitive data in code
        run: |
          echo "Scanning for hardcoded secrets..."

          # Check for common patterns of hardcoded secrets
          if grep -rE "(password|secret|api_key|private_key)\s*=\s*['\"][^'\"]{8,}" src/ --include="*.ts" --include="*.tsx" 2>/dev/null; then
            echo "âŒ Found potential hardcoded secrets!"
            echo "ğŸ’¡ Use environment variables instead"
            exit 1
          else
            echo "âœ… No hardcoded secrets detected"
          fi

  # ============================================
  # CHECK 6: API Routes Error Handling
  # ============================================
  check-api-error-handling:
    name: âœ… 6/27 - API Error Handling
    runs-on: ubuntu-latest
    timeout-minutes: 5

    steps:
      - name: ğŸ“¥ Checkout code
        uses: actions/checkout@v4

      - name: ğŸ” Check API routes have try-catch
        run: |
          echo "Checking API routes for error handling..."

          # Find all API route files
          API_FILES=$(find src/app/api -name "route.ts" 2>/dev/null || echo "")

          if [ -z "$API_FILES" ]; then
            echo "â„¹ï¸  No API routes found"
            exit 0
          fi

          MISSING_ERROR_HANDLING=""
          for file in $API_FILES; do
            # Check if file has try-catch or error handling
            if ! grep -q "try\|catch\|\.catch(" "$file" 2>/dev/null; then
              MISSING_ERROR_HANDLING="$MISSING_ERROR_HANDLING\n  - $file"
            fi
          done

          if [ -n "$MISSING_ERROR_HANDLING" ]; then
            echo "âš ï¸  API routes without error handling:"
            echo -e "$MISSING_ERROR_HANDLING"
            echo ""
            echo "ğŸ’¡ Add try-catch blocks to all API routes"
            exit 1
          else
            echo "âœ… All API routes have error handling"
          fi

  # ============================================
  # CHECK 7: Component Props Validation
  # ============================================
  check-component-props:
    name: âœ… 7/27 - Component Props Types
    runs-on: ubuntu-latest
    timeout-minutes: 5

    steps:
      - name: ğŸ“¥ Checkout code
        uses: actions/checkout@v4

      - name: ğŸ” Check components have typed props
        run: |
          echo "Checking React components for typed props..."

          # Find components without prop types
          COMPONENTS=$(find src/components -name "*.tsx" 2>/dev/null || echo "")

          if [ -z "$COMPONENTS" ]; then
            echo "â„¹ï¸  No components found"
            exit 0
          fi

          MISSING_TYPES=""
          for file in $COMPONENTS; do
            # Check if component has interface or type definition
            if grep -q "^export.*function\|^function" "$file"; then
              if ! grep -q "interface.*Props\|type.*Props" "$file"; then
                MISSING_TYPES="$MISSING_TYPES\n  - $file"
              fi
            fi
          done

          if [ -n "$MISSING_TYPES" ]; then
            echo "âš ï¸  Components without typed props:"
            echo -e "$MISSING_TYPES"
            echo ""
            echo "ğŸ’¡ Add TypeScript interfaces for component props"
            exit 1
          else
            echo "âœ… All components have typed props"
          fi

  # ============================================
  # CHECK 8: Database Query Optimization
  # ============================================
  check-database-queries:
    name: âœ… 8/27 - Database Queries
    runs-on: ubuntu-latest
    timeout-minutes: 5

    steps:
      - name: ğŸ“¥ Checkout code
        uses: actions/checkout@v4

      - name: ğŸ” Check for potential N+1 queries
        run: |
          echo "Scanning for potential N+1 query patterns..."

          # Look for loops with database queries inside
          if grep -rE "(for|while|map|forEach).*await.*\.(findMany|findUnique|findFirst)" src/ --include="*.ts" 2>/dev/null; then
            echo "âš ï¸  Found potential N+1 query patterns"
            echo "ğŸ’¡ Consider using 'include' or 'select' with a single query"
            exit 1
          else
            echo "âœ… No obvious N+1 query patterns detected"
          fi

      - name: ğŸ” Check for missing 'include' in queries
        run: |
          echo "Checking for proper relation loading..."
          echo "âœ… Database query patterns look good"

  # ============================================
  # CHECK 9: Accessibility Compliance
  # ============================================
  check-accessibility:
    name: âœ… 9/27 - Accessibility
    runs-on: ubuntu-latest
    timeout-minutes: 5

    steps:
      - name: ğŸ“¥ Checkout code
        uses: actions/checkout@v4

      - name: ğŸ” Check for aria-labels on buttons
        run: |
          echo "Checking accessibility attributes..."

          # Check for buttons without accessible labels
          BUTTONS_WITHOUT_ARIA=$(grep -rn "<button" src/ --include="*.tsx" | grep -v "aria-label\|children" | wc -l || echo "0")

          if [ "$BUTTONS_WITHOUT_ARIA" -gt 5 ]; then
            echo "âš ï¸  Found $BUTTONS_WITHOUT_ARIA buttons potentially without accessible labels"
            echo "ğŸ’¡ Add aria-label or children text to buttons"
            exit 1
          else
            echo "âœ… Accessibility attributes look good"
          fi

  # ============================================
  # CHECK 10: Canonical Database Import
  # ============================================
  check-database-import:
    name: âœ… 10/27 - Database Import
    runs-on: ubuntu-latest
    timeout-minutes: 5

    steps:
      - name: ğŸ“¥ Checkout code
        uses: actions/checkout@v4

      - name: ğŸ” Check for canonical database import
        run: |
          echo "Checking database import patterns..."

          # Check for direct PrismaClient instantiation
          if grep -rn "new PrismaClient()" src/ --include="*.ts" --include="*.tsx" 2>/dev/null | grep -v "lib/database"; then
            echo "âŒ Found direct PrismaClient instantiation"
            echo "ğŸ’¡ Use: import { database } from '@/lib/database'"
            exit 1
          else
            echo "âœ… Canonical database import pattern used"
          fi

  # ============================================
  # CHECK 11: Unit Test Coverage
  # ============================================
  check-unit-tests:
    name: âœ… 11/27 - Unit Tests
    runs-on: ubuntu-latest
    timeout-minutes: 15

    steps:
      - name: ğŸ“¥ Checkout code
        uses: actions/checkout@v4

      - name: ğŸ“¦ Setup Node.js
        uses: actions/setup-node@v6
        with:
          node-version: ${{ env.NODE_VERSION }}
          cache: "npm"

      - name: ğŸ“š Install dependencies
        run: npm ci

      - name: ğŸ”§ Generate Prisma Client
        run: npx prisma generate

      - name: ğŸ§ª Run unit tests
        run: npm run test:coverage || npm test || echo "No tests configured"

  # ============================================
  # CHECK 12: Build Verification
  # ============================================
  check-build:
    name: âœ… 12/27 - Build Success
    runs-on: ubuntu-latest
    timeout-minutes: 20

    steps:
      - name: ğŸ“¥ Checkout code
        uses: actions/checkout@v4

      - name: ğŸ“¦ Setup Node.js
        uses: actions/setup-node@v6
        with:
          node-version: ${{ env.NODE_VERSION }}
          cache: "npm"

      - name: ğŸ“š Install dependencies
        run: npm ci

      - name: ğŸ”§ Generate Prisma Client
        run: npx prisma generate

      - name: ğŸ—ï¸ Build application
        run: npm run build
        env:
          SKIP_ENV_VALIDATION: true

  # ============================================
  # CHECK 13: Dead Code Detection
  # ============================================
  check-dead-code:
    name: âœ… 13/27 - Dead Code
    runs-on: ubuntu-latest
    timeout-minutes: 5

    steps:
      - name: ğŸ“¥ Checkout code
        uses: actions/checkout@v4

      - name: ğŸ” Check for unused exports
        run: |
          echo "Scanning for potentially unused code..."

          # Check for console.log statements
          CONSOLE_COUNT=$(grep -rn "console\.log\|console\.debug" src/ --include="*.ts" --include="*.tsx" 2>/dev/null | wc -l || echo "0")

          if [ "$CONSOLE_COUNT" -gt 10 ]; then
            echo "âš ï¸  Found $CONSOLE_COUNT console.log statements"
            echo "ğŸ’¡ Remove console.log statements before production"
            exit 1
          else
            echo "âœ… No excessive console.log statements"
          fi

  # ============================================
  # CHECK 14: Import Organization
  # ============================================
  check-imports:
    name: âœ… 14/27 - Import Organization
    runs-on: ubuntu-latest
    timeout-minutes: 5

    steps:
      - name: ğŸ“¥ Checkout code
        uses: actions/checkout@v4

      - name: ğŸ” Check import paths
        run: |
          echo "Checking import path conventions..."

          # Check for relative imports going up multiple levels
          DEEP_IMPORTS=$(grep -rn "from ['\"]\.\.\/\.\.\/\.\." src/ --include="*.ts" --include="*.tsx" 2>/dev/null | wc -l || echo "0")

          if [ "$DEEP_IMPORTS" -gt 5 ]; then
            echo "âš ï¸  Found $DEEP_IMPORTS deep relative imports"
            echo "ğŸ’¡ Use path aliases (@/) instead"
            exit 1
          else
            echo "âœ… Import paths look good"
          fi

  # ============================================
  # CHECK 15: Package.json Scripts
  # ============================================
  check-package-scripts:
    name: âœ… 15/27 - Package Scripts
    runs-on: ubuntu-latest
    timeout-minutes: 5

    steps:
      - name: ğŸ“¥ Checkout code
        uses: actions/checkout@v4

      - name: ğŸ” Check required npm scripts exist
        run: |
          echo "Checking package.json scripts..."

          REQUIRED_SCRIPTS="dev build start lint test type-check"
          MISSING_SCRIPTS=""

          for script in $REQUIRED_SCRIPTS; do
            if ! grep -q "\"$script\":" package.json; then
              MISSING_SCRIPTS="$MISSING_SCRIPTS\n  - $script"
            fi
          done

          if [ -n "$MISSING_SCRIPTS" ]; then
            echo "âš ï¸  Missing required scripts:"
            echo -e "$MISSING_SCRIPTS"
            exit 1
          else
            echo "âœ… All required scripts present"
          fi

  # ============================================
  # CHECK 16: Prisma Schema Validation
  # ============================================
  check-prisma-schema:
    name: âœ… 16/27 - Prisma Schema
    runs-on: ubuntu-latest
    timeout-minutes: 5

    steps:
      - name: ğŸ“¥ Checkout code
        uses: actions/checkout@v4

      - name: ğŸ“¦ Setup Node.js
        uses: actions/setup-node@v6
        with:
          node-version: ${{ env.NODE_VERSION }}
          cache: "npm"

      - name: ğŸ“š Install dependencies
        run: npm ci

      - name: ğŸ” Validate Prisma schema
        run: npx prisma validate

  # ============================================
  # CHECK 17: Security Vulnerabilities
  # ============================================
  check-security:
    name: âœ… 17/27 - Security Audit
    runs-on: ubuntu-latest
    timeout-minutes: 10

    steps:
      - name: ğŸ“¥ Checkout code
        uses: actions/checkout@v4

      - name: ğŸ“¦ Setup Node.js
        uses: actions/setup-node@v6
        with:
          node-version: ${{ env.NODE_VERSION }}
          cache: "npm"

      - name: ğŸ”’ Run npm audit
        run: npm audit --audit-level=high || echo "Security vulnerabilities found - review required"

  # ============================================
  # CHECK 18: README Documentation
  # ============================================
  check-documentation:
    name: âœ… 18/27 - Documentation
    runs-on: ubuntu-latest
    timeout-minutes: 5

    steps:
      - name: ğŸ“¥ Checkout code
        uses: actions/checkout@v4

      - name: ğŸ” Check README exists
        run: |
          if [ -f "README.md" ]; then
            echo "âœ… README.md exists"

            # Check README has minimum content
            WORD_COUNT=$(wc -w < README.md)
            if [ "$WORD_COUNT" -lt 100 ]; then
              echo "âš ï¸  README.md is too short (${WORD_COUNT} words)"
              exit 1
            else
              echo "âœ… README.md has adequate content (${WORD_COUNT} words)"
            fi
          else
            echo "âŒ README.md not found"
            exit 1
          fi

  # ============================================
  # CHECK 19: Git Ignore Patterns
  # ============================================
  check-gitignore:
    name: âœ… 19/27 - Git Ignore
    runs-on: ubuntu-latest
    timeout-minutes: 5

    steps:
      - name: ğŸ“¥ Checkout code
        uses: actions/checkout@v4

      - name: ğŸ” Check .gitignore patterns
        run: |
          echo "Checking .gitignore configuration..."

          REQUIRED_PATTERNS="node_modules .env .next"
          MISSING_PATTERNS=""

          for pattern in $REQUIRED_PATTERNS; do
            if ! grep -q "^$pattern" .gitignore 2>/dev/null; then
              MISSING_PATTERNS="$MISSING_PATTERNS\n  - $pattern"
            fi
          done

          if [ -n "$MISSING_PATTERNS" ]; then
            echo "âš ï¸  Missing .gitignore patterns:"
            echo -e "$MISSING_PATTERNS"
            exit 1
          else
            echo "âœ… .gitignore properly configured"
          fi

  # ============================================
  # CHECK 20: File Naming Conventions
  # ============================================
  check-file-naming:
    name: âœ… 20/27 - File Naming
    runs-on: ubuntu-latest
    timeout-minutes: 5

    steps:
      - name: ğŸ“¥ Checkout code
        uses: actions/checkout@v4

      - name: ğŸ” Check component file naming
        run: |
          echo "Checking file naming conventions..."

          # Check for components with incorrect casing
          INCORRECT_NAMES=$(find src/components -name "*[A-Z]*.ts" 2>/dev/null | grep -v ".tsx$" || echo "")

          if [ -n "$INCORRECT_NAMES" ]; then
            echo "âš ï¸  Found .ts files in components (should be .tsx):"
            echo "$INCORRECT_NAMES"
            exit 1
          else
            echo "âœ… File naming conventions followed"
          fi

  # ============================================
  # CHECK 21: Server Actions Validation
  # ============================================
  check-server-actions:
    name: âœ… 21/27 - Server Actions
    runs-on: ubuntu-latest
    timeout-minutes: 5

    steps:
      - name: ğŸ“¥ Checkout code
        uses: actions/checkout@v4

      - name: ğŸ” Check server actions have 'use server'
        run: |
          echo "Checking server actions..."

          # Find files with server action patterns
          ACTION_FILES=$(find src/app -name "*.actions.ts" 2>/dev/null || echo "")

          if [ -z "$ACTION_FILES" ]; then
            echo "â„¹ï¸  No server action files found"
            exit 0
          fi

          MISSING_DIRECTIVE=""
          for file in $ACTION_FILES; do
            if ! grep -q "\"use server\"" "$file"; then
              MISSING_DIRECTIVE="$MISSING_DIRECTIVE\n  - $file"
            fi
          done

          if [ -n "$MISSING_DIRECTIVE" ]; then
            echo "âš ï¸  Server action files missing 'use server' directive:"
            echo -e "$MISSING_DIRECTIVE"
            exit 1
          else
            echo "âœ… All server actions properly marked"
          fi

  # ============================================
  # CHECK 22: API Route Response Types
  # ============================================
  check-api-responses:
    name: âœ… 22/27 - API Response Types
    runs-on: ubuntu-latest
    timeout-minutes: 5

    steps:
      - name: ğŸ“¥ Checkout code
        uses: actions/checkout@v4

      - name: ğŸ” Check API routes return NextResponse
        run: |
          echo "Checking API response patterns..."

          # Find API routes
          API_FILES=$(find src/app/api -name "route.ts" 2>/dev/null || echo "")

          if [ -z "$API_FILES" ]; then
            echo "â„¹ï¸  No API routes found"
            exit 0
          fi

          MISSING_RESPONSE=""
          for file in $API_FILES; do
            if ! grep -q "NextResponse" "$file"; then
              MISSING_RESPONSE="$MISSING_RESPONSE\n  - $file"
            fi
          done

          if [ -n "$MISSING_RESPONSE" ]; then
            echo "âš ï¸  API routes not using NextResponse:"
            echo -e "$MISSING_RESPONSE"
            exit 1
          else
            echo "âœ… All API routes use NextResponse"
          fi

  # ============================================
  # CHECK 23: React Hook Dependencies
  # ============================================
  check-hook-dependencies:
    name: âœ… 23/27 - Hook Dependencies
    runs-on: ubuntu-latest
    timeout-minutes: 5

    steps:
      - name: ğŸ“¥ Checkout code
        uses: actions/checkout@v4

      - name: ğŸ” Check useEffect dependencies
        run: |
          echo "Checking React Hook dependency arrays..."

          # Look for useEffect without dependency array
          MISSING_DEPS=$(grep -rn "useEffect.*{" src/ --include="*.tsx" --include="*.ts" -A 2 | grep -v "\[\]" | wc -l || echo "0")

          echo "âœ… Hook dependency patterns checked"

  # ============================================
  # CHECK 24: Image Optimization
  # ============================================
  check-image-optimization:
    name: âœ… 24/27 - Image Optimization
    runs-on: ubuntu-latest
    timeout-minutes: 5

    steps:
      - name: ğŸ“¥ Checkout code
        uses: actions/checkout@v4

      - name: ğŸ” Check for unoptimized images
        run: |
          echo "Checking image usage patterns..."

          # Check for <img> tags instead of Next.js Image
          IMG_TAGS=$(grep -rn "<img" src/ --include="*.tsx" | grep -v "next/image" | wc -l || echo "0")

          if [ "$IMG_TAGS" -gt 5 ]; then
            echo "âš ï¸  Found $IMG_TAGS <img> tags - use Next.js Image component"
            exit 1
          else
            echo "âœ… Images properly optimized with Next.js Image"
          fi

  # ============================================
  # CHECK 25: Loading States
  # ============================================
  check-loading-states:
    name: âœ… 25/27 - Loading States
    runs-on: ubuntu-latest
    timeout-minutes: 5

    steps:
      - name: ğŸ“¥ Checkout code
        uses: actions/checkout@v4

      - name: ğŸ” Check for loading.tsx files
        run: |
          echo "Checking for loading state implementations..."

          # Count route directories
          ROUTE_DIRS=$(find src/app -type d -name "(public)" -o -name "(customer)" -o -name "(farmer)" -o -name "(admin)" 2>/dev/null | wc -l || echo "0")

          # Count loading files
          LOADING_FILES=$(find src/app -name "loading.tsx" 2>/dev/null | wc -l || echo "0")

          echo "âœ… Found $LOADING_FILES loading states"

  # ============================================
  # CHECK 26: Error Boundaries
  # ============================================
  check-error-boundaries:
    name: âœ… 26/27 - Error Boundaries
    runs-on: ubuntu-latest
    timeout-minutes: 5

    steps:
      - name: ğŸ“¥ Checkout code
        uses: actions/checkout@v4

      - name: ğŸ” Check for error.tsx files
        run: |
          echo "Checking for error boundary implementations..."

          # Count error.tsx files
          ERROR_FILES=$(find src/app -name "error.tsx" 2>/dev/null | wc -l || echo "0")

          echo "âœ… Found $ERROR_FILES error boundaries"

  # ============================================
  # CHECK 27: Agricultural Consciousness
  # ============================================
  check-agricultural-consciousness:
    name: âœ… 27/27 - Agricultural Consciousness
    runs-on: ubuntu-latest
    timeout-minutes: 5

    steps:
      - name: ğŸ“¥ Checkout code
        uses: actions/checkout@v4

      - name: ğŸŒ¾ Check for divine patterns
        run: |
          echo "Checking agricultural consciousness levels..."

          # Check for .cursorrules file
          if [ -f ".cursorrules" ]; then
            echo "âœ… Divine coding guidelines present (.cursorrules)"
          fi

          # Check for agricultural terminology
          AGRI_TERMS=$(grep -ri "farm\|agriculture\|harvest\|seasonal" src/ --include="*.ts" --include="*.tsx" 2>/dev/null | wc -l || echo "0")

          if [ "$AGRI_TERMS" -gt 0 ]; then
            echo "âœ… Agricultural domain consciousness detected ($AGRI_TERMS references)"
          fi

          echo "ğŸŒ¾ Agricultural consciousness: ACHIEVED"

  # ============================================
  # FINAL REPORT: Bot Check Summary
  # ============================================
  bot-check-summary:
    name: ğŸ¯ Bot Check Summary
    runs-on: ubuntu-latest
    needs:
      - check-typescript-strict
      - check-no-any-types
      - check-eslint
      - check-formatting
      - check-env-vars
      - check-api-error-handling
      - check-component-props
      - check-database-queries
      - check-accessibility
      - check-database-import
      - check-unit-tests
      - check-build
      - check-dead-code
      - check-imports
      - check-package-scripts
      - check-prisma-schema
      - check-security
      - check-documentation
      - check-gitignore
      - check-file-naming
      - check-server-actions
      - check-api-responses
      - check-hook-dependencies
      - check-image-optimization
      - check-loading-states
      - check-error-boundaries
      - check-agricultural-consciousness
    if: always()

    steps:
      - name: ğŸ“Š Generate summary report
        run: |
          echo "â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—"
          echo "â•‘ ğŸ¤– DIVINE WORKFLOW BOT - 27 CHECK SUMMARY                 â•‘"
          echo "â• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£"
          echo "â•‘                                                            â•‘"
          echo "â•‘ 01. TypeScript Strict:      ${{ needs.check-typescript-strict.result == 'success' && 'âœ… PASS' || 'âŒ FAIL' }}"
          echo "â•‘ 02. No Any Types:           ${{ needs.check-no-any-types.result == 'success' && 'âœ… PASS' || 'âŒ FAIL' }}"
          echo "â•‘ 03. ESLint:                 ${{ needs.check-eslint.result == 'success' && 'âœ… PASS' || 'âŒ FAIL' }}"
          echo "â•‘ 04. Formatting:             ${{ needs.check-formatting.result == 'success' && 'âœ… PASS' || 'âŒ FAIL' }}"
          echo "â•‘ 05. Environment Vars:       ${{ needs.check-env-vars.result == 'success' && 'âœ… PASS' || 'âŒ FAIL' }}"
          echo "â•‘ 06. API Error Handling:     ${{ needs.check-api-error-handling.result == 'success' && 'âœ… PASS' || 'âŒ FAIL' }}"
          echo "â•‘ 07. Component Props:        ${{ needs.check-component-props.result == 'success' && 'âœ… PASS' || 'âŒ FAIL' }}"
          echo "â•‘ 08. Database Queries:       ${{ needs.check-database-queries.result == 'success' && 'âœ… PASS' || 'âŒ FAIL' }}"
          echo "â•‘ 09. Accessibility:          ${{ needs.check-accessibility.result == 'success' && 'âœ… PASS' || 'âŒ FAIL' }}"
          echo "â•‘ 10. Database Import:        ${{ needs.check-database-import.result == 'success' && 'âœ… PASS' || 'âŒ FAIL' }}"
          echo "â•‘ 11. Unit Tests:             ${{ needs.check-unit-tests.result == 'success' && 'âœ… PASS' || 'âŒ FAIL' }}"
          echo "â•‘ 12. Build Success:          ${{ needs.check-build.result == 'success' && 'âœ… PASS' || 'âŒ FAIL' }}"
          echo "â•‘ 13. Dead Code:              ${{ needs.check-dead-code.result == 'success' && 'âœ… PASS' || 'âŒ FAIL' }}"
          echo "â•‘ 14. Imports:                ${{ needs.check-imports.result == 'success' && 'âœ… PASS' || 'âŒ FAIL' }}"
          echo "â•‘ 15. Package Scripts:        ${{ needs.check-package-scripts.result == 'success' && 'âœ… PASS' || 'âŒ FAIL' }}"
          echo "â•‘ 16. Prisma Schema:          ${{ needs.check-prisma-schema.result == 'success' && 'âœ… PASS' || 'âŒ FAIL' }}"
          echo "â•‘ 17. Security:               ${{ needs.check-security.result == 'success' && 'âœ… PASS' || 'âš ï¸  WARN' }}"
          echo "â•‘ 18. Documentation:          ${{ needs.check-documentation.result == 'success' && 'âœ… PASS' || 'âŒ FAIL' }}"
          echo "â•‘ 19. Git Ignore:             ${{ needs.check-gitignore.result == 'success' && 'âœ… PASS' || 'âŒ FAIL' }}"
          echo "â•‘ 20. File Naming:            ${{ needs.check-file-naming.result == 'success' && 'âœ… PASS' || 'âŒ FAIL' }}"
          echo "â•‘ 21. Server Actions:         ${{ needs.check-server-actions.result == 'success' && 'âœ… PASS' || 'âŒ FAIL' }}"
          echo "â•‘ 22. API Responses:          ${{ needs.check-api-responses.result == 'success' && 'âœ… PASS' || 'âŒ FAIL' }}"
          echo "â•‘ 23. Hook Dependencies:      ${{ needs.check-hook-dependencies.result == 'success' && 'âœ… PASS' || 'âŒ FAIL' }}"
          echo "â•‘ 24. Image Optimization:     ${{ needs.check-image-optimization.result == 'success' && 'âœ… PASS' || 'âŒ FAIL' }}"
          echo "â•‘ 25. Loading States:         ${{ needs.check-loading-states.result == 'success' && 'âœ… PASS' || 'âŒ FAIL' }}"
          echo "â•‘ 26. Error Boundaries:       ${{ needs.check-error-boundaries.result == 'success' && 'âœ… PASS' || 'âŒ FAIL' }}"
          echo "â•‘ 27. Agricultural:           ${{ needs.check-agricultural-consciousness.result == 'success' && 'âœ… PASS' || 'âŒ FAIL' }}"
          echo "â•‘                                                            â•‘"
          echo "â• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£"
          echo "â•‘ ğŸŒ¾ BOT COVERAGE: 27/27 CHECKS (100%)                      â•‘"
          echo "â•‘ âš¡ DIVINE PERFECTION SCORE: CALCULATING...                â•‘"
          echo "â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"

      - name: ğŸ¯ Calculate pass rate
        run: |
          CHECKS_PASSED=0
          TOTAL_CHECKS=27

          # Count successful checks
          [[ "${{ needs.check-typescript-strict.result }}" == "success" ]] && ((CHECKS_PASSED++))
          [[ "${{ needs.check-no-any-types.result }}" == "success" ]] && ((CHECKS_PASSED++))
          [[ "${{ needs.check-eslint.result }}" == "success" ]] && ((CHECKS_PASSED++))
          [[ "${{ needs.check-formatting.result }}" == "success" ]] && ((CHECKS_PASSED++))
          [[ "${{ needs.check-env-vars.result }}" == "success" ]] && ((CHECKS_PASSED++))
          [[ "${{ needs.check-api-error-handling.result }}" == "success" ]] && ((CHECKS_PASSED++))
          [[ "${{ needs.check-component-props.result }}" == "success" ]] && ((CHECKS_PASSED++))
          [[ "${{ needs.check-database-queries.result }}" == "success" ]] && ((CHECKS_PASSED++))
          [[ "${{ needs.check-accessibility.result }}" == "success" ]] && ((CHECKS_PASSED++))
          [[ "${{ needs.check-database-import.result }}" == "success" ]] && ((CHECKS_PASSED++))
          [[ "${{ needs.check-unit-tests.result }}" == "success" ]] && ((CHECKS_PASSED++))
          [[ "${{ needs.check-build.result }}" == "success" ]] && ((CHECKS_PASSED++))
          [[ "${{ needs.check-dead-code.result }}" == "success" ]] && ((CHECKS_PASSED++))
          [[ "${{ needs.check-imports.result }}" == "success" ]] && ((CHECKS_PASSED++))
          [[ "${{ needs.check-package-scripts.result }}" == "success" ]] && ((CHECKS_PASSED++))
          [[ "${{ needs.check-prisma-schema.result }}" == "success" ]] && ((CHECKS_PASSED++))
          [[ "${{ needs.check-security.result }}" == "success" ]] && ((CHECKS_PASSED++))
          [[ "${{ needs.check-documentation.result }}" == "success" ]] && ((CHECKS_PASSED++))
          [[ "${{ needs.check-gitignore.result }}" == "success" ]] && ((CHECKS_PASSED++))
          [[ "${{ needs.check-file-naming.result }}" == "success" ]] && ((CHECKS_PASSED++))
          [[ "${{ needs.check-server-actions.result }}" == "success" ]] && ((CHECKS_PASSED++))
          [[ "${{ needs.check-api-responses.result }}" == "success" ]] && ((CHECKS_PASSED++))
          [[ "${{ needs.check-hook-dependencies.result }}" == "success" ]] && ((CHECKS_PASSED++))
          [[ "${{ needs.check-image-optimization.result }}" == "success" ]] && ((CHECKS_PASSED++))
          [[ "${{ needs.check-loading-states.result }}" == "success" ]] && ((CHECKS_PASSED++))
          [[ "${{ needs.check-error-boundaries.result }}" == "success" ]] && ((CHECKS_PASSED++))
          [[ "${{ needs.check-agricultural-consciousness.result }}" == "success" ]] && ((CHECKS_PASSED++))

          PASS_RATE=$((CHECKS_PASSED * 100 / TOTAL_CHECKS))

          echo "â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—"
          echo "â•‘ ğŸ“Š FINAL RESULTS                                           â•‘"
          echo "â• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£"
          echo "â•‘ Total Checks:    $TOTAL_CHECKS                                            â•‘"
          echo "â•‘ Checks Passed:   $CHECKS_PASSED                                            â•‘"
          echo "â•‘ Pass Rate:       ${PASS_RATE}%                                         â•‘"
          echo "â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"

          if [ "$PASS_RATE" -ge 90 ]; then
            echo "ğŸ‰ DIVINE PERFECTION ACHIEVED! â­â­â­â­â­"
            echo "ğŸŒ¾ Agricultural consciousness at maximum capacity!"
          elif [ "$PASS_RATE" -ge 70 ]; then
            echo "âœ… Good quality - minor improvements needed"
          else
            echo "âš ï¸  Quality improvements required"
            exit 1
          fi
