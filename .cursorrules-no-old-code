# üö´ NO OLD CODE POLICY - ZERO TOLERANCE
# Farmers Market Platform - Modern Code Standards & Enforcement
# Version: 4.0 - ABSOLUTE MODERNIZATION
# Last Updated: January 2026

## üéØ CORE PRINCIPLE: ZERO TOLERANCE FOR OLD CODE

**ABSOLUTE RULES**:
- ‚ùå NO deprecated code
- ‚ùå NO backward compatibility layers
- ‚ùå NO legacy patterns
- ‚ùå NO old APIs
- ‚ùå NO dead code
- ‚ùå NO polyfills (unless absolutely necessary for modern browsers)
- ‚ùå NO "TODO: remove in future" comments
- ‚ùå NO "DEPRECATED" markers - just delete it
- ‚ùå NO "legacy" directories or files
- ‚ùå NO "old" prefixes or suffixes
- ‚ùå NO commented-out code blocks

**PHILOSOPHY**: If it's old, remove it. If it's deprecated, delete it. If it's for backward compatibility, eliminate it.

---

## üìã MANDATORY MODERN STANDARDS

### JavaScript/TypeScript (2024+)

#### ‚úÖ USE (Modern)
```typescript
// ES2024+ Features
import { something } from './module'              // ES modules only
export const value = 1                            // Named exports
export default function Component() {}            // Default exports
const [state, setState] = useState()              // Hooks
async/await                                       // Modern async
?.                                                // Optional chaining
??                                                // Nullish coalescing
structuredClone()                                 // Deep cloning
Object.hasOwn()                                   // Property checking
Array.prototype.at()                              // Array access
Array.prototype.toSorted()                        // Immutable sorting
Array.prototype.toReversed()                      // Immutable reversing
Array.prototype.with()                            // Immutable updates
Array.prototype.findLast()                        // Array searching
Array.prototype.findLastIndex()                   // Array searching
Promise.allSettled()                              // Promise handling
Promise.any()                                     // Promise racing
String.prototype.replaceAll()                     // String manipulation
crypto.randomUUID()                               // UUID generation
AbortController / AbortSignal                     // Cancellation
fetch API                                         // HTTP requests
Headers / Request / Response                      // Web APIs
```

#### ‚ùå NEVER USE (Deprecated/Old)
```typescript
// FORBIDDEN - Delete on sight
require()                                         // ‚ùå Use import
module.exports                                    // ‚ùå Use export
var                                               // ‚ùå Use const/let
React.FC                                          // ‚ùå Use function
React.FunctionComponent                           // ‚ùå Use function
React.Component (class components)                // ‚ùå Use function components
componentDidMount                                 // ‚ùå Use useEffect
componentWillMount                                // ‚ùå Use useEffect
componentWillReceiveProps                         // ‚ùå Use useEffect
UNSAFE_* lifecycle methods                        // ‚ùå Delete immediately
this.setState                                     // ‚ùå Use useState
PropTypes                                         // ‚ùå Use TypeScript
defaultProps                                      // ‚ùå Use default parameters
createReactClass                                  // ‚ùå Use function
React.createClass                                 // ‚ùå Use function
_.debounce (lodash)                               // ‚ùå Use native/custom
moment.js                                         // ‚ùå Use date-fns/dayjs
new Date().getYear()                              // ‚ùå Use getFullYear()
Object.prototype.hasOwnProperty                   // ‚ùå Use Object.hasOwn()
Array.prototype.forEach (for side effects)        // ‚ùå Use for...of
```

### React Patterns (2024+)

#### ‚úÖ MODERN REACT
```typescript
// Server Components (Next.js 14+)
export default async function Page() {
  const data = await fetchData()
  return <div>{data}</div>
}

// Client Components (when needed)
'use client'
import { useState } from 'react'

export function Counter() {
  const [count, setCount] = useState(0)
  return <button onClick={() => setCount(count + 1)}>{count}</button>
}

// Modern Function Components
export function Component({ title }: { title: string }) {
  return <h1>{title}</h1>
}

// Modern Hooks
import { useState, useEffect, useCallback, useMemo } from 'react'

// Server Actions (Next.js 14+)
'use server'
export async function createItem(formData: FormData) {
  const data = await database.item.create({ ... })
  revalidatePath('/items')
  return { success: true, data }
}
```

#### ‚ùå OLD REACT PATTERNS
```typescript
// FORBIDDEN - Delete immediately

// ‚ùå Class Components
class Component extends React.Component {
  render() { return <div/> }
}

// ‚ùå React.FC / React.FunctionComponent
const Component: React.FC<Props> = (props) => { }

// ‚ùå defaultProps
Component.defaultProps = { title: 'Default' }

// ‚ùå PropTypes
Component.propTypes = { title: PropTypes.string }

// ‚ùå Legacy Context API
const ThemeContext = React.createContext()

// ‚ùå Render Props Pattern (unless absolutely necessary)
<DataProvider render={(data) => <div>{data}</div>} />

// ‚ùå HOCs (Higher Order Components) - prefer hooks
withAuth(Component)
```

### Next.js Patterns (Next.js 15+)

#### ‚úÖ MODERN NEXT.JS (App Router Only)
```typescript
// App Router (ONLY acceptable pattern)
app/
  layout.tsx                  // Root layout
  page.tsx                    // Pages
  loading.tsx                 // Loading states
  error.tsx                   // Error boundaries
  not-found.tsx              // 404 pages
  api/
    route.ts                  // API routes
  [dynamic]/
    page.tsx                  // Dynamic routes

// Server Components (default)
export default async function Page() {
  const data = await fetch(...)
  return <div>{data}</div>
}

// Client Components (explicit)
'use client'
export function InteractiveComponent() {}

// Server Actions
'use server'
export async function submitForm(data: FormData) {}

// Metadata API
export const metadata = {
  title: 'Page Title',
  description: 'Description'
}

// Dynamic Metadata
export async function generateMetadata({ params }) {
  return { title: await getTitle(params.id) }
}
```

#### ‚ùå OLD NEXT.JS PATTERNS
```typescript
// FORBIDDEN - Delete all Pages Router code

// ‚ùå Pages Router (completely forbidden)
pages/
  _app.tsx                    // ‚ùå Delete
  _document.tsx               // ‚ùå Delete
  index.tsx                   // ‚ùå Migrate to app/page.tsx
  api/                        // ‚ùå Migrate to app/api/route.ts
  [id].tsx                    // ‚ùå Migrate to app/[id]/page.tsx

// ‚ùå getServerSideProps
export async function getServerSideProps(context) {} // ‚ùå Use Server Components

// ‚ùå getStaticProps
export async function getStaticProps(context) {} // ‚ùå Use Server Components

// ‚ùå getInitialProps
Component.getInitialProps = async (context) => {} // ‚ùå Use Server Components

// ‚ùå next/head
import Head from 'next/head' // ‚ùå Use Metadata API

// ‚ùå next/script (old pattern)
<Script strategy="beforeInteractive" /> // ‚ùå Use modern async/defer
```

### TypeScript Patterns (TypeScript 5.5+)

#### ‚úÖ MODERN TYPESCRIPT
```typescript
// Type-only imports
import type { User } from './types'

// Satisfies operator
const config = { ... } satisfies Config

// Const type parameters
function makeArray<const T>(items: T[]) { }

// Using keyword (disposables)
using file = openFile('data.txt')

// Template literal types
type Route = `/api/${string}`

// Branded types
type UserId = string & { readonly brand: unique symbol }

// Strict null checks (always enabled)
const value: string | null = getValue()
if (value !== null) { /* use value */ }

// Unknown over any
function process(data: unknown) {
  if (typeof data === 'string') { /* use data as string */ }
}

// Const assertions
const routes = ['home', 'about'] as const

// Satisfies for complex types
const theme = {
  colors: { primary: '#000' }
} satisfies Theme
```

#### ‚ùå OLD TYPESCRIPT PATTERNS
```typescript
// FORBIDDEN

// ‚ùå Any type (except in rare cases with proper comment)
function process(data: any) {} // ‚ùå Use unknown

// ‚ùå Non-null assertion (except when absolutely necessary)
const value = getValue()! // ‚ùå Use proper null checking

// ‚ùå Type assertions as (prefer type guards)
const user = data as User // ‚ùå Use type guard function

// ‚ùå Namespace (use ES modules)
namespace Utils { } // ‚ùå Use export

// ‚ùå Module declaration (avoid if possible)
declare module 'old-lib' { } // ‚ùå Use proper types

// ‚ùå Triple-slash directives
/// <reference path="..." /> // ‚ùå Use import

// ‚ùå Old enum syntax (use const enum or union types)
enum Status { } // ‚ùå Use const enum or union
```

### Database Patterns (Prisma 7+)

#### ‚úÖ MODERN DATABASE
```typescript
// Direct Prisma Client (no adapters in production)
import { PrismaClient } from '@prisma/client'

const prisma = new PrismaClient({
  log: ['error'],
  datasources: {
    db: { url: process.env.DATABASE_URL }
  }
})

// Canonical import
import { database } from '@/lib/database'

// Type-safe queries
const user = await database.user.findUnique({
  where: { id },
  select: { id: true, name: true }
})

// Modern Prisma 7 features
await database.user.findMany({
  relationLoadStrategy: 'join' // Prisma 7
})
```

#### ‚ùå OLD DATABASE PATTERNS
```typescript
// FORBIDDEN

// ‚ùå Adapters in serverless (causes issues)
import { PrismaPg } from '@prisma/adapter-pg'
const pool = new Pool({ ... })
const adapter = new PrismaPg(pool)
const prisma = new PrismaClient({ adapter })

// ‚ùå Manual connection pooling
const pool = new Pool({ ... })

// ‚ùå Legacy imports
import { prisma } from '@/lib/prisma' // ‚ùå Use @/lib/database

// ‚ùå Raw queries (unless necessary)
await prisma.$queryRaw`SELECT * FROM users` // ‚ùå Use type-safe methods

// ‚ùå Prisma 5 patterns
await prisma.user.findMany() // Missing Prisma 7 optimizations
```

### Styling Patterns (Tailwind CSS 4.0+)

#### ‚úÖ MODERN STYLING
```typescript
// Tailwind CSS classes (no CSS-in-JS)
<div className="flex items-center gap-4 px-4 py-2" />

// CSS modules (if needed)
import styles from './Component.module.css'

// CSS variables (modern)
style={{ '--custom-var': value } as React.CSSProperties}

// Tailwind arbitrary values
<div className="w-[calc(100%-2rem)]" />

// Tailwind container queries (v4+)
<div className="@container">
  <div className="@lg:grid-cols-2" />
</div>
```

#### ‚ùå OLD STYLING PATTERNS
```typescript
// FORBIDDEN

// ‚ùå Styled Components
const Button = styled.button`` // ‚ùå Use Tailwind

// ‚ùå Emotion
import { css } from '@emotion/react' // ‚ùå Use Tailwind

// ‚ùå Inline styles (except for dynamic values)
<div style={{ color: 'red' }} /> // ‚ùå Use Tailwind

// ‚ùå Legacy CSS
.class { float: left; } // ‚ùå Use Flexbox/Grid

// ‚ùå CSS preprocessors
.scss, .sass, .less files // ‚ùå Use Tailwind or CSS modules
```

### Testing Patterns (Jest 29+, Vitest 2.0+)

#### ‚úÖ MODERN TESTING
```typescript
// Modern Jest/Vitest
import { describe, it, expect } from 'vitest'

describe('Component', () => {
  it('renders correctly', () => {
    expect(component).toBeTruthy()
  })
})

// React Testing Library (modern patterns)
import { render, screen, waitFor } from '@testing-library/react'
import userEvent from '@testing-library/user-event'

it('handles user interaction', async () => {
  const user = userEvent.setup()
  render(<Component />)
  await user.click(screen.getByRole('button'))
  await waitFor(() => {
    expect(screen.getByText('Success')).toBeInTheDocument()
  })
})

// Modern async testing
it('fetches data', async () => {
  const data = await fetchData()
  expect(data).toBeDefined()
})
```

#### ‚ùå OLD TESTING PATTERNS
```typescript
// FORBIDDEN

// ‚ùå Enzyme
import { shallow, mount } from 'enzyme' // ‚ùå Use Testing Library

// ‚ùå Old async patterns
it('test', (done) => {
  async().then(() => done()) // ‚ùå Use async/await
})

// ‚ùå Legacy matchers
expect(value).toBeTruthy() // Sometimes OK, but prefer specific matchers

// ‚ùå Legacy setup
beforeEach(function() { }) // ‚ùå Use arrow functions
```

---

## üîç DETECTION & REMOVAL RULES

### Automatic Detection Patterns

**File-level Indicators**:
```bash
# Files that should NOT exist
**/legacy/**/*
**/old/**/*
**/deprecated/**/*
**/*.old.*
**/*.deprecated.*
**/*.backup.*
**/*.bak
**/*-old.*
**/*-legacy.*
**/*-deprecated.*

# Patterns to search for deletion
git grep -l "DEPRECATED"
git grep -l "TODO.*remove"
git grep -l "FIXME.*legacy"
git grep -l "backward.compatibility"
git grep -l "backwards.compatibility"
```

**Code-level Indicators**:
```typescript
// Search for these and DELETE
require(                          // ‚ùå Old CommonJS
module.exports                    // ‚ùå Old CommonJS
var                               // ‚ùå Old variable declaration
React.FC                          // ‚ùå Old React type
React.Component                   // ‚ùå Old React pattern
componentDidMount                 // ‚ùå Old lifecycle
PropTypes                         // ‚ùå Old type checking
defaultProps                      // ‚ùå Old default props
getServerSideProps                // ‚ùå Old Next.js
getStaticProps                    // ‚ùå Old Next.js
getInitialProps                   // ‚ùå Old Next.js
pages/                            // ‚ùå Old Next.js router
styled-components                 // ‚ùå Old styling
@emotion                          // ‚ùå Old styling
enzyme                            // ‚ùå Old testing
```

### Removal Process

**Step 1: Identify**
```bash
# Find all deprecated patterns
git grep -n "DEPRECATED" | tee deprecated-files.txt
git grep -n "TODO.*remove" | tee todo-remove.txt
git grep -n "require(" src/ | tee requires.txt
```

**Step 2: Analyze**
```bash
# Check if code is actually used
git grep -l "import.*OldComponent"
git log --all -- path/to/file.ts # Check last modified
```

**Step 3: Remove**
```bash
# If unused, delete immediately
git rm path/to/old-file.ts
git commit -m "Remove deprecated [filename]"

# If used, migrate first then delete
# 1. Create new version
# 2. Update all references
# 3. Delete old version
```

---

## üì¶ PACKAGE.JSON MODERNIZATION

### ‚úÖ Modern Dependencies Only

```json
{
  "dependencies": {
    "next": "^15.0.0",                    // ‚úÖ Latest Next.js
    "react": "^19.0.0",                   // ‚úÖ Latest React
    "react-dom": "^19.0.0",               // ‚úÖ Latest React DOM
    "@prisma/client": "^7.0.0",           // ‚úÖ Latest Prisma
    "typescript": "^5.5.0",               // ‚úÖ Latest TypeScript
    "tailwindcss": "^4.0.0",              // ‚úÖ Latest Tailwind
    "date-fns": "^3.0.0",                 // ‚úÖ Modern date library
    "zod": "^3.23.0",                     // ‚úÖ Modern validation
    "stripe": "^16.0.0"                   // ‚úÖ Latest Stripe
  }
}
```

### ‚ùå Forbidden Dependencies

```json
{
  "dependencies": {
    "moment": "*",                        // ‚ùå Deprecated, use date-fns
    "lodash": "*",                        // ‚ùå Most not needed, use native
    "underscore": "*",                    // ‚ùå Ancient, use native
    "jquery": "*",                        // ‚ùå Ancient, not needed
    "styled-components": "*",             // ‚ùå Use Tailwind
    "@emotion/react": "*",                // ‚ùå Use Tailwind
    "enzyme": "*",                        // ‚ùå Use Testing Library
    "prop-types": "*",                    // ‚ùå Use TypeScript
    "classnames": "*",                    // ‚ùå Use clsx or native
    "react-router-dom": "*",              // ‚ùå Use Next.js router
    "express": "*",                       // ‚ùå Use Next.js API routes
    "body-parser": "*",                   // ‚ùå Use Next.js built-in
    "cors": "*",                          // ‚ùå Use Next.js config
    "dotenv": "*",                        // ‚ùå Use Next.js env
    "nodemon": "*",                       // ‚ùå Use next dev
    "babel-*": "*",                       // ‚ùå Next.js handles this
    "webpack": "*"                        // ‚ùå Next.js handles this
  }
}
```

---

## üö´ FORBIDDEN PATTERNS CHECKLIST

Run this checklist before every commit:

### Code Quality Checks
- [ ] No `require()` statements (except in config files)
- [ ] No `module.exports` (except in config files)
- [ ] No `var` declarations
- [ ] No class components
- [ ] No `React.FC` or `React.FunctionComponent`
- [ ] No `defaultProps`
- [ ] No `PropTypes`
- [ ] No lifecycle methods (`componentDidMount`, etc.)
- [ ] No `getServerSideProps` / `getStaticProps`
- [ ] No Pages Router code (`pages/` directory)
- [ ] No old Next.js patterns
- [ ] No styled-components or Emotion
- [ ] No moment.js
- [ ] No unnecessary lodash
- [ ] No `any` type (without justification)
- [ ] No commented-out code blocks
- [ ] No TODO markers about removing code
- [ ] No DEPRECATED comments
- [ ] No files with "legacy", "old", "deprecated" in name
- [ ] No backward compatibility code

### File Structure Checks
- [ ] No `pages/` directory (use `app/`)
- [ ] No `legacy/` directories
- [ ] No `old/` directories
- [ ] No `deprecated/` directories
- [ ] No `.old`, `.bak`, `.backup` files
- [ ] No `-old`, `-legacy` suffixed files

### Import Checks
- [ ] All imports use ES modules (`import`, not `require`)
- [ ] All imports use canonical paths (`@/lib/database`, not `@/lib/prisma`)
- [ ] Type imports use `import type` when possible
- [ ] No wildcard imports unless necessary

---

## üîÑ MIGRATION STRATEGIES

### React Class to Function Component

**Before (DELETE THIS)**:
```typescript
class UserProfile extends React.Component<Props, State> {
  state = { loading: false }

  componentDidMount() {
    this.fetchData()
  }

  fetchData = async () => {
    this.setState({ loading: true })
    const data = await api.fetchUser()
    this.setState({ user: data, loading: false })
  }

  render() {
    return <div>{this.state.user?.name}</div>
  }
}
```

**After (MODERN)**:
```typescript
export function UserProfile({ userId }: { userId: string }) {
  const [loading, setLoading] = useState(false)
  const [user, setUser] = useState<User | null>(null)

  useEffect(() => {
    const fetchData = async () => {
      setLoading(true)
      const data = await api.fetchUser(userId)
      setUser(data)
      setLoading(false)
    }
    fetchData()
  }, [userId])

  return <div>{user?.name}</div>
}
```

### Next.js Pages to App Router

**Before (DELETE THIS)**:
```typescript
// pages/products/[id].tsx
export async function getServerSideProps(context) {
  const product = await db.product.findUnique({
    where: { id: context.params.id }
  })
  return { props: { product } }
}

export default function ProductPage({ product }) {
  return <div>{product.name}</div>
}
```

**After (MODERN)**:
```typescript
// app/products/[id]/page.tsx
export default async function ProductPage({
  params
}: {
  params: { id: string }
}) {
  const product = await database.product.findUnique({
    where: { id: params.id }
  })

  return <div>{product.name}</div>
}
```

---

## üéØ ENFORCEMENT MECHANISMS

### Pre-commit Hook

```bash
#!/bin/bash
# .husky/pre-commit

echo "üîç Checking for old/deprecated code..."

# Check for forbidden patterns
FORBIDDEN_PATTERNS=(
  "require("
  "module.exports"
  "var "
  "React.FC"
  "React.Component"
  "componentDidMount"
  "getServerSideProps"
  "getStaticProps"
  "PropTypes"
  "defaultProps"
  "DEPRECATED"
  "TODO.*remove"
  "backward.compatibility"
)

for pattern in "${FORBIDDEN_PATTERNS[@]}"; do
  if git diff --cached --name-only | xargs grep -l "$pattern" 2>/dev/null; then
    echo "‚ùå FORBIDDEN: Found '$pattern' in staged files"
    echo "   Remove this old/deprecated code before committing"
    exit 1
  fi
done

echo "‚úÖ No old/deprecated code detected"
```

### ESLint Rules

```json
{
  "rules": {
    "no-var": "error",
    "prefer-const": "error",
    "prefer-arrow-callback": "error",
    "prefer-template": "error",
    "prefer-destructuring": "error",
    "no-restricted-imports": ["error", {
      "patterns": [{
        "group": ["styled-components", "@emotion/*", "moment", "lodash"],
        "message": "Use modern alternatives (Tailwind, date-fns, native)"
      }]
    }],
    "no-restricted-syntax": ["error", {
      "selector": "CallExpression[callee.name='require']",
      "message": "Use ES6 import instead of require()"
    }],
    "@typescript-eslint/no-explicit-any": "error",
    "@typescript-eslint/no-non-null-assertion": "warn",
    "react/no-deprecated": "error",
    "react/no-unsafe": "error"
  }
}
```

### GitHub Actions

```yaml
name: No Old Code Check
on: [push, pull_request]
jobs:
  check-old-code:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      - name: Check for forbidden patterns
        run: |
          if grep -r "require(" src/; then
            echo "‚ùå Found require() in src/"
            exit 1
          fi
          if grep -r "React.FC" src/; then
            echo "‚ùå Found React.FC"
            exit 1
          fi
          # Add more checks...
```

---

## üìö LEARNING RESOURCES

### Modern JavaScript/TypeScript
- https://tc39.es/ecma262/ (ECMAScript spec)
- https://www.typescriptlang.org/docs/handbook/release-notes/typescript-5-5.html

### Modern React
- https://react.dev/ (Official React docs - modern patterns only)
- https://react.dev/learn/removing-effect-dependencies

### Modern Next.js
- https://nextjs.org/docs (App Router section only)
- https://nextjs.org/docs/app/building-your-application/routing

### Modern Testing
- https://testing-library.com/docs/react-testing-library/intro/
- https://vitest.dev/guide/

---

## ‚úÖ SUCCESS CRITERIA

Your code is modern if:
- ‚úÖ Zero ESLint warnings about deprecated features
- ‚úÖ Zero TypeScript errors
- ‚úÖ All tests pass
- ‚úÖ No `require()` in source code
- ‚úÖ No class components
- ‚úÖ No `React.FC`
- ‚úÖ No `getServerSideProps` / `getStaticProps`
- ‚úÖ Only App Router code (no Pages Router)
- ‚úÖ All dependencies are latest stable versions
- ‚úÖ No files with "legacy", "old", "deprecated" in names
- ‚úÖ No TODO comments about removing code
- ‚úÖ Pre-commit hooks pass
- ‚úÖ CI/CD passes all modern code checks

---

## üö® ZERO TOLERANCE POLICY

**If you see it, delete it**:
1. See deprecated code ‚Üí Delete immediately
2. See TODO to remove ‚Üí Remove now, not later
3. See backward compatibility ‚Üí Eliminate
4. See old pattern ‚Üí Modernize immediately
5. See commented code ‚Üí Delete
6. See legacy file ‚Üí Migrate and delete

**No excuses**:
- "It still works" ‚Üí Not good enough, modernize it
- "It's used in production" ‚Üí Migrate, then delete
- "We might need it later" ‚Üí You won't, delete it
- "It's for backward compatibility" ‚Üí Remove it
- "I'll fix it later" ‚Üí Fix it now

---

## üéì PHILOSOPHY

> "The best code is no code. The second best is modern code. Old code is technical debt."

**Core Beliefs**:
1. **Modern code is maintainable code**
2. **Deprecated code is broken code**
3. **Backward compatibility is forward impediment**
4. **Delete > Refactor > Keep**
5. **If it's old, it's wrong**

**Benefits**:
- ‚úÖ Easier onboarding (no legacy patterns to learn)
- ‚úÖ Faster development (modern tools are faster)
- ‚úÖ Better performance (modern APIs are optimized)
- ‚úÖ Smaller bundle sizes (no old dependencies)
- ‚úÖ Fewer bugs (modern patterns are safer)
- ‚úÖ Better TypeScript support (modern features)
- ‚úÖ Future-proof codebase

---

**VERSION**: 4.0 - ABSOLUTE MODERNIZATION
**STATUS**: ‚úÖ ENFORCED - ZERO TOLERANCE
**LAST REVIEW**: January 2026
**NEXT REVIEW**: Every sprint

*"In the pursuit of agricultural divinity, we eliminate the old harvest to make way for the new growth."* üå±
