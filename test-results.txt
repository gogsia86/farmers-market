
> farmers-market@1.0.0 test
> vitest --run


[1m[46m RUN [49m[22m [36mv4.0.7 [39m[90mM:/Repo/Farmers Market Platform web and app[39m

 [32mÎ“Â£Ã´[39m src/tests/security/input-validation.test.ts [2m([22m[2m8 tests[22m[2m)[22m[32m 9[2mms[22m[39m
 [31mÎ“Â¥Â»[39m src/lib/services/security/__tests__/security.service.test.ts [2m([22m[2m14 tests[22m[2m | [22m[31m14 failed[39m[2m)[22m[32m 23[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should allow requests within rate limit[39m[32m 7[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should block requests exceeding rate limit[39m[32m 1[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should reset rate limit after window expires[39m[32m 3[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should return all required security headers[39m[32m 1[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should have strict CSP header[39m[32m 1[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should detect known bot user agents[39m[32m 1[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should not flag regular browsers as bots[39m[32m 1[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should validate matching CSRF tokens[39m[32m 1[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should reject mismatched CSRF tokens[39m[32m 1[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should allow valid origins[39m[32m 1[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should reject invalid origins[39m[32m 1[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should apply security headers to response[39m[32m 1[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should block rate-limited requests[39m[32m 1[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should allow static assets[39m[32m 1[2mms[22m[39m
[90mstdout[2m | src/hooks/__tests__/useComponentConsciousness.test.ts[2m > [22m[2museComponentConsciousness Hook[2m > [22m[2mPerformance Measurement[2m > [22m[2mshould start and complete measurement successfully
[22m[39mÎ“Â£Â¿ Divine Performance Tracking initialized

 [2m[90mÎ“Ã¥Ã´[39m[22m src/__tests__/services/shipping.service.test.ts [2m([22m[2m15 tests[22m[2m | [22m[33m15 skipped[39m[2m)[22m
 [32mÎ“Â£Ã´[39m src/lib/__tests__/cache.memory.test.ts [2m([22m[2m2 tests[22m[2m)[22m[32m 195[2mms[22m[39m
[90mstdout[2m | src/hooks/__tests__/useComponentConsciousness.test.ts[2m > [22m[2museComponentConsciousness Hook[2m > [22m[2mPerformance Measurement[2m > [22m[2mshould handle measurement failure with Error object
[22m[39mÎ“Â£Â¿ Divine Performance Tracking initialized

stderr | src/hooks/__tests__/useComponentConsciousness.test.ts > useComponentConsciousness Hook > Performance Measurement > should handle measurement failure with Error object
Î“Â¥Ã® TestComponent.failing_operation failed: Error: Test error message
    at M:/Repo/Farmers Market Platform web and app/src/hooks/__tests__/useComponentConsciousness.test.ts:153:25
    at file:///M:/Repo/Farmers%20Market%20Platform%20web%20and%20app/node_modules/@vitest/runner/dist/index.js:157:11
    at file:///M:/Repo/Farmers%20Market%20Platform%20web%20and%20app/node_modules/@vitest/runner/dist/index.js:753:26
    at file:///M:/Repo/Farmers%20Market%20Platform%20web%20and%20app/node_modules/@vitest/runner/dist/index.js:1636:20
    at new Promise (<anonymous>)
    at runWithTimeout (file:///M:/Repo/Farmers%20Market%20Platform%20web%20and%20app/node_modules/@vitest/runner/dist/index.js:1602:10)
    at runTest (file:///M:/Repo/Farmers%20Market%20Platform%20web%20and%20app/node_modules/@vitest/runner/dist/index.js:1309:12)
    at runSuite (file:///M:/Repo/Farmers%20Market%20Platform%20web%20and%20app/node_modules/@vitest/runner/dist/index.js:1468:8)
    at runSuite (file:///M:/Repo/Farmers%20Market%20Platform%20web%20and%20app/node_modules/@vitest/runner/dist/index.js:1468:8)
    at runSuite (file:///M:/Repo/Farmers%20Market%20Platform%20web%20and%20app/node_modules/@vitest/runner/dist/index.js:1468:8) after 0.11ms

[90mstdout[2m | src/hooks/__tests__/useComponentConsciousness.test.ts[2m > [22m[2museComponentConsciousness Hook[2m > [22m[2mPerformance Measurement[2m > [22m[2mshould handle measurement failure with string error
[22m[39mÎ“Â£Â¿ Divine Performance Tracking initialized

stderr | src/hooks/__tests__/useComponentConsciousness.test.ts > useComponentConsciousness Hook > Performance Measurement > should handle measurement failure with string error
Î“Â¥Ã® TestComponent.string_error_op failed: String error message after 0.01ms

[90mstdout[2m | src/hooks/__tests__/useComponentConsciousness.test.ts[2m > [22m[2museComponentConsciousness Hook[2m > [22m[2mPerformance Measurement[2m > [22m[2mshould handle measurement failure with unknown error type
[22m[39mÎ“Â£Â¿ Divine Performance Tracking initialized

stderr | src/hooks/__tests__/useComponentConsciousness.test.ts > useComponentConsciousness Hook > Performance Measurement > should handle measurement failure with unknown error type
Î“Â¥Ã® TestComponent.unknown_error_op failed: { custom: 'error object' } after 0.02ms

stderr | src/hooks/__tests__/useComponentConsciousness.test.ts > useComponentConsciousness Hook > Performance Measurement > should increment error count on failure
Î“Â¥Ã® TestComponent.error_op failed: Error: test
    at M:/Repo/Farmers Market Platform web and app/src/hooks/__tests__/useComponentConsciousness.test.ts:221:29
    at M:\Repo\Farmers Market Platform web and app\node_modules\@testing-library\react\dist\act-compat.js:48:24
    at process.env.NODE_ENV.exports.act (M:\Repo\Farmers Market Platform web and app\node_modules\react\cjs\react.development.js:814:22)
    at M:\Repo\Farmers Market Platform web and app\node_modules\@testing-library\react\dist\act-compat.js:47:25
    at M:/Repo/Farmers Market Platform web and app/src/hooks/__tests__/useComponentConsciousness.test.ts:219:13
    at file:///M:/Repo/Farmers%20Market%20Platform%20web%20and%20app/node_modules/@vitest/runner/dist/index.js:157:11
    at file:///M:/Repo/Farmers%20Market%20Platform%20web%20and%20app/node_modules/@vitest/runner/dist/index.js:753:26
    at file:///M:/Repo/Farmers%20Market%20Platform%20web%20and%20app/node_modules/@vitest/runner/dist/index.js:1636:20
    at new Promise (<anonymous>)
    at runWithTimeout (file:///M:/Repo/Farmers%20Market%20Platform%20web%20and%20app/node_modules/@vitest/runner/dist/index.js:1602:10) after 0.04ms

[90mstdout[2m | src/__tests__/services/payment.service.test.ts[2m > [22m[2mPaymentService - Divine Payment Orchestration[2m > [22m[2mcreatePaymentIntent - Manifest Payment Reality[2m > [22m[2mvalidates amount boundaries with divine wisdom
[22m[39mprisma:error 
Invalid `prisma.order.update()` invocation:

{
  where: {
    id: {
      orderId: "order-invalid",
      amount: -100,
      currency: "USD",
      provider: "STRIPE"
    }
  },
  data: {
    paymentIntentId: "pi_1762668301649",
    ~~~~~~~~~~~~~~~
?   id?: String | StringFieldUpdateOperationsInput,
?   orderNumber?: String | StringFieldUpdateOperationsInput,
?   status?: OrderStatus | EnumOrderStatusFieldUpdateOperationsInput,
?   paymentStatus?: PaymentStatus | EnumPaymentStatusFieldUpdateOperationsInput,
?   subtotal?: Decimal | DecimalFieldUpdateOperationsInput,
?   deliveryFee?: Decimal | DecimalFieldUpdateOperationsInput,
?   platformFee?: Decimal | DecimalFieldUpdateOperationsInput,
?   tax?: Decimal | DecimalFieldUpdateOperationsInput,
?   discount?: Decimal | DecimalFieldUpdateOperationsInput,
?   total?: Decimal | DecimalFieldUpdateOperationsInput,
?   farmerAmount?: Decimal | DecimalFieldUpdateOperationsInput,
?   fulfillmentMethod?: FulfillmentMethod | EnumFulfillmentMethodFieldUpdateOperationsInput,
?   scheduledDate?: DateTime | NullableDateTimeFieldUpdateOperationsInput | Null,
?   scheduledTimeSlot?: String | NullableStringFieldUpdateOperationsInput | Null,
?   fulfillmentNotes?: String | NullableStringFieldUpdateOperationsInput | Null,
?   stripePaymentIntentId?: String | NullableStringFieldUpdateOperationsInput | Null,
?   stripeChargeId?: String | NullableStringFieldUpdateOperationsInput | Null,
?   stripeTransferId?: String | NullableStringFieldUpdateOperationsInput | Null,
?   paidAt?: DateTime | NullableDateTimeFieldUpdateOperationsInput | Null,
?   trackingNumber?: String | NullableStringFieldUpdateOperationsInput | Null,
?   shippingAddress?: NullableJsonNullValueInput | Json,
?   deliverySlotId?: String | NullableStringFieldUpdateOperationsInput | Null,
?   specialInstructions?: String | NullableStringFieldUpdateOperationsInput | Null,
?   createdAt?: DateTime | DateTimeFieldUpdateOperationsInput,
?   updatedAt?: DateTime | DateTimeFieldUpdateOperationsInput,
?   confirmedAt?: DateTime | NullableDateTimeFieldUpdateOperationsInput | Null,
?   fulfilledAt?: DateTime | NullableDateTimeFieldUpdateOperationsInput | Null,
?   completedAt?: DateTime | NullableDateTimeFieldUpdateOperationsInput | Null,
?   cancelledAt?: DateTime | NullableDateTimeFieldUpdateOperationsInput | Null,
?   cancelledBy?: String | NullableStringFieldUpdateOperationsInput | Null,
?   cancelReason?: String | NullableStringFieldUpdateOperationsInput | Null,
?   customer?: UserUpdateOneRequiredWithoutOrdersNestedInput,
?   farm?: FarmUpdateOneRequiredWithoutOrdersNestedInput,
?   deliveryAddress?: UserAddressUpdateOneWithoutOrdersNestedInput,
?   items?: OrderItemUpdateManyWithoutOrderNestedInput,
?   fulfillment?: FulfillmentUpdateOneWithoutOrderNestedInput,
?   refunds?: RefundUpdateManyWithoutOrderNestedInput,
?   qualityIssues?: QualityIssueUpdateManyWithoutOrderNestedInput,
?   reviews?: ReviewUpdateManyWithoutOrderNestedInput,
?   messages?: MessageUpdateManyWithoutOrderNestedInput,
?   Payment?: PaymentUpdateOneWithoutOrderNestedInput
  }
}

Unknown argument `paymentIntentId`. Available options are marked with ?.

[90mstdout[2m | src/hooks/__tests__/useComponentConsciousness.test.ts[2m > [22m[2museComponentConsciousness Hook[2m > [22m[2mGlobal Performance Tracking Initialization[2m > [22m[2mshould initialize global trackers
[22m[39mÎ“Â£Â¿ Divine Performance Tracking initialized

[90mstdout[2m | src/hooks/__tests__/useComponentConsciousness.test.ts[2m > [22m[2museComponentConsciousness Hook[2m > [22m[2mGlobal Performance Tracking Initialization[2m > [22m[2mshould record metrics globally
[22m[39mÎ“Â£Â¿ Divine Performance Tracking initialized

[90mstdout[2m | src/hooks/__tests__/useComponentConsciousness.test.ts[2m > [22m[2museComponentConsciousness Hook[2m > [22m[2mGlobal Performance Tracking Initialization[2m > [22m[2mshould get component-specific metrics
[22m[39mÎ“Â£Â¿ Divine Performance Tracking initialized

[90mstdout[2m | src/hooks/__tests__/useComponentConsciousness.test.ts[2m > [22m[2museComponentConsciousness Hook[2m > [22m[2mGlobal Performance Tracking Initialization[2m > [22m[2mshould clear metrics
[22m[39mÎ“Â£Â¿ Divine Performance Tracking initialized

[90mstdout[2m | src/hooks/__tests__/useComponentConsciousness.test.ts[2m > [22m[2museComponentConsciousness Hook[2m > [22m[2mGlobal Performance Tracking Initialization[2m > [22m[2mshould limit metrics to 1000 entries
[22m[39mÎ“Â£Â¿ Divine Performance Tracking initialized

[90mstdout[2m | src/__tests__/services/payment.service.test.ts[2m > [22m[2mPaymentService - Divine Payment Orchestration[2m > [22m[2mcreatePaymentIntent - Manifest Payment Reality[2m > [22m[2menforces minimum payment threshold
[22m[39mprisma:error 
Invalid `prisma.order.update()` invocation:

{
  where: {
    id: {
      orderId: "order-small",
      amount: 25,
      currency: "USD",
      provider: "STRIPE"
    }
  },
  data: {
    paymentIntentId: "pi_1762668301711",
    ~~~~~~~~~~~~~~~
?   id?: String | StringFieldUpdateOperationsInput,
?   orderNumber?: String | StringFieldUpdateOperationsInput,
?   status?: OrderStatus | EnumOrderStatusFieldUpdateOperationsInput,
?   paymentStatus?: PaymentStatus | EnumPaymentStatusFieldUpdateOperationsInput,
?   subtotal?: Decimal | DecimalFieldUpdateOperationsInput,
?   deliveryFee?: Decimal | DecimalFieldUpdateOperationsInput,
?   platformFee?: Decimal | DecimalFieldUpdateOperationsInput,
?   tax?: Decimal | DecimalFieldUpdateOperationsInput,
?   discount?: Decimal | DecimalFieldUpdateOperationsInput,
?   total?: Decimal | DecimalFieldUpdateOperationsInput,
?   farmerAmount?: Decimal | DecimalFieldUpdateOperationsInput,
?   fulfillmentMethod?: FulfillmentMethod | EnumFulfillmentMethodFieldUpdateOperationsInput,
?   scheduledDate?: DateTime | NullableDateTimeFieldUpdateOperationsInput | Null,
?   scheduledTimeSlot?: String | NullableStringFieldUpdateOperationsInput | Null,
?   fulfillmentNotes?: String | NullableStringFieldUpdateOperationsInput | Null,
?   stripePaymentIntentId?: String | NullableStringFieldUpdateOperationsInput | Null,
?   stripeChargeId?: String | NullableStringFieldUpdateOperationsInput | Null,
?   stripeTransferId?: String | NullableStringFieldUpdateOperationsInput | Null,
?   paidAt?: DateTime | NullableDateTimeFieldUpdateOperationsInput | Null,
?   trackingNumber?: String | NullableStringFieldUpdateOperationsInput | Null,
?   shippingAddress?: NullableJsonNullValueInput | Json,
?   deliverySlotId?: String | NullableStringFieldUpdateOperationsInput | Null,
?   specialInstructions?: String | NullableStringFieldUpdateOperationsInput | Null,
?   createdAt?: DateTime | DateTimeFieldUpdateOperationsInput,
?   updatedAt?: DateTime | DateTimeFieldUpdateOperationsInput,
?   confirmedAt?: DateTime | NullableDateTimeFieldUpdateOperationsInput | Null,
?   fulfilledAt?: DateTime | NullableDateTimeFieldUpdateOperationsInput | Null,
?   completedAt?: DateTime | NullableDateTimeFieldUpdateOperationsInput | Null,
?   cancelledAt?: DateTime | NullableDateTimeFieldUpdateOperationsInput | Null,
?   cancelledBy?: String | NullableStringFieldUpdateOperationsInput | Null,
?   cancelReason?: String | NullableStringFieldUpdateOperationsInput | Null,
?   customer?: UserUpdateOneRequiredWithoutOrdersNestedInput,
?   farm?: FarmUpdateOneRequiredWithoutOrdersNestedInput,
?   deliveryAddress?: UserAddressUpdateOneWithoutOrdersNestedInput,
?   items?: OrderItemUpdateManyWithoutOrderNestedInput,
?   fulfillment?: FulfillmentUpdateOneWithoutOrderNestedInput,
?   refunds?: RefundUpdateManyWithoutOrderNestedInput,
?   qualityIssues?: QualityIssueUpdateManyWithoutOrderNestedInput,
?   reviews?: ReviewUpdateManyWithoutOrderNestedInput,
?   messages?: MessageUpdateManyWithoutOrderNestedInput,
?   Payment?: PaymentUpdateOneWithoutOrderNestedInput
  }
}

Unknown argument `paymentIntentId`. Available options are marked with ?.

[90mstdout[2m | src/hooks/__tests__/useComponentConsciousness.test.ts[2m > [22m[2museComponentConsciousness Hook[2m > [22m[2mEdge Cases[2m > [22m[2mshould handle measurements with zero duration
[22m[39mÎ“Â£Â¿ Divine Performance Tracking initialized

 [31mÎ“Â¥Â»[39m src/hooks/__tests__/useComponentConsciousness.test.ts [2m([22m[2m31 tests[22m[2m | [22m[31m1 failed[39m[2m)[22m[32m 234[2mms[22m[39m
       [32mÎ“Â£Ã´[39m should initialize with component name[32m 27[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m should return consistent consciousness object[39m[32m 19[2mms[22m[39m
       [32mÎ“Â£Ã´[39m should accept optional context[32m 5[2mms[22m[39m
       [32mÎ“Â£Ã´[39m should initialize metrics with zero values[32m 4[2mms[22m[39m
       [32mÎ“Â£Ã´[39m should track render count[32m 16[2mms[22m[39m
       [32mÎ“Â£Ã´[39m should record render times[32m 45[2mms[22m[39m
       [32mÎ“Â£Ã´[39m should start and complete measurement successfully[32m 61[2mms[22m[39m
       [32mÎ“Â£Ã´[39m should handle measurement failure with Error object[32m 5[2mms[22m[39m
       [32mÎ“Â£Ã´[39m should handle measurement failure with string error[32m 4[2mms[22m[39m
       [32mÎ“Â£Ã´[39m should handle measurement failure with unknown error type[32m 3[2mms[22m[39m
       [32mÎ“Â£Ã´[39m should increment error count on failure[32m 3[2mms[22m[39m
       [32mÎ“Â£Ã´[39m should work without global tracker initialized[32m 2[2mms[22m[39m
       [32mÎ“Â£Ã´[39m should track events without metadata[32m 2[2mms[22m[39m
       [32mÎ“Â£Ã´[39m should track events with metadata[32m 1[2mms[22m[39m
       [32mÎ“Â£Ã´[39m should track multiple events[32m 2[2mms[22m[39m
       [32mÎ“Â£Ã´[39m should send events to analytics tracker if available[32m 5[2mms[22m[39m
       [32mÎ“Â£Ã´[39m should work without analytics tracker[32m 3[2mms[22m[39m
       [32mÎ“Â£Ã´[39m should initialize global trackers[32m 1[2mms[22m[39m
       [32mÎ“Â£Ã´[39m should record metrics globally[32m 1[2mms[22m[39m
       [32mÎ“Â£Ã´[39m should get component-specific metrics[32m 1[2mms[22m[39m
       [32mÎ“Â£Ã´[39m should clear metrics[32m 0[2mms[22m[39m
       [32mÎ“Â£Ã´[39m should limit metrics to 1000 entries[32m 1[2mms[22m[39m
       [32mÎ“Â£Ã´[39m should track component unmount[32m 2[2mms[22m[39m
       [32mÎ“Â£Ã´[39m should handle multiple component instances[32m 3[2mms[22m[39m
       [32mÎ“Â£Ã´[39m should have properly typed return object[32m 2[2mms[22m[39m
       [32mÎ“Â£Ã´[39m should have properly typed metrics[32m 2[2mms[22m[39m
       [32mÎ“Â£Ã´[39m should handle empty component name[32m 1[2mms[22m[39m
       [32mÎ“Â£Ã´[39m should handle very long component names[32m 3[2mms[22m[39m
       [32mÎ“Â£Ã´[39m should handle special characters in component name[32m 2[2mms[22m[39m
       [32mÎ“Â£Ã´[39m should handle rapid-fire events[32m 2[2mms[22m[39m
       [32mÎ“Â£Ã´[39m should handle measurements with zero duration[32m 4[2mms[22m[39m
[90mstdout[2m | src/lib/services/farm.service.test.ts
[22m[39mRedis cache connected

[90mstdout[2m | src/__tests__/services/payment.service.test.ts[2m > [22m[2mPaymentService - Divine Payment Orchestration[2m > [22m[2mrefundPayment - Reverse Payment Reality[2m > [22m[2mvalidates refund amount does not exceed original
[22m[39mprisma:error 
Invalid `prisma.order.findUnique()` invocation:

{
  where: {
    id: {
      paymentId: "payment-1",
      amount: 6000,
      reason: "Over-refund attempt"
    }
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
  }
}

Argument `id`: Invalid value provided. Expected String, provided Object.

 [31mÎ“Â¥Â»[39m src/__tests__/services/payment.service.test.ts [2m([22m[2m16 tests[22m[2m | [22m[31m16 failed[39m[2m)[22m[32m 145[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m creates Stripe payment intent with quantum precision[39m[32m 9[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m creates PayPal order with agricultural consciousness[39m[32m 3[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m validates amount boundaries with divine wisdom[39m[32m 61[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m enforces minimum payment threshold[39m[32m 15[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m confirms Stripe payment with temporal tracking[39m[32m 17[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m handles PayPal payment capture with agricultural precision[39m[32m 8[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m handles payment failures with enlightening errors[39m[32m 6[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m processes full refund with quantum reversal[39m[32m 2[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m processes partial refund with divine precision[39m[32m 2[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m validates refund amount does not exceed original[39m[32m 5[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m retrieves user payment history with temporal ordering[39m[32m 1[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m filters by payment status with divine clarity[39m[32m 1[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m processes Stripe webhook with signature verification[39m[32m 2[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m handles refund webhook events with quantum precision[39m[32m 2[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m rejects invalid webhook signatures[39m[32m 2[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m applies farm-to-table payment consciousness[39m[32m 1[2mms[22m[39m
[90mstdout[2m | src/lib/services/farm.service.test.ts[2m > [22m[2mFarm Service - Divine Operations[2m > [22m[2mgetFarmById[2m > [22m[2mmanifests quantum farm when farm exists
[22m[39mCache miss { key: [32m'farm:farm-123'[39m }

[90mstdout[2m | src/lib/services/farm.service.test.ts[2m > [22m[2mFarm Service - Divine Operations[2m > [22m[2mgetFarmById[2m > [22m[2mmanifests quantum farm when farm exists
[22m[39mCache set { key: [32m'farm:farm-123'[39m, ttl: [33m1800[39m }

[90mstdout[2m | src/lib/services/farm.service.test.ts[2m > [22m[2mFarm Service - Divine Operations[2m > [22m[2mgetFarmById[2m > [22m[2mreturns null when farm does not exist
[22m[39mCache miss { key: [32m'farm:nonexistent-farm'[39m }

[90mstdout[2m | src/lib/services/farm.service.test.ts[2m > [22m[2mFarm Service - Divine Operations[2m > [22m[2mgetFarmById[2m > [22m[2mincludes owner information in query
[22m[39mCache hit (memory) { key: [32m'farm:farm-123'[39m }

[90mstdout[2m | src/lib/services/farm.service.test.ts[2m > [22m[2mFarm Service - Divine Operations[2m > [22m[2mgetFarmBySlug[2m > [22m[2mmanifests quantum farm when slug exists
[22m[39mCache miss { key: [32m'farm:farm:slug:quantum-valley-farm-reality'[39m }

[90mstdout[2m | src/lib/services/farm.service.test.ts[2m > [22m[2mFarm Service - Divine Operations[2m > [22m[2mgetFarmBySlug[2m > [22m[2mmanifests quantum farm when slug exists
[22m[39mCache set { key: [32m'farm:farm-123'[39m, ttl: [33m1800[39m }
Cache set { key: [32m'farm:farm:slug:quantum-valley-farm-reality'[39m, ttl: [33m1800[39m }

[90mstdout[2m | src/lib/services/farm.service.test.ts[2m > [22m[2mFarm Service - Divine Operations[2m > [22m[2mgetFarmBySlug[2m > [22m[2mreturns null when slug does not exist
[22m[39mCache miss { key: [32m'farm:farm:slug:nonexistent-slug'[39m }

 [31mÎ“Â¥Â»[39m src/lib/services/farm.service.test.ts [2m([22m[2m13 tests[22m[2m | [22m[31m1 failed[39m[2m)[22m[32m 28[2mms[22m[39m
       [32mÎ“Â£Ã´[39m manifests new farm with unique slug successfully[32m 3[2mms[22m[39m
       [32mÎ“Â£Ã´[39m handles slug collision by appending counter[32m 1[2mms[22m[39m
       [32mÎ“Â£Ã´[39m throws error after max slug collision attempts[32m 2[2mms[22m[39m
       [32mÎ“Â£Ã´[39m creates farm with PENDING status by default[32m 3[2mms[22m[39m
       [32mÎ“Â£Ã´[39m manifests quantum farm with agricultural consciousness[32m 1[2mms[22m[39m
       [32mÎ“Â£Ã´[39m returns exists=false when user has no farm[32m 0[2mms[22m[39m
       [32mÎ“Â£Ã´[39m returns exists=true with farm details when user has farm[32m 0[2mms[22m[39m
       [32mÎ“Â£Ã´[39m queries database with correct user ID[32m 1[2mms[22m[39m
       [32mÎ“Â£Ã´[39m manifests quantum farm when farm exists[32m 2[2mms[22m[39m
       [32mÎ“Â£Ã´[39m returns null when farm does not exist[32m 1[2mms[22m[39m
[31m       [31mâ”œÃ¹[31m includes owner information in query[39m[32m 7[2mms[22m[39m
       [32mÎ“Â£Ã´[39m manifests quantum farm when slug exists[32m 2[2mms[22m[39m
       [32mÎ“Â£Ã´[39m returns null when slug does not exist[32m 2[2mms[22m[39m
stderr | Object.error (M:\Repo\Farmers Market Platform web and app\src\lib\monitoring\logger.ts:4:38)
Redis cache error {
  error: ReplyError: NOAUTH Authentication required.
      at parseError (M:\Repo\Farmers Market Platform web and app\node_modules\redis-parser\lib\parser.js:179:12)
      at parseType (M:\Repo\Farmers Market Platform web and app\node_modules\redis-parser\lib\parser.js:302:14) {
    command: { name: 'info', args: [] }
  }
}

 [32mÎ“Â£Ã´[39m src/lib/services/__tests__/farm.service.test.ts [2m([22m[2m31 tests[22m[2m)[22m[32m 22[2mms[22m[39m

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â» Failed Suites 4 Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»

 FAIL  src/tests/auth/middleware.test.ts [ src/tests/auth/middleware.test.ts ]
 FAIL  src/tests/rbac/permissions.test.ts [ src/tests/rbac/permissions.test.ts ]
 FAIL  src/__tests__/services/order.service.test.ts [ src/__tests__/services/order.service.test.ts ]
Error: Do not import `@jest/globals` outside of the Jest test environment
 Î“Â¥Â» node_modules/@jest/globals/build/index.js:23:7
 Î“Â¥Â» Object.<anonymous> node_modules/@jest/globals/build/index.js:25:12

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[1/36]Î“Ã„Â»

 FAIL  src/__tests__/e2e/checkout-flow.test.ts [ src/__tests__/e2e/checkout-flow.test.ts ]
Error: Playwright Test did not expect test() to be called here.
Most common reasons include:
- You are calling test() in a configuration file.
- You are calling test() in a file that is imported by the configuration file.
- You have two different versions of @playwright/test. This usually happens
  when one of the dependencies in your package.json depends on @playwright/test.
 Î“Â¥Â» TestTypeImpl._currentSuite node_modules/playwright/lib/common/testType.js:74:13
 Î“Â¥Â» TestTypeImpl._createTest node_modules/playwright/lib/common/testType.js:87:24
 Î“Â¥Â» node_modules/playwright/lib/transform/transform.js:275:12
 Î“Â¥Â» src/__tests__/e2e/checkout-flow.test.ts:49:5
     47| 
     48|   describe("Complete Purchase Flow - Agricultural Product", () => {
     49|     playwrightTest(
       |     ^
     50|       "user completes full checkout from cart to confirmation",
     51|       async ({ page }) => {

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[2/36]Î“Ã„Â»


Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â» Failed Tests 32 Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»

 FAIL  src/lib/services/farm.service.test.ts > Farm Service - Divine Operations > getFarmById > includes owner information in query
AssertionError: expected "vi.fn()" to be called with arguments: [ { where: { id: 'farm-123' }, Î“Ã‡Âª(1) } ]

Number of calls: 0

 Î“Â¥Â» src/lib/services/farm.service.test.ts:327:40
    325| 
    326|       // Assert
    327|       expect(database.farm.findUnique).toHaveBeenCalledWith({
       |                                        ^
    328|         where: { id: "farm-123" },
    329|         include: {

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[3/36]Î“Ã„Â»

 FAIL  src/hooks/__tests__/useComponentConsciousness.test.ts > useComponentConsciousness Hook > Basic Initialization > should return consistent consciousness object
AssertionError: expected { startMeasurement: [Function], Î“Ã‡Âª(4) } to be { startMeasurement: [Function], Î“Ã‡Âª(4) } // Object.is equality

If it should pass with deep equality, replace "toBe" with "toStrictEqual"

Expected: { startMeasurement: [Function], Î“Ã‡Âª(4) }
Received: serializes to the same string


Compared values have no visual difference.

 Î“Â¥Â» src/hooks/__tests__/useComponentConsciousness.test.ts:55:30
     53| 
     54|       // Should be same reference (memoized)
     55|       expect(result.current).toBe(firstRef);
       |                              ^
     56|     });
     57|     it("should accept optional context", () => {

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[4/36]Î“Ã„Â»

 FAIL  src/__tests__/services/payment.service.test.ts > PaymentService - Divine Payment Orchestration > createPaymentIntent - Manifest Payment Reality > creates Stripe payment intent with quantum precision
Error: Cannot find module '@/lib/payment/stripe'
Require stack:
- M:\Repo\Farmers Market Platform web and app\src\__tests__\services\payment.service.test.ts
 Î“Â¥Â» src/__tests__/services/payment.service.test.ts:38:17
     36|       };
     37| 
     38|       vi.mocked(require("@/lib/payment/stripe").stripeClient).mockRetuÎ“Ã‡Âª
       |                 ^
     39|         mockStripe,
     40|       );

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[5/36]Î“Ã„Â»

 FAIL  src/__tests__/services/payment.service.test.ts > PaymentService - Divine Payment Orchestration > createPaymentIntent - Manifest Payment Reality > creates PayPal order with agricultural consciousness
Error: Cannot find module '@/lib/payment/paypal'
Require stack:
- M:\Repo\Farmers Market Platform web and app\src\__tests__\services\payment.service.test.ts
 Î“Â¥Â» src/__tests__/services/payment.service.test.ts:66:17
     64|       };
     65| 
     66|       vi.mocked(require("@/lib/payment/paypal").paypalClient).mockRetuÎ“Ã‡Âª
       |                 ^
     67|         mockPayPal,
     68|       );

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[6/36]Î“Ã„Â»

 FAIL  src/__tests__/services/payment.service.test.ts > PaymentService - Divine Payment Orchestration > createPaymentIntent - Manifest Payment Reality > validates amount boundaries with divine wisdom
AssertionError: expected [Function] to throw error including 'Amount must be positive' but got '\nInvalid `prisma.order.update()` invÎ“Ã‡Âª'

- Expected
+ Received

- Amount must be positive
+
+ Invalid `prisma.order.update()` invocation:
+
+ {
+   where: {
+     id: {
+       orderId: "order-invalid",
+       amount: -100,
+       currency: "USD",
+       provider: "STRIPE"
+     }
+   },
+   data: {
+     paymentIntentId: "pi_1762668301649",
+     ~~~~~~~~~~~~~~~
+ ?   id?: String | StringFieldUpdateOperationsInput,
+ ?   orderNumber?: String | StringFieldUpdateOperationsInput,
+ ?   status?: OrderStatus | EnumOrderStatusFieldUpdateOperationsInput,
+ ?   paymentStatus?: PaymentStatus | EnumPaymentStatusFieldUpdateOperationsInput,
+ ?   subtotal?: Decimal | DecimalFieldUpdateOperationsInput,
+ ?   deliveryFee?: Decimal | DecimalFieldUpdateOperationsInput,
+ ?   platformFee?: Decimal | DecimalFieldUpdateOperationsInput,
+ ?   tax?: Decimal | DecimalFieldUpdateOperationsInput,
+ ?   discount?: Decimal | DecimalFieldUpdateOperationsInput,
+ ?   total?: Decimal | DecimalFieldUpdateOperationsInput,
+ ?   farmerAmount?: Decimal | DecimalFieldUpdateOperationsInput,
+ ?   fulfillmentMethod?: FulfillmentMethod | EnumFulfillmentMethodFieldUpdateOperationsInput,
+ ?   scheduledDate?: DateTime | NullableDateTimeFieldUpdateOperationsInput | Null,
+ ?   scheduledTimeSlot?: String | NullableStringFieldUpdateOperationsInput | Null,
+ ?   fulfillmentNotes?: String | NullableStringFieldUpdateOperationsInput | Null,
+ ?   stripePaymentIntentId?: String | NullableStringFieldUpdateOperationsInput | Null,
+ ?   stripeChargeId?: String | NullableStringFieldUpdateOperationsInput | Null,
+ ?   stripeTransferId?: String | NullableStringFieldUpdateOperationsInput | Null,
+ ?   paidAt?: DateTime | NullableDateTimeFieldUpdateOperationsInput | Null,
+ ?   trackingNumber?: String | NullableStringFieldUpdateOperationsInput | Null,
+ ?   shippingAddress?: NullableJsonNullValueInput | Json,
+ ?   deliverySlotId?: String | NullableStringFieldUpdateOperationsInput | Null,
+ ?   specialInstructions?: String | NullableStringFieldUpdateOperationsInput | Null,
+ ?   createdAt?: DateTime | DateTimeFieldUpdateOperationsInput,
+ ?   updatedAt?: DateTime | DateTimeFieldUpdateOperationsInput,
+ ?   confirmedAt?: DateTime | NullableDateTimeFieldUpdateOperationsInput | Null,
+ ?   fulfilledAt?: DateTime | NullableDateTimeFieldUpdateOperationsInput | Null,
+ ?   completedAt?: DateTime | NullableDateTimeFieldUpdateOperationsInput | Null,
+ ?   cancelledAt?: DateTime | NullableDateTimeFieldUpdateOperationsInput | Null,
+ ?   cancelledBy?: String | NullableStringFieldUpdateOperationsInput | Null,
+ ?   cancelReason?: String | NullableStringFieldUpdateOperationsInput | Null,
+ ?   customer?: UserUpdateOneRequiredWithoutOrdersNestedInput,
+ ?   farm?: FarmUpdateOneRequiredWithoutOrdersNestedInput,
+ ?   deliveryAddress?: UserAddressUpdateOneWithoutOrdersNestedInput,
+ ?   items?: OrderItemUpdateManyWithoutOrderNestedInput,
+ ?   fulfillment?: FulfillmentUpdateOneWithoutOrderNestedInput,
+ ?   refunds?: RefundUpdateManyWithoutOrderNestedInput,
+ ?   qualityIssues?: QualityIssueUpdateManyWithoutOrderNestedInput,
+ ?   reviews?: ReviewUpdateManyWithoutOrderNestedInput,
+ ?   messages?: MessageUpdateManyWithoutOrderNestedInput,
+ ?   Payment?: PaymentUpdateOneWithoutOrderNestedInput
+   }
+ }
+
+ Unknown argument `paymentIntentId`. Available options are marked with ?.

 Î“Â¥Â» src/__tests__/services/payment.service.test.ts:84:7
     82|       };
     83| 
     84|       await expect(
       |       ^
     85|         PaymentService.createPaymentIntent(invalidInput),
     86|       ).rejects.toThrow("Amount must be positive");

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[7/36]Î“Ã„Â»

 FAIL  src/__tests__/services/payment.service.test.ts > PaymentService - Divine Payment Orchestration > createPaymentIntent - Manifest Payment Reality > enforces minimum payment threshold
AssertionError: expected [Function] to throw error including 'Amount below minimum' but got '\nInvalid `prisma.order.update()` invÎ“Ã‡Âª'

- Expected
+ Received

- Amount below minimum
+
+ Invalid `prisma.order.update()` invocation:
+
+ {
+   where: {
+     id: {
+       orderId: "order-small",
+       amount: 25,
+       currency: "USD",
+       provider: "STRIPE"
+     }
+   },
+   data: {
+     paymentIntentId: "pi_1762668301711",
+     ~~~~~~~~~~~~~~~
+ ?   id?: String | StringFieldUpdateOperationsInput,
+ ?   orderNumber?: String | StringFieldUpdateOperationsInput,
+ ?   status?: OrderStatus | EnumOrderStatusFieldUpdateOperationsInput,
+ ?   paymentStatus?: PaymentStatus | EnumPaymentStatusFieldUpdateOperationsInput,
+ ?   subtotal?: Decimal | DecimalFieldUpdateOperationsInput,
+ ?   deliveryFee?: Decimal | DecimalFieldUpdateOperationsInput,
+ ?   platformFee?: Decimal | DecimalFieldUpdateOperationsInput,
+ ?   tax?: Decimal | DecimalFieldUpdateOperationsInput,
+ ?   discount?: Decimal | DecimalFieldUpdateOperationsInput,
+ ?   total?: Decimal | DecimalFieldUpdateOperationsInput,
+ ?   farmerAmount?: Decimal | DecimalFieldUpdateOperationsInput,
+ ?   fulfillmentMethod?: FulfillmentMethod | EnumFulfillmentMethodFieldUpdateOperationsInput,
+ ?   scheduledDate?: DateTime | NullableDateTimeFieldUpdateOperationsInput | Null,
+ ?   scheduledTimeSlot?: String | NullableStringFieldUpdateOperationsInput | Null,
+ ?   fulfillmentNotes?: String | NullableStringFieldUpdateOperationsInput | Null,
+ ?   stripePaymentIntentId?: String | NullableStringFieldUpdateOperationsInput | Null,
+ ?   stripeChargeId?: String | NullableStringFieldUpdateOperationsInput | Null,
+ ?   stripeTransferId?: String | NullableStringFieldUpdateOperationsInput | Null,
+ ?   paidAt?: DateTime | NullableDateTimeFieldUpdateOperationsInput | Null,
+ ?   trackingNumber?: String | NullableStringFieldUpdateOperationsInput | Null,
+ ?   shippingAddress?: NullableJsonNullValueInput | Json,
+ ?   deliverySlotId?: String | NullableStringFieldUpdateOperationsInput | Null,
+ ?   specialInstructions?: String | NullableStringFieldUpdateOperationsInput | Null,
+ ?   createdAt?: DateTime | DateTimeFieldUpdateOperationsInput,
+ ?   updatedAt?: DateTime | DateTimeFieldUpdateOperationsInput,
+ ?   confirmedAt?: DateTime | NullableDateTimeFieldUpdateOperationsInput | Null,
+ ?   fulfilledAt?: DateTime | NullableDateTimeFieldUpdateOperationsInput | Null,
+ ?   completedAt?: DateTime | NullableDateTimeFieldUpdateOperationsInput | Null,
+ ?   cancelledAt?: DateTime | NullableDateTimeFieldUpdateOperationsInput | Null,
+ ?   cancelledBy?: String | NullableStringFieldUpdateOperationsInput | Null,
+ ?   cancelReason?: String | NullableStringFieldUpdateOperationsInput | Null,
+ ?   customer?: UserUpdateOneRequiredWithoutOrdersNestedInput,
+ ?   farm?: FarmUpdateOneRequiredWithoutOrdersNestedInput,
+ ?   deliveryAddress?: UserAddressUpdateOneWithoutOrdersNestedInput,
+ ?   items?: OrderItemUpdateManyWithoutOrderNestedInput,
+ ?   fulfillment?: FulfillmentUpdateOneWithoutOrderNestedInput,
+ ?   refunds?: RefundUpdateManyWithoutOrderNestedInput,
+ ?   qualityIssues?: QualityIssueUpdateManyWithoutOrderNestedInput,
+ ?   reviews?: ReviewUpdateManyWithoutOrderNestedInput,
+ ?   messages?: MessageUpdateManyWithoutOrderNestedInput,
+ ?   Payment?: PaymentUpdateOneWithoutOrderNestedInput
+   }
+ }
+
+ Unknown argument `paymentIntentId`. Available options are marked with ?.

 Î“Â¥Â» src/__tests__/services/payment.service.test.ts:97:7
     95|       };
     96| 
     97|       await expect(
       |       ^
     98|         PaymentService.createPaymentIntent(tooSmallInput),
     99|       ).rejects.toThrow("Amount below minimum");

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[8/36]Î“Ã„Â»

 FAIL  src/__tests__/services/payment.service.test.ts > PaymentService - Divine Payment Orchestration > confirmPayment - Collapse Payment Quantum State > confirms Stripe payment with temporal tracking
Error: Cannot find module '@/lib/payment/stripe'
Require stack:
- M:\Repo\Farmers Market Platform web and app\src\__tests__\services\payment.service.test.ts
 Î“Â¥Â» src/__tests__/services/payment.service.test.ts:116:17
    114|       };
    115| 
    116|       vi.mocked(require("@/lib/payment/stripe").stripeClient).mockRetuÎ“Ã‡Âª
       |                 ^
    117|         mockStripe,
    118|       );

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[9/36]Î“Ã„Â»

 FAIL  src/__tests__/services/payment.service.test.ts > PaymentService - Divine Payment Orchestration > confirmPayment - Collapse Payment Quantum State > handles PayPal payment capture with agricultural precision
Error: Cannot find module '@/lib/payment/paypal'
Require stack:
- M:\Repo\Farmers Market Platform web and app\src\__tests__\services\payment.service.test.ts
 Î“Â¥Â» src/__tests__/services/payment.service.test.ts:152:17
    150|       };
    151| 
    152|       vi.mocked(require("@/lib/payment/paypal").paypalClient).mockRetuÎ“Ã‡Âª
       |                 ^
    153|         mockPayPal,
    154|       );

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[10/36]Î“Ã„Â»

 FAIL  src/__tests__/services/payment.service.test.ts > PaymentService - Divine Payment Orchestration > confirmPayment - Collapse Payment Quantum State > handles payment failures with enlightening errors
Error: Cannot find module '@/lib/payment/stripe'
Require stack:
- M:\Repo\Farmers Market Platform web and app\src\__tests__\services\payment.service.test.ts
 Î“Â¥Â» src/__tests__/services/payment.service.test.ts:176:17
    174|       };
    175| 
    176|       vi.mocked(require("@/lib/payment/stripe").stripeClient).mockRetuÎ“Ã‡Âª
       |                 ^
    177|         mockStripe,
    178|       );

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[11/36]Î“Ã„Â»

 FAIL  src/__tests__/services/payment.service.test.ts > PaymentService - Divine Payment Orchestration > refundPayment - Reverse Payment Reality > processes full refund with quantum reversal
Error: Cannot find module '@/lib/payment/stripe'
Require stack:
- M:\Repo\Farmers Market Platform web and app\src\__tests__\services\payment.service.test.ts
 Î“Â¥Â» src/__tests__/services/payment.service.test.ts:199:17
    197|       };
    198| 
    199|       vi.mocked(require("@/lib/payment/stripe").stripeClient).mockRetuÎ“Ã‡Âª
       |                 ^
    200|         mockStripe,
    201|       );

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[12/36]Î“Ã„Â»

 FAIL  src/__tests__/services/payment.service.test.ts > PaymentService - Divine Payment Orchestration > refundPayment - Reverse Payment Reality > processes partial refund with divine precision
Error: Cannot find module '@/lib/payment/stripe'
Require stack:
- M:\Repo\Farmers Market Platform web and app\src\__tests__\services\payment.service.test.ts
 Î“Â¥Â» src/__tests__/services/payment.service.test.ts:237:17
    235|       };
    236| 
    237|       vi.mocked(require("@/lib/payment/stripe").stripeClient).mockRetuÎ“Ã‡Âª
       |                 ^
    238|         mockStripe,
    239|       );

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[13/36]Î“Ã„Â»

 FAIL  src/__tests__/services/payment.service.test.ts > PaymentService - Divine Payment Orchestration > refundPayment - Reverse Payment Reality > validates refund amount does not exceed original
AssertionError: expected [Function] to throw error including 'Refund amount exceeds payment' but got '\nInvalid `prisma.order.findUnique()`Î“Ã‡Âª'

- Expected
+ Received

- Refund amount exceeds payment
+
+ Invalid `prisma.order.findUnique()` invocation:
+
+ {
+   where: {
+     id: {
+       paymentId: "payment-1",
+       amount: 6000,
+       reason: "Over-refund attempt"
+     }
+     ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
+   }
+ }
+
+ Argument `id`: Invalid value provided. Expected String, provided Object.

 Î“Â¥Â» src/__tests__/services/payment.service.test.ts:256:7
    254|       });
    255| 
    256|       await expect(
       |       ^
    257|         PaymentService.refundPayment({
    258|           paymentId: "payment-1",

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[14/36]Î“Ã„Â»

 FAIL  src/__tests__/services/payment.service.test.ts > PaymentService - Divine Payment Orchestration > getPaymentHistory - Retrieve Payment Consciousness > retrieves user payment history with temporal ordering
TypeError: __vi_import_1__.PaymentService.getPaymentHistory is not a function
 Î“Â¥Â» src/__tests__/services/payment.service.test.ts:289:43
    287|         .mockResolvedValue(mockPayments);
    288| 
    289|       const result = await PaymentService.getPaymentHistory("user-123"Î“Ã‡Âª
       |                                           ^
    290|         limit: 10,
    291|         offset: 0,

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[15/36]Î“Ã„Â»

 FAIL  src/__tests__/services/payment.service.test.ts > PaymentService - Divine Payment Orchestration > getPaymentHistory - Retrieve Payment Consciousness > filters by payment status with divine clarity
TypeError: __vi_import_1__.PaymentService.getPaymentHistory is not a function
 Î“Â¥Â» src/__tests__/services/payment.service.test.ts:304:28
    302|       (database.payment.findMany as any) = vi.fn().mockResolvedValue([Î“Ã‡Âª
    303| 
    304|       await PaymentService.getPaymentHistory("user-123", {
       |                            ^
    305|         status: "FAILED",
    306|         limit: 20,

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[16/36]Î“Ã„Â»

 FAIL  src/__tests__/services/payment.service.test.ts > PaymentService - Divine Payment Orchestration > Webhook Processing - Event Reality Manifestation > processes Stripe webhook with signature verification
Error: Cannot find module '@/lib/payment/stripe'
Require stack:
- M:\Repo\Farmers Market Platform web and app\src\__tests__\services\payment.service.test.ts
 Î“Â¥Â» src/__tests__/services/payment.service.test.ts:338:17
    336|       };
    337| 
    338|       vi.mocked(require("@/lib/payment/stripe").stripeClient).mockRetuÎ“Ã‡Âª
       |                 ^
    339|         mockStripe,
    340|       );

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[17/36]Î“Ã„Â»

 FAIL  src/__tests__/services/payment.service.test.ts > PaymentService - Divine Payment Orchestration > Webhook Processing - Event Reality Manifestation > handles refund webhook events with quantum precision
Error: Cannot find module '@/lib/payment/stripe'
Require stack:
- M:\Repo\Farmers Market Platform web and app\src\__tests__\services\payment.service.test.ts
 Î“Â¥Â» src/__tests__/services/payment.service.test.ts:378:17
    376|       };
    377| 
    378|       vi.mocked(require("@/lib/payment/stripe").stripeClient).mockRetuÎ“Ã‡Âª
       |                 ^
    379|         mockStripe,
    380|       );

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[18/36]Î“Ã„Â»

 FAIL  src/__tests__/services/payment.service.test.ts > PaymentService - Divine Payment Orchestration > Webhook Processing - Event Reality Manifestation > rejects invalid webhook signatures
Error: Cannot find module '@/lib/payment/stripe'
Require stack:
- M:\Repo\Farmers Market Platform web and app\src\__tests__\services\payment.service.test.ts
 Î“Â¥Â» src/__tests__/services/payment.service.test.ts:398:17
    396|       };
    397| 
    398|       vi.mocked(require("@/lib/payment/stripe").stripeClient).mockRetuÎ“Ã‡Âª
       |                 ^
    399|         mockStripe,
    400|       );

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[19/36]Î“Ã„Â»

 FAIL  src/__tests__/services/payment.service.test.ts > PaymentService - Divine Payment Orchestration > Agricultural Payment Patterns - Farm-Specific Logic > applies farm-to-table payment consciousness
Error: Cannot find module '@/lib/payment/stripe'
Require stack:
- M:\Repo\Farmers Market Platform web and app\src\__tests__\services\payment.service.test.ts
 Î“Â¥Â» src/__tests__/services/payment.service.test.ts:436:17
    434|       };
    435| 
    436|       vi.mocked(require("@/lib/payment/stripe").stripeClient).mockRetuÎ“Ã‡Âª
       |                 ^
    437|         mockStripe,
    438|       );

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[20/36]Î“Ã„Â»

 FAIL  src/lib/services/security/__tests__/security.service.test.ts > SecurityService > Rate Limiting > should allow requests within rate limit
TypeError: securityService.checkRateLimit is not a function
 Î“Â¥Â» src/lib/services/security/__tests__/security.service.test.ts:46:38
     44|     it("should allow requests within rate limit", () => {
     45|       const identifier = "test-client";
     46|       const result = securityService.checkRateLimit("api", identifier);
       |                                      ^
     47|       expect(result).toBe(true);
     48|     });

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[21/36]Î“Ã„Â»

 FAIL  src/lib/services/security/__tests__/security.service.test.ts > SecurityService > Rate Limiting > should block requests exceeding rate limit
TypeError: securityService.checkRateLimit is not a function
 Î“Â¥Â» src/lib/services/security/__tests__/security.service.test.ts:54:25
     52|       // Make max requests
     53|       for (let i = 0; i < 100; i++) {
     54|         securityService.checkRateLimit("api", identifier);
       |                         ^
     55|       }
     56|       // Next request should be blocked

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[22/36]Î“Ã„Â»

 FAIL  src/lib/services/security/__tests__/security.service.test.ts > SecurityService > Rate Limiting > should reset rate limit after window expires
TypeError: securityService.checkRateLimit is not a function
 Î“Â¥Â» src/lib/services/security/__tests__/security.service.test.ts:68:25
     66|       // Make max requests
     67|       for (let i = 0; i < 100; i++) {
     68|         securityService.checkRateLimit("api", identifier);
       |                         ^
     69|       }
     70| 

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[23/36]Î“Ã„Â»

 FAIL  src/lib/services/security/__tests__/security.service.test.ts > SecurityService > Security Headers > should return all required security headers
TypeError: securityService.getSecurityHeaders is not a function
 Î“Â¥Â» src/lib/services/security/__tests__/security.service.test.ts:85:39
     83|   describe("Security Headers", () => {
     84|     it("should return all required security headers", () => {
     85|       const headers = securityService.getSecurityHeaders();
       |                                       ^
     86|       expect(headers).toHaveProperty("Content-Security-Policy");
     87|       expect(headers).toHaveProperty("X-Content-Type-Options");

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[24/36]Î“Ã„Â»

 FAIL  src/lib/services/security/__tests__/security.service.test.ts > SecurityService > Security Headers > should have strict CSP header
TypeError: securityService.getSecurityHeaders is not a function
 Î“Â¥Â» src/lib/services/security/__tests__/security.service.test.ts:94:39
     92| 
     93|     it("should have strict CSP header", () => {
     94|       const headers = securityService.getSecurityHeaders();
       |                                       ^
     95|       expect(headers["Content-Security-Policy"]).toContain(
     96|         "default-src 'self'"

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[25/36]Î“Ã„Â»

 FAIL  src/lib/services/security/__tests__/security.service.test.ts > SecurityService > Bot Detection > should detect known bot user agents
TypeError: this.isBot is not a function
 Î“Â¥Â» TestSecurityService.testIsBot src/lib/services/security/__tests__/security.service.test.ts:23:17
     21| class TestSecurityService extends SecurityService {
     22|   public testIsBot(request: NextRequest): boolean {
     23|     return this.isBot(request);
       |                 ^
     24|   }
     25| 
 Î“Â¥Â» src/lib/services/security/__tests__/security.service.test.ts:108:37

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[26/36]Î“Ã„Â»

 FAIL  src/lib/services/security/__tests__/security.service.test.ts > SecurityService > Bot Detection > should not flag regular browsers as bots
TypeError: this.isBot is not a function
 Î“Â¥Â» TestSecurityService.testIsBot src/lib/services/security/__tests__/security.service.test.ts:23:17
     21| class TestSecurityService extends SecurityService {
     22|   public testIsBot(request: NextRequest): boolean {
     23|     return this.isBot(request);
       |                 ^
     24|   }
     25| 
 Î“Â¥Â» src/lib/services/security/__tests__/security.service.test.ts:122:37

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[27/36]Î“Ã„Â»

 FAIL  src/lib/services/security/__tests__/security.service.test.ts > SecurityService > CSRF Protection > should validate matching CSRF tokens
TypeError: this.validateCSRFToken is not a function
 Î“Â¥Â» TestSecurityService.testValidateCSRFToken src/lib/services/security/__tests__/security.service.test.ts:27:17
     25| 
     26|   public testValidateCSRFToken(request: NextRequest): boolean {
     27|     return this.validateCSRFToken(request);
       |                 ^
     28|   }
     29| 
 Î“Â¥Â» src/lib/services/security/__tests__/security.service.test.ts:134:39

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[28/36]Î“Ã„Â»

 FAIL  src/lib/services/security/__tests__/security.service.test.ts > SecurityService > CSRF Protection > should reject mismatched CSRF tokens
TypeError: this.validateCSRFToken is not a function
 Î“Â¥Â» TestSecurityService.testValidateCSRFToken src/lib/services/security/__tests__/security.service.test.ts:27:17
     25| 
     26|   public testValidateCSRFToken(request: NextRequest): boolean {
     27|     return this.validateCSRFToken(request);
       |                 ^
     28|   }
     29| 
 Î“Â¥Â» src/lib/services/security/__tests__/security.service.test.ts:144:39

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[29/36]Î“Ã„Â»

 FAIL  src/lib/services/security/__tests__/security.service.test.ts > SecurityService > Origin Validation > should allow valid origins
TypeError: this.isValidOrigin is not a function
 Î“Â¥Â» TestSecurityService.testIsValidOrigin src/lib/services/security/__tests__/security.service.test.ts:31:17
     29| 
     30|   public testIsValidOrigin(request: NextRequest): boolean {
     31|     return this.isValidOrigin(request);
       |                 ^
     32|   }
     33| }
 Î“Â¥Â» src/lib/services/security/__tests__/security.service.test.ts:158:39

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[30/36]Î“Ã„Â»

 FAIL  src/lib/services/security/__tests__/security.service.test.ts > SecurityService > Origin Validation > should reject invalid origins
TypeError: this.isValidOrigin is not a function
 Î“Â¥Â» TestSecurityService.testIsValidOrigin src/lib/services/security/__tests__/security.service.test.ts:31:17
     29| 
     30|   public testIsValidOrigin(request: NextRequest): boolean {
     31|     return this.isValidOrigin(request);
       |                 ^
     32|   }
     33| }
 Î“Â¥Â» src/lib/services/security/__tests__/security.service.test.ts:170:39

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[31/36]Î“Ã„Â»

 FAIL  src/lib/services/security/__tests__/security.service.test.ts > SecurityService > Middleware Integration > should apply security headers to response
TypeError: securityService.middleware is not a function
 Î“Â¥Â» src/lib/services/security/__tests__/security.service.test.ts:183:46
    181|       } as unknown as NextRequest;
    182| 
    183|       const response = await securityService.middleware(request);
       |                                              ^
    184|       expect(response?.headers).toBeDefined();
    185|       expect(response?.headers.get("Content-Security-Policy")).toBeDefÎ“Ã‡Âª

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[32/36]Î“Ã„Â»

 FAIL  src/lib/services/security/__tests__/security.service.test.ts > SecurityService > Middleware Integration > should block rate-limited requests
TypeError: securityService.middleware is not a function
 Î“Â¥Â» src/lib/services/security/__tests__/security.service.test.ts:197:31
    195|       // Make max requests
    196|       for (let i = 0; i < 100; i++) {
    197|         await securityService.middleware(request);
       |                               ^
    198|       }
    199| 

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[33/36]Î“Ã„Â»

 FAIL  src/lib/services/security/__tests__/security.service.test.ts > SecurityService > Middleware Integration > should allow static assets
TypeError: securityService.middleware is not a function
 Î“Â¥Â» src/lib/services/security/__tests__/security.service.test.ts:211:46
    209|       } as unknown as NextRequest;
    210| 
    211|       const response = await securityService.middleware(request);
       |                                              ^
    212|       expect(response).toBeNull();
    213|     });

Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»Î“Ã„Â»[34/36]Î“Ã„Â»


[2m Test Files [22m [1m[31m8 failed[39m[22m[2m | [22m[1m[32m3 passed[39m[22m[2m | [22m[33m1 skipped[39m[90m (12)[39m
[2m      Tests [22m [1m[31m32 failed[39m[22m[2m | [22m[1m[32m83 passed[39m[22m[2m | [22m[33m15 skipped[39m[90m (130)[39m
[2m   Start at [22m 07:04:57
[2m   Duration [22m 5.82s[2m (transform 1.59s, setup 8.39s, collect 1.51s, tests 656ms, environment 21.23s, prepare 486ms)[22m

