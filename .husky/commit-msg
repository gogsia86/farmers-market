#!/usr/bin/env sh
. "$(dirname -- "$0")/_/husky.sh"

# üåæ FARMERS MARKET DIVINE COMMIT MESSAGE HOOK
# Validates commit message format

commit_msg_file=$1
commit_msg=$(cat "$commit_msg_file")

# Divine Commit Message Format:
# <type>(<scope>): <subject>
#
# Types: feat, fix, docs, style, refactor, perf, test, chore, ci, build
# Example: feat(farms): add farm verification workflow

# Color codes
RED='\033[0;31m'
GREEN='\033[0;32m'
YELLOW='\033[1;33m'
NC='\033[0m' # No Color

# Check if commit message follows conventional commits
if echo "$commit_msg" | grep -qE "^(feat|fix|docs|style|refactor|perf|test|chore|ci|build|revert)(\(.+\))?: .{3,}"; then
  echo "${GREEN}‚úÖ Commit message format is valid${NC}"
  exit 0
fi

# Check for merge commits
if echo "$commit_msg" | grep -qE "^Merge"; then
  echo "${GREEN}‚úÖ Merge commit detected${NC}"
  exit 0
fi

# Check for revert commits
if echo "$commit_msg" | grep -qE "^Revert"; then
  echo "${GREEN}‚úÖ Revert commit detected${NC}"
  exit 0
fi

# Invalid commit message
echo ""
echo "${RED}‚ùå Invalid commit message format!${NC}"
echo ""
echo "${YELLOW}üìã Divine Commit Message Format:${NC}"
echo "   <type>(<scope>): <subject>"
echo ""
echo "${YELLOW}üè∑Ô∏è  Valid Types:${NC}"
echo "   ${GREEN}feat${NC}     - New feature"
echo "   ${GREEN}fix${NC}      - Bug fix"
echo "   ${GREEN}docs${NC}     - Documentation changes"
echo "   ${GREEN}style${NC}    - Code style changes (formatting, etc.)"
echo "   ${GREEN}refactor${NC} - Code refactoring"
echo "   ${GREEN}perf${NC}     - Performance improvements"
echo "   ${GREEN}test${NC}     - Adding or updating tests"
echo "   ${GREEN}chore${NC}    - Maintenance tasks"
echo "   ${GREEN}ci${NC}       - CI/CD changes"
echo "   ${GREEN}build${NC}    - Build system changes"
echo ""
echo "${YELLOW}üìù Examples:${NC}"
echo "   ${GREEN}feat(farms): add farm verification workflow${NC}"
echo "   ${GREEN}fix(auth): resolve login redirect issue${NC}"
echo "   ${GREEN}docs(readme): update setup instructions${NC}"
echo "   ${GREEN}perf(database): optimize farm queries${NC}"
echo ""
echo "${YELLOW}Your commit message:${NC}"
echo "   ${RED}${commit_msg}${NC}"
echo ""
exit 1
